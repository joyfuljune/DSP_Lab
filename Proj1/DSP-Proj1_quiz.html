<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSP-Proj1 ç»ƒä¹ æµ‹éªŒ</title>
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [['$$','$$'], ['\\[','\\]']],
                processEscapes: true
            }
        });
    </script>

    <style>
        .mathjax-status {
            position: fixed;
            top: 10px;
            right: 15px;
            padding: 8px 15px;
            border-radius: 5px;
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            font-size: 14px;
            z-index: 10000;
            font-family: 'Microsoft YaHei', sans-serif;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .mathjax-status.loading {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }
        .mathjax-status.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
            transition: opacity 0.5s ease-out 1.5s;
            opacity: 0;
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimSun', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.25);
            padding: 40px;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }

        h2 {
            color: #667eea;
            margin: 25px 0 15px 0;
        }

        .login-section, .quiz-section, .result-section {
            display: none;
        }

        .login-section.active, .quiz-section.active, .result-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 8px;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #9f7aea;
            border-radius: 8px;
            font-size: 16px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .question-box {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 25px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .question-title {
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .options {
            margin: 15px 0;
        }

        .option {
            display: block;
            background: white;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            background: #f0f4ff;
            border-color: #667eea;
        }

        .option.selected {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        .option.correct {
            background: #48bb78;
            color: white;
            border-color: #38a169;
        }

        .option.incorrect {
            background: #f56565;
            color: white;
            border-color: #e53e3e;
        }

        .feedback {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #48bb78;
            border-left: 5px solid #48bb78;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #f56565;
            border-left: 5px solid #f56565;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #667eea 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .stats-table th, .stats-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        .stats-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stats-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .mastery-excellent {
            color: #48bb78;
            font-weight: bold;
        }

        .mastery-good {
            color: #667eea;
            font-weight: bold;
        }

        .mastery-fair {
            color: #ed8936;
            font-weight: bold;
        }

        .mastery-poor {
            color: #f56565;
            font-weight: bold;
        }

        .info-box {
            background: #fff8e1;
            border-left: 5px solid #ed8936;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-option:hover {
            background: #f0f4ff;
            border-color: #667eea;
        }

        .checkbox-option.correct {
            background: #48bb78;
            color: white;
            border-color: #38a169;
        }

        .checkbox-option.incorrect {
            background: #f56565;
            color: white;
            border-color: #e53e3e;
        }
    </style>
</head>
<body>
    <div id="mathjaxStatus" class="mathjax-status loading">æ­£åœ¨åŠ è½½æ•°å­¦å…¬å¼...</div>
    
    <div class="container">
        <!-- ç™»å½•ç•Œé¢ -->
        <div class="login-section active">
            <h1>ğŸ“ DSP-Proj1 ç»ƒä¹ æµ‹éªŒ</h1>
            <div class="info-box">
                <strong>ğŸ“Œ æµ‹éªŒè¯´æ˜</strong>
                <p>æœ¬ç³»ç»Ÿå°†æµ‹è¯•æ‚¨å¯¹ã€ŠåŸºäºDCTåŸç†çš„éŸ³é¢‘å‹ç¼©å®éªŒã€‹çš„æŒæ¡ç¨‹åº¦ã€‚æ¯ä¸ªçŸ¥è¯†ç‚¹å°†éšæœºå‡ºé¢˜,ç­”å¯¹åè¿›å…¥ä¸‹ä¸€çŸ¥è¯†ç‚¹,ç­”é”™å°†ç»§ç»­è¯¥çŸ¥è¯†ç‚¹çš„å…¶ä»–é¢˜ç›®ã€‚æ¶µç›–7å¤§æ ¸å¿ƒçŸ¥è¯†ç‚¹,å…±70+é“éšæœºé¢˜ç›®ã€‚</p>
            </div>
            
            <div class="form-group">
                <label>å­¦å·:</label>
                <input type="text" id="studentId" placeholder="è¯·è¾“å…¥å­¦å·">
            </div>
            
            <div class="form-group">
                <label>å§“å:</label>
                <input type="text" id="studentName" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            
            <button id="startQuizBtn">å¼€å§‹æµ‹éªŒ</button>
        </div>

        <!-- æµ‹éªŒç•Œé¢ -->
        <div class="quiz-section">
            <h1>DSP-Proj1 ç»ƒä¹ æµ‹éªŒ</h1>
            <div id="studentInfo"></div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar">0%</div>
            </div>
            
            <div id="currentTopic"></div>
            
            <div class="question-box">
                <div class="question-title" id="questionTitle"></div>
                <div id="questionContent"></div>
                <div id="options" class="options"></div>
                <div id="feedback"></div>
                <button id="submitBtn">æäº¤ç­”æ¡ˆ</button>
                <button id="nextBtn" style="display:none;">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <!-- ç»“æœç•Œé¢ -->
        <div class="result-section">
            <h1>ğŸ“Š æµ‹éªŒç»“æœæŠ¥å‘Š</h1>
            <div id="finalReport"></div>
            <button id="saveBtn">æˆªå›¾ä¿å­˜</button>
        </div>
    </div>

    <script>
        // ==================== æ•°æ®ç»“æ„ ====================
        let studentData = {
            id: '',
            name: '',
            topicStats: {},
            currentTopicIndex: 0,
            currentQuestionIndex: 0,
            usedQuestions: {}
        };

        // çŸ¥è¯†ç‚¹å®šä¹‰
        const topics = [
            {
                name: 'DCTåŸºæœ¬æ¦‚å¿µ',
                id: 'dct_basics',
                description: 'DCTå˜æ¢çš„å®šä¹‰ã€æ€§è´¨å’Œä¸DFTçš„å…³ç³»'
            },
            {
                name: 'ä¿¡å·åˆ†æ®µå¤„ç†',
                id: 'windowing',
                description: 'éŸ³é¢‘ä¿¡å·åˆ†æ®µçš„åŸç†å’Œå®ç°æ–¹æ³•'
            },
            {
                name: 'èƒ½é‡é˜ˆå€¼å¤„ç†',
                id: 'energy_threshold',
                description: 'åŸºäºèƒ½é‡çš„ç³»æ•°ä¿ç•™ç­–ç•¥'
            },
            {
                name: 'é‡åŒ–ä¸è§£é‡åŒ–',
                id: 'quantization',
                description: 'å‡åŒ€é‡åŒ–åŸç†å’Œä¸åŒä½æ•°çš„å½±å“'
            },
            {
                name: 'å‡æ–¹è¯¯å·®è¯„ä¼°',
                id: 'mse',
                description: 'MSEå’ŒSNRçš„è®¡ç®—ä¸åº”ç”¨'
            },
            {
                name: 'å‹ç¼©æ¯”è®¡ç®—',
                id: 'compression',
                description: 'å‹ç¼©æ¯”ã€å‹ç¼©ç‡çš„å®šä¹‰å’Œæƒè¡¡'
            },
            {
                name: 'å®Œæ•´å‹ç¼©æµç¨‹',
                id: 'workflow',
                description: '7æ­¥å‹ç¼©æµç¨‹çš„ç†è§£å’ŒMATLABå®ç°'
            }
        ];

        // ==================== å·¥å…·å‡½æ•° ====================
        
        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function randChoice(arr) {
            return arr[randInt(0, arr.length - 1)];
        }

        // ğŸ”¥ å•é€‰é¢˜é€‰é¡¹æ‰“ä¹±å‡½æ•°
        function shuffleOptionsWithAnswer(options, correctIndex) {
            const indices = options.map((_, i) => i);
            // Fisher-Yates æ´—ç‰Œç®—æ³•
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            
            return {
                options: indices.map(i => options[i]),
                correct: indices.indexOf(correctIndex)
            };
        }

        // ğŸ”¥ å¤šé€‰é¢˜é€‰é¡¹æ‰“ä¹±å‡½æ•°
        function shuffleOptionsWithAnswers(options, correctIndices) {
            const indices = options.map((_, i) => i);
            // Fisher-Yates æ´—ç‰Œç®—æ³•
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            
            return {
                options: indices.map(i => options[i]),
                correct: correctIndices.map(ci => indices.indexOf(ci)).sort((a, b) => a - b)
            };
        }

        // ==================== é¢˜ç›®ç”Ÿæˆå‡½æ•° ====================
        
        const questionGenerators = {
            dct_basics: [
                // DCTé¢˜ç›®1: DCTä¸DFTçš„åŒºåˆ«
                () => {
                    return {
                        type: 'single',
                        question: `DCTç›¸æ¯”DFTçš„ä¸»è¦ä¼˜åŠ¿æ˜¯ä»€ä¹ˆ?`,
                        options: [
                            'DCTä½¿ç”¨å®æ•°è¿ç®—,èƒ½é‡æ›´é›†ä¸­åœ¨ä½é¢‘éƒ¨åˆ†',
                            'DCTè®¡ç®—é€Ÿåº¦æ¯”FFTæ›´å¿«',
                            'DCTå¯ä»¥å¤„ç†æ— é™é•¿ä¿¡å·',
                            'DCTçš„é¢‘è°±æ˜¯ç¦»æ•£çš„'
                        ],
                        correct: 0,
                        explanation: 'DCTä½¿ç”¨ä½™å¼¦å‡½æ•°ä½œä¸ºåŸºå‡½æ•°,å…¨éƒ¨æ˜¯å®æ•°è¿ç®—,å¹¶ä¸”å¯¹äºå¹³æ»‘ä¿¡å·èƒ½å°†èƒ½é‡é›†ä¸­åœ¨ä½é¢‘ç³»æ•°,è¿™æ­£æ˜¯å‹ç¼©æ‰€éœ€è¦çš„ç‰¹æ€§ã€‚'
                    };
                },
                
                // DCTé¢˜ç›®2: DCTåŸºå‡½æ•°
                () => {
                    const m = randInt(0, 3);
                    return {
                        type: 'single',
                        question: `DCTçš„åŸºå‡½æ•°æ˜¯ $\\cos\\left(\\frac{\\pi m (n + 0.5)}{N}\\right)$,å½“ $m=${m}$ æ—¶å¯¹åº”:`,
                        options: [
                            m === 0 ? 'DCåˆ†é‡(ç›´æµ)' : (m === 1 ? 'æœ€ä½é¢‘ç‡' : 'è¾ƒé«˜é¢‘ç‡'),
                            m === 0 ? 'æœ€é«˜é¢‘ç‡' : 'DCåˆ†é‡',
                            'éšæœºé¢‘ç‡',
                            'è´Ÿé¢‘ç‡'
                        ],
                        correct: 0,
                        explanation: `m=${m}æ—¶,${m === 0 ? 'm=0å¯¹åº”DCåˆ†é‡(å¸¸æ•°)' : m === 1 ? 'm=1å¯¹åº”æœ€ä½é¢‘ç‡' : 'må€¼è¶Šå¤§é¢‘ç‡è¶Šé«˜'}ã€‚DCTå°†ä¿¡å·åˆ†è§£ä¸ºä¸åŒé¢‘ç‡çš„ä½™å¼¦æ³¢ç»„åˆã€‚`
                    };
                },
                
                // DCTé¢˜ç›®3: èƒ½é‡é›†ä¸­ç‰¹æ€§
                () => {
                    const percent = randChoice([90, 95, 99]);
                    return {
                        type: 'single',
                        question: `å¯¹äºå¤§å¤šæ•°éŸ³é¢‘ä¿¡å·,ç»è¿‡DCTå˜æ¢å,è¶…è¿‡${percent}%çš„èƒ½é‡é€šå¸¸é›†ä¸­åœ¨:`,
                        options: [
                            'å‰10%çš„ä½é¢‘ç³»æ•°ä¸­',
                            'å‡åŒ€åˆ†å¸ƒåœ¨æ‰€æœ‰ç³»æ•°ä¸­',
                            'å10%çš„é«˜é¢‘ç³»æ•°ä¸­',
                            'ä¸­é¢‘ç³»æ•°ä¸­'
                        ],
                        correct: 0,
                        explanation: `DCTçš„èƒ½é‡é›†ä¸­ç‰¹æ€§æ˜¯å‹ç¼©çš„åŸºç¡€:å¤§éƒ¨åˆ†èƒ½é‡é›†ä¸­åœ¨ä½é¢‘ç³»æ•°,é«˜é¢‘ç³»æ•°é€šå¸¸å¾ˆå°å¯ä»¥ä¸¢å¼ƒæˆ–ç²—ç•¥é‡åŒ–ã€‚`
                    };
                },
                
                // DCTé¢˜ç›®4: æ­£äº¤æ€§
                () => {
                    return {
                        type: 'single',
                        question: `DCTå˜æ¢å…·æœ‰æ­£äº¤æ€§,è¿™æ„å‘³ç€:`,
                        options: [
                            'æ—¶åŸŸèƒ½é‡ç­‰äºé¢‘åŸŸèƒ½é‡(Parsevalå®šç†)',
                            'æ‰€æœ‰ç³»æ•°éƒ½ç›¸ç­‰',
                            'å˜æ¢ä¸å¯é€†',
                            'åªèƒ½ç”¨äºå‘¨æœŸä¿¡å·'
                        ],
                        correct: 0,
                        explanation: 'DCTæ˜¯æ­£äº¤å˜æ¢,æ»¡è¶³èƒ½é‡å®ˆæ’å®šç†,å³ $\\sum x[n]^2 = \\sum X[m]^2$,è¿™ä¿è¯äº†ä¿¡æ¯çš„å®Œæ•´æ€§ã€‚'
                    };
                },
                
                // DCTé¢˜ç›®5: MATLABå®ç°
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­,å¯¹ä¿¡å·xè¿›è¡ŒDCTå˜æ¢çš„æ­£ç¡®å‘½ä»¤æ˜¯:`,
                        options: [
                            'X = dct(x)',
                            'X = fft(x)',
                            'X = dft(x)',
                            'X = transform(x)'
                        ],
                        correct: 0,
                        explanation: 'MATLABæä¾›äº†å†…ç½®çš„dct()å‡½æ•°è¿›è¡ŒDCTå˜æ¢,idct()è¿›è¡Œé€†å˜æ¢ã€‚'
                    };
                },
                
                // DCTé¢˜ç›®6: ç³»æ•°å½’ä¸€åŒ–
                () => {
                    return {
                        type: 'single',
                        question: `DCTå…¬å¼ä¸­,m=0æ—¶çš„å½’ä¸€åŒ–ç³»æ•° $c[0]$ ä¸º:`,
                        options: [
                            '$\\frac{1}{\\sqrt{2}}$',
                            '$1$',
                            '$\\sqrt{2}$',
                            '$0$'
                        ],
                        correct: 0,
                        explanation: 'DCT-IIä¸­,m=0æ—¶ $c[0] = \\frac{1}{\\sqrt{2}}$,å…¶ä»–æƒ…å†µ $c[m] = 1$,è¿™ä¿è¯äº†å˜æ¢çš„æ­£äº¤æ€§ã€‚'
                    };
                },
                
                // DCTé¢˜ç›®7: å¤šé€‰é¢˜
                () => {
                    return {
                        type: 'multiple',
                        question: `DCTåœ¨éŸ³é¢‘å‹ç¼©ä¸­çš„ä¼˜åŠ¿åŒ…æ‹¬:(å¤šé€‰)`,
                        options: [
                            'å®æ•°è¿ç®—,æ— éœ€å¤„ç†å¤æ•°',
                            'èƒ½é‡é›†ä¸­åœ¨ä½é¢‘,ä¾¿äºå‹ç¼©',
                            'è¾¹ç•Œè¿ç»­æ€§å¥½,å‡å°‘è¾¹ç•Œæ•ˆåº”',
                            'å¯ä»¥è¡¨ç¤ºä»»æ„ä¿¡å·'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'DCTçš„ä¸‰å¤§ä¼˜åŠ¿:å®æ•°è¿ç®—ç®€åŒ–è®¡ç®—ã€èƒ½é‡é›†ä¸­ç‰¹æ€§é€‚åˆå‹ç¼©ã€éšå«çš„å¶å¯¹ç§°å»¶æ‹“å‡å°‘äº†è¾¹ç•Œä¸è¿ç»­ã€‚'
                    };
                },
                
                // DCTé¢˜ç›®8: DFTå¯¹æ¯”
                () => {
                    return {
                        type: 'single',
                        question: `å¯¹äºå®ä¿¡å·,DFTä¼šäº§ç”Ÿå…±è½­å¯¹ç§°çš„é¢‘è°±,è¿™æ„å‘³ç€æœ‰ä¸€åŠä¿¡æ¯æ˜¯å†—ä½™çš„ã€‚DCTå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜?`,
                        options: [
                            'DCTåªä½¿ç”¨ä½™å¼¦åŸºå‡½æ•°,ç›´æ¥äº§ç”Ÿå®æ•°é¢‘è°±',
                            'DCTå‹ç¼©æ‰å†—ä½™ä¿¡æ¯',
                            'DCTä½¿ç”¨æ›´å¤šçš„ç³»æ•°',
                            'DCTä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜'
                        ],
                        correct: 0,
                        explanation: 'DCTä½¿ç”¨ä½™å¼¦åŸºå‡½æ•°(å®å‡½æ•°),å¯¹å®ä¿¡å·äº§ç”Ÿå®æ•°é¢‘è°±,å¤©ç„¶é¿å…äº†DFTçš„å…±è½­å¯¹ç§°å†—ä½™ã€‚'
                    };
                }
            ],
            
            windowing: [
                // åˆ†æ®µé¢˜ç›®1: ä¸ºä»€ä¹ˆåˆ†æ®µ
                () => {
                    const N = randInt(10000, 50000);
                    return {
                        type: 'single',
                        question: `å¯¹ä¸€ä¸ªé•¿åº¦ä¸º${N}çš„éŸ³é¢‘ä¿¡å·ç›´æ¥åšDCT,ä¸»è¦é—®é¢˜æ˜¯:`,
                        options: [
                            'è®¡ç®—é‡å·¨å¤§,æ— æ³•é€‚åº”ä¿¡å·çš„å±€éƒ¨ç‰¹æ€§',
                            'ç»“æœä¸å‡†ç¡®',
                            'æ— æ³•å¾—åˆ°é¢‘è°±',
                            'ä¼šä¸¢å¤±ä¿¡æ¯'
                        ],
                        correct: 0,
                        explanation: 'é•¿ä¿¡å·ç›´æ¥DCTè®¡ç®—é‡ä¸ºO(NÂ²),ä¸”éŸ³é¢‘ä¿¡å·åœ¨ä¸åŒæ—¶é—´æ®µç‰¹æ€§ä¸åŒ,åˆ†æ®µå¯ä»¥é™ä½è®¡ç®—é‡å¹¶é€‚åº”å±€éƒ¨ç‰¹æ€§ã€‚'
                    };
                },
                
                // åˆ†æ®µé¢˜ç›®2: çª—å£å¤§å°é€‰æ‹©
                () => {
                    const options = [256, 512, 1024, 2048];
                    const W = randChoice(options);
                    return {
                        type: 'single',
                        question: `é€‰æ‹©çª—å£å¤§å°ä¸º${W}çš„ä¸»è¦è€ƒè™‘æ˜¯:`,
                        options: [
                            '2çš„å¹‚æ¬¡æ–¹ä¾¿äºFFTåŠ é€Ÿ,åŒæ—¶å¹³è¡¡æ—¶é¢‘åˆ†è¾¨ç‡',
                            'è¿™æ˜¯å›ºå®šå€¼ä¸èƒ½æ”¹å˜',
                            'çª—å£è¶Šå¤§å‹ç¼©æ•ˆæœè¶Šå¥½',
                            'çª—å£è¶Šå°éŸ³è´¨è¶Šå¥½'
                        ],
                        correct: 0,
                        explanation: `çª—å£å¤§å°é€šå¸¸é€‰æ‹©2çš„å¹‚æ¬¡æ–¹(å¦‚${W}),ä¾¿äºFFTåŠ é€Ÿã€‚çª—å£å¤§å°éœ€è¦æƒè¡¡:å¤ªå¤§æŸå¤±æ—¶é—´åˆ†è¾¨ç‡,å¤ªå°æŸå¤±é¢‘ç‡åˆ†è¾¨ç‡ã€‚`
                    };
                },
                
                // åˆ†æ®µé¢˜ç›®3: åˆ†æ®µå…¬å¼
                () => {
                    const N = randInt(5000, 10000);
                    const W = randChoice([256, 512]);
                    const segments = Math.floor(N / W);
                    return {
                        type: 'single',
                        question: `ä¿¡å·é•¿åº¦ä¸º${N},çª—å£å¤§å°ä¸º${W},å¯ä»¥åˆ†æˆå¤šå°‘æ®µ?`,
                        options: [
                            `${segments}æ®µ`,
                            `${segments + 1}æ®µ`,
                            `${Math.ceil(N / W)}æ®µ`,
                            `${N}æ®µ`
                        ],
                        correct: 0,
                        explanation: `æ®µæ•° = $\\lfloor \\frac{N}{W} \\rfloor = \\lfloor \\frac{${N}}{${W}} \\rfloor = ${segments}$æ®µã€‚`
                    };
                },
                
                // åˆ†æ®µé¢˜ç›®4: MATLABå®ç°
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­,ä»ä¿¡å·xä¸­æå–ç¬¬kæ®µ(çª—å£å¤§å°ä¸ºW)çš„ä»£ç æ˜¯:`,
                        options: [
                            'x_seg = x((k-1)*W+1 : k*W)',
                            'x_seg = x(k*W : (k+1)*W)',
                            'x_seg = x(k : k+W)',
                            'x_seg = x(1:W)'
                        ],
                        correct: 0,
                        explanation: 'MATLABç´¢å¼•ä»1å¼€å§‹,ç¬¬kæ®µ(k=1,2,...)åº”è¯¥æ˜¯ x((k-1)*W+1 : k*W)ã€‚'
                    };
                },
                
                // åˆ†æ®µé¢˜ç›®5: è¾¹ç•Œå¤„ç†
                () => {
                    const N = randInt(5000, 6000);
                    const W = 512;
                    const lastSegLen = N % W;
                    return {
                        type: 'single',
                        question: `ä¿¡å·é•¿åº¦${N},çª—å£${W},æœ€åä¸€æ®µé•¿åº¦ä¸è¶³,åº”è¯¥å¦‚ä½•å¤„ç†?`,
                        options: [
                            `è¡¥é›¶è‡³${W}ç‚¹`,
                            'ä¸¢å¼ƒæœ€åä¸€æ®µ',
                            'é‡å å‰ä¸€æ®µ',
                            'ä¸åšå¤„ç†'
                        ],
                        correct: 0,
                        explanation: `æœ€åä¸€æ®µé•¿åº¦ä¸º${lastSegLen},ä¸è¶³çª—å£å¤§å°æ—¶éœ€è¦è¡¥é›¶è‡³${W}ç‚¹,ç¡®ä¿æ¯æ®µé•¿åº¦ç›¸åŒã€‚`
                    };
                },
                
                // åˆ†æ®µé¢˜ç›®6: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: `ä¿¡å·åˆ†æ®µå¤„ç†çš„ä¼˜åŠ¿åŒ…æ‹¬:(å¤šé€‰)`,
                        options: [
                            'é™ä½è®¡ç®—å¤æ‚åº¦,ä¾¿äºå¹¶è¡Œå¤„ç†',
                            'é€‚åº”ä¿¡å·çš„å±€éƒ¨ç‰¹æ€§å˜åŒ–',
                            'æ”¯æŒæµå¼å®æ—¶å¤„ç†',
                            'å¢åŠ ä¿¡å·çš„é¢‘ç‡åˆ†é‡'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'åˆ†æ®µçš„ä¼˜åŠ¿:è®¡ç®—æ•ˆç‡é«˜ã€é€‚åº”å±€éƒ¨ç‰¹æ€§ã€æ”¯æŒå®æ—¶å¤„ç†,ä½†ä¸ä¼šæ”¹å˜ä¿¡å·æœ¬èº«çš„é¢‘ç‡åˆ†é‡ã€‚'
                    };
                }
            ],
            
            energy_threshold: [
                // èƒ½é‡é˜ˆå€¼é¢˜ç›®1: åŸºæœ¬åŸç†
                () => {
                    const perc = randChoice([95, 99, 99.5]);
                    return {
                        type: 'single',
                        question: `èƒ½é‡é˜ˆå€¼ä¸º${perc}%æ„å‘³ç€:`,
                        options: [
                            `ä¿ç•™èƒ½é‡æœ€å¤§çš„ç³»æ•°,ä½¿å…¶ç´¯è®¡èƒ½é‡è¾¾åˆ°æ€»èƒ½é‡çš„${perc}%`,
                            `ä¿ç•™${perc}%çš„ç³»æ•°`,
                            `ä¸¢å¼ƒ${perc}%çš„èƒ½é‡`,
                            `éšæœºä¿ç•™ç³»æ•°`
                        ],
                        correct: 0,
                        explanation: `èƒ½é‡é˜ˆå€¼${perc}%è¡¨ç¤ºä¿ç•™æœ€é‡è¦çš„ç³»æ•°,ä½¿å…¶èƒ½é‡ä¹‹å’Œ â‰¥ ${perc}% Ã— æ€»èƒ½é‡,å…¶ä½™ç³»æ•°ç½®é›¶ã€‚`
                    };
                },
                
                // èƒ½é‡é˜ˆå€¼é¢˜ç›®2: èƒ½é‡è®¡ç®—
                () => {
                    return {
                        type: 'single',
                        question: `DCTç³»æ•°X[m]çš„èƒ½é‡å®šä¹‰ä¸º:`,
                        options: [
                            '$X[m]^2$',
                            '$|X[m]|$',
                            '$\\sqrt{X[m]}$',
                            '$X[m]$'
                        ],
                        correct: 0,
                        explanation: 'èƒ½é‡å®šä¹‰ä¸ºå¹…å€¼çš„å¹³æ–¹:$E[m] = X[m]^2$,æ€»èƒ½é‡ä¸º $E_{total} = \\sum_{m=0}^{N-1} X[m]^2$ã€‚'
                    };
                },
                
                // èƒ½é‡é˜ˆå€¼é¢˜ç›®3: ç®—æ³•æ­¥éª¤
                () => {
                    return {
                        type: 'single',
                        question: `èƒ½é‡é˜ˆå€¼å¤„ç†çš„æ­£ç¡®æ­¥éª¤æ˜¯:`,
                        options: [
                            'è®¡ç®—æ€»èƒ½é‡â†’æŒ‰èƒ½é‡å¤§å°æ’åºâ†’ç´¯åŠ è‡³é˜ˆå€¼â†’ä¿ç•™å¯¹åº”ç³»æ•°',
                            'éšæœºé€‰æ‹©ç³»æ•°â†’è®¡ç®—èƒ½é‡â†’åˆ¤æ–­æ˜¯å¦è¶³å¤Ÿ',
                            'ç›´æ¥ä¸¢å¼ƒä¸€åŠç³»æ•°',
                            'åªä¿ç•™ä½é¢‘ç³»æ•°'
                        ],
                        correct: 0,
                        explanation: 'æ­£ç¡®æµç¨‹:1)è®¡ç®—æ¯ä¸ªç³»æ•°çš„èƒ½é‡ 2)æŒ‰èƒ½é‡é™åºæ’åº 3)ç´¯åŠ èƒ½é‡ç›´åˆ°è¾¾åˆ°é˜ˆå€¼ 4)ä¿ç•™è¿™äº›ç³»æ•°,å…¶ä½™ç½®é›¶ã€‚'
                    };
                },
                
                // èƒ½é‡é˜ˆå€¼é¢˜ç›®4: ä¿ç•™ç³»æ•°æ•°é‡
                () => {
                    const N = randChoice([256, 512, 1024]);
                    const perc = randChoice([95, 99]);
                    const kept = Math.floor(N * 0.1);
                    return {
                        type: 'single',
                        question: `å¯¹${N}ç‚¹DCT,èƒ½é‡é˜ˆå€¼${perc}%æ—¶,é€šå¸¸éœ€è¦ä¿ç•™çš„ç³»æ•°æ•°é‡çº¦ä¸º:`,
                        options: [
                            `10-20ä¸ªå·¦å³`,
                            `${N/2}ä¸ª`,
                            `${N}ä¸ª`,
                            `1ä¸ª`
                        ],
                        correct: 0,
                        explanation: `ç”±äºDCTçš„èƒ½é‡é›†ä¸­ç‰¹æ€§,é€šå¸¸åªéœ€ä¿ç•™5-10%çš„ç³»æ•°(çº¦10-50ä¸ª)å°±èƒ½è¾¾åˆ°95-99%çš„èƒ½é‡,è¿™æ­£æ˜¯å‹ç¼©çš„å…³é”®ã€‚`
                    };
                },
                
                // èƒ½é‡é˜ˆå€¼é¢˜ç›®5: MATLABå®ç°
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­,æŒ‰èƒ½é‡å¤§å°å¯¹DCTç³»æ•°æ’åºçš„ä»£ç æ˜¯:`,
                        options: [
                            '[~, idx] = sort(abs(X), \'descend\')',
                            '[~, idx] = sort(X)',
                            'idx = find(X > threshold)',
                            'idx = 1:length(X)'
                        ],
                        correct: 0,
                        explanation: 'ä½¿ç”¨sortå‡½æ•°æŒ‰å¹…å€¼é™åºæ’åº:sort(abs(X), \'descend\'),è¿”å›æ’åºåçš„ç´¢å¼•ç”¨äºåç»­å¤„ç†ã€‚'
                    };
                },
                
                // èƒ½é‡é˜ˆå€¼é¢˜ç›®6: é˜ˆå€¼å½±å“
                () => {
                    return {
                        type: 'single',
                        question: `é™ä½èƒ½é‡é˜ˆå€¼(å¦‚ä»99%é™åˆ°95%)ä¼šå¯¼è‡´:`,
                        options: [
                            'ä¿ç•™æ›´å°‘ç³»æ•°,å‹ç¼©æ¯”æé«˜,ä½†å¤±çœŸå¢å¤§',
                            'ä¿ç•™æ›´å¤šç³»æ•°,éŸ³è´¨æ›´å¥½',
                            'æ²¡æœ‰å½±å“',
                            'å‹ç¼©æ¯”é™ä½'
                        ],
                        correct: 0,
                        explanation: 'é˜ˆå€¼é™ä½â†’ä¿ç•™ç³»æ•°å‡å°‘â†’å‹ç¼©æ¯”æé«˜,ä½†ä¸¢å¼ƒäº†æ›´å¤šä¿¡æ¯â†’å¤±çœŸå¢å¤§ã€‚è¿™æ˜¯å‹ç¼©æ¯”ä¸éŸ³è´¨çš„æƒè¡¡ã€‚'
                    };
                },
                
                // èƒ½é‡é˜ˆå€¼é¢˜ç›®7: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: `èƒ½é‡é˜ˆå€¼å¤„ç†çš„ä½œç”¨åŒ…æ‹¬:(å¤šé€‰)`,
                        options: [
                            'å»é™¤èƒ½é‡å°çš„ç³»æ•°,å‡å°‘æ•°æ®é‡',
                            'ä¿ç•™æœ€é‡è¦çš„é¢‘ç‡åˆ†é‡',
                            'å®ç°æœ‰æŸå‹ç¼©',
                            'å®Œå…¨æ— æŸé‡å»ºä¿¡å·'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'èƒ½é‡é˜ˆå€¼æ˜¯æœ‰æŸå‹ç¼©çš„å…³é”®æ­¥éª¤:ä¸¢å¼ƒæ¬¡è¦ä¿¡æ¯ã€ä¿ç•™ä¸»è¦é¢‘ç‡åˆ†é‡ã€å‡å°‘æ•°æ®é‡,ä½†æ— æ³•å®Œå…¨æ— æŸé‡å»ºã€‚'
                    };
                }
            ],
            
            quantization: [
                // é‡åŒ–é¢˜ç›®1: é‡åŒ–åŸç†
                () => {
                    const bits = randChoice([2, 4, 6, 8]);
                    const levels = Math.pow(2, bits);
                    return {
                        type: 'single',
                        question: `${bits}ä½å‡åŒ€é‡åŒ–å¯ä»¥è¡¨ç¤ºå¤šå°‘ä¸ªé‡åŒ–çº§åˆ«?`,
                        options: [
                            `${levels}ä¸ª`,
                            `${bits}ä¸ª`,
                            `${levels * 2}ä¸ª`,
                            `${bits * 2}ä¸ª`
                        ],
                        correct: 0,
                        explanation: `${bits}ä½é‡åŒ–å¯è¡¨ç¤º $2^{${bits}} = ${levels}$ ä¸ªä¸åŒçš„é‡åŒ–çº§åˆ«ã€‚ä½æ•°è¶Šå¤š,é‡åŒ–è¶Šç²¾ç»†ã€‚`
                    };
                },
                
                // é‡åŒ–é¢˜ç›®2: é‡åŒ–æ­¥é•¿
                () => {
                    const L = randInt(8, 16);
                    const b = randChoice([4, 6, 8]);
                    const step = (L / (Math.pow(2, b-1) - 1)).toFixed(3);
                    return {
                        type: 'single',
                        question: `é‡åŒ–åŒºé—´ä¸º[-${L}, ${L}],ä½¿ç”¨${b}ä½é‡åŒ–,é‡åŒ–æ­¥é•¿ä¸º:`,
                        options: [
                            `çº¦${step}`,
                            `${L}`,
                            `${b}`,
                            `${L / b}`
                        ],
                        correct: 0,
                        explanation: `é‡åŒ–æ­¥é•¿ $q_{step} = \\frac{2L}{2^{b}-1} = \\frac{${2*L}}{${Math.pow(2,b)-1}} \\approx ${step}$`
                    };
                },
                
                // é‡åŒ–é¢˜ç›®3: é‡åŒ–å…¬å¼
                () => {
                    const x = (Math.random() * 6 + 2).toFixed(2);
                    return {
                        type: 'single',
                        question: `å¯¹å€¼ $x=${x}$,é‡åŒ–æ­¥é•¿ä¸º2,é‡åŒ–åçš„å€¼ä¸º:`,
                        options: [
                            `${Math.round(parseFloat(x) / 2) * 2}`,
                            `${x}`,
                            `${Math.floor(parseFloat(x))}`,
                            `${Math.ceil(parseFloat(x))}`
                        ],
                        correct: 0,
                        explanation: `é‡åŒ–: $q = \\text{round}(x / q_{step}) \\times q_{step} = \\text{round}(${x} / 2) \\times 2 = ${Math.round(parseFloat(x) / 2) * 2}$`
                    };
                },
                
                // é‡åŒ–é¢˜ç›®4: é‡åŒ–è¯¯å·®
                () => {
                    return {
                        type: 'single',
                        question: `é‡åŒ–æ­¥é•¿ä¸º$\\Delta$æ—¶,é‡åŒ–è¯¯å·®çš„èŒƒå›´æ˜¯:`,
                        options: [
                            '$[-\\Delta/2, \\Delta/2]$',
                            '$[-\\Delta, \\Delta]$',
                            '$[0, \\Delta]$',
                            '$[-2\\Delta, 2\\Delta]$'
                        ],
                        correct: 0,
                        explanation: 'å‡åŒ€é‡åŒ–çš„æœ€å¤§è¯¯å·®ä¸ºåŠä¸ªæ­¥é•¿,å³ $e \\in [-\\Delta/2, \\Delta/2]$ã€‚'
                    };
                },
                
                // é‡åŒ–é¢˜ç›®5: ä½æ•°å½±å“
                () => {
                    return {
                        type: 'single',
                        question: `å°†é‡åŒ–ä½æ•°ä»8ä½é™åˆ°4ä½ä¼šå¯¼è‡´:`,
                        options: [
                            'é‡åŒ–çº§åˆ«å‡å°‘,è¯¯å·®å¢å¤§,ä½†å‹ç¼©æ¯”æé«˜',
                            'éŸ³è´¨æ›´å¥½',
                            'è®¡ç®—æ›´å¤æ‚',
                            'æ²¡æœ‰å½±å“'
                        ],
                        correct: 0,
                        explanation: 'ä½æ•°å‡å°‘:çº§åˆ«ä»256é™åˆ°16,é‡åŒ–æ›´ç²—ç³™,è¯¯å·®å¢å¤§,ä½†æ¯ä¸ªç³»æ•°å­˜å‚¨ç©ºé—´å‡åŠ,å‹ç¼©æ¯”æé«˜ã€‚'
                    };
                },
                
                // é‡åŒ–é¢˜ç›®6: MATLABå®ç°
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­å®ç°é‡åŒ–çš„æ ¸å¿ƒä»£ç æ˜¯:`,
                        options: [
                            'X_quant = round(X / q_step) * q_step',
                            'X_quant = floor(X / q_step)',
                            'X_quant = X / q_step',
                            'X_quant = quantize(X)'
                        ],
                        correct: 0,
                        explanation: 'é‡åŒ–æ­¥éª¤:é™¤ä»¥æ­¥é•¿â†’å››èˆäº”å…¥â†’ä¹˜å›æ­¥é•¿,å³ round(X / q_step) * q_stepã€‚'
                    };
                },
                
                // é‡åŒ–é¢˜ç›®7: è§£é‡åŒ–
                () => {
                    return {
                        type: 'single',
                        question: `è§£é‡åŒ–çš„ä½œç”¨æ˜¯:`,
                        options: [
                            'å°†é‡åŒ–çº§åˆ«æ˜ å°„å›è¿‘ä¼¼çš„åŸå§‹å€¼',
                            'å®Œå…¨æ¢å¤åŸå§‹å€¼',
                            'è¿›ä¸€æ­¥å‹ç¼©æ•°æ®',
                            'åˆ é™¤é‡åŒ–è¯¯å·®'
                        ],
                        correct: 0,
                        explanation: 'è§£é‡åŒ–å°†ç¦»æ•£çº§åˆ«è½¬å›è¿ç»­å€¼,ä½†æ— æ³•æ¶ˆé™¤é‡åŒ–è¯¯å·®,åªèƒ½å¾—åˆ°è¿‘ä¼¼å€¼ã€‚'
                    };
                },
                
                // é‡åŒ–é¢˜ç›®8: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: `å…³äºé‡åŒ–ä½æ•°çš„é€‰æ‹©,æ­£ç¡®çš„æ˜¯:(å¤šé€‰)`,
                        options: [
                            'ä½æ•°è¶Šå¤š,é‡åŒ–è¶Šç²¾ç»†,éŸ³è´¨è¶Šå¥½',
                            'ä½æ•°è¶Šå°‘,å‹ç¼©æ¯”è¶Šé«˜',
                            'éœ€è¦åœ¨éŸ³è´¨å’Œå‹ç¼©æ¯”ä¹‹é—´æƒè¡¡',
                            'ä½æ•°è¶Šå°‘,è®¡ç®—è¶Šå¿«'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'é‡åŒ–ä½æ•°çš„æƒè¡¡:é«˜ä½æ•°(8-10ä½)éŸ³è´¨å¥½ä½†å‹ç¼©æ¯”ä½,ä½ä½æ•°(2-4ä½)å‹ç¼©æ¯”é«˜ä½†å¤±çœŸå¤§ã€‚'
                    };
                }
            ],
            
            mse: [
                // MSEé¢˜ç›®1: MSEå®šä¹‰
                () => {
                    return {
                        type: 'single',
                        question: `å‡æ–¹è¯¯å·®(MSE)çš„å®šä¹‰æ˜¯:`,
                        options: [
                            '$\\frac{1}{N}\\sum_{n=0}^{N-1}[x[n] - \\hat{x}[n]]^2$',
                            '$\\sum_{n=0}^{N-1}|x[n] - \\hat{x}[n]|$',
                            '$\\frac{1}{N}\\sum_{n=0}^{N-1}|x[n] - \\hat{x}[n]|$',
                            '$\\sqrt{\\sum_{n=0}^{N-1}[x[n] - \\hat{x}[n]]^2}$'
                        ],
                        correct: 0,
                        explanation: 'MSEæ˜¯è¯¯å·®å¹³æ–¹çš„å¹³å‡å€¼,å®šä¹‰ä¸º $\\text{MSE} = \\frac{1}{N}\\sum_{n=0}^{N-1}[x[n] - \\hat{x}[n]]^2$ã€‚'
                    };
                },
                
                // MSEé¢˜ç›®2: MSEæ„ä¹‰
                () => {
                    return {
                        type: 'single',
                        question: `MSEè¶Šå°è¯´æ˜:`,
                        options: [
                            'é‡å»ºä¿¡å·è¶Šæ¥è¿‘åŸå§‹ä¿¡å·,å‹ç¼©è´¨é‡è¶Šå¥½',
                            'å‹ç¼©æ¯”è¶Šé«˜',
                            'è®¡ç®—é€Ÿåº¦è¶Šå¿«',
                            'ä¿¡å·èƒ½é‡è¶Šå¤§'
                        ],
                        correct: 0,
                        explanation: 'MSEè¡¡é‡é‡å»ºè¯¯å·®,MSEè¶Šå°è¡¨ç¤ºå¤±çœŸè¶Šå°,é‡å»ºè´¨é‡è¶Šé«˜ã€‚ç†æƒ³æƒ…å†µæ˜¯MSE=0(æ— æŸ)ã€‚'
                    };
                },
                
                // MSEé¢˜ç›®3: MATLABè®¡ç®—
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­è®¡ç®—MSEçš„ä»£ç æ˜¯:`,
                        options: [
                            'mse = mean((x - x_recon).^2)',
                            'mse = sum(abs(x - x_recon))',
                            'mse = sqrt(sum((x - x_recon).^2))',
                            'mse = std(x - x_recon)'
                        ],
                        correct: 0,
                        explanation: 'MATLABä¸­: mse = mean((x - x_recon).^2) è®¡ç®—è¯¯å·®å¹³æ–¹çš„å‡å€¼ã€‚'
                    };
                },
                
                // MSEé¢˜ç›®4: SNRå®šä¹‰
                () => {
                    return {
                        type: 'single',
                        question: `ä¿¡å™ªæ¯”(SNR)çš„å®šä¹‰æ˜¯:`,
                        options: [
                            '$10\\log_{10}\\left(\\frac{\\text{ä¿¡å·èƒ½é‡}}{\\text{å™ªå£°èƒ½é‡}}\\right)$ dB',
                            '$\\frac{\\text{ä¿¡å·å¹…åº¦}}{\\text{å™ªå£°å¹…åº¦}}$',
                            '$\\frac{\\text{å™ªå£°èƒ½é‡}}{\\text{ä¿¡å·èƒ½é‡}}$',
                            '$\\log(\\text{MSE})$'
                        ],
                        correct: 0,
                        explanation: 'SNRå®šä¹‰ä¸ºä¿¡å·èƒ½é‡ä¸å™ªå£°èƒ½é‡ä¹‹æ¯”çš„å¯¹æ•°: $\\text{SNR} = 10\\log_{10}(P_{signal}/P_{noise})$ dBã€‚'
                    };
                },
                
                // MSEé¢˜ç›®5: SNRä¸MSEå…³ç³»
                () => {
                    return {
                        type: 'single',
                        question: `SNRä¸MSEçš„å…³ç³»æ˜¯:`,
                        options: [
                            'SNRè¶Šå¤§,MSEè¶Šå°,è´¨é‡è¶Šå¥½',
                            'SNRè¶Šå°,MSEè¶Šå°',
                            'SNRä¸MSEæ— å…³',
                            'SNRç­‰äºMSE'
                        ],
                        correct: 0,
                        explanation: 'SNRå’ŒMSEæ˜¯åå‘å…³ç³»:SNRâ†‘â†’å™ªå£°â†“â†’è¯¯å·®â†“â†’MSEâ†“â†’è´¨é‡â†‘ã€‚é€šå¸¸SNR>20dBä¸ºå¯æ¥å—ã€‚'
                    };
                },
                
                // MSEé¢˜ç›®6: è´¨é‡è¯„ä¼°æ ‡å‡†
                () => {
                    const snr = randChoice([15, 25, 35]);
                    const quality = snr < 20 ? 'è¾ƒå·®' : snr < 30 ? 'å¯æ¥å—' : 'ä¼˜ç§€';
                    return {
                        type: 'single',
                        question: `å‹ç¼©åSNRä¸º${snr}dB,éŸ³è´¨è¯„ä»·ä¸º:`,
                        options: [
                            quality,
                            snr < 20 ? 'ä¼˜ç§€' : 'è¾ƒå·®',
                            'æ— æ³•åˆ¤æ–­',
                            'å®Œå…¨æ— æŸ'
                        ],
                        correct: 0,
                        explanation: `éŸ³è´¨è¯„ä»·æ ‡å‡†:SNR<20dBè¾ƒå·®,20-30dBå¯æ¥å—,>30dBä¼˜ç§€ã€‚${snr}dBå±äº${quality}ã€‚`
                    };
                },
                
                // MSEé¢˜ç›®7: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: `å…³äºMSEå’ŒSNRçš„è¯´æ³•æ­£ç¡®çš„æ˜¯:(å¤šé€‰)`,
                        options: [
                            'MSEæ˜¯å®¢è§‚è¯„ä»·æŒ‡æ ‡,ç›´æ¥è¡¡é‡è¯¯å·®å¤§å°',
                            'SNRç”¨å¯¹æ•°è¡¨ç¤º,å•ä½æ˜¯dB',
                            'MSE=0è¡¨ç¤ºå®Œå…¨æ— æŸå‹ç¼©',
                            'SNRå¯ä»¥ä¸ºè´Ÿå€¼'
                        ],
                        correct: [0, 1, 2, 3],
                        explanation: 'è¿™äº›éƒ½æ˜¯æ­£ç¡®çš„:MSEå®¢è§‚è¡¡é‡è¯¯å·®,SNRç”¨dBè¡¨ç¤º,MSE=0å¯¹åº”æ— æŸ,SNRåœ¨å™ªå£°å¤§æ—¶å¯ä¸ºè´Ÿå€¼ã€‚'
                    };
                }
            ],
            
            compression: [
                // å‹ç¼©æ¯”é¢˜ç›®1: å‹ç¼©æ¯”å®šä¹‰
                () => {
                    return {
                        type: 'single',
                        question: `å‹ç¼©æ¯”çš„å®šä¹‰æ˜¯:`,
                        options: [
                            '$\\frac{\\text{åŸå§‹å¤§å°}}{\\text{å‹ç¼©åå¤§å°}}$',
                            '$\\frac{\\text{å‹ç¼©åå¤§å°}}{\\text{åŸå§‹å¤§å°}}$',
                            '$\\text{åŸå§‹å¤§å°} - \\text{å‹ç¼©åå¤§å°}$',
                            '$\\text{å‹ç¼©åå¤§å°}$'
                        ],
                        correct: 0,
                        explanation: 'å‹ç¼©æ¯” = åŸå§‹å¤§å°/å‹ç¼©åå¤§å°ã€‚å¦‚10:1è¡¨ç¤ºå‹ç¼©åˆ°åŸæ¥çš„1/10,èŠ‚çœ90%ç©ºé—´ã€‚'
                    };
                },
                
                // å‹ç¼©æ¯”é¢˜ç›®2: è®¡ç®—å®ä¾‹
                () => {
                    const N = randChoice([512, 1024]);
                    const kept = randInt(20, 50);
                    const bits = randChoice([4, 6, 8]);
                    const ratio = ((N * 16) / (kept * bits)).toFixed(2);
                    return {
                        type: 'single',
                        question: `åŸå§‹${N}ä¸ª16ä½ç³»æ•°,å‹ç¼©åä¿ç•™${kept}ä¸ªç³»æ•°,æ¯ä¸ªç”¨${bits}ä½é‡åŒ–,å‹ç¼©æ¯”çº¦ä¸º:`,
                        options: [
                            `${ratio}:1`,
                            `${(kept/N).toFixed(2)}:1`,
                            `${bits}:1`,
                            `${N}:1`
                        ],
                        correct: 0,
                        explanation: `åŸå§‹:${N}Ã—16=${N*16}ä½;å‹ç¼©å:${kept}Ã—${bits}=${kept*bits}ä½;å‹ç¼©æ¯”â‰ˆ${ratio}:1`
                    };
                },
                
                // å‹ç¼©æ¯”é¢˜ç›®3: å‹ç¼©ç‡
                () => {
                    const ratio = randChoice([5, 8, 10]);
                    const rate = ((1 - 1/ratio) * 100).toFixed(0);
                    return {
                        type: 'single',
                        question: `å‹ç¼©æ¯”ä¸º${ratio}:1,å‹ç¼©ç‡(èŠ‚çœçš„ç©ºé—´ç™¾åˆ†æ¯”)ä¸º:`,
                        options: [
                            `${rate}%`,
                            `${100 - parseInt(rate)}%`,
                            `${ratio}%`,
                            `${100/ratio}%`
                        ],
                        correct: 0,
                        explanation: `å‹ç¼©ç‡ = (1 - 1/å‹ç¼©æ¯”) Ã— 100% = (1 - 1/${ratio}) Ã— 100% = ${rate}%`
                    };
                },
                
                // å‹ç¼©æ¯”é¢˜ç›®4: å½±å“å› ç´ 
                () => {
                    return {
                        type: 'single',
                        question: `æé«˜å‹ç¼©æ¯”çš„æ–¹æ³•ä¸åŒ…æ‹¬:`,
                        options: [
                            'å¢åŠ èƒ½é‡é˜ˆå€¼',
                            'é™ä½èƒ½é‡é˜ˆå€¼(ä¿ç•™æ›´å°‘ç³»æ•°)',
                            'å‡å°‘é‡åŒ–ä½æ•°',
                            'ä½¿ç”¨æ›´å¤§çš„çª—å£'
                        ],
                        correct: 0,
                        explanation: 'æé«˜å‹ç¼©æ¯”çš„æ–¹æ³•:é™ä½èƒ½é‡é˜ˆå€¼(ä¿ç•™æ›´å°‘ç³»æ•°)ã€å‡å°‘é‡åŒ–ä½æ•°ã€‚å¢åŠ é˜ˆå€¼ä¼šä¿ç•™æ›´å¤šç³»æ•°,é™ä½å‹ç¼©æ¯”ã€‚'
                    };
                },
                
                // å‹ç¼©æ¯”é¢˜ç›®5: æƒè¡¡å…³ç³»
                () => {
                    return {
                        type: 'single',
                        question: `å‹ç¼©æ¯”ä¸éŸ³è´¨çš„å…³ç³»æ˜¯:`,
                        options: [
                            'å‹ç¼©æ¯”è¶Šé«˜,éŸ³è´¨é€šå¸¸è¶Šå·®,éœ€è¦æƒè¡¡',
                            'å‹ç¼©æ¯”è¶Šé«˜,éŸ³è´¨è¶Šå¥½',
                            'å‹ç¼©æ¯”ä¸éŸ³è´¨æ— å…³',
                            'å‹ç¼©æ¯”è¶Šä½,éŸ³è´¨è¶Šå·®'
                        ],
                        correct: 0,
                        explanation: 'è¿™æ˜¯æ ¸å¿ƒæƒè¡¡:é«˜å‹ç¼©æ¯”â†’ä¸¢å¼ƒæ›´å¤šä¿¡æ¯â†’å¤±çœŸâ†‘â†’éŸ³è´¨â†“ã€‚éœ€æ ¹æ®åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„å‹ç¼©æ¯”ã€‚'
                    };
                },
                
                // å‹ç¼©æ¯”é¢˜ç›®6: MP3å¯¹æ¯”
                () => {
                    return {
                        type: 'single',
                        question: `MP3éŸ³é¢‘é€šå¸¸èƒ½è¾¾åˆ°çš„å‹ç¼©æ¯”çº¦ä¸º:`,
                        options: [
                            '10:1å·¦å³',
                            '2:1å·¦å³',
                            '50:1å·¦å³',
                            '100:1å·¦å³'
                        ],
                        correct: 0,
                        explanation: 'MP3é€šè¿‡DCTã€å¿ƒç†å£°å­¦æ¨¡å‹ã€å“ˆå¤«æ›¼ç¼–ç ç­‰æŠ€æœ¯,é€šå¸¸è¾¾åˆ°10:1å·¦å³çš„å‹ç¼©æ¯”,éŸ³è´¨æŸå¤±è¾ƒå°ã€‚'
                    };
                },
                
                // å‹ç¼©æ¯”é¢˜ç›®7: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: `å½±å“å‹ç¼©æ¯”çš„å› ç´ åŒ…æ‹¬:(å¤šé€‰)`,
                        options: [
                            'èƒ½é‡é˜ˆå€¼çš„è®¾å®š',
                            'é‡åŒ–ä½æ•°çš„é€‰æ‹©',
                            'çª—å£å¤§å°',
                            'åŸå§‹ä¿¡å·çš„ç‰¹æ€§'
                        ],
                        correct: [0, 1, 3],
                        explanation: 'å‹ç¼©æ¯”ä¸»è¦ç”±èƒ½é‡é˜ˆå€¼(ä¿ç•™ç³»æ•°æ•°é‡)ã€é‡åŒ–ä½æ•°(æ¯ä¸ªç³»æ•°çš„å­˜å‚¨)å†³å®š,ä¹Ÿå—ä¿¡å·ç‰¹æ€§å½±å“ã€‚çª—å£å¤§å°ä¸»è¦å½±å“é¢‘ç‡åˆ†è¾¨ç‡ã€‚'
                    };
                }
            ],
            
            workflow: [
                // æµç¨‹é¢˜ç›®1: 7æ­¥æµç¨‹
                () => {
                    return {
                        type: 'single',
                        question: `éŸ³é¢‘å‹ç¼©çš„ç¬¬ä¸€æ­¥æ˜¯:`,
                        options: [
                            'è¯»å–éŸ³é¢‘å¹¶åˆ†æ®µ',
                            'DCTå˜æ¢',
                            'èƒ½é‡é˜ˆå€¼å¤„ç†',
                            'é‡åŒ–'
                        ],
                        correct: 0,
                        explanation: 'å®Œæ•´æµç¨‹:1)è¯»å–éŸ³é¢‘å¹¶åˆ†æ®µ 2)DCTå˜æ¢ 3)èƒ½é‡é˜ˆå€¼ 4)é‡åŒ– 5)é€†DCT 6)åˆå¹¶é‡å»º 7)æ€§èƒ½åˆ†æã€‚'
                    };
                },
                
                // æµç¨‹é¢˜ç›®2: æ­¥éª¤é¡ºåº
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨å‹ç¼©æµç¨‹ä¸­,èƒ½é‡é˜ˆå€¼å¤„ç†å’Œé‡åŒ–çš„æ­£ç¡®é¡ºåºæ˜¯:`,
                        options: [
                            'å…ˆèƒ½é‡é˜ˆå€¼,åé‡åŒ–',
                            'å…ˆé‡åŒ–,åèƒ½é‡é˜ˆå€¼',
                            'ä¸¤è€…å¯ä»¥äº’æ¢',
                            'åªéœ€è¦å…¶ä¸­ä¸€ä¸ª'
                        ],
                        correct: 0,
                        explanation: 'æ­£ç¡®é¡ºåº:DCTâ†’èƒ½é‡é˜ˆå€¼(å»é™¤å°ç³»æ•°)â†’é‡åŒ–(ç¦»æ•£åŒ–ä¿ç•™çš„ç³»æ•°)â†’é€†DCTã€‚'
                    };
                },
                
                // æµç¨‹é¢˜ç›®3: MATLABå‡½æ•°
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­,è¯»å–éŸ³é¢‘æ–‡ä»¶çš„å‡½æ•°æ˜¯:`,
                        options: [
                            'audioread(\'filename.wav\')',
                            'wavread(\'filename.wav\')',
                            'load(\'filename.wav\')',
                            'read_audio(\'filename.wav\')'
                        ],
                        correct: 0,
                        explanation: 'MATLABä¸­ä½¿ç”¨audioreadå‡½æ•°è¯»å–éŸ³é¢‘:[x, Fs] = audioread(\'filename.wav\')ã€‚'
                    };
                },
                
                // æµç¨‹é¢˜ç›®4: åˆå¹¶é‡å»º
                () => {
                    return {
                        type: 'single',
                        question: `å°†æ‰€æœ‰å‹ç¼©åçš„ç‰‡æ®µåˆå¹¶æˆå®Œæ•´éŸ³é¢‘çš„æ–¹æ³•æ˜¯:`,
                        options: [
                            'æŒ‰é¡ºåºæ‹¼æ¥å„ç‰‡æ®µ',
                            'å–å„ç‰‡æ®µçš„å¹³å‡å€¼',
                            'åªä¿ç•™ç¬¬ä¸€ä¸ªç‰‡æ®µ',
                            'éšæœºç»„åˆ'
                        ],
                        correct: 0,
                        explanation: 'åˆå¹¶æ—¶æŒ‰åŸå§‹é¡ºåºå°†å„ç‰‡æ®µä¾æ¬¡æ‹¼æ¥:x_final = [seg1, seg2, seg3, ...]ã€‚'
                    };
                },
                
                // æµç¨‹é¢˜ç›®5: å†™å…¥éŸ³é¢‘
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­ä¿å­˜é‡å»ºéŸ³é¢‘çš„å‡½æ•°æ˜¯:`,
                        options: [
                            'audiowrite(\'output.wav\', x, Fs)',
                            'wavwrite(x, Fs, \'output.wav\')',
                            'save(\'output.wav\', x)',
                            'write_audio(x, \'output.wav\')'
                        ],
                        correct: 0,
                        explanation: 'ä½¿ç”¨audiowriteå‡½æ•°ä¿å­˜:audiowrite(\'output.wav\', x, Fs),éœ€æŒ‡å®šé‡‡æ ·ç‡Fsã€‚'
                    };
                },
                
                // æµç¨‹é¢˜ç›®6: æ€§èƒ½æŒ‡æ ‡
                () => {
                    return {
                        type: 'multiple',
                        question: `æ€§èƒ½åˆ†æé˜¶æ®µéœ€è¦è®¡ç®—çš„æŒ‡æ ‡åŒ…æ‹¬:(å¤šé€‰)`,
                        options: [
                            'å‹ç¼©æ¯”',
                            'MSE(å‡æ–¹è¯¯å·®)',
                            'SNR(ä¿¡å™ªæ¯”)',
                            'åŸå§‹éŸ³é¢‘æ—¶é•¿'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'æ€§èƒ½åˆ†æä¸»è¦å…³æ³¨:å‹ç¼©æ¯”(æ•°æ®é‡å‡å°‘)ã€MSE(é‡å»ºè¯¯å·®)ã€SNR(ä¿¡å·è´¨é‡),æ—¶é•¿ä¸æ˜¯å‹ç¼©æ€§èƒ½æŒ‡æ ‡ã€‚'
                    };
                },
                
                // æµç¨‹é¢˜ç›®7: æœ‰æŸvsæ— æŸ
                () => {
                    return {
                        type: 'single',
                        question: `æœ¬å®éªŒçš„å‹ç¼©æ–¹æ³•å±äº:`,
                        options: [
                            'æœ‰æŸå‹ç¼©',
                            'æ— æŸå‹ç¼©',
                            'éƒ¨åˆ†æœ‰æŸ',
                            'è‡ªé€‚åº”å‹ç¼©'
                        ],
                        correct: 0,
                        explanation: 'ç”±äºä½¿ç”¨äº†èƒ½é‡é˜ˆå€¼(ä¸¢å¼ƒç³»æ•°)å’Œé‡åŒ–(ç¦»æ•£åŒ–),è¿™æ˜¯æœ‰æŸå‹ç¼©,æ— æ³•å®Œå…¨æ¢å¤åŸå§‹ä¿¡å·ã€‚'
                    };
                },
                
                // æµç¨‹é¢˜ç›®8: å¤šé€‰-å…³é”®æ­¥éª¤
                () => {
                    return {
                        type: 'multiple',
                        question: `åœ¨7æ­¥æµç¨‹ä¸­,å“ªäº›æ­¥éª¤å¯¼è‡´äº†ä¿¡æ¯æŸå¤±?(å¤šé€‰)`,
                        options: [
                            'èƒ½é‡é˜ˆå€¼å¤„ç†(ä¸¢å¼ƒå°ç³»æ•°)',
                            'é‡åŒ–ä¸è§£é‡åŒ–(ç¦»æ•£åŒ–è¯¯å·®)',
                            'DCTå˜æ¢',
                            'ä¿¡å·åˆ†æ®µ'
                        ],
                        correct: [0, 1],
                        explanation: 'ä¿¡æ¯æŸå¤±å‘ç”Ÿåœ¨:èƒ½é‡é˜ˆå€¼(ç›´æ¥ä¸¢å¼ƒ)å’Œé‡åŒ–(èˆå…¥è¯¯å·®)ã€‚DCTå’Œåˆ†æ®µéƒ½æ˜¯å¯é€†çš„,ä¸æŸå¤±ä¿¡æ¯ã€‚'
                    };
                }
            ]
        };

        // ==================== äº‹ä»¶ç›‘å¬å™¨ç»‘å®š ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // å¼€å§‹æµ‹éªŒæŒ‰é’®
            document.getElementById('startQuizBtn').addEventListener('click', startQuiz);
            
            // æäº¤ç­”æ¡ˆæŒ‰é’®
            document.getElementById('submitBtn').addEventListener('click', submitAnswer);
            
            // ä¸‹ä¸€é¢˜æŒ‰é’®
            document.getElementById('nextBtn').addEventListener('click', nextQuestion);
            
            // ä¿å­˜æˆªå›¾æŒ‰é’®
            document.getElementById('saveBtn').addEventListener('click', saveScreenshot);
        });

        // ==================== æµ‹éªŒé€»è¾‘ ====================
        
        function startQuiz() {
            const id = document.getElementById('studentId').value.trim();
            const name = document.getElementById('studentName').value.trim();
            
            if (!id || !name) {
                alert('è¯·å¡«å†™å­¦å·å’Œå§“å!');
                return;
            }
            
            studentData.id = id;
            studentData.name = name;
            
            topics.forEach(topic => {
                studentData.topicStats[topic.id] = {
                    attempts: 0,
                    correct: 0,
                    questions: []
                };
                studentData.usedQuestions[topic.id] = [];
            });
            
            document.querySelector('.login-section').classList.remove('active');
            document.querySelector('.quiz-section').classList.add('active');
            
            document.getElementById('studentInfo').innerHTML = 
                `<p style="text-align: center; color: #666;">å­¦å·: ${id} | å§“å: ${name}</p>`;
            
            loadQuestion();
        }

        function loadQuestion() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            
            const progress = (studentData.currentTopicIndex / topics.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = 
                `${studentData.currentTopicIndex}/${topics.length}`;
            
            document.getElementById('currentTopic').innerHTML = 
                `<h2>ğŸ“š å½“å‰çŸ¥è¯†ç‚¹: ${currentTopic.name}</h2>
                 <p style="color: #666;">${currentTopic.description}</p>`;
            
            const generators = questionGenerators[topicId];
            let questionIndex;
            
            if (studentData.usedQuestions[topicId].length >= generators.length) {
                studentData.usedQuestions[topicId] = [];
            }
            
            do {
                questionIndex = randInt(0, generators.length - 1);
            } while (studentData.usedQuestions[topicId].includes(questionIndex));
            
            studentData.usedQuestions[topicId].push(questionIndex);
            
            const question = generators[questionIndex]();
            
            // ğŸ”¥ğŸ”¥ğŸ”¥ æ ¸å¿ƒä¿®æ”¹ï¼šæ‰“ä¹±é€‰é¡¹é¡ºåº
            if (question.type === 'single') {
                const shuffled = shuffleOptionsWithAnswer(question.options, question.correct);
                question.options = shuffled.options;
                question.correct = shuffled.correct;
            } else if (question.type === 'multiple') {
                const shuffled = shuffleOptionsWithAnswers(question.options, question.correct);
                question.options = shuffled.options;
                question.correct = shuffled.correct;
            }
            
            stats.questions.push({
                ...question,
                answered: false,
                isCorrect: false
            });
            
            document.getElementById('questionTitle').innerHTML = 
                `é¢˜ç›® ${stats.attempts + 1}`;
            
            document.getElementById('questionContent').innerHTML = 
                `<p style="margin: 15px 0; font-size: 1.1em;">${question.question}</p>`;
            
            let optionsHTML = '';
            
            if (question.type === 'single') {
                question.options.forEach((option, index) => {
                    optionsHTML += `
                        <div class="option" data-index="${index}">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`;
                });
            } else {
                question.options.forEach((option, index) => {
                    optionsHTML += `
                        <div class="checkbox-option" data-index="${index}">
                            <input type="checkbox" id="opt${index}">
                            <label for="opt${index}" style="cursor: pointer; margin: 0;">
                                ${String.fromCharCode(65 + index)}. ${option}
                            </label>
                        </div>`;
                });
            }
            
            document.getElementById('options').innerHTML = optionsHTML;
            
            // ç»‘å®šé€‰é¡¹ç‚¹å‡»äº‹ä»¶
            if (question.type === 'single') {
                document.querySelectorAll('.option').forEach(option => {
                    option.addEventListener('click', function() {
                        selectOption(parseInt(this.getAttribute('data-index')));
                    });
                });
            } else {
                document.querySelectorAll('.checkbox-option').forEach(option => {
                    option.addEventListener('click', function() {
                        toggleCheckbox(parseInt(this.getAttribute('data-index')));
                    });
                });
            }
            
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            
            if (typeof MathJax !== 'undefined') {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }

        function selectOption(index) {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelectorAll('.option')[index].classList.add('selected');
        }

        function toggleCheckbox(index) {
            const checkbox = document.getElementById(`opt${index}`);
            checkbox.checked = !checkbox.checked;
        }

        function submitAnswer() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            const question = stats.questions[stats.questions.length - 1];
            
            let selectedAnswers;
            let isCorrect;
            
            if (question.type === 'single') {
                const selected = document.querySelector('.option.selected');
                if (!selected) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ!');
                    return;
                }
                selectedAnswers = parseInt(selected.getAttribute('data-index'));
                isCorrect = selectedAnswers === question.correct;
                
                document.querySelectorAll('.option').forEach((opt, idx) => {
                    if (idx === question.correct) {
                        opt.classList.add('correct');
                    } else if (idx === selectedAnswers && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                    opt.style.pointerEvents = 'none';
                });
            } else {
                selectedAnswers = [];
                document.querySelectorAll('input[type="checkbox"]').forEach((cb, idx) => {
                    if (cb.checked) {
                        selectedAnswers.push(idx);
                    }
                });
                
                if (selectedAnswers.length === 0) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ!');
                    return;
                }
                
                isCorrect = selectedAnswers.length === question.correct.length &&
                           selectedAnswers.every(ans => question.correct.includes(ans));
                
                document.querySelectorAll('.checkbox-option').forEach((opt, idx) => {
                    if (question.correct.includes(idx)) {
                        opt.classList.add('correct');
                    } else if (selectedAnswers.includes(idx)) {
                        opt.classList.add('incorrect');
                    }
                    opt.style.pointerEvents = 'none';
                });
            }
            
            stats.attempts++;
            question.answered = true;
            question.isCorrect = isCorrect;
            
            if (isCorrect) {
                stats.correct++;
            }
            
            const feedbackDiv = document.getElementById('feedback');
            if (isCorrect) {
                feedbackDiv.innerHTML = 
                    `<div class="feedback correct">
                        âœ… å›ç­”æ­£ç¡®!<br>
                        <small>${question.explanation}</small>
                    </div>`;
                document.getElementById('submitBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').textContent = 
                    studentData.currentTopicIndex < topics.length - 1 ? 'ä¸‹ä¸€çŸ¥è¯†ç‚¹' : 'æŸ¥çœ‹ç»“æœ';
            } else {
                feedbackDiv.innerHTML = 
                    `<div class="feedback incorrect">
                        âŒ å›ç­”é”™è¯¯,è¯·å†è¯•ä¸€æ¬¡!<br>
                        <small>${question.explanation}</small>
                    </div>`;
                document.getElementById('submitBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').textContent = 'ç»§ç»­ç­”é¢˜';
            }
            
            if (typeof MathJax !== 'undefined') {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }

        function nextQuestion() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            const lastQuestion = stats.questions[stats.questions.length - 1];
            
            if (lastQuestion.isCorrect) {
                studentData.currentTopicIndex++;
                
                if (studentData.currentTopicIndex >= topics.length) {
                    showResults();
                } else {
                    loadQuestion();
                }
            } else {
                loadQuestion();
            }
        }

        function showResults() {
            document.querySelector('.quiz-section').classList.remove('active');
            document.querySelector('.result-section').classList.add('active');
            
            let reportHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #667eea;">ğŸ‰ ${studentData.name} åŒå­¦(å­¦å·:${studentData.id})</h2>
                    <p style="color: #666; font-size: 1.1em;">æ‚¨å·²å®Œæˆæœ¬æ¬¡DSP-Proj1ç»ƒä¹ æµ‹éªŒ!</p>
                </div>
                
                <table class="stats-table">
                    <tr>
                        <th>çŸ¥è¯†ç‚¹</th>
                        <th>ç­”é¢˜æ¬¡æ•°</th>
                        <th>é¦–æ¬¡æ­£ç¡®ç‡</th>
                        <th>æŒæ¡ç¨‹åº¦</th>
                    </tr>
            `;
            
            let excellentTopics = [];
            let goodTopics = [];
            let fairTopics = [];
            let poorTopics = [];
            
            topics.forEach(topic => {
                const stats = studentData.topicStats[topic.id];
                const accuracy = ((1 / stats.attempts) * 100).toFixed(0);
                
                let mastery, masteryClass;
                if (stats.attempts === 1) {
                    mastery = 'ä¼˜ç§€ â­â­â­â­';
                    masteryClass = 'mastery-excellent';
                    excellentTopics.push(topic.name);
                } else if (stats.attempts === 2) {
                    mastery = 'è‰¯å¥½ â­â­â­';
                    masteryClass = 'mastery-good';
                    goodTopics.push(topic.name);
                } else if (stats.attempts <= 4) {
                    mastery = 'ä¸€èˆ¬ â­â­';
                    masteryClass = 'mastery-fair';
                    fairTopics.push(topic.name);
                } else {
                    mastery = 'éœ€åŠ å¼º â­';
                    masteryClass = 'mastery-poor';
                    poorTopics.push(topic.name);
                }
                
                reportHTML += `
                    <tr>
                        <td><strong>${topic.name}</strong></td>
                        <td>${stats.attempts}æ¬¡</td>
                        <td>${accuracy}%</td>
                        <td class="${masteryClass}">${mastery}</td>
                    </tr>
                `;
            });
            
            reportHTML += '</table>';
            
            reportHTML += '<div style="margin-top: 30px;">';
            reportHTML += '<h3 style="color: #667eea;">ğŸ“Š çŸ¥è¯†æŒæ¡åˆ†æ</h3>';
            
            if (excellentTopics.length > 0) {
                reportHTML += `
                    <div style="background: #e8f5e9; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #48bb78;">
                        <strong style="color: #48bb78;">âœ… æŒæ¡ä¼˜ç§€çš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${excellentTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (goodTopics.length > 0) {
                reportHTML += `
                    <div style="background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #667eea;">
                        <strong style="color: #667eea;">ğŸ‘ æŒæ¡è‰¯å¥½çš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${goodTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (fairTopics.length > 0) {
                reportHTML += `
                    <div style="background: #fff8e1; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #ed8936;">
                        <strong style="color: #ed8936;">âš ï¸ éœ€è¦å·©å›ºçš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${fairTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (poorTopics.length > 0) {
                reportHTML += `
                    <div style="background: #ffebee; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #f56565;">
                        <strong style="color: #f56565;">âŒ éœ€è¦é‡ç‚¹åŠ å¼ºçš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${poorTopics.join('ã€')}
                    </div>
                `;
            }
            
            reportHTML += `
                <div style="background: #f0f4ff; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 5px solid #667eea;">
                    <h4 style="color: #667eea; margin-top: 0;">ğŸ’¡ å¤ä¹ å»ºè®®</h4>
                    <ul style="line-height: 2; color: #555;">
                        <li>é‡ç‚¹å¤ä¹ æ ‡è®°ä¸º"éœ€åŠ å¼º"çš„çŸ¥è¯†ç‚¹,ç»“åˆå®éªŒæ‰‹å†Œè¯¦ç»†å­¦ä¹ </li>
                        <li>å¯¹äºç­”é¢˜æ¬¡æ•°è¾ƒå¤šçš„çŸ¥è¯†ç‚¹,å»ºè®®åŠ¨æ‰‹å®è·µMATLABä»£ç åŠ æ·±ç†è§£</li>
                        <li>ç†è§£DCTå‹ç¼©çš„å®Œæ•´æµç¨‹:åˆ†æ®µâ†’DCTâ†’é˜ˆå€¼â†’é‡åŒ–â†’é€†DCTâ†’åˆå¹¶</li>
                        <li>æŒæ¡å‹ç¼©æ¯”ä¸éŸ³è´¨çš„æƒè¡¡å…³ç³»,è¿™æ˜¯å®é™…åº”ç”¨çš„å…³é”®</li>
                    </ul>
                </div>
            `;
            
            reportHTML += '</div>';
            
            document.getElementById('finalReport').innerHTML = reportHTML;
        }

        function saveScreenshot() {
            const button = document.getElementById('saveBtn');
            button.disabled = true;
            button.textContent = 'æ­£åœ¨ç”Ÿæˆæˆªå›¾...';
            
            html2canvas(document.body, {
                backgroundColor: '#ffffff',
                scale: 2,
                logging: false
            }).then(canvas => {
                canvas.toBlob(blob => {
                    const cleanId = studentData.id.replace(/[^a-zA-Z0-9_\u4e00-\u9fa5-]/g, '_');
                    const cleanName = studentData.name.replace(/[^a-zA-Z0-9_\u4e00-\u9fa5-]/g, '_');
                    const filename = `${cleanId}_${cleanName}_Proj1Quiz.png`;
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    button.disabled = false;
                    button.textContent = 'æˆªå›¾å·²ä¿å­˜';
                    setTimeout(() => {
                        button.textContent = 'å†æ¬¡æˆªå›¾';
                    }, 2000);
                }, 'image/png');
            }).catch(error => {
                console.error('æˆªå›¾å¤±è´¥:', error);
                alert('æˆªå›¾å¤±è´¥,è¯·å°è¯•ä½¿ç”¨æµè§ˆå™¨æˆªå›¾åŠŸèƒ½');
                button.disabled = false;
                button.textContent = 'æˆªå›¾ä¿å­˜';
            });
        }
    </script>
    
    <script>
        (function() {
            const statusDiv = document.getElementById('mathjaxStatus');
            const primaryCDN = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
            const backupCDN = 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML';

            function loadScript(src, onload, onerror) {
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                script.onload = onload;
                script.onerror = onerror;
                document.head.appendChild(script);
            }

            function onMathJaxLoad() {
                console.log('MathJax loaded successfully.');
                statusDiv.textContent = 'âœ“ æ•°å­¦å…¬å¼åŠ è½½æˆåŠŸ';
                statusDiv.className = 'mathjax-status success';
            }

            loadScript(primaryCDN, onMathJaxLoad, function() {
                console.warn('Primary MathJax CDN failed. Trying backup...');
                statusDiv.textContent = 'ä¸»CDNåŠ è½½å¤±è´¥,å°è¯•å¤‡ç”¨...';
                loadScript(backupCDN, onMathJaxLoad, function() {
                    console.error('Backup MathJax CDN also failed.');
                    statusDiv.textContent = 'âŒ å…¬å¼åŠ è½½å¤±è´¥,è¯·æ£€æŸ¥ç½‘ç»œ';
                    statusDiv.className = 'mathjax-status';
                });
            });
        })();
    </script>
</body>
</html>