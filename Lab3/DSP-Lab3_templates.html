<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DSP Lab 3 å®éªŒæ¨¡æ¿ (ä¿®è®¢ç‰ˆ)</title>
    <style>
        body { font-family: 'Segoe UI', Consolas, 'Microsoft YaHei', sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        .control-panel { position: sticky; top: 0; z-index: 100; background: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        .control-btn { background: #2d57a4; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 10px; }
        .control-btn:hover { background: #1e3a6e; }
        .control-btn.secondary { background: #6c757d; }
        .file-block { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; overflow: hidden; }
        .file-header { background: #2d57a4; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; user-select: none; }
        .file-header:hover { background: #3b6bbd; }
        .file-title { font-weight: bold; display: flex; align-items: center; }
        .arrow-icon { display: inline-block; margin-right: 10px; transition: transform 0.3s; }
        .file-block.collapsed .arrow-icon { transform: rotate(-90deg); }
        .file-content { display: block; }
        .file-block.collapsed .file-content { display: none; }
        .copy-btn { background: #5ca353; border: none; color: white; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .copy-btn:hover { background: #4a8842; }
        pre { margin: 0; padding: 20px; overflow-x: auto; line-height: 1.8; font-size: 13px; background: #f8f9fa; border-top: 1px solid #e9ecef; }
        .comment { color: #228b22; font-style: italic; }
        .todo-tag { background: #fff3cd; color: #856404; padding: 2px 6px; border-radius: 3px; border: 1px solid #ffeeba; font-weight: bold; font-size: 0.9em; margin-right: 5px; }
        .info-banner { background: #e7f3ff; border-left: 4px solid #2d57a4; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .warning-banner { background: #fff3cd; border-left: 4px solid #ff9800; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .data-banner { background: #e8f5e9; border-left: 4px solid #5ca353; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <h2 style="margin:0; color:#2d57a4;">ğŸ“ DSP Lab 3 - å­¦ç”Ÿå®éªŒæ¨¡æ¿</h2>
            <div>
                <button class="control-btn" onclick="expandAll()">å…¨éƒ¨å±•å¼€</button>
                <button class="control-btn secondary" onclick="collapseAll()">å…¨éƒ¨æŠ˜å </button>
            </div>
        </div>

        <div class="info-banner">
            <strong>ğŸ“Œ ç¼–ç¨‹è§„èŒƒè¯´æ˜ï¼š</strong>
            <ul style="margin:5px 0 0 20px; padding:0; line-height:1.8;">
                <li>ä»£ç ä¸­å·²é¢„å®šä¹‰äº†å…³é”®å˜é‡ï¼ˆå¦‚ <code>h = [];</code>ï¼‰ï¼Œ<strong>è¯·å‹¿ä¿®æ”¹å˜é‡å</strong>ã€‚</li>
                <li>è¯·åœ¨ <code>% TODO</code> æ³¨é‡ŠæŒ‡å¼•ä¸‹ç¼–å†™ä»£ç ã€‚</li>
                <li>æ¯ä¸ªè„šæœ¬æœ«å°¾åŒ…å«<strong>è‡ªæ£€ä»£ç </strong>ï¼Œè¿è¡Œè„šæœ¬æ—¶è‹¥çœ‹åˆ°çº¢å­—è­¦å‘Šï¼Œè¯´æ˜å˜é‡æœªæ­£ç¡®èµ‹å€¼ã€‚</li>
            </ul>
        </div>

        <div class="data-banner">
            <strong>ğŸ“‚ å®éªŒæ•°æ®æ–‡ä»¶ï¼š</strong>
            <ul style="margin:5px 0 0 20px; padding:0;">
                <li><code>phdist.mat</code> - åŒ…å«ä¸‰ç»„æ»¤æ³¢å™¨ç³»æ•°å’ŒåŠ å™ªè¯­éŸ³</li>
                <li><code>orig.mat</code> - åŒ…å«åŸå§‹è¯­éŸ³ä¿¡å·å’Œé‡‡æ ·ç‡</li>
            </ul>
        </div>
        
        <div class="warning-banner">
            <strong>âš ï¸ æäº¤æ–‡ä»¶åˆ—è¡¨ï¼š</strong>
            <ul style="margin:5px 0 0 20px; padding:0;">
                <li>exercise1_fir_design.m</li>
                <li>exercise2_speech_filtering.m</li>
                <li>exercise3_window_length.m</li>
                <li>exercise4_window_comparison</li>
            </ul>
        </div>


        <!-- Exercise 1 -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title"><span class="arrow-icon">â–¼</span>ğŸ“„ exercise1_fir_design.m</span>
                <button class="copy-btn" onclick="copyCode(event, 'code1')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code1">%% ç»ƒä¹ ä¸€ï¼šæ±‰æ˜çª—FIRä½é€šæ»¤æ³¢å™¨è®¾è®¡ä¸ä¿¡å·æ»¤æ³¢
% æ–‡ä»¶å: exercise1_fir_design.m
% å­¦å·ï¼š______  å§“åï¼š______

%% è®¾è®¡å‚æ•°
M = 31;                 <span class="comment">% æ»¤æ³¢å™¨é˜¶æ•°</span>
N = M + 1;              <span class="comment">% æ»¤æ³¢å™¨é•¿åº¦</span>
omega_c = pi / 4;       <span class="comment">% æˆªæ­¢è§’é¢‘ç‡</span>
Wn = omega_c / pi;      <span class="comment">% å½’ä¸€åŒ–æˆªæ­¢é¢‘ç‡</span>

n_signal = 0:127;       <span class="comment">% ä¿¡å·é•¿åº¦</span>
omega1 = pi / 3;        <span class="comment">% é˜»å¸¦æµ‹è¯•é¢‘ç‡</span>
omega2 = pi / 6;        <span class="comment">% é€šå¸¦æµ‹è¯•é¢‘ç‡</span>

%% ä»»åŠ¡ä¸€ï¼šè®¾è®¡æ»¤æ³¢å™¨
<span class="comment">% <span class="todo-tag">TODO</span> ä½¿ç”¨fir1è®¾è®¡æ±‰æ˜çª—FIRä½é€šæ»¤æ³¢å™¨</span>
h = [];

%% ä»»åŠ¡äºŒï¼šé¢‘ç‡å“åº”åˆ†æ
Nfft = 1024;
<span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—é¢‘ç‡å“åº”</span>
H = [];
w = [];

<span class="comment">% <span class="todo-tag">TODO</span> ç»˜åˆ¶å¹…åº¦å“åº”(dB)å’Œç›¸ä½å“åº”</span>
figure('Name', 'ä»»åŠ¡äºŒ: é¢‘ç‡å“åº”');


%% ä»»åŠ¡ä¸‰ï¼šåŒéŸ³ä¿¡å·æ»¤æ³¢
<span class="comment">% <span class="todo-tag">TODO</span> ç”Ÿæˆæµ‹è¯•ä¿¡å· x[n] = cos(Ï‰1*n) + cos(Ï‰2*n)</span>
x = [];

<span class="comment">% <span class="todo-tag">TODO</span> ä½¿ç”¨convæ»¤æ³¢</span>
y = [];

<span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—FFTå¹¶ç»˜åˆ¶é¢‘è°±å¯¹æ¯”</span>
Nfft_sig = 1024;
X_fft = [];
Y_fft = [];

figure('Name', 'ä»»åŠ¡ä¸‰: ä¿¡å·æ»¤æ³¢');


%% ========================================
%  ğŸ” æäº¤å‰è‡ªæ£€ (è¯·å‹¿ä¿®æ”¹ä»¥ä¸‹ä»£ç )
%  ========================================
vars_chk = {'h', 'H', 'y', 'X_fft', 'Y_fft'};
miss = {};
for i = 1:length(vars_chk)
    if ~exist(vars_chk{i}, 'var') || isempty(eval(vars_chk{i}))
        miss{end+1} = vars_chk{i};
    end
end
if ~isempty(miss)
    fprintf(2, 'âŒ é”™è¯¯ï¼šä»¥ä¸‹å˜é‡æœªèµ‹å€¼æˆ–ä¸ºç©ºï¼š%s\n', strjoin(miss, ', '));
else
    fprintf('âœ… ç»ƒä¹ ä¸€å˜é‡æ£€æŸ¥é€šè¿‡ã€‚\n');
end
</pre>
            </div>
        </div>

        <!-- Exercise 2 -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title"><span class="arrow-icon">â–¼</span>ğŸ“„ exercise2_speech_filtering.m</span>
                <button class="copy-btn" onclick="copyCode(event, 'code2')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code2">%% ç»ƒä¹ äºŒï¼šè¯­éŸ³ä¿¡å·æ»¤æ³¢ç»¼åˆå®éªŒ
% æ–‡ä»¶å: exercise2_speech_filtering.m
% å­¦å·ï¼š______  å§“åï¼š______

%% æ•°æ®åŠ è½½
load('phdist.mat');     <span class="comment">% a1,b1,a2,b2,a3,b3,xnoise</span>
load('orig.mat');       <span class="comment">% x, Fs</span>

<span class="comment">% å¦‚æœæ•°æ®æ–‡ä»¶ä¸­æ²¡æœ‰Fsï¼Œè®¾ç½®é»˜è®¤å€¼ï¼›ç¡®ä¿ä¸ºdoubleç±»å‹</span>
if ~exist('Fs', 'var'), Fs = 8000; end
Fs = double(Fs);

fprintf('é‡‡æ ·ç‡: Fs = %d Hz\n', Fs);

%% ä»»åŠ¡ä¸€ï¼šå¹…åº¦å“åº”å¯¹æ¯”
Nfft = 1024;
<span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—ä¸‰ä¸ªæ»¤æ³¢å™¨çš„é¢‘ç‡å“åº”</span>
H1 = [];
H2 = [];
H3 = [];
w = [];

<span class="comment">% <span class="todo-tag">TODO</span> ç»˜åˆ¶å¹…åº¦å“åº”å¯¹æ¯”å›¾(dB)</span>
figure('Name', 'ä»»åŠ¡ä¸€: å¹…åº¦å“åº”');


%% ä»»åŠ¡äºŒï¼šç›¸ä½å“åº”å¯¹æ¯”
<span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—ç›¸ä½å“åº” (ä½¿ç”¨unwrap)</span>
H1_phase = [];
H2_phase = [];
H3_phase = [];

<span class="comment">% <span class="todo-tag">TODO</span> ç»˜åˆ¶ç›¸ä½å“åº”å¯¹æ¯”å›¾</span>
figure('Name', 'ä»»åŠ¡äºŒ: ç›¸ä½å“åº”');


%% ä»»åŠ¡ä¸‰ï¼šä¸»è§‚å¬è§‰æµ‹è¯•
<span class="comment">% <span class="todo-tag">TODO</span> å¯¹åŸå§‹è¯­éŸ³xæ»¤æ³¢</span>
y1 = [];
y2 = [];
y3 = [];

<span class="comment">% å–æ¶ˆæ³¨é‡Šæ’­æ”¾:</span>
<span class="comment">% soundsc(y1, Fs); pause(length(y1)/Fs+0.5);</span>

%% ä»»åŠ¡å››ï¼šå™ªå£°åˆ†æä¸å»å™ª
<span class="comment">% <span class="todo-tag">TODO</span> å¯¹xnoiseå»å™ª</span>
yn1 = [];
yn2 = [];
yn3 = [];

<span class="comment">% <span class="todo-tag">TODO</span> ç»˜åˆ¶é¢‘è°±å¯¹æ¯”</span>
figure('Name', 'ä»»åŠ¡å››: å»å™ªæ•ˆæœ');


%% ========================================
%  ğŸ” æäº¤å‰è‡ªæ£€ (è¯·å‹¿ä¿®æ”¹ä»¥ä¸‹ä»£ç )
%  ========================================
vars_chk = {'H1', 'H2', 'H3', 'y1', 'y2', 'y3', 'yn1', 'yn2', 'yn3'};
miss = {};
for i = 1:length(vars_chk)
    if ~exist(vars_chk{i}, 'var') || isempty(eval(vars_chk{i}))
        miss{end+1} = vars_chk{i};
    end
end
if ~isempty(miss)
    fprintf(2, 'âŒ é”™è¯¯ï¼šä»¥ä¸‹å˜é‡æœªèµ‹å€¼æˆ–ä¸ºç©ºï¼š%s\n', strjoin(miss, ', '));
else
    fprintf('âœ… ç»ƒä¹ äºŒå˜é‡æ£€æŸ¥é€šè¿‡ã€‚\n');
end
</pre>
            </div>
        </div>

        <!-- Exercise 3 -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title"><span class="arrow-icon">â–¼</span>ğŸ“„ exercise3_window_length.m</span>
                <button class="copy-btn" onclick="copyCode(event, 'code3')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code3">%% ç»ƒä¹ ä¸‰ï¼šçª—å‡½æ•°é•¿åº¦å¯¹æ»¤æ³¢å™¨æ€§èƒ½çš„å½±å“
% æ–‡ä»¶å: exercise3_window_length.m
% å­¦å·ï¼š______  å§“åï¼š______

%% å‚æ•°å®šä¹‰
N1 = 31;  N2 = 121;     <span class="comment">% çª—é•¿åº¦</span>
M1 = 30;  M2 = 120;     <span class="comment">% æ»¤æ³¢å™¨é˜¶æ•°</span>
Wn = 0.4;               <span class="comment">% æˆªæ­¢é¢‘ç‡</span>
Fs = 48000;             <span class="comment">% é‡‡æ ·ç‡</span>
f_cpu = 100e6;          <span class="comment">% CPUæ—¶é’Ÿ</span>

%% ä»»åŠ¡ä¸€ï¼šçŸ©å½¢çª—é¢‘è°±åˆ†æ
<span class="comment">% <span class="todo-tag">TODO</span> ç”ŸæˆçŸ©å½¢çª—</span>
w1 = [];
w2 = [];

<span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—4096ç‚¹FFT</span>
Nfft = 4096;
W1 = [];
W2 = [];

<span class="comment">% <span class="todo-tag">TODO</span> ç»˜åˆ¶é¢‘è°±å¯¹æ¯”</span>
figure('Name', 'ä»»åŠ¡ä¸€: çŸ©å½¢çª—é¢‘è°±');


%% ä»»åŠ¡äºŒï¼šFIRæ»¤æ³¢å™¨æ€§èƒ½å¯¹æ¯”
<span class="comment">% <span class="todo-tag">TODO</span> è®¾è®¡æ±‰æ˜çª—FIRæ»¤æ³¢å™¨</span>
h1 = [];
h2 = [];

<span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—é¢‘ç‡å“åº”</span>
H1 = [];
H2 = [];
H1_dB = [];
H2_dB = [];

<span class="comment">% <span class="todo-tag">TODO</span> ç»˜åˆ¶å¹…åº¦å“åº”å¯¹æ¯”</span>
figure('Name', 'ä»»åŠ¡äºŒ: FIRæ€§èƒ½å¯¹æ¯”');


%% ä»»åŠ¡ä¸‰ï¼šè®¡ç®—å¤æ‚åº¦åˆ†æ
<span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—MACæ“ä½œæ•°å’ŒCPUåˆ©ç”¨ç‡</span>
mac1 = [];
mac2 = [];
util1 = [];
util2 = [];

fprintf('M=%d: %dMAC, %.2f%%åˆ©ç”¨ç‡\n', M1, mac1, util1);
fprintf('M=%d: %dMAC, %.2f%%åˆ©ç”¨ç‡\n', M2, mac2, util2);

%% ========================================
%  ğŸ” æäº¤å‰è‡ªæ£€
%  ========================================
vars_chk = {'W1', 'W2', 'h1', 'h2', 'H1_dB', 'H2_dB', 'mac1', 'mac2'};
miss = {};
for i = 1:length(vars_chk)
    if ~exist(vars_chk{i}, 'var') || isempty(eval(vars_chk{i}))
        miss{end+1} = vars_chk{i};
    end
end
if ~isempty(miss)
    fprintf(2, 'âŒ é”™è¯¯ï¼šä»¥ä¸‹å˜é‡æœªèµ‹å€¼æˆ–ä¸ºç©ºï¼š%s\n', strjoin(miss, ', '));
else
    fprintf('âœ… ç»ƒä¹ ä¸‰å˜é‡æ£€æŸ¥é€šè¿‡ã€‚\n');
end
</pre>
            </div>
        </div>

        <!-- Exercise 4 -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title"><span class="arrow-icon">â–¼</span>ğŸ“„ exercise4_window_comparison.m</span>
                <button class="copy-btn" onclick="copyCode(event, 'code4')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code4">%% ç»ƒä¹ å››ï¼šçª—å‡½æ•°æ€§èƒ½å¯¹æ¯”ä¸ä¼˜åŒ–è®¾è®¡
% æ–‡ä»¶å: exercise4_window_comparison.m
% å­¦å·ï¼š______  å§“åï¼š______

%% å‚æ•°å®šä¹‰
M = 31;  N = M + 1;
Wn = 0.4;
Nfft = 4096;

%% ä»»åŠ¡ä¸€ï¼šå››ç§çª—å‡½æ•°å¯¹æ¯”
<span class="comment">% <span class="todo-tag">TODO</span> è®¾è®¡å››ç§çª—å‡½æ•°çš„æ»¤æ³¢å™¨</span>
h_rect = [];
h_hann = [];
h_hamm = [];
h_black = [];

<span class="comment">% <span class="todo-tag">TODO</span> æµ‹é‡é˜»å¸¦è¡°å‡</span>
atten_rect = [];
atten_hann = [];
atten_hamm = [];
atten_black = [];

<span class="comment">% <span class="todo-tag">TODO</span> ç»˜åˆ¶å¯¹æ¯”å›¾</span>
figure('Name', 'ä»»åŠ¡ä¸€: çª—å‡½æ•°å¯¹æ¯”');


%% ä»»åŠ¡äºŒï¼šå‡¯æ³½çª—å‚æ•°ä¼˜åŒ–
<span class="comment">% <span class="todo-tag">TODO</span> Î²=3,5,7,9çš„å‡¯æ³½çª—å¯¹æ¯”</span>
figure('Name', 'ä»»åŠ¡äºŒ: å‡¯æ³½çª—');


%% ä»»åŠ¡ä¸‰ï¼šé˜¶æ•°å½±å“
<span class="comment">% <span class="todo-tag">TODO</span> M=15,31,63,127çš„æ±‰æ˜çª—å¯¹æ¯”</span>
figure('Name', 'ä»»åŠ¡ä¸‰: é˜¶æ•°å½±å“');


%% ä»»åŠ¡å››ï¼šè®¾è®¡æŒ‘æˆ˜
<span class="comment">% è§„æ ¼: Ï‰p=0.3Ï€, Ï‰s=0.5Ï€, é˜»å¸¦â‰¥60dB</span>
<span class="comment">% <span class="todo-tag">TODO</span> è®¾è®¡æ»¡è¶³è§„æ ¼çš„æ»¤æ³¢å™¨</span>
M_design = [];
h_design = [];

<span class="comment">% <span class="todo-tag">TODO</span> éªŒè¯è®¾è®¡</span>
figure('Name', 'ä»»åŠ¡å››: è®¾è®¡éªŒè¯');


%% ========================================
%  ğŸ” æäº¤å‰è‡ªæ£€
%  ========================================
vars_chk = {'h_rect', 'h_hann', 'h_hamm', 'h_black', 'h_design'};
miss = {};
for i = 1:length(vars_chk)
    if ~exist(vars_chk{i}, 'var') || isempty(eval(vars_chk{i}))
        miss{end+1} = vars_chk{i};
    end
end
if ~isempty(miss)
    fprintf(2, 'âŒ é”™è¯¯ï¼šä»¥ä¸‹å˜é‡æœªèµ‹å€¼æˆ–ä¸ºç©ºï¼š%s\n', strjoin(miss, ', '));
else
    fprintf('âœ… ç»ƒä¹ å››å˜é‡æ£€æŸ¥é€šè¿‡ã€‚\n');
end
</pre>
            </div>
        </div>
    </div>

    <script>
        function toggleBlock(header) { header.parentElement.classList.toggle('collapsed'); }
        function expandAll() { document.querySelectorAll('.file-block').forEach(b => b.classList.remove('collapsed')); }
        function collapseAll() { document.querySelectorAll('.file-block').forEach(b => b.classList.add('collapsed')); }
        function copyCode(event, id) {
            event.stopPropagation();
            const el = document.createElement('textarea');
            el.value = document.getElementById(id).innerText;
            document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
            const btn = event.target; 
            btn.textContent = 'âœ“ å·²å¤åˆ¶'; btn.style.background = '#28a745';
            setTimeout(() => { btn.textContent = 'å¤åˆ¶ä»£ç '; btn.style.background = '#5ca353'; }, 2000);
        }
    </script>
</body>
</html>
