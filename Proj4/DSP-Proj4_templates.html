<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DSP é¡¹ç›®4 - DTWå­¤ç«‹è¯è¯­éŸ³è¯†åˆ«ä»£ç æ¨¡æ¿</title>
    <style>
        body { font-family: 'Segoe UI', Consolas, 'Microsoft YaHei', sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        .control-panel {
            position: sticky; top: 0; z-index: 100;
            background: white; padding: 15px; margin-bottom: 20px;
            border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .control-btn {
            background: #3498db; color: white; border: none; padding: 8px 16px;
            border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 10px;
        }
        .control-btn:hover { background: #2980b9; }
        .control-btn.secondary { background: #9b59b6; }

        .file-block { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; overflow: hidden; }
        
        .file-header { 
            background: linear-gradient(135deg, #3498db 0%, #9b59b6 100%); 
            color: white; padding: 15px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; user-select: none;
        }
        .file-header:hover { opacity: 0.9; }
        .file-header.completed { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); }
        .file-header.helper { background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%); }
        
        .file-title { font-weight: bold; display: flex; align-items: center; }
        .arrow-icon { display: inline-block; margin-right: 10px; transition: transform 0.3s; }
        .file-block.collapsed .arrow-icon { transform: rotate(-90deg); }
        
        .file-content { display: block; }
        .file-block.collapsed .file-content { display: none; }

        .copy-btn { background: #48bb78; border: none; color: white; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .copy-btn:hover { background: #38a169; }

        pre { margin: 0; padding: 20px; overflow-x: auto; line-height: 1.8; font-size: 13px; background: #f8f9fa; border-top: 1px solid #e9ecef; }
        
        .keyword { color: #0000ff; font-weight: bold; }
        .comment { color: #228b22; font-style: italic; }
        .string { color: #a020f0; }
        .number { color: #ff0000; }
        .todo { background: #fff3cd; color: #856404; padding: 2px 6px; border-radius: 3px; border: 1px solid #ffeeba; font-weight: bold; }
        
        .info-banner { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-left: 4px solid #3498db; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .warning-banner { background: linear-gradient(135deg, #fff3cd 0%, #fffdf7 100%); border-left: 4px solid #ed8936; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .success-banner { background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%); border-left: 4px solid #48bb78; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .test-banner { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-left: 4px solid #4caf50; padding: 15px; margin-bottom: 20px; border-radius: 4px; }

        code { background: #edf2f7; padding: 2px 6px; border-radius: 3px; color: #3498db; font-size: 0.95em; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 10px; }
        .tag-required { background: #fed7d7; color: #c53030; }
        .tag-completed { background: #c6f6d5; color: #276749; }
        .tag-helper { background: #e2e8f0; color: #4a5568; }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <h2 style="margin:0; color:#3498db;">ğŸ¤ DSP é¡¹ç›®4 - DTWå­¤ç«‹è¯è¯­éŸ³è¯†åˆ«ä»£ç æ¨¡æ¿</h2>
            <div>
                <button class="control-btn" onclick="expandAll()">å…¨éƒ¨å±•å¼€</button>
                <button class="control-btn secondary" onclick="collapseAll()">å…¨éƒ¨æŠ˜å </button>
            </div>
        </div>

        <div class="info-banner">
            <strong>ğŸ“Œ é¡¹ç›®è¯´æ˜ï¼š</strong>
            <ul style="margin:5px 0 0 20px; padding:0; line-height:1.8;">
                <li>æœ¬é¡¹ç›®å®ç°åŸºäº<strong>åŠ¨æ€æ—¶é—´è§„æ•´ï¼ˆDTWï¼‰</strong>çš„å­¤ç«‹è¯è¯­éŸ³è¯†åˆ«ç³»ç»Ÿ</li>
                <li>ä»£ç ä¸­ <code>?</code> æ ‡è®°å¤„éœ€è¦å¡«å†™åˆé€‚çš„ä»£ç </li>
                <li><code>ex0</code>ã€<code>ex5</code>ã€<code>ex6</code> å·²å®Œæˆï¼Œ<strong>æ— éœ€ä¿®æ”¹</strong></li>
                <li>å®Œæˆåä½¿ç”¨ <code>test_Project4.p</code> è¿›è¡Œè‡ªåŠ¨æ£€æŸ¥</li>
            </ul>
        </div>

        <div class="warning-banner">
            <strong>âš ï¸ æäº¤æ¸…å•ï¼š</strong>
            <ul style="margin:5px 0 0 20px; padding:0;">
                <li>ex1_preemphasis.mï¼ˆé¢„åŠ é‡æ»¤æ³¢ï¼‰<span class="tag tag-required">éœ€ä¿®æ”¹</span></li>
                <li>ex2_enframe.mï¼ˆä¿¡å·åˆ†å¸§ï¼‰<span class="tag tag-required">éœ€ä¿®æ”¹</span></li>
                <li>ex3_mfcc.mï¼ˆMFCCç‰¹å¾æå–ï¼‰<span class="tag tag-required">éœ€ä¿®æ”¹</span></li>
                <li>ex4_dtw.mï¼ˆDTWåŠ¨æ€è§„æ•´ï¼‰<span class="tag tag-required">éœ€ä¿®æ”¹</span></li>
            </ul>
        </div>

        <div class="success-banner">
            <strong>âœ… å®éªŒæµç¨‹ï¼š</strong>
            <ol style="margin:5px 0 0 20px; padding:0; line-height:1.8;">
                <li>é˜…è¯»å®éªŒæ‰‹å†Œã€ŠDTWè¯­éŸ³è¯†åˆ«ã€‹ï¼ˆproj4_handoutï¼‰</li>
                <li>æŒ‰é¡ºåºå®Œæˆ ex1, ex2, ex3, ex4ï¼Œå¡«å†™æ ‡è®°ä¸º <code>?</code> çš„ä»£ç </li>
                <li>è¿è¡Œ <code>test_Project4.p</code> æ£€æŸ¥ä»£ç </li>
                <li>è¾“å…¥ 9 ç”ŸæˆåŠ å¯†æˆç»©ï¼Œå°†æ–‡ä»¶å‹ç¼©ä¸ºã€å­¦å·_å§“å.zipã€‘æäº¤</li>
            </ol>
        </div>

        <!-- ex0 ä¸»å‡½æ•° -->
        <div class="file-block collapsed">
            <div class="file-header completed" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex0_all.mï¼ˆä¸»ç¨‹åºï¼‰<span class="tag tag-completed">å·²å®Œæˆ</span>
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code0')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code0"><span class="comment">%% ex0_all.m - DTWå­¤ç«‹è¯è¯­éŸ³è¯†åˆ«ä¸»ç¨‹åº</span>
<span class="comment">%</span>
<span class="comment">%  åŠŸèƒ½: æ‰¹é‡è¯†åˆ« audio/ ç›®å½•ä¸‹çš„æ‰€æœ‰ wav æ–‡ä»¶</span>
<span class="comment">%</span>
<span class="comment">%  è°ƒç”¨å…³ç³»:</span>
<span class="comment">%      ex0_main</span>
<span class="comment">%        â”œâ”€â”€ ex6_vad        (ç«¯ç‚¹æ£€æµ‹)</span>
<span class="comment">%        â”œâ”€â”€ ex3_mfcc       (MFCCç‰¹å¾æå–)</span>
<span class="comment">%        â”‚     â”œâ”€â”€ ex1_preemphasis  (é¢„åŠ é‡)</span>
<span class="comment">%        â”‚     â””â”€â”€ ex2_enframe      (åˆ†å¸§)</span>
<span class="comment">%        â””â”€â”€ ex5_recognize  (è¯†åˆ«å†³ç­–)</span>
<span class="comment">%              â””â”€â”€ ex4_dtw  (DTWè®¡ç®—)</span>
<span class="comment">%</span>
<span class="comment">%  éŸ³é¢‘æ–‡ä»¶å‘½åè§„åˆ™ (è‡ªåŠ¨ä»æ–‡ä»¶åæå–çœŸå®æ ‡ç­¾):</span>
<span class="comment">%      - æ–‡ä»¶åä¸­åŒ…å«æ•°å­—0-9å³å¯</span>
<span class="comment">%      - ä¾‹å¦‚: 0_male.wav, female_3.wav, test5.wav, æ•°å­—7.wav</span>
<span class="comment">%</span>
<span class="comment">%  å—äº¬å·¥ä¸šå¤§å­¦æµ¦æ±Ÿå­¦é™¢ - DSPè¯¾ç¨‹å®éªŒ</span>

<span class="keyword">clear</span>; <span class="keyword">clc</span>; <span class="keyword">close</span> <span class="keyword">all</span>;

<span class="comment">%% ==================== é…ç½®å‚æ•° ====================</span>
audio_dir = <span class="string">'audio'</span>;  <span class="comment">% éŸ³é¢‘æ–‡ä»¶ç›®å½•</span>

<span class="comment">% MFCCå‚æ•° (ä¸æ¨¡æ¿æå–æ—¶ä¸€è‡´)</span>
params = <span class="keyword">struct</span>();
params.frame_len_ms = <span class="number">25</span>;      <span class="comment">% å¸§é•¿ 25ms</span>
params.frame_shift_ms = <span class="number">10</span>;    <span class="comment">% å¸§ç§» 10ms</span>
params.pre_emphasis = <span class="number">0.97</span>;    <span class="comment">% é¢„åŠ é‡ç³»æ•°</span>
params.nfft = <span class="number">2048</span>;            <span class="comment">% FFTç‚¹æ•°</span>
params.num_filters = <span class="number">32</span>;       <span class="comment">% Melæ»¤æ³¢å™¨æ•°</span>
params.num_ceps = <span class="number">12</span>;          <span class="comment">% MFCCç³»æ•°æ•° (ä¸å«0é˜¶)</span>
params.lifter_coef = <span class="number">22</span>;       <span class="comment">% å‡å€’è°±ç³»æ•°</span>
params.delta_N = <span class="number">2</span>;            <span class="comment">% å·®åˆ†çª—å£</span>

<span class="comment">%% ==================== æ˜¾ç¤ºä¿¡æ¯ ====================</span>
fprintf(<span class="string">'â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—\n'</span>);
fprintf(<span class="string">'â•‘       DTW å­¤ç«‹è¯è¯­éŸ³è¯†åˆ«ç³»ç»Ÿ (æ‰¹é‡æ¨¡å¼)           â•‘\n'</span>);
fprintf(<span class="string">'â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£\n'</span>);
fprintf(<span class="string">'â•‘  éŸ³é¢‘ç›®å½•: %-38sâ•‘\n'</span>, audio_dir);
fprintf(<span class="string">'â•‘  ç‰¹å¾ç»´åº¦: 36 (12 MFCC + 12 Î” + 12 Î”Î”)          â•‘\n'</span>);
fprintf(<span class="string">'â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n'</span>);

<span class="comment">%% ==================== åŠ è½½æ¨¡æ¿åº“ ====================</span>
fprintf(<span class="string">'[1/3] åŠ è½½æ¨¡æ¿åº“...\n'</span>);

<span class="keyword">if</span> ~exist(<span class="string">'template.mat'</span>, <span class="string">'file'</span>)
    error(<span class="string">'æ‰¾ä¸åˆ° template.mat æ–‡ä»¶ï¼'</span>);
<span class="keyword">end</span>

load(<span class="string">'template.mat'</span>, <span class="string">'template'</span>);

<span class="comment">% è½¬æ¢ä¸ºcellæ•°ç»„æ ¼å¼</span>
<span class="keyword">if</span> iscell(template)
    templates = template;
<span class="keyword">else</span>
    templates = cell(<span class="number">1</span>, <span class="number">10</span>);
    <span class="keyword">for</span> i = <span class="number">1</span>:<span class="number">10</span>
        templates{i} = template{i};
    <span class="keyword">end</span>
<span class="keyword">end</span>

fprintf(<span class="string">'      âœ“ å·²åŠ è½½ %d ä¸ªæ¨¡æ¿ (æ•°å­— 0-9)\n\n'</span>, length(templates));

<span class="comment">%% ==================== æ‰«æéŸ³é¢‘æ–‡ä»¶ ====================</span>
fprintf(<span class="string">'[2/3] æ‰«æéŸ³é¢‘æ–‡ä»¶...\n'</span>);

<span class="keyword">if</span> ~exist(audio_dir, <span class="string">'dir'</span>)
    error(<span class="string">'æ‰¾ä¸åˆ°éŸ³é¢‘ç›®å½•: %s'</span>, audio_dir);
<span class="keyword">end</span>

<span class="comment">% è·å–æ‰€æœ‰wavæ–‡ä»¶</span>
wav_files = dir(fullfile(audio_dir, <span class="string">'*.wav'</span>));

<span class="keyword">if</span> isempty(wav_files)
    error(<span class="string">'éŸ³é¢‘ç›®å½•ä¸­æ²¡æœ‰æ‰¾åˆ° .wav æ–‡ä»¶'</span>);
<span class="keyword">end</span>

fprintf(<span class="string">'      âœ“ æ‰¾åˆ° %d ä¸ªéŸ³é¢‘æ–‡ä»¶\n\n'</span>, length(wav_files));

<span class="comment">%% ==================== æ‰¹é‡è¯†åˆ« ====================</span>
fprintf(<span class="string">'[3/3] å¼€å§‹è¯†åˆ«...\n'</span>);
fprintf(<span class="string">'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n'</span>);
fprintf(<span class="string">'  åºå·  æ–‡ä»¶å                    çœŸå®  è¯†åˆ«  ç»“æœ    DTWè·ç¦»\n'</span>);
fprintf(<span class="string">'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n'</span>);

num_files = length(wav_files);
results = zeros(num_files, <span class="number">1</span>);      <span class="comment">% è¯†åˆ«ç»“æœ</span>
true_labels = zeros(num_files, <span class="number">1</span>);  <span class="comment">% çœŸå®æ ‡ç­¾</span>
scores_all = zeros(num_files, <span class="number">10</span>);  <span class="comment">% æ‰€æœ‰DTWå¾—åˆ†</span>
correct = <span class="number">0</span>;
has_label = <span class="number">0</span>;

<span class="keyword">for</span> i = <span class="number">1</span>:num_files
    filename = wav_files(i).name;
    filepath = fullfile(audio_dir, filename);
    
    <span class="comment">% è¯»å–éŸ³é¢‘</span>
    [audio, fs] = audioread(filepath);
    
    <span class="comment">% å¦‚æœæ˜¯åŒå£°é“ï¼Œå–ç¬¬ä¸€å£°é“</span>
    <span class="keyword">if</span> size(audio, <span class="number">2</span>) > <span class="number">1</span>
        audio = audio(:, <span class="number">1</span>);
    <span class="keyword">end</span>
    
    <span class="comment">% ç«¯ç‚¹æ£€æµ‹</span>
    audio_vad = ex6_vad(audio, fs);
    
    <span class="comment">% æ£€æŸ¥æœ‰æ•ˆæ€§</span>
    <span class="keyword">if</span> length(audio_vad) < fs * <span class="number">0.05</span>
        fprintf(<span class="string">'  %3d   %-25s  è·³è¿‡ (è¯­éŸ³å¤ªçŸ­)\n'</span>, i, filename);
        results(i) = <span class="number">-1</span>;
        true_labels(i) = <span class="number">-1</span>;
        <span class="keyword">continue</span>;
    <span class="keyword">end</span>
    
    <span class="comment">% MFCCæå–</span>
    test_feat = ex3_mfcc(audio_vad, fs, params);
    
    <span class="comment">% DTWè¯†åˆ«</span>
    [result, scores, ~] = ex5_recognize(test_feat, templates);
    results(i) = result;
    scores_all(i, :) = scores;
    
    <span class="comment">% å°è¯•ä»æ–‡ä»¶åæå–çœŸå®æ ‡ç­¾</span>
    true_label = extract_label(filename);
    true_labels(i) = true_label;
    
    <span class="comment">% åˆ¤æ–­æ­£è¯¯</span>
    <span class="keyword">if</span> true_label >= <span class="number">0</span>
        has_label = has_label + <span class="number">1</span>;
        <span class="keyword">if</span> result == true_label
            correct = correct + <span class="number">1</span>;
            status = <span class="string">'âœ“'</span>;
        <span class="keyword">else</span>
            status = <span class="string">'âœ—'</span>;
        <span class="keyword">end</span>
        fprintf(<span class="string">'  %3d   %-25s   %d     %d     %s     %.2f\n'</span>, ...
                i, filename, true_label, result, status, min(scores));
    <span class="keyword">else</span>
        fprintf(<span class="string">'  %3d   %-25s   -     %d     -     %.2f\n'</span>, ...
                i, filename, result, min(scores));
    <span class="keyword">end</span>
<span class="keyword">end</span>

fprintf(<span class="string">'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n'</span>);

<span class="comment">%% ==================== ç»Ÿè®¡ç»“æœ ====================</span>
fprintf(<span class="string">'\n'</span>);
fprintf(<span class="string">'â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n'</span>);
fprintf(<span class="string">'â”‚                      è¯†åˆ«ç»“æœç»Ÿè®¡                          â”‚\n'</span>);
fprintf(<span class="string">'â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n'</span>);
fprintf(<span class="string">'â”‚  æ€»æ–‡ä»¶æ•°:     %3d                                         â”‚\n'</span>, num_files);

<span class="keyword">if</span> has_label > <span class="number">0</span>
    accuracy = correct / has_label * <span class="number">100</span>;
    fprintf(<span class="string">'â”‚  æœ‰æ ‡ç­¾æ–‡ä»¶:   %3d                                         â”‚\n'</span>, has_label);
    fprintf(<span class="string">'â”‚  è¯†åˆ«æ­£ç¡®:     %3d                                         â”‚\n'</span>, correct);
    fprintf(<span class="string">'â”‚  è¯†åˆ«é”™è¯¯:     %3d                                         â”‚\n'</span>, has_label - correct);
    fprintf(<span class="string">'â”‚  å‡†ç¡®ç‡:       %.1f%%                                       â”‚\n'</span>, accuracy);
<span class="keyword">else</span>
    fprintf(<span class="string">'â”‚  (æ— æ³•è®¡ç®—å‡†ç¡®ç‡ - æ–‡ä»¶åä¸­æœªåŒ…å«æ•°å­—æ ‡ç­¾)                 â”‚\n'</span>);
<span class="keyword">end</span>

fprintf(<span class="string">'â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n'</span>);

fprintf(<span class="string">'\nç¨‹åºç»“æŸã€‚\n'</span>);

<span class="comment">%% ==================== è¾…åŠ©å‡½æ•° ====================</span>
<span class="keyword">function</span> label = extract_label(filename)
<span class="comment">%EXTRACT_LABEL ä»æ–‡ä»¶åä¸­æå–æ•°å­—æ ‡ç­¾</span>

    [~, name, ~] = fileparts(filename);
    
    <span class="keyword">if</span> ~isempty(name) && name(<span class="number">1</span>) >= <span class="string">'0'</span> && name(<span class="number">1</span>) <= <span class="string">'9'</span>
        label = str2double(name(<span class="number">1</span>));
        <span class="keyword">return</span>;
    <span class="keyword">end</span>
    
    digits = regexp(name, <span class="string">'\d'</span>, <span class="string">'match'</span>);
    <span class="keyword">if</span> ~isempty(digits)
        label = str2double(digits{<span class="number">1</span>});
        <span class="keyword">if</span> label >= <span class="number">0</span> && label <= <span class="number">9</span>
            <span class="keyword">return</span>;
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    
    chinese_digits = {<span class="string">'é›¶'</span>, <span class="string">'ä¸€'</span>, <span class="string">'äºŒ'</span>, <span class="string">'ä¸‰'</span>, <span class="string">'å››'</span>, <span class="string">'äº”'</span>, <span class="string">'å…­'</span>, <span class="string">'ä¸ƒ'</span>, <span class="string">'å…«'</span>, <span class="string">'ä¹'</span>};
    <span class="keyword">for</span> i = <span class="number">1</span>:<span class="number">10</span>
        <span class="keyword">if</span> contains(name, chinese_digits{i})
            label = i - <span class="number">1</span>;
            <span class="keyword">return</span>;
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    
    label = <span class="number">-1</span>;
<span class="keyword">end</span></pre>
            </div>
        </div>

        <!-- ex1 é¢„åŠ é‡ -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex1_preemphasis.mï¼ˆé¢„åŠ é‡æ»¤æ³¢ï¼‰<span class="tag tag-required">éœ€ä¿®æ”¹</span>
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code1')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code1"><span class="keyword">function</span> y = ex1_preemphasis(x, alpha)
<span class="comment">%EX1_PREEMPHASIS é¢„åŠ é‡æ»¤æ³¢</span>
<span class="comment">%</span>
<span class="comment">%   y = ex1_preemphasis(x, alpha)</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å…¥:</span>
<span class="comment">%       x     - è¯­éŸ³ä¿¡å· (åˆ—å‘é‡)</span>
<span class="comment">%       alpha - é¢„åŠ é‡ç³»æ•°, é»˜è®¤ 0.97</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å‡º:</span>
<span class="comment">%       y     - é¢„åŠ é‡åçš„ä¿¡å·</span>
<span class="comment">%</span>
<span class="comment">%   å…¬å¼:</span>
<span class="comment">%       y[n] = x[n] - alpha * x[n-1]</span>
<span class="comment">%</span>
<span class="comment">%   è¯´æ˜:</span>
<span class="comment">%       é¢„åŠ é‡ç”¨äºè¡¥å¿è¯­éŸ³ä¿¡å·çš„é«˜é¢‘è¡°å‡ï¼Œä½¿é¢‘è°±æ›´åŠ å¹³å¦</span>
<span class="comment">%       å®ç°ä¸ºä¸€é˜¶é«˜é€šFIRæ»¤æ³¢å™¨: H(z) = 1 - alpha*z^(-1)</span>

<span class="keyword">if</span> nargin < <span class="number">2</span>
    alpha = <span class="number">0.97</span>;
<span class="keyword">end</span>

x = x(:);  <span class="comment">% ç¡®ä¿åˆ—å‘é‡</span>

<span class="comment">% TODO: ä½¿ç”¨filterå‡½æ•°å®ç°ä¸€é˜¶é«˜é€šæ»¤æ³¢å™¨</span>
<span class="comment">% æ»¤æ³¢å™¨ç³»æ•° b = [1, -alpha], a = 1</span>
y = filter(<span class="todo">?</span>, <span class="number">1</span>, x);

<span class="keyword">end</span></pre>
            </div>
        </div>

        <!-- ex2 åˆ†å¸§ -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex2_enframe.mï¼ˆä¿¡å·åˆ†å¸§ï¼‰<span class="tag tag-required">éœ€ä¿®æ”¹</span>
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code2')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code2"><span class="keyword">function</span> frames = ex2_enframe(x, frame_len, frame_shift)
<span class="comment">%EX2_ENFRAME å°†ä¿¡å·åˆ†å¸§</span>
<span class="comment">%</span>
<span class="comment">%   frames = ex2_enframe(x, frame_len, frame_shift)</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å…¥:</span>
<span class="comment">%       x           - è¯­éŸ³ä¿¡å· (åˆ—å‘é‡)</span>
<span class="comment">%       frame_len   - å¸§é•¿ (é‡‡æ ·ç‚¹æ•°)</span>
<span class="comment">%       frame_shift - å¸§ç§» (é‡‡æ ·ç‚¹æ•°)</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å‡º:</span>
<span class="comment">%       frames - åˆ†å¸§çŸ©é˜µ [frame_len x num_frames]</span>
<span class="comment">%                æ¯åˆ—æ˜¯ä¸€å¸§</span>
<span class="comment">%</span>
<span class="comment">%   è¯´æ˜:</span>
<span class="comment">%       å…¸å‹å‚æ•°: å¸§é•¿25ms, å¸§ç§»10ms</span>
<span class="comment">%       å¯¹äº16kHzé‡‡æ ·ç‡: frame_len=400, frame_shift=160</span>
<span class="comment">%       å¸§æ•°è®¡ç®—å…¬å¼: num_frames = floor((N - frame_len) / frame_shift) + 1</span>

x = x(:);
N = length(x);

<span class="comment">% TODO: æ ¹æ®å…¬å¼è®¡ç®—å¸§æ•°</span>
<span class="comment">% num_frames = floor((ä¿¡å·é•¿åº¦ - å¸§é•¿) / å¸§ç§») + 1</span>
num_frames = <span class="todo">?</span>;

<span class="keyword">if</span> num_frames < <span class="number">1</span>
    error(<span class="string">'ä¿¡å·å¤ªçŸ­ï¼Œæ— æ³•åˆ†å¸§'</span>);
<span class="keyword">end</span>

<span class="comment">% åˆ†å¸§</span>
frames = zeros(frame_len, num_frames);
<span class="keyword">for</span> i = <span class="number">1</span>:num_frames
    <span class="comment">% TODO: è®¡ç®—ç¬¬iå¸§çš„èµ·å§‹ç´¢å¼•</span>
    <span class="comment">% ç¬¬1å¸§ä»ç´¢å¼•1å¼€å§‹ï¼Œç¬¬2å¸§ä»ç´¢å¼•(1+frame_shift)å¼€å§‹ï¼Œä»¥æ­¤ç±»æ¨</span>
    start_idx = <span class="todo">?</span>;
    frames(:, i) = x(start_idx : start_idx + frame_len - <span class="number">1</span>);
<span class="keyword">end</span>

<span class="keyword">end</span></pre>
            </div>
        </div>

        <!-- ex3 MFCC -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex3_mfcc.mï¼ˆMFCCç‰¹å¾æå–ï¼‰<span class="tag tag-required">éœ€ä¿®æ”¹</span>
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code3')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code3"><span class="keyword">function</span> [mfcc_all, mfcc_base] = ex3_mfcc(x, fs, params)
<span class="comment">%EX3_MFCC è®¡ç®—MFCCç‰¹å¾ (å«Deltaå’ŒDelta-Delta)</span>
<span class="comment">%</span>
<span class="comment">%   [mfcc_all, mfcc_base] = ex3_mfcc(x, fs, params)</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å…¥:</span>
<span class="comment">%       x      - è¯­éŸ³ä¿¡å·</span>
<span class="comment">%       fs     - é‡‡æ ·ç‡</span>
<span class="comment">%       params - å‚æ•°ç»“æ„ä½“ (å¯é€‰)</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å‡º:</span>
<span class="comment">%       mfcc_all  - å®Œæ•´ç‰¹å¾ [36 x num_frames] (MFCC + Delta + Delta-Delta)</span>
<span class="comment">%       mfcc_base - åŸºç¡€MFCC [12 x num_frames]</span>
<span class="comment">%</span>
<span class="comment">%   å¤„ç†æµç¨‹:</span>
<span class="comment">%       1. é¢„åŠ é‡</span>
<span class="comment">%       2. åˆ†å¸§</span>
<span class="comment">%       3. åŠ çª— (æ±‰å®çª—)</span>
<span class="comment">%       4. FFT -> åŠŸç‡è°±</span>
<span class="comment">%       5. Melæ»¤æ³¢å™¨ç»„</span>
<span class="comment">%       6. å–å¯¹æ•°</span>
<span class="comment">%       7. DCT</span>
<span class="comment">%       8. å‡å€’è°± (Liftering)</span>
<span class="comment">%       9. è®¡ç®—Deltaå’ŒDelta-Delta</span>

<span class="comment">%% é»˜è®¤å‚æ•°</span>
<span class="keyword">if</span> nargin < <span class="number">3</span>
    params = <span class="keyword">struct</span>();
<span class="keyword">end</span>

<span class="comment">% è®¾ç½®é»˜è®¤å€¼</span>
<span class="keyword">if</span> ~isfield(params, <span class="string">'frame_len_ms'</span>),  params.frame_len_ms = <span class="number">25</span>; <span class="keyword">end</span>
<span class="keyword">if</span> ~isfield(params, <span class="string">'frame_shift_ms'</span>), params.frame_shift_ms = <span class="number">10</span>; <span class="keyword">end</span>
<span class="keyword">if</span> ~isfield(params, <span class="string">'pre_emphasis'</span>),  params.pre_emphasis = <span class="number">0.97</span>; <span class="keyword">end</span>
<span class="keyword">if</span> ~isfield(params, <span class="string">'nfft'</span>),          params.nfft = <span class="number">2048</span>; <span class="keyword">end</span>
<span class="keyword">if</span> ~isfield(params, <span class="string">'num_filters'</span>),   params.num_filters = <span class="number">32</span>; <span class="keyword">end</span>
<span class="keyword">if</span> ~isfield(params, <span class="string">'num_ceps'</span>),      params.num_ceps = <span class="number">12</span>; <span class="keyword">end</span>
<span class="keyword">if</span> ~isfield(params, <span class="string">'lifter_coef'</span>),   params.lifter_coef = <span class="number">22</span>; <span class="keyword">end</span>
<span class="keyword">if</span> ~isfield(params, <span class="string">'delta_N'</span>),       params.delta_N = <span class="number">2</span>; <span class="keyword">end</span>

<span class="comment">%% Step 1: é¢„åŠ é‡</span>
x_emph = ex1_preemphasis(x, params.pre_emphasis);

<span class="comment">%% Step 2: åˆ†å¸§</span>
frame_len = round(params.frame_len_ms * fs / <span class="number">1000</span>);
frame_shift = round(params.frame_shift_ms * fs / <span class="number">1000</span>);
frames = ex2_enframe(x_emph, frame_len, frame_shift);
num_frames = size(frames, <span class="number">2</span>);

<span class="comment">%% Step 3: åŠ çª— (æ±‰å®çª—)</span>
<span class="comment">% TODO: åˆ›å»ºå‘¨æœŸæ€§æ±‰å®çª—ï¼Œé•¿åº¦ä¸º frame_len</span>
<span class="comment">% ä½¿ç”¨ hann(N, 'periodic') ç”Ÿæˆçª—å‡½æ•°</span>
win = <span class="todo">?</span>;

<span class="comment">% TODO: å¯¹æ¯å¸§åº”ç”¨çª—å‡½æ•° (é€å…ƒç´ ç›¸ä¹˜)</span>
<span class="comment">% ä½¿ç”¨ repmat å°†çª—å‡½æ•°å¤åˆ¶æˆä¸ frames ç›¸åŒåˆ—æ•°çš„çŸ©é˜µ</span>
frames_win = <span class="todo">?</span>;

<span class="comment">%% Step 4: FFT -> åŠŸç‡è°±</span>
nfft = params.nfft;

<span class="comment">% TODO: å¯¹åŠ çª—åçš„å¸§è¿›è¡Œ nfft ç‚¹ FFT</span>
X = <span class="todo">?</span>;

<span class="comment">% TODO: åªå–æ­£é¢‘ç‡éƒ¨åˆ† (å‰ nfft/2+1 ä¸ªç‚¹)</span>
<span class="comment">% è®¡ç®—åŠŸç‡è°±: P = (1/nfft) * |X|^2</span>
pow_spec = <span class="todo">?</span>;

<span class="comment">%% Step 5: Melæ»¤æ³¢å™¨ç»„</span>
num_filters = params.num_filters;
mel_bank = create_mel_filterbank(fs, nfft, num_filters, <span class="number">0</span>, fs/<span class="number">2</span>);
<span class="comment">% åº”ç”¨æ»¤æ³¢å™¨: [num_filters x num_frames]</span>
mel_energy = mel_bank * pow_spec;
<span class="comment">% é¿å…log(0)</span>
mel_energy = max(mel_energy, eps);

<span class="comment">%% Step 6: å–å¯¹æ•°</span>
log_mel = log(mel_energy);

<span class="comment">%% Step 7: DCT</span>
<span class="comment">% TODO: å¯¹å¯¹æ•°æ¢…å°”èƒ½é‡è¿›è¡Œç¦»æ•£ä½™å¼¦å˜æ¢</span>
<span class="comment">% ä½¿ç”¨ MATLAB å†…ç½®çš„ dct å‡½æ•°</span>
dct_coef = <span class="todo">?</span>;

<span class="comment">% TODO: ä¿ç•™ç¬¬2åˆ°ç¬¬(num_ceps+1)é˜¶ç³»æ•°ï¼Œå³å»æ‰0é˜¶èƒ½é‡é¡¹</span>
<span class="comment">% MFCCé€šå¸¸ä¸ä½¿ç”¨ç¬¬0é˜¶(ä»£è¡¨èƒ½é‡)ï¼Œè€Œæ˜¯å–ç¬¬1-12é˜¶</span>
num_ceps = params.num_ceps;
mfcc_base = <span class="todo">?</span>;

<span class="comment">%% Step 8: å‡å€’è°± (Liftering)</span>
L = params.lifter_coef;
n = (<span class="number">1</span>:num_ceps)';
lifter = <span class="number">1</span> + (L/<span class="number">2</span>) * sin(pi * n / L);
mfcc_base = mfcc_base .* repmat(lifter, <span class="number">1</span>, num_frames);

<span class="comment">%% Step 9: è®¡ç®—Deltaå’ŒDelta-Delta</span>
delta = compute_delta(mfcc_base, params.delta_N);
delta_delta = compute_delta(delta, params.delta_N);

<span class="comment">%% åˆå¹¶è¾“å‡º [36 x num_frames]</span>
mfcc_all = [mfcc_base; delta; delta_delta];

<span class="keyword">end</span>

<span class="comment">%% ==================== è¾…åŠ©å‡½æ•° ====================</span>

<span class="keyword">function</span> mel_bank = create_mel_filterbank(fs, nfft, num_filters, low_freq, high_freq)
<span class="comment">%CREATE_MEL_FILTERBANK åˆ›å»ºæ¢…å°”ä¸‰è§’æ»¤æ³¢å™¨ç»„</span>

<span class="comment">% Hz -> Mel</span>
hz2mel = @(f) <span class="number">2595</span> * log10(<span class="number">1</span> + f/<span class="number">700</span>);
<span class="comment">% Mel -> Hz</span>
mel2hz = @(m) <span class="number">700</span> * (<span class="number">10</span>.^(m/<span class="number">2595</span>) - <span class="number">1</span>);

<span class="comment">% æ¢…å°”é¢‘ç‡èŒƒå›´</span>
low_mel = hz2mel(low_freq);
high_mel = hz2mel(high_freq);

<span class="comment">% åœ¨æ¢…å°”å°ºåº¦ä¸Šå‡åŒ€åˆ†å¸ƒ (num_filters + 2) ä¸ªç‚¹</span>
mel_points = linspace(low_mel, high_mel, num_filters + <span class="number">2</span>);
hz_points = mel2hz(mel_points);

<span class="comment">% è½¬æ¢ä¸ºFFT binç´¢å¼•</span>
bin_points = floor(hz_points / fs * nfft) + <span class="number">1</span>;
bin_points = min(bin_points, nfft/<span class="number">2</span> + <span class="number">1</span>);
bin_points = max(bin_points, <span class="number">1</span>);

<span class="comment">% æ„å»ºæ»¤æ³¢å™¨ç»„</span>
num_bins = nfft/<span class="number">2</span> + <span class="number">1</span>;
mel_bank = zeros(num_filters, num_bins);

<span class="keyword">for</span> i = <span class="number">1</span>:num_filters
    left = bin_points(i);
    center = bin_points(i + <span class="number">1</span>);
    right = bin_points(i + <span class="number">2</span>);
    
    <span class="comment">% ä¸Šå‡æ²¿</span>
    <span class="keyword">for</span> k = left:center
        <span class="keyword">if</span> center ~= left
            mel_bank(i, k) = (k - left) / (center - left);
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    
    <span class="comment">% ä¸‹é™æ²¿</span>
    <span class="keyword">for</span> k = center:right
        <span class="keyword">if</span> right ~= center
            mel_bank(i, k) = (right - k) / (right - center);
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">end</span>

<span class="keyword">function</span> delta = compute_delta(feat, N)
<span class="comment">%COMPUTE_DELTA è®¡ç®—å·®åˆ†ç³»æ•°</span>
<span class="comment">%</span>
<span class="comment">%   å…¬å¼:</span>
<span class="comment">%       delta[t] = sum(n * (c[t+n] - c[t-n])) / (2 * sum(n^2))</span>
<span class="comment">%       n = 1, 2, ..., N</span>

[num_ceps, num_frames] = size(feat);
delta = zeros(num_ceps, num_frames);

<span class="comment">% å½’ä¸€åŒ–å› å­</span>
denom = <span class="number">2</span> * sum((<span class="number">1</span>:N).^<span class="number">2</span>);

<span class="keyword">for</span> t = <span class="number">1</span>:num_frames
    numerator = zeros(num_ceps, <span class="number">1</span>);
    <span class="keyword">for</span> n = <span class="number">1</span>:N
        <span class="comment">% è¾¹ç•Œå¤„ç†: å¤åˆ¶è¾¹ç•Œå€¼</span>
        t_plus = min(t + n, num_frames);
        t_minus = max(t - n, <span class="number">1</span>);
        numerator = numerator + n * (feat(:, t_plus) - feat(:, t_minus));
    <span class="keyword">end</span>
    delta(:, t) = numerator / denom;
<span class="keyword">end</span>

<span class="keyword">end</span></pre>
            </div>
        </div>

        <!-- ex4 DTW -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex4_dtw.mï¼ˆDTWåŠ¨æ€è§„æ•´ï¼‰<span class="tag tag-required">éœ€ä¿®æ”¹</span>
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code4')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code4"><span class="keyword">function</span> [dist, D, path] = ex4_dtw(template, test, normalize_flag)
<span class="comment">%EX4_DTW åŠ¨æ€æ—¶é—´è§„æ•´ç®—æ³•</span>
<span class="comment">%</span>
<span class="comment">%   [dist, D, path] = ex4_dtw(template, test, normalize_flag)</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å…¥:</span>
<span class="comment">%       template       - æ¨¡æ¿ç‰¹å¾ [dim x n]</span>
<span class="comment">%       test           - æµ‹è¯•ç‰¹å¾ [dim x m]</span>
<span class="comment">%       normalize_flag - æ˜¯å¦å‡å€¼å½’ä¸€åŒ–, é»˜è®¤true</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å‡º:</span>
<span class="comment">%       dist - DTWè·ç¦» (æ ‡é‡)</span>
<span class="comment">%       D    - ç´¯ç§¯è·ç¦»çŸ©é˜µ [(n+1) x (m+1)]</span>
<span class="comment">%       path - æœ€ä¼˜è·¯å¾„ [k x 2], æ¯è¡Œä¸º [i, j]</span>
<span class="comment">%</span>
<span class="comment">%   ç®—æ³•:</span>
<span class="comment">%       é€’æ¨å…¬å¼: D(i,j) = d(i,j) + min{D(i-1,j), D(i,j-1), D(i-1,j-1)}</span>
<span class="comment">%       å…¶ä¸­ d(i,j) = ||template(:,i) - test(:,j)||_2 (æ¬§æ°è·ç¦»)</span>
<span class="comment">%</span>
<span class="comment">%   è¾¹ç•Œæ¡ä»¶:</span>
<span class="comment">%       D(0,0) = 0</span>
<span class="comment">%       D(i,0) = D(0,j) = inf</span>

<span class="keyword">if</span> nargin < <span class="number">3</span>
    normalize_flag = <span class="keyword">true</span>;
<span class="keyword">end</span>

<span class="comment">%% è·å–ç»´åº¦</span>
[dim1, n] = size(template);  <span class="comment">% n = æ¨¡æ¿å¸§æ•°</span>
[dim2, m] = size(test);      <span class="comment">% m = æµ‹è¯•å¸§æ•°</span>

<span class="keyword">if</span> dim1 ~= dim2
    error(<span class="string">'ç‰¹å¾ç»´åº¦ä¸åŒ¹é…: %d vs %d'</span>, dim1, dim2);
<span class="keyword">end</span>

<span class="comment">%% å‡å€¼å½’ä¸€åŒ– (æ¶ˆé™¤è¯´è¯äººå·®å¼‚)</span>
<span class="keyword">if</span> normalize_flag
    template = template - mean(template, <span class="number">2</span>);
    test = test - mean(test, <span class="number">2</span>);
<span class="keyword">end</span>

<span class="comment">%% è®¡ç®—å±€éƒ¨è·ç¦»çŸ©é˜µ d(i,j)</span>
local_dist = zeros(n, m);
<span class="keyword">for</span> i = <span class="number">1</span>:n
    <span class="keyword">for</span> j = <span class="number">1</span>:m
        <span class="comment">% TODO: è®¡ç®—æ¨¡æ¿ç¬¬iå¸§ä¸æµ‹è¯•ç¬¬jå¸§ä¹‹é—´çš„æ¬§æ°è·ç¦»</span>
        <span class="comment">% ä½¿ç”¨ norm å‡½æ•°è®¡ç®—ä¸¤ä¸ªç‰¹å¾å‘é‡çš„2èŒƒæ•°è·ç¦»</span>
        local_dist(i, j) = <span class="todo">?</span>;
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">%% åˆå§‹åŒ–ç´¯ç§¯è·ç¦»çŸ©é˜µ</span>
<span class="comment">% ä½¿ç”¨ (n+1) x (m+1) çŸ©é˜µ, ç´¢å¼•ä»1å¼€å§‹</span>
<span class="comment">% D(1,1) å¯¹åº”è¾¹ç•Œ D(0,0) = 0</span>

<span class="comment">% TODO: åˆå§‹åŒ– D çŸ©é˜µä¸ºå…¨ infï¼Œå¤§å°ä¸º (n+1) x (m+1)</span>
D = <span class="todo">?</span>;

<span class="comment">% TODO: è®¾ç½®è¾¹ç•Œæ¡ä»¶ D(0,0) = 0ï¼Œå³ D(1,1) = 0</span>
<span class="todo">?</span>;

<span class="comment">%% åŠ¨æ€è§„åˆ’å¡«å……</span>
<span class="keyword">for</span> i = <span class="number">1</span>:n
    <span class="keyword">for</span> j = <span class="number">1</span>:m
        cost = local_dist(i, j);
        <span class="comment">% TODO: è·å–ä¸‰ä¸ªå€™é€‰è·¯å¾„çš„ç´¯ç§¯è·ç¦»</span>
        <span class="comment">% d1: ä»ä¸Šæ–¹ (i-1, j) æ¥ï¼Œå¯¹åº” D(i, j+1)</span>
        <span class="comment">% d2: ä»å·¦æ–¹ (i, j-1) æ¥ï¼Œå¯¹åº” D(i+1, j)</span>
        <span class="comment">% d3: ä»å¯¹è§’ (i-1, j-1) æ¥ï¼Œå¯¹åº” D(i, j)</span>
        d1 = <span class="todo">?</span>;
        d2 = <span class="todo">?</span>;
        d3 = <span class="todo">?</span>;
        <span class="comment">% TODO: é€’æ¨å…¬å¼: D(i,j) = d(i,j) + min{d1, d2, d3}</span>
        D(i + <span class="number">1</span>, j + <span class="number">1</span>) = <span class="todo">?</span>;
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment">%% æœ€ç»ˆè·ç¦»</span>
dist = D(n + <span class="number">1</span>, m + <span class="number">1</span>);

<span class="comment">%% è·¯å¾„å›æº¯ (å¯é€‰)</span>
<span class="keyword">if</span> nargout >= <span class="number">3</span>
    path = backtrack(D);
<span class="keyword">end</span>

<span class="keyword">end</span>

<span class="comment">%% ==================== è¾…åŠ©å‡½æ•° ====================</span>

<span class="keyword">function</span> path = backtrack(D)
<span class="comment">%BACKTRACK ä»ç´¯ç§¯è·ç¦»çŸ©é˜µå›æº¯æœ€ä¼˜è·¯å¾„</span>

[n_plus1, m_plus1] = size(D);
n = n_plus1 - <span class="number">1</span>;
m = m_plus1 - <span class="number">1</span>;

<span class="comment">% ä»ç»ˆç‚¹å¼€å§‹å›æº¯</span>
path = zeros(n + m, <span class="number">2</span>);
k = <span class="number">0</span>;
i = n;
j = m;

<span class="keyword">while</span> i > <span class="number">0</span> && j > <span class="number">0</span>
    k = k + <span class="number">1</span>;
    path(k, :) = [i, j];
    
    <span class="keyword">if</span> i == <span class="number">1</span> && j == <span class="number">1</span>
        <span class="keyword">break</span>;
    <span class="keyword">end</span>
    
    <span class="comment">% é€‰æ‹©æ¥æºæ–¹å‘ (ç´¯ç§¯è·ç¦»æœ€å°çš„)</span>
    candidates = [];
    <span class="keyword">if</span> i > <span class="number">1</span> && j > <span class="number">1</span>
        candidates = [candidates; i-<span class="number">1</span>, j-<span class="number">1</span>, D(i, j)];      <span class="comment">% å¯¹è§’</span>
    <span class="keyword">end</span>
    <span class="keyword">if</span> i > <span class="number">1</span>
        candidates = [candidates; i-<span class="number">1</span>, j, D(i, j+<span class="number">1</span>)];      <span class="comment">% ä¸Šæ–¹</span>
    <span class="keyword">end</span>
    <span class="keyword">if</span> j > <span class="number">1</span>
        candidates = [candidates; i, j-<span class="number">1</span>, D(i+<span class="number">1</span>, j)];      <span class="comment">% å·¦æ–¹</span>
    <span class="keyword">end</span>
    
    <span class="keyword">if</span> isempty(candidates)
        <span class="keyword">break</span>;
    <span class="keyword">end</span>
    
    [~, idx] = min(candidates(:, <span class="number">3</span>));
    i = candidates(idx, <span class="number">1</span>);
    j = candidates(idx, <span class="number">2</span>);
<span class="keyword">end</span>

<span class="comment">% æˆªå–æœ‰æ•ˆéƒ¨åˆ†å¹¶åè½¬ (ä»èµ·ç‚¹åˆ°ç»ˆç‚¹)</span>
path = path(<span class="number">1</span>:k, :);
path = flipud(path);

<span class="keyword">end</span></pre>
            </div>
        </div>

        <!-- ex5 è¯†åˆ«å†³ç­– -->
        <div class="file-block collapsed">
            <div class="file-header completed" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex5_recognize.mï¼ˆè¯†åˆ«å†³ç­–ï¼‰<span class="tag tag-completed">å·²å®Œæˆ</span>
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code5')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code5"><span class="keyword">function</span> [result, scores, min_score] = ex5_recognize(test_feat, templates)
<span class="comment">%EX5_RECOGNIZE åŸºäºDTWçš„è¯†åˆ«å†³ç­–</span>
<span class="comment">%</span>
<span class="comment">%   [result, scores, min_score] = ex5_recognize(test_feat, templates)</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å…¥:</span>
<span class="comment">%       test_feat - æµ‹è¯•è¯­éŸ³ç‰¹å¾ [dim x num_frames]</span>
<span class="comment">%       templates - æ¨¡æ¿åº“ (cellæ•°ç»„), templates{i} ä¸ºç¬¬iä¸ªæ¨¡æ¿</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å‡º:</span>
<span class="comment">%       result    - è¯†åˆ«ç»“æœ (0-9)</span>
<span class="comment">%       scores    - å„æ¨¡æ¿çš„DTWè·ç¦» [1 x 10]</span>
<span class="comment">%       min_score - æœ€å°è·ç¦»</span>
<span class="comment">%</span>
<span class="comment">%   è¯´æ˜:</span>
<span class="comment">%       é€‰æ‹©DTWè·ç¦»æœ€å°çš„æ¨¡æ¿ä½œä¸ºè¯†åˆ«ç»“æœ</span>

num_templates = length(templates);
scores = zeros(<span class="number">1</span>, num_templates);

<span class="comment">% è®¡ç®—ä¸æ¯ä¸ªæ¨¡æ¿çš„DTWè·ç¦»</span>
<span class="keyword">for</span> i = <span class="number">1</span>:num_templates
    scores(i) = ex4_dtw(templates{i}, test_feat, <span class="keyword">true</span>);
<span class="keyword">end</span>

<span class="comment">% æ‰¾æœ€å°è·ç¦»</span>
[min_score, min_idx] = min(scores);

<span class="comment">% ç»“æœ (0-9)</span>
result = min_idx - <span class="number">1</span>;

<span class="keyword">end</span></pre>
            </div>
        </div>

        <!-- ex6 VAD -->
        <div class="file-block collapsed">
            <div class="file-header completed" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex6_vad.mï¼ˆç«¯ç‚¹æ£€æµ‹ï¼‰<span class="tag tag-completed">å·²å®Œæˆ</span>
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code6')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code6"><span class="keyword">function</span> [y, start_idx, end_idx] = ex6_vad(x, fs)
<span class="comment">%EX6_VAD è¯­éŸ³ç«¯ç‚¹æ£€æµ‹ (Voice Activity Detection)</span>
<span class="comment">%</span>
<span class="comment">%   [y, start_idx, end_idx] = ex6_vad(x, fs)</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å…¥:</span>
<span class="comment">%       x  - è¯­éŸ³ä¿¡å·</span>
<span class="comment">%       fs - é‡‡æ ·ç‡</span>
<span class="comment">%</span>
<span class="comment">%   è¾“å‡º:</span>
<span class="comment">%       y         - è£å‰ªåçš„è¯­éŸ³</span>
<span class="comment">%       start_idx - èµ·å§‹æ ·æœ¬ç´¢å¼•</span>
<span class="comment">%       end_idx   - ç»“æŸæ ·æœ¬ç´¢å¼•</span>
<span class="comment">%</span>
<span class="comment">%   ç®—æ³•:</span>
<span class="comment">%       åŸºäºçŸ­æ—¶èƒ½é‡çš„åŒé—¨é™æ³•</span>

x = x(:);
N = length(x);

<span class="comment">%% å‚æ•°</span>
frame_len = round(<span class="number">0.025</span> * fs);   <span class="comment">% å¸§é•¿ 25ms</span>
frame_shift = round(<span class="number">0.010</span> * fs); <span class="comment">% å¸§ç§» 10ms</span>
thresh_high = <span class="number">0.15</span>;              <span class="comment">% é«˜é˜ˆå€¼</span>
thresh_low = <span class="number">0.05</span>;               <span class="comment">% ä½é˜ˆå€¼</span>
margin = <span class="number">3</span>;                      <span class="comment">% è¾¹ç•Œæ‰©å±•å¸§æ•°</span>

<span class="comment">%% è®¡ç®—å¸§æ•°</span>
num_frames = floor((N - frame_len) / frame_shift) + <span class="number">1</span>;

<span class="keyword">if</span> num_frames < <span class="number">1</span>
    y = x;
    start_idx = <span class="number">1</span>;
    end_idx = N;
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="comment">%% è®¡ç®—æ¯å¸§èƒ½é‡</span>
energy = zeros(num_frames, <span class="number">1</span>);
<span class="keyword">for</span> i = <span class="number">1</span>:num_frames
    s = (i - <span class="number">1</span>) * frame_shift + <span class="number">1</span>;
    frame = x(s : s + frame_len - <span class="number">1</span>);
    energy(i) = sum(frame.^<span class="number">2</span>);
<span class="keyword">end</span>

<span class="comment">%% å½’ä¸€åŒ–èƒ½é‡</span>
max_energy = max(energy);
<span class="keyword">if</span> max_energy > <span class="number">0</span>
    energy_norm = energy / max_energy;
<span class="keyword">else</span>
    y = x;
    start_idx = <span class="number">1</span>;
    end_idx = N;
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="comment">%% åŒé—¨é™æ£€æµ‹</span>
<span class="comment">% ç”¨é«˜é˜ˆå€¼æ‰¾ç¡®å®šçš„è¯­éŸ³å¸§</span>
speech_high = energy_norm > thresh_high;

<span class="keyword">if</span> ~any(speech_high)
    <span class="comment">% é™ä½é˜ˆå€¼é‡è¯•</span>
    speech_high = energy_norm > thresh_low;
<span class="keyword">end</span>

<span class="keyword">if</span> ~any(speech_high)
    y = x;
    start_idx = <span class="number">1</span>;
    end_idx = N;
    <span class="keyword">return</span>;
<span class="keyword">end</span>

<span class="comment">% æ‰¾é¦–å°¾</span>
first_high = find(speech_high, <span class="number">1</span>, <span class="string">'first'</span>);
last_high = find(speech_high, <span class="number">1</span>, <span class="string">'last'</span>);

<span class="comment">% ç”¨ä½é˜ˆå€¼å‘å¤–æ‰©å±•</span>
start_frame = first_high;
<span class="keyword">while</span> start_frame > <span class="number">1</span> && energy_norm(start_frame - <span class="number">1</span>) > thresh_low
    start_frame = start_frame - <span class="number">1</span>;
<span class="keyword">end</span>

end_frame = last_high;
<span class="keyword">while</span> end_frame < num_frames && energy_norm(end_frame + <span class="number">1</span>) > thresh_low
    end_frame = end_frame + <span class="number">1</span>;
<span class="keyword">end</span>

<span class="comment">% å†æ‰©å±•å‡ å¸§ä½™é‡</span>
start_frame = max(<span class="number">1</span>, start_frame - margin);
end_frame = min(num_frames, end_frame + margin);

<span class="comment">%% è½¬æ¢ä¸ºæ ·æœ¬ç´¢å¼•</span>
start_idx = (start_frame - <span class="number">1</span>) * frame_shift + <span class="number">1</span>;
end_idx = min(N, (end_frame - <span class="number">1</span>) * frame_shift + frame_len);

y = x(start_idx : end_idx);

<span class="keyword">end</span></pre>
            </div>
        </div>

        <!-- æµ‹è¯•ç¤ºä¾‹ -->
        <div class="test-banner">
            <strong>ğŸ§ª å®Œæˆåæµ‹è¯•ï¼š</strong>
            <p style="margin: 10px 0;">å®Œæˆæ‰€æœ‰ä»£ç åï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•ï¼š</p>
            <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; margin: 10px 0;">
<span class="comment">% å°†æµ‹è¯•éŸ³é¢‘æ”¾å…¥ audio/ ç›®å½•åè¿è¡Œä¸»ç¨‹åº</span>
>> ex0_all

<span class="comment">% æˆ–å•ç‹¬æµ‹è¯•å„æ¨¡å—ï¼š</span>
<span class="comment">% æµ‹è¯•é¢„åŠ é‡</span>
>> x = randn(<span class="number">1000</span>, <span class="number">1</span>);
>> y = ex1_preemphasis(x, <span class="number">0.97</span>);

<span class="comment">% æµ‹è¯•åˆ†å¸§ (å¸§é•¿400ï¼Œå¸§ç§»160)</span>
>> frames = ex2_enframe(x, <span class="number">400</span>, <span class="number">160</span>);

<span class="comment">% æµ‹è¯•DTW</span>
>> template = randn(<span class="number">36</span>, <span class="number">20</span>);
>> test = randn(<span class="number">36</span>, <span class="number">25</span>);
>> dist = ex4_dtw(template, test);</pre>
        </div>

    </div>

    <script>
        function toggleBlock(header) {
            const block = header.parentElement;
            block.classList.toggle('collapsed');
        }

        function expandAll() {
            document.querySelectorAll('.file-block').forEach(block => {
                block.classList.remove('collapsed');
            });
        }

        function collapseAll() {
            document.querySelectorAll('.file-block').forEach(block => {
                block.classList.add('collapsed');
            });
        }

        function copyCode(event, codeId) {
            event.stopPropagation();
            const code = document.getElementById(codeId).innerText;
            navigator.clipboard.writeText(code).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ“ å·²å¤åˆ¶';
                btn.style.background = '#38a169';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#48bb78';
                }, 2000);
            });
        }
    </script>
</body>
</html>
