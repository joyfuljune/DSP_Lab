<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSP-Lab1-ç»ƒä¹ </title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [['$$','$$'], ['\\[','\\]']],
                processEscapes: true
            }
        });
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimSun', Arial, sans-serif;
            background: linear-gradient(135deg, #608de0 0%, #7dadff 50%, #5ca353 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.25);
            padding: 40px;
        }

        h1 {
            color: #2d57a4;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }

        h2 {
            color: #608de0;
            margin: 25px 0 15px 0;
        }

        .login-section, .quiz-section, .result-section {
            display: none;
        }

        .login-section.active, .quiz-section.active, .result-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #2d57a4;
            font-weight: bold;
            margin-bottom: 8px;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #7dadff;
            border-radius: 8px;
            font-size: 16px;
        }

        button {
            background: linear-gradient(135deg, #608de0 0%, #7dadff 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(96, 141, 224, 0.3);
        }

        button:hover {
            background: linear-gradient(135deg, #2d57a4 0%, #608de0 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(96, 141, 224, 0.5);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .question-box {
            background: #f8f9fa;
            border-left: 5px solid #608de0;
            padding: 25px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .question-title {
            color: #2d57a4;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .options {
            margin: 15px 0;
        }

        .option {
            display: block;
            background: white;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            background: #e8f5ff;
            border-color: #608de0;
        }

        .option.selected {
            background: #608de0;
            color: white;
            border-color: #2d57a4;
        }

        .option.correct {
            background: #5ca353;
            color: white;
            border-color: #4a8842;
        }

        .option.incorrect {
            background: #D46A6A;
            color: white;
            border-color: #912d32;
        }

        .feedback {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #5ca353;
            border-left: 5px solid #5ca353;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #912d32;
            border-left: 5px solid #912d32;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #5ca353 0%, #608de0 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .stats-table th, .stats-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        .stats-table th {
            background: linear-gradient(135deg, #608de0 0%, #7dadff 100%);
            color: white;
        }

        .stats-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .mastery-good {
            color: #5ca353;
            font-weight: bold;
        }

        .mastery-fair {
            color: #D46A6A;
            font-weight: bold;
        }

        .mastery-poor {
            color: #912d32;
            font-weight: bold;
        }

        .info-box {
            background: #fff8e1;
            border-left: 5px solid #D46A6A;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-option:hover {
            background: #e8f5ff;
            border-color: #608de0;
        }

        .checkbox-option.correct {
            background: #5ca353;
            color: white;
            border-color: #4a8842;
        }

        .checkbox-option.incorrect {
            background: #D46A6A;
            color: white;
            border-color: #912d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç™»å½•ç•Œé¢ -->
        <div class="login-section active">
            <h1>ğŸ“ DSP-Lab1-ç»ƒä¹ </h1>
            <div class="info-box">
                <strong>ğŸ“Œ æµ‹éªŒè¯´æ˜</strong>
                <p>æœ¬ç³»ç»Ÿå°†æµ‹è¯•æ‚¨å¯¹ã€Šåˆ©ç”¨FFTè®¡ç®—é¢‘è°±åŠç»“æœåˆ†æã€‹å®éªŒçš„æŒæ¡ç¨‹åº¦ã€‚æ¯ä¸ªçŸ¥è¯†ç‚¹å°†éšæœºå‡ºé¢˜,ç­”å¯¹åè¿›å…¥ä¸‹ä¸€çŸ¥è¯†ç‚¹,ç­”é”™å°†ç»§ç»­è¯¥çŸ¥è¯†ç‚¹çš„å…¶ä»–é¢˜ç›®ã€‚</p>
            </div>
            
            <div class="form-group">
                <label>å­¦å·:</label>
                <input type="text" id="studentId" placeholder="è¯·è¾“å…¥å­¦å·">
            </div>
            
            <div class="form-group">
                <label>å§“å:</label>
                <input type="text" id="studentName" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            
            <button onclick="startQuiz()">å¼€å§‹æµ‹éªŒ</button>
        </div>

        <!-- æµ‹éªŒç•Œé¢ -->
        <div class="quiz-section">
            <h1>DSP-Lab1-ç»ƒä¹ </h1>
            <div id="studentInfo"></div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar">0%</div>
            </div>
            
            <div id="currentTopic"></div>
            
            <div class="question-box">
                <div class="question-title" id="questionTitle"></div>
                <div id="questionContent"></div>
                <div id="options" class="options"></div>
                <div id="feedback"></div>
                <button id="submitBtn" onclick="submitAnswer()">æäº¤ç­”æ¡ˆ</button>
                <button id="nextBtn" onclick="nextQuestion()" style="display:none;">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <!-- ç»“æœç•Œé¢ -->
        <div class="result-section">
            <h1>ğŸ“Š æµ‹éªŒç»“æœæŠ¥å‘Š</h1>
            <div id="finalReport"></div>
            <button onclick="saveScreenshot()" id="saveBtn">æˆªå›¾ä¿å­˜</button>
        </div>
    </div>

    <script>
        // ==================== æ•°æ®ç»“æ„ ====================
        let studentData = {
            id: '',
            name: '',
            topicStats: {},
            currentTopicIndex: 0,
            currentQuestionIndex: 0,
            usedQuestions: {}
        };

        // çŸ¥è¯†ç‚¹å®šä¹‰
        const topics = [
            {
                name: 'DTFTåŸºæœ¬æ¦‚å¿µ',
                id: 'dtft',
                description: 'ç¦»æ•£æ—¶é—´å‚…é‡Œå¶å˜æ¢çš„å®šä¹‰å’Œæ€§è´¨'
            },
            {
                name: 'DFTä¸é¢‘ç‡é‡‡æ ·',
                id: 'dft',
                description: 'DFTçš„è®¡ç®—å’Œé¢‘ç‡é‡‡æ ·å…³ç³»'
            },
            {
                name: 'FFTå¿«é€Ÿç®—æ³•',
                id: 'fft',
                description: 'FFTçš„MATLABå®ç°å’Œåº”ç”¨'
            },
            {
                name: 'é›¶å¡«å……ä¸é¢‘ç‡åˆ†è¾¨ç‡',
                id: 'zero_padding',
                description: 'é›¶å¡«å……å¯¹é¢‘è°±åˆ†æçš„å½±å“'
            },
            {
                name: 'å·ç§¯å®šç†',
                id: 'convolution',
                description: 'çº¿æ€§å·ç§¯å’Œå¾ªç¯å·ç§¯'
            },
            {
                name: 'é¢‘è°±åˆ†æ',
                id: 'spectrum',
                description: 'å¹…åº¦è°±å’Œç›¸ä½è°±çš„ç†è§£'
            },
            {
                name: 'é¢‘ç‡å…³ç³»',
                id: 'frequency',
                description: 'æ•°å­—é¢‘ç‡Ï‰ä¸DFTç´¢å¼•kçš„å…³ç³»'
            }
        ];

        // ==================== é¢˜ç›®ç”Ÿæˆå‡½æ•° ====================
        
        // ç”Ÿæˆéšæœºæ•´æ•°
        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // ç”Ÿæˆéšæœºåºåˆ—
        function generateSequence(length, min = -5, max = 5) {
            return Array.from({length}, () => randInt(min, max));
        }

        // ç”Ÿæˆéšæœºè¡°å‡å› å­
        function generateDecayFactor() {
            return (Math.random() * 0.5 + 0.5).toFixed(1);
        }

        // é¢˜åº“ç”Ÿæˆå‡½æ•°
        const questionGenerators = {
            dtft: [
                // DTFTé¢˜ç›®1: å•é€‰ - DTFTæ€§è´¨
                () => {
                    const period = randInt(3, 5) * 2;
                    return {
                        type: 'single',
                        question: `DTFTçš„é¢‘è°± $X(e^{j\\omega})$ å…·æœ‰å‘¨æœŸæ€§,å…¶å‘¨æœŸä¸º:`,
                        options: [
                            `$${period}\\pi$`,
                            `$2\\pi$`,
                            `$\\pi$`,
                            `$4\\pi$`
                        ],
                        correct: 1,
                        explanation: 'DTFTçš„é¢‘è°± $X(e^{j\\omega})$ æ˜¯ä»¥ $2\\pi$ ä¸ºå‘¨æœŸçš„å‘¨æœŸå‡½æ•°ã€‚'
                    };
                },
                
                // DTFTé¢˜ç›®2: åˆ¤æ–­ - è¿ç»­æ€§
                () => {
                    return {
                        type: 'single',
                        question: `ä¸‹åˆ—å…³äºDTFTçš„æè¿°,æ­£ç¡®çš„æ˜¯:`,
                        options: [
                            'DTFTçš„é¢‘è°±æ˜¯ç¦»æ•£çš„',
                            'DTFTçš„é¢‘è°±æ˜¯è¿ç»­çš„',
                            'DTFTåªèƒ½ç”¨äºå‘¨æœŸä¿¡å·',
                            'DTFTçš„é¢‘è°±ä¸å…·æœ‰å‘¨æœŸæ€§'
                        ],
                        correct: 1,
                        explanation: 'DTFTçš„é¢‘è°± $X(e^{j\\omega})$ æ˜¯å…³äºé¢‘ç‡ $\\omega$ çš„è¿ç»­å‡½æ•°ã€‚'
                    };
                },
                
                // DTFTé¢˜ç›®3: å•é€‰ - å•ä½è„‰å†²
                () => {
                    const n0 = randInt(0, 5);
                    return {
                        type: 'single',
                        question: `ä¿¡å· $x[n] = \\delta[n-${n0}]$ çš„DTFTä¸º:`,
                        options: [
                            `$e^{-j\\omega \\cdot ${n0}}$`,
                            `$e^{j\\omega \\cdot ${n0}}$`,
                            `$1$`,
                            `$0$`
                        ],
                        correct: 0,
                        explanation: `æ ¹æ®æ—¶ç§»æ€§è´¨,$\\delta[n-${n0}]$ çš„DTFTä¸º $e^{-j\\omega \\cdot ${n0}}$ã€‚`
                    };
                },
                
                // DTFTé¢˜ç›®4: å¤šé€‰ - DTFTæ€§è´¨
                () => {
                    return {
                        type: 'multiple',
                        question: `å¯¹äºå®åºåˆ— $x[n]$ ,å…¶DTFT $X(e^{j\\omega})$ å…·æœ‰å“ªäº›æ€§è´¨?(å¤šé€‰)`,
                        options: [
                            'å…±è½­å¯¹ç§°æ€§',
                            'å¹…åº¦è°±ä¸ºå¶å‡½æ•°',
                            'ç›¸ä½è°±ä¸ºå¥‡å‡½æ•°',
                            'å¹…åº¦è°±ä¸ºå¥‡å‡½æ•°'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'å®åºåˆ—çš„DTFTå…·æœ‰å…±è½­å¯¹ç§°æ€§,å› æ­¤å¹…åº¦è°±ä¸ºå¶å‡½æ•°,ç›¸ä½è°±ä¸ºå¥‡å‡½æ•°ã€‚'
                    };
                },
                
                // DTFTé¢˜ç›®5: å•é€‰ - è®¡ç®—å¤æ‚åº¦
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨è®¡ç®—æœºä¸­æ— æ³•ç›´æ¥å®ç°DTFTçš„ä¸»è¦åŸå› æ˜¯:`,
                        options: [
                            'DTFTçš„æ±‚å’ŒèŒƒå›´æ˜¯ä»è´Ÿæ— ç©·åˆ°æ­£æ— ç©·',
                            'DTFTéœ€è¦å®æ•°è¿ç®—',
                            'DTFTè®¡ç®—å¤ªç®€å•',
                            'DTFTä¸é€‚ç”¨äºç¦»æ•£ä¿¡å·'
                        ],
                        correct: 0,
                        explanation: 'DTFTçš„åˆ†ææ–¹ç¨‹éœ€è¦ä»è´Ÿæ— ç©·åˆ°æ­£æ— ç©·æ±‚å’Œ,åœ¨è®¡ç®—æœºä¸­ä¸å¯å®ç°ã€‚'
                    };
                }
            ],
            
            dft: [
                // DFTé¢˜ç›®1: å•é€‰ - DFTç‚¹æ•°
                () => {
                    const N = Math.pow(2, randInt(3, 6));
                    const M = Math.floor(N / 2);
                    return {
                        type: 'single',
                        question: `å¯¹é•¿åº¦ä¸º${M}çš„åºåˆ—è¿›è¡Œ${N}ç‚¹DFT,å®é™…ä¸Šæ˜¯åœ¨åŸåºåˆ—åè¡¥å……äº†å¤šå°‘ä¸ªé›¶?`,
                        options: [
                            `${N - M}ä¸ª`,
                            `${M}ä¸ª`,
                            `${N}ä¸ª`,
                            `0ä¸ª`
                        ],
                        correct: 0,
                        explanation: `DFTç‚¹æ•°ä¸º${N},åºåˆ—é•¿åº¦ä¸º${M},éœ€è¦è¡¥å……${N - M}ä¸ªé›¶ã€‚`
                    };
                },
                
                // DFTé¢˜ç›®2: å•é€‰ - é¢‘ç‡é‡‡æ ·
                () => {
                    const N = Math.pow(2, randInt(3, 5));
                    const k = randInt(1, N - 1);
                    return {
                        type: 'single',
                        question: `å¯¹äº${N}ç‚¹DFT,é¢‘ç‡ç´¢å¼• $k=${k}$ å¯¹åº”çš„å½’ä¸€åŒ–è§’é¢‘ç‡ $\\omega_k$ ä¸º:`,
                        options: [
                            `$\\frac{2\\pi \\cdot ${k}}{${N}}$`,
                            `$\\frac{\\pi \\cdot ${k}}{${N}}$`,
                            `$\\frac{${k}}{${N}}$`,
                            `$2\\pi \\cdot ${k}$`
                        ],
                        correct: 0,
                        explanation: `å½’ä¸€åŒ–è§’é¢‘ç‡ $\\omega_k = \\frac{2\\pi k}{N} = \\frac{2\\pi \\cdot ${k}}{${N}}$ã€‚`
                    };
                },
                
                // DFTé¢˜ç›®3: åˆ¤æ–­
                () => {
                    return {
                        type: 'single',
                        question: `DFTç»“æœåŒ…å«äº†Nä¸ªç¦»æ•£é¢‘ç‡ç‚¹å¤„çš„DTFTç»“æœ,è¿™äº›é¢‘ç‡ç‚¹:`,
                        options: [
                            'ç­‰é—´éš”åˆ†å¸ƒåœ¨[0, 2Ï€)åŒºé—´',
                            'ç­‰é—´éš”åˆ†å¸ƒåœ¨[-Ï€, Ï€]åŒºé—´',
                            'éšæœºåˆ†å¸ƒ',
                            'éå‡åŒ€åˆ†å¸ƒ'
                        ],
                        correct: 0,
                        explanation: 'DFTçš„Nä¸ªé¢‘ç‡ç‚¹ç­‰é—´éš”åˆ†å¸ƒåœ¨[0, 2Ï€)åŒºé—´å†…ã€‚'
                    };
                },
                
                // DFTé¢˜ç›®4: å•é€‰ - IDFT
                () => {
                    const N = Math.pow(2, randInt(3, 5));
                    return {
                        type: 'single',
                        question: `${N}ç‚¹IDFT(é€†DFT)çš„å…¬å¼ä¸­,æ±‚å’Œç»“æœéœ€è¦ä¹˜ä»¥çš„ç³»æ•°æ˜¯:`,
                        options: [
                            `$\\frac{1}{${N}}$`,
                            `$${N}$`,
                            `$\\frac{1}{2\\pi}$`,
                            `$1$`
                        ],
                        correct: 0,
                        explanation: `IDFTå…¬å¼ä¸­éœ€è¦ä¹˜ä»¥ $\\frac{1}{N} = \\frac{1}{${N}}$ã€‚`
                    };
                },
                
                // DFTé¢˜ç›®5: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: `å…³äºDFTä¸DTFTçš„å…³ç³»,ä¸‹åˆ—è¯´æ³•æ­£ç¡®çš„æ˜¯:(å¤šé€‰)`,
                        options: [
                            'DFTæ˜¯DTFTçš„é‡‡æ ·ç‰ˆæœ¬',
                            'DFTç‚¹æ•°è¶Šå¤š,è¶Šæ¥è¿‘DTFT',
                            'DFTå®Œå…¨ç­‰åŒäºDTFT',
                            'DFTå¯ä»¥é€šè¿‡FFTå¿«é€Ÿè®¡ç®—'
                        ],
                        correct: [0, 1, 3],
                        explanation: 'DFTæ˜¯å¯¹DTFTçš„é¢‘ç‡é‡‡æ ·,å¢åŠ DFTç‚¹æ•°å¯ä»¥æ›´å¥½åœ°é€¼è¿‘DTFT,FFTæ˜¯è®¡ç®—DFTçš„å¿«é€Ÿç®—æ³•ã€‚'
                    };
                }
            ],
            
            fft: [
                // FFTé¢˜ç›®1: å•é€‰ - å¤æ‚åº¦
                () => {
                    const N = Math.pow(2, randInt(8, 10));
                    return {
                        type: 'single',
                        question: `FFTç®—æ³•å°†DFTçš„è®¡ç®—å¤æ‚åº¦ä» $O(N^2)$ é™ä½åˆ°:`,
                        options: [
                            '$O(N \\log N)$',
                            '$O(N)$',
                            '$O(\\log N)$',
                            '$O(N^2)$'
                        ],
                        correct: 0,
                        explanation: 'FFTç®—æ³•çš„è®¡ç®—å¤æ‚åº¦ä¸º $O(N \\log N)$ã€‚'
                    };
                },
                
                // FFTé¢˜ç›®2: å•é€‰ - MATLABå‡½æ•°
                () => {
                    const N = Math.pow(2, randInt(3, 5));
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­,è®¡ç®—åºåˆ—xçš„${N}ç‚¹DFTçš„æ­£ç¡®å‘½ä»¤æ˜¯:`,
                        options: [
                            `fft(x, ${N})`,
                            `dft(x, ${N})`,
                            `fft(x)`,
                            `dtft(x, ${N})`
                        ],
                        correct: 0,
                        explanation: `ä½¿ç”¨fft(x, N)è®¡ç®—Nç‚¹DFT,N=${N}ã€‚`
                    };
                },
                
                // FFTé¢˜ç›®3: å•é€‰ - æ•ˆç‡ä¼˜åŠ¿
                () => {
                    const N = 1024;
                    const ratio = 100;
                    return {
                        type: 'single',
                        question: `å¯¹äº${N}ç‚¹çš„DFT,FFTç›¸æ¯”ç›´æ¥è®¡ç®—DFT,è®¡ç®—æ•ˆç‡å¤§çº¦æé«˜äº†:`,
                        options: [
                            `çº¦${ratio}å€`,
                            `çº¦10å€`,
                            `çº¦2å€`,
                            `æ²¡æœ‰æé«˜`
                        ],
                        correct: 0,
                        explanation: `å¯¹äºN=${N},FFTçš„æ•ˆç‡ä¼˜åŠ¿çº¦ä¸º${ratio}å€ã€‚`
                    };
                },
                
                // FFTé¢˜ç›®4: å•é€‰ - æœ€ä¼˜ç‚¹æ•°
                () => {
                    return {
                        type: 'single',
                        question: `ä¸ºäº†ä½¿FFTç®—æ³•æ•ˆç‡æœ€é«˜,DFTç‚¹æ•°Næœ€å¥½é€‰æ‹©:`,
                        options: [
                            '2çš„å¹‚æ¬¡(å¦‚64, 128, 256)',
                            'ä»»æ„å¶æ•°',
                            'ä»»æ„æ•´æ•°',
                            'è´¨æ•°'
                        ],
                        correct: 0,
                        explanation: 'FFTç®—æ³•åœ¨Nä¸º2çš„å¹‚æ¬¡æ—¶æ•ˆç‡æœ€é«˜ã€‚'
                    };
                },
                
                // FFTé¢˜ç›®5: å•é€‰ - IFFT
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­,è®¡ç®—é€†DFT(IDFT)çš„å‡½æ•°æ˜¯:`,
                        options: [
                            'ifft',
                            'idft',
                            'inv_fft',
                            'fft_inv'
                        ],
                        correct: 0,
                        explanation: 'MATLABä¸­ä½¿ç”¨ifftå‡½æ•°è®¡ç®—é€†DFTã€‚'
                    };
                }
            ],
            
            zero_padding: [
                // é›¶å¡«å……é¢˜ç›®1: å•é€‰ - é¢‘ç‡åˆ†è¾¨ç‡
                () => {
                    const N1 = Math.pow(2, randInt(4, 6));
                    const N2 = N1 * 2;
                    return {
                        type: 'single',
                        question: `å¯¹åŒä¸€ä¿¡å·,${N2}ç‚¹DFTç›¸æ¯”${N1}ç‚¹DFT,é¢‘ç‡åˆ†è¾¨ç‡:`,
                        options: [
                            'æé«˜äº†(æ›´ç²¾ç»†)',
                            'é™ä½äº†',
                            'ä¸å˜',
                            'æ— æ³•ç¡®å®š'
                        ],
                        correct: 0,
                        explanation: `å¢åŠ DFTç‚¹æ•°å¯ä»¥æé«˜é¢‘ç‡åˆ†è¾¨ç‡,ä½¿é¢‘è°±æ›´ç²¾ç»†ã€‚`
                    };
                },
                
                // é›¶å¡«å……é¢˜ç›®2: å•é€‰ - ä¿¡æ¯é‡
                () => {
                    return {
                        type: 'single',
                        question: `é›¶å¡«å……å¯¹ä¿¡å·é¢‘è°±åˆ†æçš„å½±å“æ˜¯:`,
                        options: [
                            'æé«˜é¢‘ç‡åˆ†è¾¨ç‡,ä½†ä¸å¢åŠ æ–°ä¿¡æ¯',
                            'å¢åŠ æ–°çš„é¢‘ç‡åˆ†é‡',
                            'æ”¹å˜åŸæœ‰é¢‘ç‡åˆ†é‡çš„å¹…åº¦',
                            'æ²¡æœ‰ä»»ä½•ä½œç”¨'
                        ],
                        correct: 0,
                        explanation: 'é›¶å¡«å……åªæ˜¯å¯¹DTFTè¿›è¡Œæ›´å¯†é›†çš„é‡‡æ ·,ä¸ä¼šåˆ›é€ æ–°ä¿¡æ¯ã€‚'
                    };
                },
                
                // é›¶å¡«å……é¢˜ç›®3: å•é€‰ - é¢‘ç‡åˆ†è¾¨ç‡å…¬å¼
                () => {
                    const Fs = randInt(80, 120);
                    const N = Math.pow(2, randInt(6, 8));
                    const deltaF = (Fs / N).toFixed(2);
                    return {
                        type: 'single',
                        question: `é‡‡æ ·é¢‘ç‡ $F_s=${Fs}$ Hz,è¿›è¡Œ${N}ç‚¹DFT,é¢‘ç‡åˆ†è¾¨ç‡ $\\Delta f$ ä¸º:`,
                        options: [
                            `${deltaF} Hz`,
                            `${(Fs / 2).toFixed(2)} Hz`,
                            `${Fs} Hz`,
                            `${(2 * Fs / N).toFixed(2)} Hz`
                        ],
                        correct: 0,
                        explanation: `é¢‘ç‡åˆ†è¾¨ç‡ $\\Delta f = \\frac{F_s}{N} = \\frac{${Fs}}{${N}} = ${deltaF}$ Hzã€‚`
                    };
                },
                
                // é›¶å¡«å……é¢˜ç›®4: åˆ¤æ–­
                () => {
                    return {
                        type: 'single',
                        question: `å…³äºé›¶å¡«å……,ä¸‹åˆ—è¯´æ³•æ­£ç¡®çš„æ˜¯:`,
                        options: [
                            'é›¶å¡«å……ä½¿DFTç»“æœæ›´æ¥è¿‘çœŸå®çš„DTFT',
                            'é›¶å¡«å……ä¼šæ”¹å˜ä¿¡å·çš„é¢‘ç‡æˆåˆ†',
                            'é›¶å¡«å……ä¼šå¢å¤§ä¿¡å·èƒ½é‡',
                            'é›¶å¡«å……å¿…é¡»åœ¨ä¿¡å·å¼€å¤´è¿›è¡Œ'
                        ],
                        correct: 0,
                        explanation: 'é›¶å¡«å……é€šè¿‡å¢åŠ é¢‘ç‡é‡‡æ ·ç‚¹,ä½¿DFTç»“æœæ›´æ¥è¿‘è¿ç»­çš„DTFTã€‚'
                    };
                },
                
                // é›¶å¡«å……é¢˜ç›®5: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: `é›¶å¡«å……çš„ä¸»è¦ä½œç”¨åŒ…æ‹¬:(å¤šé€‰)`,
                        options: [
                            'æé«˜é¢‘ç‡åˆ†è¾¨ç‡',
                            'ä½¿é¢‘è°±æ›²çº¿æ›´å¹³æ»‘',
                            'æ›´å¯†é›†åœ°é‡‡æ ·DTFT',
                            'å¢åŠ ä¿¡å·çš„é¢‘ç‡åˆ†é‡'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'é›¶å¡«å……å¯ä»¥æé«˜é¢‘ç‡åˆ†è¾¨ç‡ã€ä½¿é¢‘è°±å¹³æ»‘ã€æ›´å¯†é›†é‡‡æ ·DTFT,ä½†ä¸å¢åŠ æ–°çš„é¢‘ç‡åˆ†é‡ã€‚'
                    };
                }
            ],
            
            convolution: [
                // å·ç§¯é¢˜ç›®1: å•é€‰ - å·ç§¯é•¿åº¦
                () => {
                    const L1 = randInt(3, 6);
                    const L2 = randInt(3, 6);
                    const result = L1 + L2 - 1;
                    return {
                        type: 'single',
                        question: `é•¿åº¦ä¸º${L1}å’Œ${L2}çš„ä¸¤ä¸ªåºåˆ—è¿›è¡Œçº¿æ€§å·ç§¯,ç»“æœé•¿åº¦ä¸º:`,
                        options: [
                            `${result}`,
                            `${Math.max(L1, L2)}`,
                            `${L1 + L2}`,
                            `${L1 * L2}`
                        ],
                        correct: 0,
                        explanation: `çº¿æ€§å·ç§¯ç»“æœé•¿åº¦ä¸º $L_1 + L_2 - 1 = ${L1} + ${L2} - 1 = ${result}$ã€‚`
                    };
                },
                
                // å·ç§¯é¢˜ç›®2: å•é€‰ - MATLABå‡½æ•°
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­,è®¡ç®—ä¸¤ä¸ªåºåˆ—xå’Œhçš„çº¿æ€§å·ç§¯çš„å‡½æ•°æ˜¯:`,
                        options: [
                            'conv(x, h)',
                            'fft(x) .* fft(h)',
                            'x * h',
                            'convolve(x, h)'
                        ],
                        correct: 0,
                        explanation: 'MATLABä¸­ä½¿ç”¨conv(x, h)è®¡ç®—çº¿æ€§å·ç§¯ã€‚'
                    };
                },
                
                // å·ç§¯é¢˜ç›®3: å•é€‰ - å¾ªç¯å·ç§¯
                () => {
                    const L1 = randInt(4, 7);
                    const L2 = randInt(4, 7);
                    const minLen = L1 + L2 - 1;
                    return {
                        type: 'single',
                        question: `è¦ä½¿é•¿åº¦ä¸º${L1}å’Œ${L2}çš„ä¸¤åºåˆ—çš„å¾ªç¯å·ç§¯ç­‰äºçº¿æ€§å·ç§¯,è‡³å°‘éœ€è¦è¡¥é›¶åˆ°é•¿åº¦:`,
                        options: [
                            `${minLen}`,
                            `${Math.max(L1, L2)}`,
                            `${L1 + L2}`,
                            `${Math.min(L1, L2)}`
                        ],
                        correct: 0,
                        explanation: `éœ€è¦è¡¥é›¶åˆ°è‡³å°‘ $L_1 + L_2 - 1 = ${L1} + ${L2} - 1 = ${minLen}$ã€‚`
                    };
                },
                
                // å·ç§¯é¢˜ç›®4: å¤šé€‰ - å·ç§¯å®šç†
                () => {
                    return {
                        type: 'multiple',
                        question: `å…³äºå·ç§¯å®šç†,ä¸‹åˆ—è¯´æ³•æ­£ç¡®çš„æ˜¯:(å¤šé€‰)`,
                        options: [
                            'æ—¶åŸŸå·ç§¯å¯¹åº”é¢‘åŸŸç›¸ä¹˜',
                            'å¯ä»¥ç”¨FFTå¿«é€Ÿè®¡ç®—å·ç§¯',
                            'å¾ªç¯å·ç§¯ç­‰äºçº¿æ€§å·ç§¯éœ€è¦è¡¥é›¶',
                            'å·ç§¯å®šç†åªé€‚ç”¨äºè¿ç»­ä¿¡å·'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'å·ç§¯å®šç†æŒ‡å‡ºæ—¶åŸŸå·ç§¯å¯¹åº”é¢‘åŸŸç›¸ä¹˜,å¯ä»¥ç”¨FFTå¿«é€Ÿè®¡ç®—,ä½†éœ€è¦è¡¥é›¶ä½¿å¾ªç¯å·ç§¯ç­‰äºçº¿æ€§å·ç§¯ã€‚'
                    };
                },
                
                // å·ç§¯é¢˜ç›®5: å•é€‰ - FFTå·ç§¯
                () => {
                    return {
                        type: 'single',
                        question: `ç›´æ¥ä½¿ç”¨FFTè®¡ç®—(æœªè¡¥é›¶) $y = \\text{ifft}(\\text{fft}(x) .* \\text{fft}(h))$ å¾—åˆ°çš„æ˜¯:`,
                        options: [
                            'å¾ªç¯å·ç§¯',
                            'çº¿æ€§å·ç§¯',
                            'ç›¸å…³å‡½æ•°',
                            'é¢‘è°±'
                        ],
                        correct: 0,
                        explanation: 'æœªè¡¥é›¶çš„FFTè®¡ç®—å¾—åˆ°çš„æ˜¯å¾ªç¯å·ç§¯ã€‚'
                    };
                }
            ],
            
            spectrum: [
                // é¢‘è°±é¢˜ç›®1: å•é€‰ - å¹…åº¦è°±
                () => {
                    return {
                        type: 'single',
                        question: `å¯¹äºå¤æ•°é¢‘è°± $X[k] = a + jb$ ,å…¶å¹…åº¦è°±çš„è®¡ç®—å…¬å¼æ˜¯:`,
                        options: [
                            '$\\sqrt{a^2 + b^2}$',
                            '$a + b$',
                            '$\\arctan(b/a)$',
                            '$a^2 + b^2$'
                        ],
                        correct: 0,
                        explanation: 'å¹…åº¦è°±ä¸ºå¤æ•°çš„æ¨¡: $|X[k]| = \\sqrt{a^2 + b^2}$ã€‚'
                    };
                },
                
                // é¢‘è°±é¢˜ç›®2: å•é€‰ - ç›¸ä½è°±
                () => {
                    return {
                        type: 'single',
                        question: `å¯¹äºå¤æ•°é¢‘è°± $X[k] = a + jb$ ,å…¶ç›¸ä½è°±çš„è®¡ç®—å…¬å¼æ˜¯:`,
                        options: [
                            '$\\arctan(b/a)$',
                            '$\\sqrt{a^2 + b^2}$',
                            '$a/b$',
                            '$b/a$'
                        ],
                        correct: 0,
                        explanation: 'ç›¸ä½è°±ä¸ºå¤æ•°çš„å¹…è§’: $\\angle X[k] = \\arctan(b/a)$ã€‚'
                    };
                },
                
                // é¢‘è°±é¢˜ç›®3: å•é€‰ - MATLABå‡½æ•°
                () => {
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­,è®¡ç®—å¤æ•°åºåˆ—Xçš„å¹…åº¦è°±çš„å‡½æ•°æ˜¯:`,
                        options: [
                            'abs(X)',
                            'angle(X)',
                            'real(X)',
                            'imag(X)'
                        ],
                        correct: 0,
                        explanation: 'abs(X)å‡½æ•°è®¡ç®—å¤æ•°çš„æ¨¡,å³å¹…åº¦è°±ã€‚'
                    };
                },
                
                // é¢‘è°±é¢˜ç›®4: å¤šé€‰ - å®ä¿¡å·æ€§è´¨
                () => {
                    return {
                        type: 'multiple',
                        question: `å¯¹äºå®ä¿¡å·çš„é¢‘è°±,å…·æœ‰å“ªäº›å¯¹ç§°æ€§è´¨:(å¤šé€‰)`,
                        options: [
                            'å¹…åº¦è°±å…³äºåŸç‚¹å¶å¯¹ç§°',
                            'ç›¸ä½è°±å…³äºåŸç‚¹å¥‡å¯¹ç§°',
                            'é¢‘è°±å…·æœ‰å…±è½­å¯¹ç§°æ€§',
                            'å¹…åº¦è°±å…³äºåŸç‚¹å¥‡å¯¹ç§°'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'å®ä¿¡å·çš„é¢‘è°±å…·æœ‰å…±è½­å¯¹ç§°æ€§,å› æ­¤å¹…åº¦è°±ä¸ºå¶å‡½æ•°,ç›¸ä½è°±ä¸ºå¥‡å‡½æ•°ã€‚'
                    };
                },
                
                // é¢‘è°±é¢˜ç›®5: å•é€‰ - å•ä½è„‰å†²é¢‘è°±
                () => {
                    return {
                        type: 'single',
                        question: `å•ä½è„‰å†²ä¿¡å· $\\delta[n]$ çš„å¹…åº¦è°±ç‰¹ç‚¹æ˜¯:`,
                        options: [
                            'åœ¨æ‰€æœ‰é¢‘ç‡å¤„å¹…åº¦å‡ä¸º1',
                            'åªåœ¨é›¶é¢‘å¤„å¹…åº¦ä¸º1',
                            'éšé¢‘ç‡é€’å‡',
                            'åªåœ¨é«˜é¢‘å¤„æœ‰å€¼'
                        ],
                        correct: 0,
                        explanation: 'å•ä½è„‰å†²çš„DTFTæ’ä¸º1,å› æ­¤å…¶å¹…åº¦è°±åœ¨æ‰€æœ‰é¢‘ç‡å¤„å‡ä¸º1ã€‚'
                    };
                }
            ],
            
            frequency: [
                // é¢‘ç‡å…³ç³»é¢˜ç›®1: å•é€‰ - Ï‰ä¸kå…³ç³»
                () => {
                    const N = Math.pow(2, randInt(4, 7));
                    return {
                        type: 'single',
                        question: `å¯¹äº${N}ç‚¹DFT,é¢‘ç‡ç´¢å¼•kä¸å½’ä¸€åŒ–è§’é¢‘ç‡Ï‰çš„å…³ç³»æ˜¯:`,
                        options: [
                            `$\\omega = \\frac{2\\pi k}{${N}}$`,
                            `$\\omega = \\frac{\\pi k}{${N}}$`,
                            `$\\omega = \\frac{k}{${N}}$`,
                            `$\\omega = 2\\pi k$`
                        ],
                        correct: 0,
                        explanation: `å½’ä¸€åŒ–è§’é¢‘ç‡ $\\omega_k = \\frac{2\\pi k}{N} = \\frac{2\\pi k}{${N}}$ã€‚`
                    };
                },
                
                // é¢‘ç‡å…³ç³»é¢˜ç›®2: å•é€‰ - å®é™…é¢‘ç‡
                () => {
                    const Fs = randInt(80, 120);
                    const N = Math.pow(2, randInt(5, 7));
                    const k = randInt(1, 10);
                    const fk = (k * Fs / N).toFixed(2);
                    return {
                        type: 'single',
                        question: `é‡‡æ ·é¢‘ç‡ $F_s=${Fs}$ Hz,${N}ç‚¹DFT,é¢‘ç‡ç´¢å¼• $k=${k}$ å¯¹åº”çš„å®é™…é¢‘ç‡ä¸º:`,
                        options: [
                            `${fk} Hz`,
                            `${(k * 2 * Fs / N).toFixed(2)} Hz`,
                            `${(Fs / k).toFixed(2)} Hz`,
                            `${k} Hz`
                        ],
                        correct: 0,
                        explanation: `å®é™…é¢‘ç‡ $f_k = \\frac{kF_s}{N} = \\frac{${k} \\times ${Fs}}{${N}} = ${fk}$ Hzã€‚`
                    };
                },
                
                // é¢‘ç‡å…³ç³»é¢˜ç›®3: å•é€‰ - æœ€é«˜é¢‘ç‡
                () => {
                    const Fs = randInt(80, 120);
                    const Nyquist = Fs / 2;
                    return {
                        type: 'single',
                        question: `é‡‡æ ·é¢‘ç‡ä¸º${Fs}Hzæ—¶,æ ¹æ®å¥ˆå¥æ–¯ç‰¹å®šç†,èƒ½å¤Ÿå‡†ç¡®è¡¨ç¤ºçš„æœ€é«˜é¢‘ç‡ä¸º:`,
                        options: [
                            `${Nyquist} Hz`,
                            `${Fs} Hz`,
                            `${Fs * 2} Hz`,
                            `${(Nyquist / 2).toFixed(0)} Hz`
                        ],
                        correct: 0,
                        explanation: `å¥ˆå¥æ–¯ç‰¹é¢‘ç‡ä¸ºé‡‡æ ·é¢‘ç‡çš„ä¸€åŠ: $f_{max} = \\frac{F_s}{2} = \\frac{${Fs}}{2} = ${Nyquist}$ Hzã€‚`
                    };
                },
                
                // é¢‘ç‡å…³ç³»é¢˜ç›®4: å•é€‰ - DFTåŒºé—´
                () => {
                    const N = Math.pow(2, randInt(4, 6));
                    return {
                        type: 'single',
                        question: `${N}ç‚¹DFTçš„é¢‘ç‡ç´¢å¼•kçš„å–å€¼èŒƒå›´æ˜¯:`,
                        options: [
                            `$0 \\leq k \\leq ${N-1}$`,
                            `$1 \\leq k \\leq ${N}$`,
                            `$0 \\leq k \\leq ${N}$`,
                            `$-${N/2} \\leq k \\leq ${N/2-1}$`
                        ],
                        correct: 0,
                        explanation: `DFTçš„é¢‘ç‡ç´¢å¼•èŒƒå›´ä¸º $0 \\leq k \\leq N-1$ ,å³ $0 \\leq k \\leq ${N-1}$ã€‚`
                    };
                },
                
                // é¢‘ç‡å…³ç³»é¢˜ç›®5: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: `å…³äºæ•°å­—é¢‘ç‡Ï‰å’ŒDFTç´¢å¼•kçš„å…³ç³»,ä¸‹åˆ—è¯´æ³•æ­£ç¡®çš„æ˜¯:(å¤šé€‰)`,
                        options: [
                            'å¢åŠ DFTç‚¹æ•°N,é¢‘ç‡åˆ†è¾¨ç‡æé«˜',
                            'Ï‰åœ¨[0, 2Ï€]èŒƒå›´å†…',
                            'k=0å¯¹åº”ç›´æµåˆ†é‡',
                            'kä¸å®é™…é¢‘ç‡æ— å…³'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'å¢åŠ Næé«˜é¢‘ç‡åˆ†è¾¨ç‡,Ï‰åœ¨[0, 2Ï€]èŒƒå›´,k=0å¯¹åº”ç›´æµ,kä¸å®é™…é¢‘ç‡æœ‰å…³ã€‚'
                    };
                }
            ]
        };

        // ==================== æµ‹éªŒé€»è¾‘ ====================
        
        function startQuiz() {
            const id = document.getElementById('studentId').value.trim();
            const name = document.getElementById('studentName').value.trim();
            
            if (!id || !name) {
                alert('è¯·å¡«å†™å­¦å·å’Œå§“å!');
                return;
            }
            
            studentData.id = id;
            studentData.name = name;
            
            // åˆå§‹åŒ–æ¯ä¸ªçŸ¥è¯†ç‚¹çš„ç»Ÿè®¡
            topics.forEach(topic => {
                studentData.topicStats[topic.id] = {
                    attempts: 0,
                    correct: 0,
                    questions: []
                };
                studentData.usedQuestions[topic.id] = [];
            });
            
            // åˆ‡æ¢åˆ°æµ‹éªŒç•Œé¢
            document.querySelector('.login-section').classList.remove('active');
            document.querySelector('.quiz-section').classList.add('active');
            
            document.getElementById('studentInfo').innerHTML = 
                `<p style="text-align: center; color: #666;">å­¦å·: ${id} | å§“å: ${name}</p>`;
            
            // åŠ è½½ç¬¬ä¸€é¢˜
            loadQuestion();
        }

        function loadQuestion() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            
            // æ›´æ–°è¿›åº¦æ¡
            const progress = (studentData.currentTopicIndex / topics.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = 
                `${studentData.currentTopicIndex}/${topics.length}`;
            
            // æ˜¾ç¤ºå½“å‰çŸ¥è¯†ç‚¹
            document.getElementById('currentTopic').innerHTML = 
                `<h2>ğŸ“š å½“å‰çŸ¥è¯†ç‚¹: ${currentTopic.name}</h2>
                 <p style="color: #666;">${currentTopic.description}</p>`;
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªæœªç”¨è¿‡çš„é¢˜ç›®
            const generators = questionGenerators[topicId];
            let questionIndex;
            
            // å¦‚æœæ‰€æœ‰é¢˜ç›®éƒ½ç”¨è¿‡äº†,é‡ç½®
            if (studentData.usedQuestions[topicId].length >= generators.length) {
                studentData.usedQuestions[topicId] = [];
            }
            
            // é€‰æ‹©æœªç”¨è¿‡çš„é¢˜ç›®
            do {
                questionIndex = randInt(0, generators.length - 1);
            } while (studentData.usedQuestions[topicId].includes(questionIndex));
            
            studentData.usedQuestions[topicId].push(questionIndex);
            
            // ç”Ÿæˆé¢˜ç›®
            const question = generators[questionIndex]();
            
            // è®°å½•é¢˜ç›®
            stats.questions.push({
                ...question,
                answered: false,
                isCorrect: false
            });
            
            // æ˜¾ç¤ºé¢˜ç›®
            document.getElementById('questionTitle').innerHTML = 
                `é¢˜ç›® ${stats.attempts + 1}`;
            
            document.getElementById('questionContent').innerHTML = 
                `<p style="margin: 15px 0; font-size: 1.1em;">${question.question}</p>`;
            
            // æ˜¾ç¤ºé€‰é¡¹
            let optionsHTML = '';
            
            if (question.type === 'single') {
                question.options.forEach((option, index) => {
                    optionsHTML += `
                        <div class="option" data-index="${index}" onclick="selectOption(${index})">
                            ${String.fromCharCode(65 + index)}. ${option}
                        </div>`;
                });
            } else {
                question.options.forEach((option, index) => {
                    optionsHTML += `
                        <div class="checkbox-option" onclick="toggleCheckbox(${index})">
                            <input type="checkbox" id="opt${index}">
                            <label for="opt${index}" style="cursor: pointer; margin: 0;">
                                ${String.fromCharCode(65 + index)}. ${option}
                            </label>
                        </div>`;
                });
            }
            
            document.getElementById('options').innerHTML = optionsHTML;
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            
            // é‡æ–°æ¸²æŸ“æ•°å­¦å…¬å¼
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }

        function selectOption(index) {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelectorAll('.option')[index].classList.add('selected');
        }

        function toggleCheckbox(index) {
            const checkbox = document.getElementById(`opt${index}`);
            checkbox.checked = !checkbox.checked;
        }

        function submitAnswer() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            const question = stats.questions[stats.questions.length - 1];
            
            let selectedAnswers;
            let isCorrect;
            
            if (question.type === 'single') {
                const selected = document.querySelector('.option.selected');
                if (!selected) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ!');
                    return;
                }
                selectedAnswers = parseInt(selected.getAttribute('data-index'));
                isCorrect = selectedAnswers === question.correct;
                
                // æ˜¾ç¤ºç»“æœ
                document.querySelectorAll('.option').forEach((opt, idx) => {
                    if (idx === question.correct) {
                        opt.classList.add('correct');
                    } else if (idx === selectedAnswers && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                    opt.style.pointerEvents = 'none';
                });
            } else {
                selectedAnswers = [];
                document.querySelectorAll('input[type="checkbox"]').forEach((cb, idx) => {
                    if (cb.checked) {
                        selectedAnswers.push(idx);
                    }
                });
                
                if (selectedAnswers.length === 0) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ!');
                    return;
                }
                
                isCorrect = selectedAnswers.length === question.correct.length &&
                           selectedAnswers.every(ans => question.correct.includes(ans));
                
                // æ˜¾ç¤ºç»“æœ
                document.querySelectorAll('.checkbox-option').forEach((opt, idx) => {
                    if (question.correct.includes(idx)) {
                        opt.classList.add('correct');
                    } else if (selectedAnswers.includes(idx)) {
                        opt.classList.add('incorrect');
                    }
                    opt.style.pointerEvents = 'none';
                });
            }
            
            // æ›´æ–°ç»Ÿè®¡
            stats.attempts++;
            question.answered = true;
            question.isCorrect = isCorrect;
            
            if (isCorrect) {
                stats.correct++;
            }
            
            // æ˜¾ç¤ºåé¦ˆ
            const feedbackDiv = document.getElementById('feedback');
            if (isCorrect) {
                feedbackDiv.innerHTML = 
                    `<div class="feedback correct">
                        âœ… å›ç­”æ­£ç¡®!<br>
                        <small>${question.explanation}</small>
                    </div>`;
                document.getElementById('submitBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').textContent = 
                    studentData.currentTopicIndex < topics.length - 1 ? 'ä¸‹ä¸€çŸ¥è¯†ç‚¹' : 'æŸ¥çœ‹ç»“æœ';
            } else {
                feedbackDiv.innerHTML = 
                    `<div class="feedback incorrect">
                        âŒ å›ç­”é”™è¯¯,è¯·å†è¯•ä¸€æ¬¡!<br>
                        <small>${question.explanation}</small>
                    </div>`;
                document.getElementById('submitBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').textContent = 'ç»§ç»­ç­”é¢˜';
            }
            
            // é‡æ–°æ¸²æŸ“æ•°å­¦å…¬å¼
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }

        function nextQuestion() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            const lastQuestion = stats.questions[stats.questions.length - 1];
            
            if (lastQuestion.isCorrect) {
                // ç­”å¯¹äº†,è¿›å…¥ä¸‹ä¸€çŸ¥è¯†ç‚¹
                studentData.currentTopicIndex++;
                
                if (studentData.currentTopicIndex >= topics.length) {
                    // æ‰€æœ‰çŸ¥è¯†ç‚¹å®Œæˆ,æ˜¾ç¤ºç»“æœ
                    showResults();
                } else {
                    // åŠ è½½ä¸‹ä¸€çŸ¥è¯†ç‚¹
                    loadQuestion();
                }
            } else {
                // ç­”é”™äº†,ç»§ç»­å½“å‰çŸ¥è¯†ç‚¹
                loadQuestion();
            }
        }

        function showResults() {
            document.querySelector('.quiz-section').classList.remove('active');
            document.querySelector('.result-section').classList.add('active');
            
            let reportHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #608de0;">ğŸ‰ ${studentData.name} åŒå­¦(å­¦å·:${studentData.id})</h2>
                    <p style="color: #666; font-size: 1.1em;">æ‚¨å·²å®Œæˆæœ¬æ¬¡DSP-Lab1-ç»ƒä¹ !</p>
                </div>
                
                <table class="stats-table">
                    <tr>
                        <th>çŸ¥è¯†ç‚¹</th>
                        <th>ç­”é¢˜æ¬¡æ•°</th>
                        <th>é¦–æ¬¡æ­£ç¡®ç‡</th>
                        <th>æŒæ¡ç¨‹åº¦</th>
                    </tr>
            `;
            
            let goodTopics = [];
            let fairTopics = [];
            let poorTopics = [];
            
            topics.forEach(topic => {
                const stats = studentData.topicStats[topic.id];
                const firstTryCorrect = stats.attempts === 1 ? 100 : 0;
                const accuracy = ((1 / stats.attempts) * 100).toFixed(0);
                
                let mastery, masteryClass;
                if (stats.attempts === 1) {
                    mastery = 'ä¼˜ç§€ â­â­â­';
                    masteryClass = 'mastery-good';
                    goodTopics.push(topic.name);
                } else if (stats.attempts <= 3) {
                    mastery = 'è‰¯å¥½ â­â­';
                    masteryClass = 'mastery-fair';
                    fairTopics.push(topic.name);
                } else {
                    mastery = 'éœ€åŠ å¼º â­';
                    masteryClass = 'mastery-poor';
                    poorTopics.push(topic.name);
                }
                
                reportHTML += `
                    <tr>
                        <td><strong>${topic.name}</strong></td>
                        <td>${stats.attempts}æ¬¡</td>
                        <td>${accuracy}%</td>
                        <td class="${masteryClass}">${mastery}</td>
                    </tr>
                `;
            });
            
            reportHTML += '</table>';
            
            // æ€»ç»“åˆ†æ
            reportHTML += '<div style="margin-top: 30px;">';
            reportHTML += '<h3 style="color: #2d57a4;">ğŸ“Š çŸ¥è¯†æŒæ¡åˆ†æ</h3>';
            
            if (goodTopics.length > 0) {
                reportHTML += `
                    <div style="background: #e8f5e9; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #5ca353;">
                        <strong style="color: #5ca353;">âœ… æŒæ¡è¾ƒå¥½çš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${goodTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (fairTopics.length > 0) {
                reportHTML += `
                    <div style="background: #fff8e1; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #D46A6A;">
                        <strong style="color: #D46A6A;">âš ï¸ éœ€è¦å·©å›ºçš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${fairTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (poorTopics.length > 0) {
                reportHTML += `
                    <div style="background: #ffebee; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #912d32;">
                        <strong style="color: #912d32;">âŒ éœ€è¦é‡ç‚¹åŠ å¼ºçš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${poorTopics.join('ã€')}
                    </div>
                `;
            }
            
            reportHTML += '</div>';
            
            document.getElementById('finalReport').innerHTML = reportHTML;
        }

        // ==================== æˆªå›¾ä¿å­˜åŠŸèƒ½ ====================
        function saveScreenshot() {
            const button = document.getElementById('saveBtn');
            button.disabled = true;
            button.textContent = 'æ­£åœ¨ç”Ÿæˆæˆªå›¾...';
            
            // ä½¿ç”¨html2canvasç”Ÿæˆæˆªå›¾
            html2canvas(document.body, {
                backgroundColor: '#ffffff',
                scale: 2,  // æé«˜æ¸…æ™°åº¦
                logging: false
            }).then(canvas => {
                // è½¬æ¢ä¸ºå›¾ç‰‡
                canvas.toBlob(blob => {
                    // æ¸…ç†æ–‡ä»¶åä¸­çš„ç‰¹æ®Šå­—ç¬¦
                    const cleanId = studentData.id.replace(/[^a-zA-Z0-9_\u4e00-\u9fa5-]/g, '_');
                    const cleanName = studentData.name.replace(/[^a-zA-Z0-9_\u4e00-\u9fa5-]/g, '_');
                    
                    // æ„é€ æ–‡ä»¶å: å­¦å·_å§“å_Quiz1.png
                    const filename = `${cleanId}_${cleanName}_Quiz1.png`;
                    
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    // æ¸…ç†
                    URL.revokeObjectURL(url);
                    
                    // æ¢å¤æŒ‰é’®
                    button.disabled = false;
                    button.textContent = 'æˆªå›¾å·²ä¿å­˜';
                    setTimeout(() => {
                        button.textContent = 'å†æ¬¡æˆªå›¾';
                    }, 2000);
                }, 'image/png');
            }).catch(error => {
                console.error('æˆªå›¾å¤±è´¥:', error);
                alert('æˆªå›¾å¤±è´¥,è¯·å°è¯•ä½¿ç”¨æµè§ˆå™¨æˆªå›¾åŠŸèƒ½(Ctrl+Shift+S æˆ– Command+Shift+4)');
                button.disabled = false;
                button.textContent = 'æˆªå›¾ä¿å­˜';
            });
        }
    </script>
</body>
</html>