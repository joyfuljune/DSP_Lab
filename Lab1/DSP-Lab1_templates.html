<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DSPå®éªŒç©ºç™½æ¨¡æ¿</title>
    <style>
        body { font-family: 'Segoe UI', Consolas, 'Microsoft YaHei', sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        .control-panel {
            position: sticky; top: 0; z-index: 100;
            background: white; padding: 15px; margin-bottom: 20px;
            border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .control-btn {
            background: #2d57a4; color: white; border: none; padding: 8px 16px;
            border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 10px;
        }
        .control-btn:hover { background: #1e3a6e; }
        .control-btn.secondary { background: #6c757d; }

        .file-block { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; overflow: hidden; }
        
        .file-header { 
            background: #2d57a4; color: white; padding: 15px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; user-select: none;
        }
        .file-header:hover { background: #3b6bbd; }
        
        .file-title { font-weight: bold; display: flex; align-items: center; }
        .arrow-icon { display: inline-block; margin-right: 10px; transition: transform 0.3s; }
        .file-block.collapsed .arrow-icon { transform: rotate(-90deg); }
        
        .file-content { display: block; }
        .file-block.collapsed .file-content { display: none; }

        .copy-btn { background: #5ca353; border: none; color: white; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; }
        .copy-btn:hover { background: #4a8842; }

        pre { margin: 0; padding: 20px; overflow-x: auto; line-height: 1.8; font-size: 13px; background: #f8f9fa; border-top: 1px solid #e9ecef; }
        
        /* ä»£ç é«˜äº®æ ·å¼ */
        .keyword { color: #0000ff; }
        .comment { color: #228b22; font-style: italic; }
        .string { color: #a020f0; }
        .number { color: #ff0000; }
        
        /* å¾…åŠäº‹é¡¹æ ·å¼ */
        .todo-tag { background: #fff3cd; color: #856404; padding: 2px 6px; border-radius: 3px; border: 1px solid #ffeeba; font-weight: bold; font-size: 0.9em; margin-right: 5px; }

        .info-banner { background: #e7f3ff; border-left: 4px solid #2d57a4; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .warning-banner { background: #fff3cd; border-left: 4px solid #ff9800; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <h2 style="margin:0; color:#2d57a4;">ğŸ“ DSP Lab 1 - å­¦ç”Ÿå®éªŒæ¨¡æ¿</h2>
            <div>
                <button class="control-btn" onclick="expandAll()">å…¨éƒ¨å±•å¼€</button>
                <button class="control-btn secondary" onclick="collapseAll()">å…¨éƒ¨æŠ˜å </button>
            </div>
        </div>

        <div class="info-banner">
            <strong>ğŸ“Œ ç¼–ç¨‹è§„èŒƒè¯´æ˜ï¼š</strong>
            <ul style="margin:5px 0 0 20px; padding:0; line-height:1.8;">
                <li>ä»£ç ä¸­å·²é¢„å®šä¹‰äº†å…³é”®å˜é‡ï¼ˆå¦‚ <code>x = [];</code>ï¼‰ï¼Œ<strong>è¯·å‹¿ä¿®æ”¹å˜é‡å</strong>ã€‚</li>
                <li>è¯·åœ¨ <code>% TODO</code> æ³¨é‡ŠæŒ‡å¼•ä¸‹ç¼–å†™ä»£ç ï¼Œå°†è®¡ç®—ç»“æœèµ‹å€¼ç»™å¯¹åº”çš„å˜é‡ã€‚</li>
                <li>æ¯ä¸ªè„šæœ¬æœ«å°¾åŒ…å«<strong>è‡ªæ£€ä»£ç </strong>ï¼Œè¿è¡Œè„šæœ¬æ—¶è‹¥çœ‹åˆ°çº¢å­—è­¦å‘Šï¼Œè¯´æ˜å˜é‡æœªæ­£ç¡®èµ‹å€¼ã€‚</li>
            </ul>
        </div>

        <div class="warning-banner">
            <strong>âš ï¸ æäº¤æ£€æŸ¥ï¼š</strong>
            <ul style="margin:5px 0 0 20px; padding:0;">
                <li>exercise1_exponential_spectrum.m</li>
                <li>exercise2_convolution_theorem.m</li>
                <li>exercise3_tone_analysis.m</li>
                <li>MyDFT.m (å‡½æ•°æ–‡ä»¶)</li>
            </ul>
        </div>

        <!-- Exercise 1 -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ exercise1_exponential_spectrum.m
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code1')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code1">%% ç»ƒä¹ ä¸€ï¼šæŒ‡æ•°åºåˆ—çš„é¢‘è°±åˆ†æ
% æ–‡ä»¶å: exercise1_exponential_spectrum.m
% å­¦å·ï¼š______  å§“åï¼š______

clear; clc; close all;

%% 1. å‚æ•°å®šä¹‰
a = 0.9;
N_signal = 8;

%% 2. åºåˆ—ç”Ÿæˆ
x = [];          <span class="comment">% <span class="todo-tag">TODO</span> ç”ŸæˆæŒ‡æ•°åºåˆ— x[n] = a^n, n=0..N_signal-1</span>

%% 3. DTFTè®¡ç®—
omega = linspace(0, 2*pi, 512);
X_dtft = [];     <span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—DTFT (åœ¨omegaä¸Šé‡‡æ ·)</span>

%% 4. DFTè®¡ç®— (å…³é”®å˜é‡ï¼Œè¯·å‹¿æ”¹å)
X_dft_8   = [];  <span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®— 8ç‚¹ DFT</span>
X_dft_16  = [];  <span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®— 16ç‚¹ DFT</span>
X_dft_128 = [];  <span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®— 128ç‚¹ DFT</span>

%% 5. ç»˜å›¾
% <span class="todo-tag">TODO</span> ç»˜å›¾è¦æ±‚ï¼š2è¡Œ3åˆ—å­å›¾
% 1. åŸå§‹åºåˆ— x[n]
% 2. DTFTå¹…åº¦è°± |X|
% 3. DTFTç›¸ä½è°± Angle
% 4. 8ç‚¹DFT (stem) vs DTFT (plot)
% 5. 16ç‚¹DFT (stem) vs DTFT (plot)
% 6. 128ç‚¹DFT (stem) vs DTFT (plot)

figure('Name', 'Exercise 1: æŒ‡æ•°åºåˆ—é¢‘è°±åˆ†æ');
% åœ¨æ­¤å¤„ç¼–å†™ç»˜å›¾ä»£ç ...


%% ========================================
%  ğŸ” æäº¤å‰è‡ªæ£€ (è¯·å‹¿ä¿®æ”¹ä»¥ä¸‹ä»£ç )
%  =======================================
vars_chk = {'x', 'X_dft_8', 'X_dft_16', 'X_dft_128'};
miss = {};
for i = 1:length(vars_chk)
    if ~exist(vars_chk{i}, 'var') || isempty(eval(vars_chk{i}))
        miss{end+1} = vars_chk{i};
    end
end
if ~isempty(miss)
    fprintf(2, 'âŒ é”™è¯¯ï¼šä»¥ä¸‹å˜é‡æœªèµ‹å€¼æˆ–ä¸ºç©ºï¼Œæ— æ³•é€šè¿‡æ‰¹æ”¹ï¼š\n   -> %s\n', miss{:});
else
    fprintf('âœ… ç»ƒä¹ ä¸€å˜é‡æ£€æŸ¥é€šè¿‡ã€‚\n');
end
</pre>
            </div>
        </div>

        <!-- Exercise 2 -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ exercise2_convolution_theorem.m
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code2')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code2">%% ç»ƒä¹ äºŒï¼šå·ç§¯å®šç†éªŒè¯
% æ–‡ä»¶å: exercise2_convolution_theorem.m
% å­¦å·ï¼š______  å§“åï¼š______

clear; clc; close all;

%% 1. åºåˆ—å®šä¹‰
x = [];          <span class="comment">% <span class="todo-tag">TODO</span> å®šä¹‰åºåˆ— x (å¦‚ [1,1,1,1])</span>
h = [];          <span class="comment">% <span class="todo-tag">TODO</span> å®šä¹‰åºåˆ— h (å¦‚ [1,1,1,1])</span>

%% 2. çº¿æ€§å·ç§¯
z_linear = [];   <span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—çº¿æ€§å·ç§¯ (ä½¿ç”¨conv)</span>

%% 3. å¾ªç¯å·ç§¯ (å…³é”®å˜é‡ï¼Œè¯·å‹¿æ”¹å)
% æ–¹æ³•ï¼šDFT -> ç‚¹ä¹˜ -> IDFT
z_circ = [];     <span class="comment">% <span class="todo-tag">TODO</span> è®¡ç®—4ç‚¹å¾ªç¯å·ç§¯ç»“æœ</span>

%% 4. FFTå¿«é€Ÿè®¡ç®—çº¿æ€§å·ç§¯
% æç¤ºï¼šéœ€è¦è¡¥é›¶åˆ° L >= Nx + Nh - 1
z_fast_conv = []; <span class="comment">% <span class="todo-tag">TODO</span> ä½¿ç”¨FFTè®¡ç®—çº¿æ€§å·ç§¯</span>

%% 5. ç»˜å›¾
% <span class="todo-tag">TODO</span> ç»˜å›¾è¦æ±‚ï¼š2è¡Œ3åˆ—
% å±•ç¤º x[n], h[n], çº¿æ€§å·ç§¯, å¾ªç¯å·ç§¯, å¿«é€Ÿå·ç§¯ç»“æœ

figure('Name', 'Exercise 2: å·ç§¯å®šç†éªŒè¯');
% åœ¨æ­¤å¤„ç¼–å†™ç»˜å›¾ä»£ç ...


%% ========================================
%  ğŸ” æäº¤å‰è‡ªæ£€ (è¯·å‹¿ä¿®æ”¹ä»¥ä¸‹ä»£ç )
%  =======================================
vars_chk = {'x', 'h', 'z_linear', 'z_circ', 'z_fast_conv'};
miss = {};
for i = 1:length(vars_chk)
    if ~exist(vars_chk{i}, 'var') || isempty(eval(vars_chk{i}))
        miss{end+1} = vars_chk{i};
    end
end
if ~isempty(miss)
    fprintf(2, 'âŒ é”™è¯¯ï¼šä»¥ä¸‹å˜é‡æœªèµ‹å€¼æˆ–ä¸ºç©ºï¼Œæ— æ³•é€šè¿‡æ‰¹æ”¹ï¼š\n   -> %s\n', miss{:});
else
    fprintf('âœ… ç»ƒä¹ äºŒå˜é‡æ£€æŸ¥é€šè¿‡ã€‚\n');
end
</pre>
            </div>
        </div>

        <!-- Exercise 3 -->
        <div class="file-block collapsed">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ exercise3_tone_analysis.m
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code3')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code3">%% ç»ƒä¹ ä¸‰ï¼šå®é™…ä¿¡å·é¢‘è°±åˆ†æ
% æ–‡ä»¶å: exercise3_tone_analysis.m
% å­¦å·ï¼š______  å§“åï¼š______

clear; clc; close all;

%% 1. åŠ è½½æ•°æ®
if exist('tones.mat', 'file')
    load('tones.mat'); % åŠ è½½å˜é‡ y å’Œ Fs
else
    error('æœªæ‰¾åˆ° tones.mat æ–‡ä»¶ï¼Œè¯·ç¡®ä¿æ–‡ä»¶åœ¨å½“å‰ç›®å½•ä¸‹');
end

%% 2. é¢‘è°±åˆ†æ (å…³é”®å˜é‡ï¼Œè¯·å‹¿æ”¹å)
X_orig = [];     <span class="comment">% <span class="todo-tag">TODO</span> åŸå§‹é•¿åº¦Nçš„FFTç»“æœ</span>
X_25   = [];     <span class="comment">% <span class="todo-tag">TODO</span> N=25ç‚¹çš„FFTç»“æœ (ç”¨äºæ‰¹æ”¹ç‚¹æ£€æµ‹)</span>

% æ‰©å±•åˆ†æ (å¯é€‰å˜é‡å)
X_2x   = [];     <span class="comment">% <span class="todo-tag">TODO</span> 2å€é•¿åº¦è¡¥é›¶FFT</span>
X_4x   = [];     <span class="comment">% <span class="todo-tag">TODO</span> 4å€é•¿åº¦è¡¥é›¶FFT</span>

%% 3. å³°å€¼æ£€æµ‹
% <span class="todo-tag">TODO</span> æ‰“å°ä¸»è¦é¢‘ç‡åˆ†é‡ (findpeaks)


%% 4. ç»˜å›¾
% <span class="todo-tag">TODO</span> ç»˜åˆ¶æ—¶åŸŸæ³¢å½¢ã€ä¸åŒåˆ†è¾¨ç‡çš„é¢‘è°±å¯¹æ¯”å›¾

figure('Name', 'Exercise 3: éŸ³è°ƒä¿¡å·åˆ†æ');
% åœ¨æ­¤å¤„ç¼–å†™ç»˜å›¾ä»£ç ...


%% ========================================
%  ğŸ” æäº¤å‰è‡ªæ£€ (è¯·å‹¿ä¿®æ”¹ä»¥ä¸‹ä»£ç )
%  =======================================
vars_chk = {'X_orig', 'X_25'};
miss = {};
for i = 1:length(vars_chk)
    if ~exist(vars_chk{i}, 'var') || isempty(eval(vars_chk{i}))
        miss{end+1} = vars_chk{i};
    end
end
if ~isempty(miss)
    fprintf(2, 'âŒ é”™è¯¯ï¼šä»¥ä¸‹å˜é‡æœªèµ‹å€¼æˆ–ä¸ºç©ºï¼Œæ— æ³•é€šè¿‡æ‰¹æ”¹ï¼š\n   -> %s\n', miss{:});
else
    fprintf('âœ… ç»ƒä¹ ä¸‰å˜é‡æ£€æŸ¥é€šè¿‡ã€‚\n');
end
</pre>
            </div>
        </div>

        <!-- MyDFT Function -->
        <div class="file-block collapsed">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ MyDFT.m <span style="font-weight:normal; margin-left:10px; color:#ffc107;">âš ï¸ ç‹¬ç«‹å‡½æ•°æ–‡ä»¶</span>
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code4')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code4">function X = MyDFT(x, N)
%% MyDFT - è‡ªå®šä¹‰DFTå‡½æ•°
% è¾“å…¥ï¼š
%   x - è¾“å…¥åºåˆ—
%   N - DFTç‚¹æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ºåºåˆ—é•¿åº¦ï¼‰
% è¾“å‡ºï¼š
%   X - Nç‚¹DFTç»“æœ (å¿…é¡»èµ‹å€¼ç»™æ­¤å˜é‡)

%% 1. å‚æ•°åˆå§‹åŒ–
if nargin < 2
    % <span class="todo-tag">TODO</span> å¦‚æœæœªæä¾›Nï¼Œé»˜è®¤Nä¸ºxçš„é•¿åº¦
    N = length(x); 
end

%% 2. é¢„å¤„ç† (è¡¥é›¶æˆ–æˆªæ–­)
% <span class="todo-tag">TODO</span> æ ¹æ®Nå’Œxçš„é•¿åº¦å…³ç³»ï¼Œå¯¹xè¿›è¡Œå¤„ç†
x_processed = x; % è¯·ä¿®æ”¹æ­¤å¤„é€»è¾‘


%% 3. DFTæ ¸å¿ƒè®¡ç®—
X = zeros(N, 1); % åˆå§‹åŒ–è¾“å‡º

% <span class="todo-tag">TODO</span> å®ç°DFTå…¬å¼ï¼šX[k] = sum(x[n] * exp(-j*2*pi*k*n/N))
% å»ºè®®ä½¿ç”¨çŸ©é˜µè¿ç®—ä»¥æé«˜æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŒé‡å¾ªç¯


%% 4. è¾“å‡ºæ ¼å¼è°ƒæ•´
% <span class="todo-tag">TODO</span> ç¡®ä¿è¾“å‡º X çš„è¡Œåˆ—æ–¹å‘ä¸è¾“å…¥ x ä¸€è‡´


end
</pre>
            </div>
        </div>

        <!-- æµ‹è¯•è¯´æ˜ -->
        <div style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 8px; padding: 20px; margin-top: 30px;">
            <h3 style="color: #2d57a4; margin-top: 0;">ğŸ’¡ æœ¬åœ°éªŒè¯å»ºè®®</h3>
            
            <p>å»ºè®®åœ¨ç¼–å†™å®Œä»£ç åï¼Œåœ¨å‘½ä»¤è¡Œçª—å£è¿è¡Œä»¥ä¸‹æµ‹è¯•ï¼Œç¡®ä¿ä½ çš„ <code>MyDFT</code> ç»“æœæ­£ç¡®ï¼š</p>
            <pre style="background: white; padding: 15px; border-radius: 4px; border: 1px solid #dee2e6;">
x = [1, 2, 3, 4];

<span class="comment">% æµ‹è¯•1ï¼šåŸºæœ¬åŠŸèƒ½</span>
X1 = MyDFT(x, 4);
err1 = norm(X1 - fft(x, 4));
fprintf('Test 1 Error: %e\n', err1); <span class="comment">% åº”è¯¥éå¸¸æ¥è¿‘ 0</span>

<span class="comment">% æµ‹è¯•2ï¼šè¡¥é›¶æµ‹è¯• (N=8)</span>
X2 = MyDFT(x, 8);
err2 = norm(X2 - fft(x, 8));
fprintf('Test 2 Error: %e\n', err2); <span class="comment">% åº”è¯¥éå¸¸æ¥è¿‘ 0</span></pre>
        </div>

    </div>

    <script>
        function toggleBlock(header) {
            header.parentElement.classList.toggle('collapsed');
        }

        function expandAll() {
            document.querySelectorAll('.file-block').forEach(b => b.classList.remove('collapsed'));
        }

        function collapseAll() {
            document.querySelectorAll('.file-block').forEach(b => b.classList.add('collapsed'));
        }

        function copyCode(event, id) {
            event.stopPropagation();
            const container = document.getElementById(id);
            
            // åˆ›å»ºä¸´æ—¶å®¹å™¨ï¼Œç”¨äºè·å–çº¯æ–‡æœ¬
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = container.innerHTML;
            
            // æ ¸å¿ƒé€»è¾‘ï¼šä¿æŒä»£ç æ–‡æœ¬åŸæ ·ï¼Œä½†å»é™¤HTMLæ ‡ç­¾
            // æ³¨æ„ï¼špre æ ‡ç­¾ä¸­çš„ innerText ä¼šä¿ç•™æ¢è¡Œç¬¦
            const cleanCode = tempDiv.innerText;

            const el = document.createElement('textarea');
            el.value = cleanCode;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            
            const btn = event.target;
            const origText = btn.textContent;
            btn.textContent = 'âœ“ å·²å¤åˆ¶';
            btn.style.background = '#28a745';
            setTimeout(() => {
                btn.textContent = origText;
                btn.style.background = '#5ca353';
            }, 2000);
        }
    </script>
</body>
</html>
