<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSP-Proj3 ç»ƒä¹ æµ‹éªŒ - éŸ³é¢‘å˜è°ƒå®éªŒ</title>
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [['$$','$$'], ['\\[','\\]']],
                processEscapes: true
            }
        });
    </script>

    <style>
        .mathjax-status {
            position: fixed;
            top: 10px;
            right: 15px;
            padding: 8px 15px;
            border-radius: 5px;
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            font-size: 14px;
            z-index: 10000;
            font-family: 'Microsoft YaHei', sans-serif;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .mathjax-status.loading {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }
        .mathjax-status.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
            transition: opacity 0.5s ease-out 1.5s;
            opacity: 0;
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimSun', Arial, sans-serif;
            background: linear-gradient(135deg, #e74c3c 0%, #8e44ad 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.25);
            padding: 40px;
        }

        h1 {
            color: #e74c3c;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }

        h2 {
            color: #e74c3c;
            margin: 25px 0 15px 0;
        }

        .login-section, .quiz-section, .result-section {
            display: none;
        }

        .login-section.active, .quiz-section.active, .result-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #e74c3c;
            font-weight: bold;
            margin-bottom: 8px;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #c0392b;
            border-radius: 8px;
            font-size: 16px;
        }

        button {
            background: linear-gradient(135deg, #e74c3c 0%, #8e44ad 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(231, 76, 60, 0.3);
        }

        button:hover {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.5);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .question-box {
            background: #f8f9fa;
            border-left: 5px solid #e74c3c;
            padding: 25px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .question-title {
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .options {
            margin: 15px 0;
        }

        .option {
            display: block;
            background: white;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            background: #fff5f5;
            border-color: #e74c3c;
        }

        .option.selected {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }

        .option.correct {
            background: #48bb78;
            color: white;
            border-color: #38a169;
        }

        .option.incorrect {
            background: #f56565;
            color: white;
            border-color: #e53e3e;
        }

        .feedback {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #48bb78;
            border-left: 5px solid #48bb78;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #f56565;
            border-left: 5px solid #f56565;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #e74c3c 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .stats-table th, .stats-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e0e0e0;
        }

        .stats-table th {
            background: linear-gradient(135deg, #e74c3c 0%, #8e44ad 100%);
            color: white;
        }

        .stats-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .mastery-excellent { color: #48bb78; font-weight: bold; }
        .mastery-good { color: #667eea; font-weight: bold; }
        .mastery-fair { color: #ed8936; font-weight: bold; }
        .mastery-poor { color: #f56565; font-weight: bold; }

        .tf-options {
            display: flex;
            gap: 20px;
            margin: 15px 0;
        }

        .tf-option {
            flex: 1;
            padding: 15px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tf-option:hover {
            border-color: #e74c3c;
        }

        .tf-option.selected {
            background: #e74c3c;
            color: white;
            border-color: #c0392b;
        }

        .multiple-hint {
            color: #e74c3c;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div id="mathjaxStatus" class="mathjax-status loading">â³ æ­£åœ¨åŠ è½½æ•°å­¦å…¬å¼...</div>

    <div class="container">
        <!-- ç™»å½•ç•Œé¢ -->
        <div class="login-section active">
            <h1>ğŸµ DSP-Proj3 ç»ƒä¹ æµ‹éªŒ</h1>
            <h2 style="text-align: center; color: #8e44ad;">éŸ³é¢‘å˜è°ƒå®éªŒ</h2>
            
            <div style="background: #fff5f5; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 5px solid #e74c3c;">
                <p><strong>ğŸ“‹ æµ‹éªŒè¯´æ˜ï¼š</strong></p>
                <ul style="margin: 10px 0 0 20px; line-height: 2;">
                    <li>æœ¬æµ‹éªŒåŒ…å« <strong>7ä¸ªçŸ¥è¯†ç‚¹</strong>ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éœ€ç­”å¯¹ä¸€é¢˜æ‰èƒ½è¿›å…¥ä¸‹ä¸€ä¸ª</li>
                    <li>é¢˜ç›®éšæœºç”Ÿæˆï¼Œæ•°å€¼å’Œé€‰é¡¹é¡ºåºæ¯æ¬¡ä¸åŒ</li>
                    <li>ç­”é”™ä¼šç”Ÿæˆæ–°é¢˜ç»§ç»­ï¼Œç›´åˆ°ç­”å¯¹ä¸ºæ­¢</li>
                    <li>æœ€ç»ˆä¼šæ ¹æ®ç­”é¢˜æ¬¡æ•°è¯„ä¼°çŸ¥è¯†æŒæ¡ç¨‹åº¦</li>
                </ul>
            </div>

            <div class="form-group">
                <label>ğŸ“ å­¦å·ï¼ˆ10ä½æ•°å­—ï¼‰</label>
                <input type="text" id="studentId" placeholder="è¯·è¾“å…¥å­¦å·" maxlength="10">
            </div>
            <div class="form-group">
                <label>ğŸ‘¤ å§“å</label>
                <input type="text" id="studentName" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            <button onclick="startQuiz()">å¼€å§‹æµ‹éªŒ â†’</button>
        </div>

        <!-- ç­”é¢˜ç•Œé¢ -->
        <div class="quiz-section">
            <h1>ğŸµ DSP-Proj3 ç»ƒä¹ æµ‹éªŒ</h1>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%">0/7</div>
            </div>

            <div id="topicInfo" style="color: #8e44ad; font-weight: bold; margin-bottom: 10px;"></div>
            
            <div class="question-box">
                <div class="question-title" id="questionTitle"></div>
                <div id="questionContent"></div>
                <div id="feedbackArea"></div>
            </div>

            <button id="submitBtn" onclick="submitAnswer()">æäº¤ç­”æ¡ˆ</button>
            <button id="nextBtn" onclick="nextQuestion()" style="display: none;">ç»§ç»­ç­”é¢˜</button>
        </div>

        <!-- ç»“æœç•Œé¢ -->
        <div class="result-section">
            <h1>ğŸ“Š æµ‹éªŒç»“æœæŠ¥å‘Š</h1>
            <div id="finalReport"></div>
            <button id="saveBtn" onclick="saveScreenshot()">æˆªå›¾ä¿å­˜</button>
        </div>
    </div>

    <script>
        // ==================== æ•°æ®ç»“æ„ ====================
        let studentData = {
            id: '',
            name: '',
            topicStats: {},
            currentTopicIndex: 0,
            currentQuestionIndex: 0,
            usedQuestions: {}
        };

        // çŸ¥è¯†ç‚¹å®šä¹‰
        const topics = [
            {
                name: 'åŸºé¢‘ä¸éŸ³è°ƒ',
                id: 'pitch_basics',
                description: 'éŸ³é«˜ã€åŸºé¢‘ã€ç”·å¥³å£°é¢‘ç‡èŒƒå›´'
            },
            {
                name: 'äººä½“å‘å£°åŸç†',
                id: 'voice_production',
                description: 'å£°æº-æ»¤æ³¢å™¨æ¨¡å‹ã€å£°å¸¦ä¸è°ƒéŸ³åŒº'
            },
            {
                name: 'å…±æŒ¯å³°æ¦‚å¿µ',
                id: 'formant',
                description: 'å…±æŒ¯å³°çš„å®šä¹‰ã€ä½œç”¨åŠ"å°é»„äºº"æ•ˆåº”'
            },
            {
                name: 'Phase Vocoderå›é¡¾',
                id: 'pv_review',
                description: 'ç›¸ä½å£°ç å™¨çš„å˜é€ŸåŸç†'
            },
            {
                name: 'å˜è°ƒæ–¹æ³•ä¸€',
                id: 'method1',
                description: 'PVæ—¶é—´ä¼¸ç¼©+é‡é‡‡æ ·å˜è°ƒ'
            },
            {
                name: 'å˜è°ƒæ–¹æ³•äºŒ',
                id: 'method2',
                description: 'é¢‘è°±å¸§æ“ä½œå˜è°ƒ'
            },
            {
                name: 'é¢‘è°±å¹…åº¦ä¿®æ­£',
                id: 'envelope_correction',
                description: 'å…±æŒ¯å³°ä¿æŒä¸åŒ…ç»œä¿®æ­£'
            }
        ];

        // ==================== å·¥å…·å‡½æ•° ====================
        
        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function randChoice(arr) {
            return arr[randInt(0, arr.length - 1)];
        }

        function randFloat(min, max, decimals = 2) {
            return (Math.random() * (max - min) + min).toFixed(decimals);
        }

        function shuffleOptionsWithAnswer(options, correctIndex) {
            const indices = options.map((_, i) => i);
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            return {
                options: indices.map(i => options[i]),
                correct: indices.indexOf(correctIndex)
            };
        }

        function shuffleOptionsWithAnswers(options, correctIndices) {
            const indices = options.map((_, i) => i);
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            return {
                options: indices.map(i => options[i]),
                correct: correctIndices.map(ci => indices.indexOf(ci)).sort((a, b) => a - b)
            };
        }

        // ==================== é¢˜ç›®ç”Ÿæˆå‡½æ•° ====================
        
        const questionGenerators = {
            // ========== çŸ¥è¯†ç‚¹1: åŸºé¢‘ä¸éŸ³è°ƒ ==========
            pitch_basics: [
                () => {
                    return {
                        type: 'single',
                        question: 'å˜è°ƒï¼ˆPitch Shiftingï¼‰æ˜¯æŒ‡æ”¹å˜éŸ³é¢‘ä¿¡å·çš„ä»€ä¹ˆç‰¹æ€§ï¼Ÿ',
                        options: [
                            'åŸºæœ¬é¢‘ç‡ï¼ˆåŸºé¢‘ï¼‰ï¼Œä»è€Œæ”¹å˜éŸ³é«˜',
                            'æŒ¯å¹…ï¼Œä»è€Œæ”¹å˜å“åº¦',
                            'æŒç»­æ—¶é—´ï¼Œä»è€Œæ”¹å˜é€Ÿåº¦',
                            'é‡‡æ ·ç‡ï¼Œä»è€Œæ”¹å˜è´¨é‡'
                        ],
                        correct: 0,
                        explanation: 'å˜è°ƒæ˜¯æ”¹å˜éŸ³é¢‘çš„åŸºé¢‘ï¼ˆFundamental Frequencyï¼‰ï¼ŒåŸºé¢‘å†³å®šäº†æˆ‘ä»¬å¬åˆ°çš„éŸ³é«˜ã€‚'
                    };
                },
                
                () => {
                    const noteC = 261;
                    const noteE = 330;
                    return {
                        type: 'single',
                        question: `é’¢ç´ä¸­éŸ³Cï¼ˆdoï¼‰çš„åŸºé¢‘çº¦ä¸º${noteC}Hzï¼Œä¸­éŸ³Eï¼ˆmiï¼‰çš„åŸºé¢‘çº¦ä¸º${noteE}Hzã€‚å“ªä¸ªéŸ³è°ƒæ›´é«˜ï¼Ÿ`,
                        options: [
                            'miæ›´é«˜ï¼Œå› ä¸ºåŸºé¢‘æ›´å¤§',
                            'doæ›´é«˜ï¼Œå› ä¸ºåŸºé¢‘æ›´å°',
                            'ä¸¤è€…ä¸€æ ·é«˜',
                            'æ— æ³•åˆ¤æ–­'
                        ],
                        correct: 0,
                        explanation: `åŸºé¢‘è¶Šé«˜ï¼ŒéŸ³è°ƒè¶Šé«˜ã€‚${noteE}Hz > ${noteC}Hzï¼Œæ‰€ä»¥miæ¯”doéŸ³è°ƒé«˜ã€‚`
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'å…³äºç”·å¥³å£°çš„åŸºé¢‘èŒƒå›´ï¼Œä»¥ä¸‹æ­£ç¡®çš„æ˜¯ï¼š',
                        options: [
                            'ç”·æ€§çº¦85-180Hzï¼Œå¥³æ€§çº¦165-255Hz',
                            'ç”·æ€§çº¦165-255Hzï¼Œå¥³æ€§çº¦85-180Hz',
                            'ç”·å¥³åŸºé¢‘èŒƒå›´ç›¸åŒ',
                            'ç”·æ€§çº¦500-1000Hzï¼Œå¥³æ€§çº¦1000-2000Hz'
                        ],
                        correct: 0,
                        explanation: 'ç”·æ€§å£°å¸¦è¾ƒé•¿è¾ƒåšï¼ŒæŒ¯åŠ¨é¢‘ç‡è¾ƒä½ï¼ˆ85-180Hzï¼‰ï¼›å¥³æ€§å£°å¸¦è¾ƒçŸ­è¾ƒè–„ï¼ŒæŒ¯åŠ¨é¢‘ç‡è¾ƒé«˜ï¼ˆ165-255Hzï¼‰ã€‚'
                    };
                },
                
                () => {
                    const threshold = randChoice([150, 160, 170]);
                    return {
                        type: 'tf',
                        question: `åˆ¤æ–­ï¼šé€šå¸¸åŸºé¢‘å¤§äº${threshold}Hzçš„è¯­éŸ³ä¼šè¢«åˆ¤æ–­ä¸ºå¥³å£°ã€‚`,
                        correct: threshold <= 160,
                        explanation: `é€šå¸¸ä»¥çº¦160Hzä¸ºåˆ†ç•Œï¼Œå¤§äº160Hzåˆ¤æ–­ä¸ºå¥³å£°ï¼Œå°äº160Hzåˆ¤æ–­ä¸ºç”·å£°ã€‚${threshold}Hz ${threshold <= 160 ? 'â‰¤' : '>'} 160Hzã€‚`
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'åœ¨MATLAB 2018åŠä»¥åç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç”¨å“ªä¸ªå‡½æ•°ç›´æ¥è·å–è¯­éŸ³ä¿¡å·çš„åŸºé¢‘ï¼Ÿ',
                        options: [
                            'pitch(x, fs)',
                            'fft(x)',
                            'stft(x)',
                            'fundamental(x, fs)'
                        ],
                        correct: 0,
                        explanation: 'MATLABæä¾›äº†pitch()å‡½æ•°æ¥ä¼°è®¡è¯­éŸ³ä¿¡å·çš„åŸºé¢‘ï¼Œç”¨æ³•ä¸º f0 = pitch(x, fs)ã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹2: äººä½“å‘å£°åŸç† ==========
            voice_production: [
                () => {
                    return {
                        type: 'single',
                        question: 'äººä½“å‘å£°ç³»ç»Ÿå¯ä»¥ç®€åŒ–ä¸ºå“ªä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼Ÿ',
                        options: [
                            'å£°å¸¦ï¼ˆå£°æºåŒºï¼‰å’Œè°ƒéŸ³åŒºï¼ˆè¿‡æ»¤å™¨ï¼‰',
                            'è‚ºéƒ¨å’Œå£è…”',
                            'å–‰å’™å’Œé¼»è…”',
                            'æ°”ç®¡å’Œå£°é—¨'
                        ],
                        correct: 0,
                        explanation: 'å‘å£°ç³»ç»Ÿåˆ†ä¸ºï¼šå£°æºåŒºï¼ˆå£°å¸¦æŒ¯åŠ¨äº§ç”ŸåŸºé¢‘ï¼‰å’Œè°ƒéŸ³åŒº/è¿‡æ»¤å™¨ï¼ˆå£è…”ã€å’½è…”ç­‰ä¿®é¥°éŸ³è‰²ï¼‰ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'åœ¨å£°æº-æ»¤æ³¢å™¨æ¨¡å‹ä¸­ï¼Œå£°å¸¦çš„ä½œç”¨æ˜¯ï¼š',
                        options: [
                            'æŒ¯åŠ¨äº§ç”ŸåŸºé¢‘ï¼Œå†³å®šéŸ³é«˜',
                            'ä¿®é¥°éŸ³è‰²ï¼Œäº§ç”Ÿå…±æŒ¯å³°',
                            'æä¾›æ°”æµåŠ¨åŠ›',
                            'æ§åˆ¶è¯´è¯é€Ÿåº¦'
                        ],
                        correct: 0,
                        explanation: 'å£°å¸¦æ˜¯å£°æºåŒºï¼Œé€šè¿‡æŒ¯åŠ¨äº§ç”Ÿç‰¹å®šé¢‘ç‡çš„å£°æ³¢ï¼Œè¿™ä¸ªé¢‘ç‡å°±æ˜¯åŸºé¢‘ï¼Œå†³å®šäº†éŸ³é«˜ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'ä¸ºä»€ä¹ˆæ¯ä¸ªäººçš„è¯´è¯å£°éŸ³ä¸åŒï¼Œå³ä½¿å”±åŒä¸€ä¸ªéŸ³è°ƒï¼Ÿ',
                        options: [
                            'æ¯ä¸ªäººå£è…”å½¢çŠ¶ã€èˆŒå¤´ä½ç½®ç­‰ä¸åŒï¼Œè°ƒéŸ³åŒºå¯¹éŸ³è‰²çš„ä¿®æ”¹ä¸åŒ',
                            'æ¯ä¸ªäººå£°å¸¦æŒ¯åŠ¨é¢‘ç‡ä¸åŒ',
                            'æ¯ä¸ªäººè‚ºæ´»é‡ä¸åŒ',
                            'æ¯ä¸ªäººå¬åŠ›ä¸åŒ'
                        ],
                        correct: 0,
                        explanation: 'å³ä½¿åŸºé¢‘ç›¸åŒï¼ˆéŸ³è°ƒç›¸åŒï¼‰ï¼Œä¸åŒäººçš„è°ƒéŸ³åŒºï¼ˆå£è…”ã€å’½è…”å½¢çŠ¶ç­‰ï¼‰ä¼šå¯¹å£°éŸ³è¿›è¡Œä¸åŒçš„ä¿®é¥°ï¼Œå½¢æˆä¸åŒéŸ³è‰²ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­ï¼šä»…æ”¹å˜è¯­éŸ³ä¿¡å·çš„åŸºé¢‘å°±èƒ½å®Œç¾æ¨¡æ‹Ÿå¦ä¸€ä¸ªäººçš„å£°éŸ³ã€‚',
                        correct: false,
                        explanation: 'é”™è¯¯ã€‚æ”¹å˜åŸºé¢‘åªæ”¹å˜éŸ³é«˜ï¼Œä½†éŸ³è‰²ç”±è°ƒéŸ³åŒºï¼ˆå…±æŒ¯å³°ï¼‰å†³å®šã€‚è¦æ¨¡æ‹Ÿå¦ä¸€äººçš„å£°éŸ³ï¼Œè¿˜éœ€è¦ä¿®æ”¹å…±æŒ¯å³°ç‰¹æ€§ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'multiple',
                        question: 'ä»¥ä¸‹å“ªäº›å±äºäººä½“å‘å£°ç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†ï¼Ÿï¼ˆå¤šé€‰ï¼‰',
                        options: [
                            'è‚ºéƒ¨å’Œæ¨ªè†ˆè†œï¼ˆåŠ¨åŠ›åŒºï¼‰',
                            'å£°å¸¦å’Œå–‰éƒ¨ï¼ˆå£°æºåŒºï¼‰',
                            'å£è…”ã€å’½è…”ã€é¼»è…”ï¼ˆè°ƒéŸ³åŒºï¼‰',
                            'è€³æœµï¼ˆå¬è§‰åŒºï¼‰'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'å‘å£°ç³»ç»ŸåŒ…æ‹¬ï¼šåŠ¨åŠ›åŒºï¼ˆè‚ºã€æ¨ªè†ˆè†œæä¾›æ°”æµï¼‰ã€å£°æºåŒºï¼ˆå£°å¸¦æŒ¯åŠ¨ï¼‰ã€è°ƒéŸ³åŒºï¼ˆå£è…”ç­‰ä¿®é¥°éŸ³è‰²ï¼‰ã€‚è€³æœµæ˜¯å¬è§‰å™¨å®˜ï¼Œä¸å±äºå‘å£°ç³»ç»Ÿã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹3: å…±æŒ¯å³°æ¦‚å¿µ ==========
            formant: [
                () => {
                    return {
                        type: 'single',
                        question: 'å…±æŒ¯å³°ï¼ˆFormantï¼‰çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ',
                        options: [
                            'å†³å®šéŸ³è‰²ï¼ŒåŒºåˆ†ä¸åŒäººçš„å£°éŸ³',
                            'å†³å®šéŸ³é«˜ï¼ŒåŒºåˆ†ä¸åŒéŸ³è°ƒ',
                            'å†³å®šå“åº¦ï¼ŒåŒºåˆ†å£°éŸ³å¤§å°',
                            'å†³å®šé€Ÿåº¦ï¼ŒåŒºåˆ†è¯´è¯å¿«æ…¢'
                        ],
                        correct: 0,
                        explanation: 'å…±æŒ¯å³°æ˜¯è°ƒéŸ³åŒºäº§ç”Ÿçš„å…±æŒ¯é¢‘ç‡ï¼Œå†³å®šäº†å£°éŸ³çš„éŸ³è‰²ç‰¹å¾ï¼Œæ˜¯åŒºåˆ†ä¸åŒäººå£°éŸ³çš„å…³é”®å‚æ•°ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'åŸºé¢‘ï¼ˆF0ï¼‰å’Œå…±æŒ¯å³°ï¼ˆF1, F2, F3...ï¼‰çš„å…³ç³»æ˜¯ï¼š',
                        options: [
                            'åŸºé¢‘å†³å®šéŸ³é«˜ï¼Œå…±æŒ¯å³°å†³å®šéŸ³è‰²ï¼ŒäºŒè€…ç›¸å¯¹ç‹¬ç«‹',
                            'å…±æŒ¯å³°æ˜¯åŸºé¢‘çš„æ•´æ•°å€',
                            'åŸºé¢‘ç­‰äºæ‰€æœ‰å…±æŒ¯å³°çš„å¹³å‡å€¼',
                            'åŸºé¢‘å’Œå…±æŒ¯å³°å®Œå…¨ç›¸åŒ'
                        ],
                        correct: 0,
                        explanation: 'åŸºé¢‘ç”±å£°å¸¦æŒ¯åŠ¨äº§ç”Ÿï¼ˆå†³å®šéŸ³é«˜ï¼‰ï¼Œå…±æŒ¯å³°ç”±è°ƒéŸ³åŒºå…±æŒ¯äº§ç”Ÿï¼ˆå†³å®šéŸ³è‰²ï¼‰ã€‚äºŒè€…ç”±ä¸åŒå‘å£°å™¨å®˜äº§ç”Ÿï¼Œç›¸å¯¹ç‹¬ç«‹ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: '"å°é»„äºº"æˆ–"èŠ±æ —é¼ "æ•ˆåº”æ˜¯ç”±ä»€ä¹ˆåŸå› é€ æˆçš„ï¼Ÿ',
                        options: [
                            'å‡é«˜éŸ³è°ƒæ—¶å…±æŒ¯å³°ä¹Ÿè¢«å‡é«˜ï¼Œè¶…å‡ºæ­£å¸¸äººç±»èŒƒå›´',
                            'é™ä½éŸ³è°ƒæ—¶åŸºé¢‘è¿‡ä½',
                            'éŸ³é¢‘é‡‡æ ·ç‡å¤ªä½',
                            'çª—å‡½æ•°é€‰æ‹©ä¸å½“'
                        ],
                        correct: 0,
                        explanation: 'ç®€å•å˜è°ƒä¼šåŒæ—¶æ”¹å˜åŸºé¢‘å’Œå…±æŒ¯å³°ã€‚å½“å…±æŒ¯å³°è¶…å‡ºäººç±»æ­£å¸¸èŒƒå›´ï¼ˆçº¦500-3000Hzï¼‰æ—¶ï¼Œå£°éŸ³å°±ä¼šå¤±çœŸï¼Œå¬èµ·æ¥åƒå¡é€šäººç‰©ã€‚'
                    };
                },
                
                () => {
                    const gender = randChoice(['ç”·æ€§', 'å¥³æ€§']);
                    const range = gender === 'ç”·æ€§' ? '500~2600Hz' : '600~2900Hz';
                    return {
                        type: 'single',
                        question: `${gender}å…ƒéŸ³i/uçš„å…±æŒ¯å³°èŒƒå›´å¤§çº¦æ˜¯ï¼š`,
                        options: [
                            range,
                            gender === 'ç”·æ€§' ? '600~2900Hz' : '500~2600Hz',
                            '100~500Hz',
                            '3000~5000Hz'
                        ],
                        correct: 0,
                        explanation: `äººç±»å…±æŒ¯å³°æœ‰å›ºå®šèŒƒå›´ï¼šç”·æ€§çº¦500~2600Hzï¼Œå¥³æ€§çº¦600~2900Hzã€‚è¶…å‡ºæ­¤èŒƒå›´ä¼šäº§ç”Ÿä¸è‡ªç„¶çš„å£°éŸ³ã€‚`
                    };
                },
                
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­ï¼šä¸åŒå…ƒéŸ³ï¼ˆå¦‚[ah]ã€[ee]ã€[oo]ï¼‰å…·æœ‰ä¸åŒçš„å…±æŒ¯å³°ç‰¹å¾ã€‚',
                        correct: true,
                        explanation: 'æ­£ç¡®ã€‚ä¸åŒå…ƒéŸ³ç”±ä¸åŒçš„å£å‹ã€èˆŒä½äº§ç”Ÿï¼Œå½¢æˆä¸åŒçš„å…±æŒ¯å³°æ¨¡å¼ï¼Œè¿™æ˜¯åŒºåˆ†å…ƒéŸ³çš„å…³é”®ã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹4: Phase Vocoderå›é¡¾ ==========
            pv_review: [
                () => {
                    return {
                        type: 'single',
                        question: 'Phase Vocoderå˜é€Ÿçš„æ ¸å¿ƒåŸç†æ˜¯ï¼š',
                        options: [
                            'ä»¥åˆ†æå¸§ç§»Raåˆ†å¸§ï¼Œä»¥åˆæˆå¸§ç§»Rsé‡å»º',
                            'ç›´æ¥å¯¹æ—¶åŸŸä¿¡å·æ’å€¼',
                            'æ”¹å˜é‡‡æ ·ç‡',
                            'ä¿®æ”¹FFTç‚¹æ•°'
                        ],
                        correct: 0,
                        explanation: 'Phase Vocoderé€šè¿‡ä¸åŒçš„åˆ†æå¸§ç§»Raå’Œåˆæˆå¸§ç§»Rså®ç°å˜é€Ÿï¼ŒÎ± = Rs/Ra ä¸ºæ‹‰ä¼¸å› å­ã€‚'
                    };
                },
                
                () => {
                    const alpha = randChoice([0.5, 0.8, 1.2, 1.5, 2.0]);
                    const effect = alpha > 1 ? 'å‡é€Ÿï¼ˆå˜æ…¢ï¼‰' : (alpha < 1 ? 'åŠ é€Ÿï¼ˆå˜å¿«ï¼‰' : 'ä¸å˜');
                    return {
                        type: 'single',
                        question: `å½“æ‹‰ä¼¸å› å­ Î± = ${alpha} æ—¶ï¼ŒéŸ³é¢‘ä¼šï¼š`,
                        options: [
                            effect,
                            alpha > 1 ? 'åŠ é€Ÿï¼ˆå˜å¿«ï¼‰' : 'å‡é€Ÿï¼ˆå˜æ…¢ï¼‰',
                            'éŸ³è°ƒå‡é«˜',
                            'éŸ³è°ƒé™ä½'
                        ],
                        correct: 0,
                        explanation: `Î± = Rs/Raã€‚Î± > 1 è¡¨ç¤ºåˆæˆå¸§ç§»å¤§äºåˆ†æå¸§ç§»ï¼Œä¿¡å·è¢«æ‹‰ä¼¸ï¼ˆå‡é€Ÿï¼‰ï¼›Î± < 1 åˆ™å‹ç¼©ï¼ˆåŠ é€Ÿï¼‰ã€‚Î± = ${alpha} ${alpha > 1 ? '> 1ï¼Œå‡é€Ÿ' : '< 1ï¼ŒåŠ é€Ÿ'}ã€‚`
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'Phase Vocoderä¸­ä¸ºä»€ä¹ˆéœ€è¦è¿›è¡Œç›¸ä½ä¿®æ­£ï¼Ÿ',
                        options: [
                            'ä¿è¯é¢‘ç‡è¿ç»­æ€§ï¼Œé¿å…ç›¸ä½ä¸è¿ç»­å¯¼è‡´çš„ä¼ªå½±',
                            'å¢åŠ è®¡ç®—é€Ÿåº¦',
                            'å‡å°‘å†…å­˜å ç”¨',
                            'æé«˜é‡‡æ ·ç‡'
                        ],
                        correct: 0,
                        explanation: 'æ”¹å˜å¸§ç§»åï¼Œç›¸é‚»å¸§çš„ç›¸ä½å…³ç³»ä¼šè¢«ç ´åã€‚ç›¸ä½ä¿®æ­£ç¡®ä¿é‡å»ºä¿¡å·çš„é¢‘ç‡è¿ç»­æ€§ï¼Œé¿å…å¬è§‰ä¼ªå½±ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'Phase Vocoderçš„åŸºæœ¬å¤„ç†æµç¨‹æ˜¯ï¼š',
                        options: [
                            'åˆ†å¸§åŠ çª— â†’ FFT â†’ ä¿®æ”¹å¸§ç§»/ç›¸ä½ â†’ IFFT â†’ OLAé‡å»º',
                            'FFT â†’ åˆ†å¸§ â†’ ä¿®æ”¹ç›¸ä½ â†’ é‡å»º',
                            'ç›´æ¥æ’å€¼ â†’ FFT â†’ IFFT',
                            'é‡‡æ ·ç‡è½¬æ¢ â†’ æ»¤æ³¢ â†’ è¾“å‡º'
                        ],
                        correct: 0,
                        explanation: 'PVæµç¨‹ï¼šè¾“å…¥ä¿¡å·åˆ†å¸§åŠ çª— â†’ æ¯å¸§FFT â†’ ä¿®æ”¹å¸§ç§»å¹¶ä¿®æ­£ç›¸ä½ â†’ IFFT â†’ é‡å ç›¸åŠ (OLA)é‡å»ºã€‚'
                    };
                },
                
                () => {
                    const Ra = randChoice([128, 256, 512]);
                    const alpha = randChoice([0.5, 1.5, 2.0]);
                    const Rs = Ra * alpha;
                    return {
                        type: 'single',
                        question: `è‹¥åˆ†æå¸§ç§» Ra = ${Ra}ï¼Œæ‹‰ä¼¸å› å­ Î± = ${alpha}ï¼Œåˆ™åˆæˆå¸§ç§» Rs = ï¼Ÿ`,
                        options: [
                            `${Rs}`,
                            `${Ra / alpha}`,
                            `${Ra}`,
                            `${Ra + alpha}`
                        ],
                        correct: 0,
                        explanation: `Rs = Ra Ã— Î± = ${Ra} Ã— ${alpha} = ${Rs}ã€‚`
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹5: å˜è°ƒæ–¹æ³•ä¸€ ==========
            method1: [
                () => {
                    return {
                        type: 'single',
                        question: 'å˜è°ƒæ–¹æ³•ä¸€çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š',
                        options: [
                            'å…ˆç”¨PVå˜é€Ÿï¼ˆæ—¶é—´ä¼¸ç¼©ï¼‰ï¼Œå†é‡é‡‡æ ·æ¢å¤åŸé•¿åº¦',
                            'ç›´æ¥ä¿®æ”¹é¢‘è°±çš„é¢‘ç‡åˆ†é‡',
                            'æ”¹å˜é‡‡æ ·ç‡',
                            'ä½¿ç”¨æ»¤æ³¢å™¨'
                        ],
                        correct: 0,
                        explanation: 'æ–¹æ³•ä¸€ï¼šPVæ—¶é—´ä¼¸ç¼©æ”¹å˜ä¿¡å·é•¿åº¦ â†’ é‡é‡‡æ ·ï¼ˆæ’å€¼ï¼‰æ¢å¤åŸé•¿åº¦ã€‚é•¿åº¦æ¢å¤åï¼Œé¢‘ç‡éšä¹‹æ”¹å˜ï¼Œå®ç°å˜è°ƒã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'ä½¿ç”¨æ–¹æ³•ä¸€å‡é«˜éŸ³è°ƒçš„æ­¥éª¤æ˜¯ï¼š',
                        options: [
                            'PVæ‹‰ä¼¸ä¿¡å·ï¼ˆÎ± > 1ï¼‰â†’ ä¸‹é‡‡æ ·åˆ°åŸé•¿åº¦ â†’ é¢‘ç‡å‡é«˜',
                            'PVå‹ç¼©ä¿¡å·ï¼ˆÎ± < 1ï¼‰â†’ ä¸Šé‡‡æ ·åˆ°åŸé•¿åº¦ â†’ é¢‘ç‡å‡é«˜',
                            'ç›´æ¥å¢åŠ é‡‡æ ·ç‡',
                            'å¢åŠ FFTç‚¹æ•°'
                        ],
                        correct: 0,
                        explanation: 'å‡è°ƒï¼šå…ˆæ‹‰ä¼¸ä¿¡å·ï¼ˆå˜é•¿ï¼‰ï¼Œå†ä¸‹é‡‡æ ·åˆ°åŸé•¿åº¦ã€‚ä¸‹é‡‡æ ·ç›¸å½“äºåŠ å¿«æ’­æ”¾ï¼Œé¢‘ç‡å‡é«˜ï¼ŒéŸ³è°ƒä¸Šå‡ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'ä½¿ç”¨æ–¹æ³•ä¸€é™ä½éŸ³è°ƒçš„æ­¥éª¤æ˜¯ï¼š',
                        options: [
                            'PVå‹ç¼©ä¿¡å·ï¼ˆÎ± < 1ï¼‰â†’ ä¸Šé‡‡æ ·åˆ°åŸé•¿åº¦ â†’ é¢‘ç‡é™ä½',
                            'PVæ‹‰ä¼¸ä¿¡å·ï¼ˆÎ± > 1ï¼‰â†’ ä¸‹é‡‡æ ·åˆ°åŸé•¿åº¦ â†’ é¢‘ç‡é™ä½',
                            'ç›´æ¥é™ä½é‡‡æ ·ç‡',
                            'å‡å°‘FFTç‚¹æ•°'
                        ],
                        correct: 0,
                        explanation: 'é™è°ƒï¼šå…ˆå‹ç¼©ä¿¡å·ï¼ˆå˜çŸ­ï¼‰ï¼Œå†ä¸Šé‡‡æ ·åˆ°åŸé•¿åº¦ã€‚ä¸Šé‡‡æ ·ç›¸å½“äºæ”¾æ…¢æ’­æ”¾ï¼Œé¢‘ç‡é™ä½ï¼ŒéŸ³è°ƒä¸‹é™ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'æ–¹æ³•ä¸€ä¸­ï¼ŒISTFTé‡å»ºæ—¶ä½¿ç”¨çš„å¸§ç§»æ˜¯ï¼š',
                        options: [
                            'æ–°å¸§ç§» Rsï¼ˆ= Ra Ã— Î±ï¼‰',
                            'åŸå¸§ç§» Ra',
                            'å¸§é•¿ Lwin',
                            'FFTç‚¹æ•° N'
                        ],
                        correct: 0,
                        explanation: 'æ–¹æ³•ä¸€ä½¿ç”¨PVå˜é€Ÿç®—æ³•ï¼Œé‡å»ºæ—¶ä½¿ç”¨æ–°å¸§ç§» Rs = Ra Ã— Î±ï¼Œå®ç°æ—¶é—´ä¼¸ç¼©ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­ï¼šæ–¹æ³•ä¸€å¯ä»¥ç›´æ¥å¤ç”¨Project 2ä¸­çš„Phase Vocoderå˜é€Ÿä»£ç ã€‚',
                        correct: true,
                        explanation: 'æ­£ç¡®ã€‚æ–¹æ³•ä¸€çš„å˜é€Ÿéƒ¨åˆ†ä¸Project 2å®Œå…¨ç›¸åŒï¼Œåªæ˜¯åœ¨å˜é€Ÿåå¢åŠ äº†é‡é‡‡æ ·ï¼ˆæ’å€¼ï¼‰æ­¥éª¤æ¥æ¢å¤åŸé•¿åº¦ã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹6: å˜è°ƒæ–¹æ³•äºŒ ==========
            method2: [
                () => {
                    return {
                        type: 'single',
                        question: 'å˜è°ƒæ–¹æ³•äºŒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š',
                        options: [
                            'å¯¹é¢‘è°±å¸§è¿›è¡ŒæŠ½å–æˆ–å¤åˆ¶ï¼Œæ”¹å˜å¸§æ•°åä»¥åŸå¸§ç§»é‡å»º',
                            'æ”¹å˜åˆ†æå’Œåˆæˆå¸§ç§»',
                            'ç›´æ¥ä¿®æ”¹é‡‡æ ·ç‡',
                            'ä½¿ç”¨ä¸åŒçš„çª—å‡½æ•°'
                        ],
                        correct: 0,
                        explanation: 'æ–¹æ³•äºŒï¼šé€šè¿‡æŠ½å–ï¼ˆå‡å°‘å¸§ï¼‰æˆ–å¤åˆ¶ï¼ˆå¢åŠ å¸§ï¼‰é¢‘è°±å¸§ï¼Œæ”¹å˜å¸§æ•°åä»¥åŸå¸§ç§»Raé‡å»ºï¼Œå†æ’å€¼æ¢å¤åŸé•¿åº¦ã€‚'
                    };
                },
                
                () => {
                    const alpha = 0.5;
                    return {
                        type: 'single',
                        question: `æ–¹æ³•äºŒä¸­ï¼Œå½“ Î± = ${alpha} æ—¶ï¼Œå¯¹é¢‘è°±å¸§çš„æ“ä½œæ˜¯ï¼š`,
                        options: [
                            'æŠ½å–ï¼ˆæ¯2å¸§ä¿ç•™1å¸§ï¼Œå¸§æ•°å‡åŠï¼‰',
                            'å¤åˆ¶ï¼ˆæ¯å¸§å¤åˆ¶ä¸€æ¬¡ï¼Œå¸§æ•°åŠ å€ï¼‰',
                            'ä¸å˜',
                            'å…¨éƒ¨åˆ é™¤'
                        ],
                        correct: 0,
                        explanation: `Î± < 1 è¡¨ç¤ºé™è°ƒï¼Œéœ€è¦å‡å°‘å¸§æ•°ã€‚Î± = ${alpha} æ„å‘³ç€å¸§æ•°å˜ä¸ºåŸæ¥çš„ä¸€åŠï¼Œå³æ¯2å¸§ä¿ç•™1å¸§ã€‚`
                    };
                },
                
                () => {
                    const alpha = 2.0;
                    return {
                        type: 'single',
                        question: `æ–¹æ³•äºŒä¸­ï¼Œå½“ Î± = ${alpha} æ—¶ï¼Œå¯¹é¢‘è°±å¸§çš„æ“ä½œæ˜¯ï¼š`,
                        options: [
                            'å¤åˆ¶/æ’å€¼ï¼ˆå¸§æ•°åŠ å€ï¼‰',
                            'æŠ½å–ï¼ˆå¸§æ•°å‡åŠï¼‰',
                            'ä¸å˜',
                            'å…¨éƒ¨åˆ é™¤'
                        ],
                        correct: 0,
                        explanation: `Î± > 1 è¡¨ç¤ºå‡è°ƒï¼Œéœ€è¦å¢åŠ å¸§æ•°ã€‚Î± = ${alpha} æ„å‘³ç€å¸§æ•°å˜ä¸ºåŸæ¥çš„ä¸¤å€ï¼Œé€šè¿‡å¤åˆ¶æˆ–æ’å€¼å®ç°ã€‚`
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'æ–¹æ³•äºŒä¸­ï¼ŒISTFTé‡å»ºæ—¶ä½¿ç”¨çš„å¸§ç§»æ˜¯ï¼š',
                        options: [
                            'åŸå¸§ç§» Ra',
                            'æ–°å¸§ç§» Rs',
                            'å¸§é•¿ Lwin',
                            'FFTç‚¹æ•° N'
                        ],
                        correct: 0,
                        explanation: 'æ–¹æ³•äºŒçš„å…³é”®åŒºåˆ«ï¼šé‡å»ºæ—¶ä½¿ç”¨åŸå¸§ç§»Raï¼ˆè€Œéæ–¹æ³•ä¸€çš„Rsï¼‰ã€‚é€šè¿‡æ”¹å˜å¸§æ•°è€Œéå¸§ç§»æ¥å®ç°ä¿¡å·é•¿åº¦å˜åŒ–ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'multiple',
                        question: 'æ–¹æ³•äºŒçš„å®Œæ•´æµç¨‹åŒ…æ‹¬å“ªäº›æ­¥éª¤ï¼Ÿï¼ˆå¤šé€‰ï¼‰',
                        options: [
                            'åˆ†å¸§åŠ çª— + FFTè®¡ç®—é¢‘è°±',
                            'é¢‘è°±å¸§æŠ½å–æˆ–å¤åˆ¶',
                            'IFFT + OLAä»¥åŸå¸§ç§»Raé‡å»º',
                            'æ’å€¼æ¢å¤åŸå§‹é•¿åº¦'
                        ],
                        correct: [0, 1, 2, 3],
                        explanation: 'æ–¹æ³•äºŒå®Œæ•´æµç¨‹ï¼šåˆ†å¸§åŠ çª—â†’FFTâ†’å¸§æŠ½å–/å¤åˆ¶â†’IFFT+OLA(ç”¨Ra)â†’æ’å€¼æ¢å¤åŸé•¿ã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹7: é¢‘è°±å¹…åº¦ä¿®æ­£ ==========
            envelope_correction: [
                () => {
                    return {
                        type: 'single',
                        question: 'é¢‘è°±å¹…åº¦ä¿®æ­£çš„ç›®çš„æ˜¯ï¼š',
                        options: [
                            'ä¿æŒåŸå§‹å…±æŒ¯å³°ä½ç½®ï¼Œé¿å…"å°é»„äºº"æ•ˆåº”',
                            'å¢åŠ éŸ³é‡',
                            'å‡å°‘å™ªå£°',
                            'åŠ å¿«å¤„ç†é€Ÿåº¦'
                        ],
                        correct: 0,
                        explanation: 'å˜è°ƒä¼šåŒæ—¶æ”¹å˜åŸºé¢‘å’Œå…±æŒ¯å³°ã€‚é¢‘è°±ä¿®æ­£ä¿æŒåŸå§‹å…±æŒ¯å³°åŒ…ç»œï¼Œåªæ”¹å˜åŸºé¢‘ï¼Œé¿å…éŸ³è‰²å¤±çœŸã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'é¢‘è°±ä¿®æ­£ç®—æ³•ä¸­ï¼Œ"æ®‹å·®"æ˜¯å¦‚ä½•è®¡ç®—çš„ï¼Ÿ',
                        options: [
                            'é¢‘è°± Ã· åŒ…ç»œ',
                            'é¢‘è°± Ã— åŒ…ç»œ',
                            'é¢‘è°± - åŒ…ç»œ',
                            'é¢‘è°± + åŒ…ç»œ'
                        ],
                        correct: 0,
                        explanation: 'æ®‹å·® = åŸå§‹é¢‘è°± / åŒ…ç»œã€‚è¿™æ ·å¯ä»¥æ¶ˆé™¤å…±æŒ¯å³°çš„å½±å“ï¼Œå¾—åˆ°"çº¯å‡€"çš„è°æ³¢ç»“æ„ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'é¢‘è°±ä¿®æ­£çš„æœ€ç»ˆè¾“å‡ºå¦‚ä½•å¾—åˆ°ï¼Ÿ',
                        options: [
                            'æ®‹å·® Ã— é‡æ„åçš„åŒ…ç»œ',
                            'æ®‹å·® + åŸå§‹åŒ…ç»œ',
                            'æ®‹å·® - æ–°åŒ…ç»œ',
                            'æ®‹å·® Ã· æ–°åŒ…ç»œ'
                        ],
                        correct: 0,
                        explanation: 'è¾“å‡º = æ®‹å·® Ã— é‡æ„åŒ…ç»œã€‚æ®‹å·®ä¿ç•™äº†è°æ³¢ç»“æ„ï¼Œä¹˜ä»¥ä¿®æ­£åçš„åŒ…ç»œå¾—åˆ°"åŸºé¢‘å˜åŒ–ä½†å…±æŒ¯å³°ä¸å˜"çš„æ•ˆæœã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'multiple',
                        question: 'ä»¥ä¸‹å“ªäº›æ˜¯å¸¸ç”¨çš„åŒ…ç»œæå–æ–¹æ³•ï¼Ÿï¼ˆå¤šé€‰ï¼‰',
                        options: [
                            'LPCï¼ˆçº¿æ€§é¢„æµ‹ç¼–ç ï¼‰',
                            'å€’è°±æ³•ï¼ˆCepstrumï¼‰',
                            'FFT',
                            'ç›´æ¥å–å¹…åº¦å³°å€¼æ’å€¼'
                        ],
                        correct: [0, 1, 3],
                        explanation: 'LPCå’Œå€’è°±æ³•æ˜¯ç»å…¸çš„åŒ…ç»œæå–æ–¹æ³•ï¼Œç›´æ¥å¯¹å¹…åº¦è°±å³°å€¼æ’å€¼ä¹Ÿæ˜¯ä¸€ç§ç®€å•æ–¹æ³•ã€‚FFTæœ¬èº«ä¸æ˜¯åŒ…ç»œæå–æ–¹æ³•ã€‚'
                    };
                },
                
                () => {
                    return {
                        type: 'single',
                        question: 'é¢‘è°±ä¿®æ­£ç®—æ³•çš„æ­£ç¡®æ­¥éª¤é¡ºåºæ˜¯ï¼š',
                        options: [
                            'æ±‚åŒ…ç»œ â†’ è®¡ç®—æ®‹å·® â†’ é‡æ„åŒ…ç»œ â†’ æ®‹å·®Ã—æ–°åŒ…ç»œ',
                            'è®¡ç®—æ®‹å·® â†’ æ±‚åŒ…ç»œ â†’ åˆæˆ â†’ é‡æ„',
                            'é‡æ„åŒ…ç»œ â†’ æ±‚æ®‹å·® â†’ åˆæˆ',
                            'FFT â†’ IFFT â†’ ä¿®æ­£'
                        ],
                        correct: 0,
                        explanation: 'æ­¥éª¤ï¼š1)å¯¹åŸé¢‘è°±æ±‚åŒ…ç»œ 2)æ®‹å·®=é¢‘è°±/åŒ…ç»œ 3)æ ¹æ®Î±é‡æ„åŒ…ç»œ 4)è¾“å‡º=æ®‹å·®Ã—æ–°åŒ…ç»œã€‚'
                    };
                }
            ]
        };

        // ==================== æ ¸å¿ƒé€»è¾‘ ====================

        function startQuiz() {
            const id = document.getElementById('studentId').value.trim();
            const name = document.getElementById('studentName').value.trim();
            
            if (!/^\d{10}$/.test(id)) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„10ä½å­¦å·ï¼');
                return;
            }
            if (!name) {
                alert('è¯·è¾“å…¥å§“åï¼');
                return;
            }
            
            studentData.id = id;
            studentData.name = name;
            
            topics.forEach(topic => {
                studentData.topicStats[topic.id] = {
                    attempts: 0,
                    correct: false,
                    questions: []
                };
                studentData.usedQuestions[topic.id] = [];
            });
            
            document.querySelector('.login-section').classList.remove('active');
            document.querySelector('.quiz-section').classList.add('active');
            
            loadQuestion();
        }

        function loadQuestion() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const generators = questionGenerators[topicId];
            
            // æ›´æ–°è¿›åº¦
            const progress = ((studentData.currentTopicIndex) / topics.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressFill').textContent = `${studentData.currentTopicIndex}/${topics.length}`;
            
            document.getElementById('topicInfo').innerHTML = 
                `ğŸ“š çŸ¥è¯†ç‚¹ ${studentData.currentTopicIndex + 1}/${topics.length}: <span style="color: #e74c3c;">${currentTopic.name}</span>`;
            
            // ç”Ÿæˆæ–°é¢˜ç›®
            let questionIndex;
            const usedList = studentData.usedQuestions[topicId];
            
            if (usedList.length >= generators.length) {
                studentData.usedQuestions[topicId] = [];
            }
            
            do {
                questionIndex = randInt(0, generators.length - 1);
            } while (studentData.usedQuestions[topicId].includes(questionIndex) && 
                     studentData.usedQuestions[topicId].length < generators.length);
            
            studentData.usedQuestions[topicId].push(questionIndex);
            
            const question = generators[questionIndex]();
            studentData.currentQuestion = question;
            
            document.getElementById('questionTitle').textContent = question.question;
            
            let contentHTML = '';
            
            if (question.type === 'single') {
                const shuffled = shuffleOptionsWithAnswer(question.options, question.correct);
                question.shuffledOptions = shuffled.options;
                question.shuffledCorrect = shuffled.correct;
                
                contentHTML = '<div class="options">';
                shuffled.options.forEach((opt, i) => {
                    contentHTML += `<div class="option" data-index="${i}" onclick="selectOption(this)">${String.fromCharCode(65+i)}. ${opt}</div>`;
                });
                contentHTML += '</div>';
            } else if (question.type === 'multiple') {
                const shuffled = shuffleOptionsWithAnswers(question.options, question.correct);
                question.shuffledOptions = shuffled.options;
                question.shuffledCorrect = shuffled.correct;
                
                contentHTML = '<p class="multiple-hint">âš ï¸ æœ¬é¢˜ä¸ºå¤šé€‰é¢˜ï¼Œè¯·é€‰æ‹©æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆ</p>';
                contentHTML += '<div class="options">';
                shuffled.options.forEach((opt, i) => {
                    contentHTML += `<div class="option" data-index="${i}" onclick="toggleOption(this)">${String.fromCharCode(65+i)}. ${opt}</div>`;
                });
                contentHTML += '</div>';
            } else if (question.type === 'tf') {
                contentHTML = `
                    <div class="tf-options">
                        <div class="tf-option" data-value="true" onclick="selectTF(this)">âœ“ æ­£ç¡®</div>
                        <div class="tf-option" data-value="false" onclick="selectTF(this)">âœ— é”™è¯¯</div>
                    </div>
                `;
            }
            
            document.getElementById('questionContent').innerHTML = contentHTML;
            document.getElementById('feedbackArea').innerHTML = '';
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            
            if (typeof MathJax !== 'undefined') {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }

        function selectOption(el) {
            document.querySelectorAll('.options .option').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
        }

        function toggleOption(el) {
            el.classList.toggle('selected');
        }

        function selectTF(el) {
            document.querySelectorAll('.tf-option').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
        }

        function submitAnswer() {
            const question = studentData.currentQuestion;
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            
            let userAnswer, isCorrect;
            
            if (question.type === 'single') {
                const selected = document.querySelector('.options .option.selected');
                if (!selected) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼');
                    return;
                }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = (userAnswer === question.shuffledCorrect);
                
                document.querySelectorAll('.options .option').forEach((opt, i) => {
                    if (i === question.shuffledCorrect) {
                        opt.classList.add('correct');
                    } else if (i === userAnswer && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                });
            } else if (question.type === 'multiple') {
                const selected = document.querySelectorAll('.options .option.selected');
                if (selected.length === 0) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼');
                    return;
                }
                userAnswer = Array.from(selected).map(el => parseInt(el.dataset.index)).sort((a,b) => a-b);
                isCorrect = JSON.stringify(userAnswer) === JSON.stringify(question.shuffledCorrect);
                
                document.querySelectorAll('.options .option').forEach((opt, i) => {
                    if (question.shuffledCorrect.includes(i)) {
                        opt.classList.add('correct');
                    } else if (userAnswer.includes(i)) {
                        opt.classList.add('incorrect');
                    }
                });
            } else if (question.type === 'tf') {
                const selected = document.querySelector('.tf-option.selected');
                if (!selected) {
                    alert('è¯·é€‰æ‹©æ­£ç¡®æˆ–é”™è¯¯ï¼');
                    return;
                }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = (userAnswer === question.correct);
                
                document.querySelectorAll('.tf-option').forEach(opt => {
                    const val = opt.dataset.value === 'true';
                    if (val === question.correct) {
                        opt.classList.add('correct');
                        opt.style.background = '#48bb78';
                        opt.style.color = 'white';
                    } else if (val === userAnswer && !isCorrect) {
                        opt.classList.add('incorrect');
                        opt.style.background = '#f56565';
                        opt.style.color = 'white';
                    }
                });
            }
            
            stats.attempts++;
            stats.questions.push({
                question: question.question,
                userAnswer: userAnswer,
                isCorrect: isCorrect
            });
            
            const feedbackDiv = document.getElementById('feedbackArea');
            
            if (isCorrect) {
                stats.correct = true;
                feedbackDiv.innerHTML = 
                    `<div class="feedback correct">
                        âœ… å›ç­”æ­£ç¡®ï¼<br>
                        <small>${question.explanation}</small>
                    </div>`;
                document.getElementById('submitBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').textContent = 
                    studentData.currentTopicIndex < topics.length - 1 ? 'ä¸‹ä¸€çŸ¥è¯†ç‚¹' : 'æŸ¥çœ‹ç»“æœ';
            } else {
                feedbackDiv.innerHTML = 
                    `<div class="feedback incorrect">
                        âŒ å›ç­”é”™è¯¯ï¼Œè¯·å†è¯•ä¸€æ¬¡ï¼<br>
                        <small>${question.explanation}</small>
                    </div>`;
                document.getElementById('submitBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').textContent = 'ç»§ç»­ç­”é¢˜';
            }
            
            if (typeof MathJax !== 'undefined') {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }

        function nextQuestion() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            const lastQuestion = stats.questions[stats.questions.length - 1];
            
            if (lastQuestion.isCorrect) {
                studentData.currentTopicIndex++;
                
                if (studentData.currentTopicIndex >= topics.length) {
                    showResults();
                } else {
                    loadQuestion();
                }
            } else {
                loadQuestion();
            }
        }

        function showResults() {
            document.querySelector('.quiz-section').classList.remove('active');
            document.querySelector('.result-section').classList.add('active');
            
            let reportHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #e74c3c;">ğŸ‰ ${studentData.name} åŒå­¦ï¼ˆå­¦å·ï¼š${studentData.id}ï¼‰</h2>
                    <p style="color: #666; font-size: 1.1em;">æ‚¨å·²å®ŒæˆDSP-Proj3éŸ³é¢‘å˜è°ƒå®éªŒç»ƒä¹ æµ‹éªŒï¼</p>
                </div>
                
                <table class="stats-table">
                    <tr>
                        <th>çŸ¥è¯†ç‚¹</th>
                        <th>ç­”é¢˜æ¬¡æ•°</th>
                        <th>é¦–æ¬¡æ­£ç¡®ç‡</th>
                        <th>æŒæ¡ç¨‹åº¦</th>
                    </tr>
            `;
            
            let excellentTopics = [];
            let goodTopics = [];
            let fairTopics = [];
            let poorTopics = [];
            
            topics.forEach(topic => {
                const stats = studentData.topicStats[topic.id];
                const accuracy = ((1 / stats.attempts) * 100).toFixed(0);
                
                let mastery, masteryClass;
                if (stats.attempts === 1) {
                    mastery = 'ä¼˜ç§€ â­â­â­â­';
                    masteryClass = 'mastery-excellent';
                    excellentTopics.push(topic.name);
                } else if (stats.attempts === 2) {
                    mastery = 'è‰¯å¥½ â­â­â­';
                    masteryClass = 'mastery-good';
                    goodTopics.push(topic.name);
                } else if (stats.attempts <= 4) {
                    mastery = 'ä¸€èˆ¬ â­â­';
                    masteryClass = 'mastery-fair';
                    fairTopics.push(topic.name);
                } else {
                    mastery = 'éœ€åŠ å¼º â­';
                    masteryClass = 'mastery-poor';
                    poorTopics.push(topic.name);
                }
                
                reportHTML += `
                    <tr>
                        <td><strong>${topic.name}</strong></td>
                        <td>${stats.attempts}æ¬¡</td>
                        <td>${accuracy}%</td>
                        <td class="${masteryClass}">${mastery}</td>
                    </tr>
                `;
            });
            
            reportHTML += '</table>';
            
            reportHTML += '<div style="margin-top: 30px;">';
            reportHTML += '<h3 style="color: #e74c3c;">ğŸ“Š çŸ¥è¯†æŒæ¡åˆ†æ</h3>';
            
            if (excellentTopics.length > 0) {
                reportHTML += `
                    <div style="background: #e8f5e9; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #48bb78;">
                        <strong style="color: #48bb78;">âœ… æŒæ¡ä¼˜ç§€çš„çŸ¥è¯†ç‚¹ï¼š</strong><br>
                        ${excellentTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (goodTopics.length > 0) {
                reportHTML += `
                    <div style="background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #667eea;">
                        <strong style="color: #667eea;">ğŸ‘ æŒæ¡è‰¯å¥½çš„çŸ¥è¯†ç‚¹ï¼š</strong><br>
                        ${goodTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (fairTopics.length > 0) {
                reportHTML += `
                    <div style="background: #fff8e1; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #ed8936;">
                        <strong style="color: #ed8936;">âš ï¸ éœ€è¦å·©å›ºçš„çŸ¥è¯†ç‚¹ï¼š</strong><br>
                        ${fairTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (poorTopics.length > 0) {
                reportHTML += `
                    <div style="background: #ffebee; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #f56565;">
                        <strong style="color: #f56565;">âŒ éœ€è¦é‡ç‚¹åŠ å¼ºçš„çŸ¥è¯†ç‚¹ï¼š</strong><br>
                        ${poorTopics.join('ã€')}
                    </div>
                `;
            }
            
            reportHTML += `
                <div style="background: #fff5f5; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 5px solid #e74c3c;">
                    <h4 style="color: #e74c3c; margin-top: 0;">ğŸ’¡ å¤ä¹ å»ºè®®</h4>
                    <ul style="line-height: 2; color: #555;">
                        <li>é‡ç‚¹å¤ä¹ æ ‡è®°ä¸º"éœ€åŠ å¼º"çš„çŸ¥è¯†ç‚¹ï¼Œç»“åˆå®éªŒæ‰‹å†Œè¯¦ç»†å­¦ä¹ </li>
                        <li>ç†è§£åŸºé¢‘ï¼ˆéŸ³é«˜ï¼‰ä¸å…±æŒ¯å³°ï¼ˆéŸ³è‰²ï¼‰çš„åŒºåˆ«æ˜¯å…³é”®</li>
                        <li>æŒæ¡æ–¹æ³•ä¸€ä¸æ–¹æ³•äºŒçš„æ ¸å¿ƒåŒºåˆ«ï¼šé‡å»ºæ—¶çš„å¸§ç§»ä¸åŒï¼ˆRs vs Raï¼‰</li>
                        <li>ç†è§£"å°é»„äºº"æ•ˆåº”çš„æˆå› ï¼šå…±æŒ¯å³°è¶…å‡ºäººç±»æ­£å¸¸èŒƒå›´</li>
                        <li>åŠ¨æ‰‹å®è·µMATLABä»£ç ï¼Œç†è§£é¢‘è°±ä¿®æ­£çš„åŒ…ç»œæå–å’Œæ®‹å·®è®¡ç®—</li>
                    </ul>
                </div>
            `;
            
            reportHTML += '</div>';
            
            document.getElementById('finalReport').innerHTML = reportHTML;
        }

        function saveScreenshot() {
            const button = document.getElementById('saveBtn');
            button.disabled = true;
            button.textContent = 'æ­£åœ¨ç”Ÿæˆæˆªå›¾...';
            
            html2canvas(document.body, {
                backgroundColor: '#ffffff',
                scale: 2,
                logging: false
            }).then(canvas => {
                canvas.toBlob(blob => {
                    const cleanId = studentData.id.replace(/[^a-zA-Z0-9_\u4e00-\u9fa5-]/g, '_');
                    const cleanName = studentData.name.replace(/[^a-zA-Z0-9_\u4e00-\u9fa5-]/g, '_');
                    const filename = `${cleanId}_${cleanName}_Proj3Quiz.png`;
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    button.disabled = false;
                    button.textContent = 'æˆªå›¾å·²ä¿å­˜';
                    setTimeout(() => {
                        button.textContent = 'å†æ¬¡æˆªå›¾';
                    }, 2000);
                }, 'image/png');
            }).catch(error => {
                console.error('æˆªå›¾å¤±è´¥:', error);
                alert('æˆªå›¾å¤±è´¥ï¼Œè¯·å°è¯•ä½¿ç”¨æµè§ˆå™¨æˆªå›¾åŠŸèƒ½');
                button.disabled = false;
                button.textContent = 'æˆªå›¾ä¿å­˜';
            });
        }
    </script>
    
    <script>
        (function() {
            const statusDiv = document.getElementById('mathjaxStatus');
            const primaryCDN = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
            const backupCDN = 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML';

            function loadScript(src, onload, onerror) {
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                script.onload = onload;
                script.onerror = onerror;
                document.head.appendChild(script);
            }

            function onMathJaxLoad() {
                console.log('MathJax loaded successfully.');
                statusDiv.textContent = 'âœ“ æ•°å­¦å…¬å¼åŠ è½½æˆåŠŸ';
                statusDiv.className = 'mathjax-status success';
            }

            loadScript(primaryCDN, onMathJaxLoad, function() {
                console.warn('Primary MathJax CDN failed. Trying backup...');
                statusDiv.textContent = 'ä¸»CDNåŠ è½½å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨...';
                loadScript(backupCDN, onMathJaxLoad, function() {
                    console.error('Backup MathJax CDN also failed.');
                    statusDiv.textContent = 'âŒ å…¬å¼åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ';
                    statusDiv.className = 'mathjax-status';
                });
            });
        })();
    </script>
</body>
</html>
