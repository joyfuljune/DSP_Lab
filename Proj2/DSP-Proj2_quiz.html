<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSP-Proj2 ç»ƒä¹ æµ‹éªŒ - éŸ³é¢‘å˜é€Ÿå®éªŒ</title>
    
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [['$','$'], ['\\(','\\)']],
                displayMath: [['$$','$$'], ['\\[','\\]']],
                processEscapes: true
            }
        });
    </script>

    <style>
        .mathjax-status {
            position: fixed;
            top: 10px;
            right: 15px;
            padding: 8px 15px;
            border-radius: 5px;
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            font-size: 14px;
            z-index: 10000;
            font-family: 'Microsoft YaHei', sans-serif;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .mathjax-status.loading {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }
        .mathjax-status.success {
            background-color: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
            transition: opacity 0.5s ease-out 1.5s;
            opacity: 0;
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimSun', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.25);
            padding: 40px;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }

        h2 {
            color: #667eea;
            margin: 25px 0 15px 0;
        }

        .login-section, .quiz-section, .result-section {
            display: none;
        }

        .login-section.active, .quiz-section.active, .result-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 8px;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #9f7aea;
            border-radius: 8px;
            font-size: 16px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
        }

        button:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #667eea 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.5);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .question-box {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 25px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .question-title {
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .options {
            margin: 15px 0;
        }

        .option {
            display: block;
            background: white;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .option:hover {
            background: #f0f4ff;
            border-color: #667eea;
        }

        .option.selected {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        .option.correct {
            background: #48bb78;
            color: white;
            border-color: #38a169;
        }

        .option.incorrect {
            background: #f56565;
            color: white;
            border-color: #e53e3e;
        }

        .feedback {
            margin: 15px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #48bb78;
            border-left: 5px solid #48bb78;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #f56565;
            border-left: 5px solid #f56565;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #667eea 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .stats-table th, .stats-table td {
            padding: 12px;
            text-align: left;
            border: 1px solid #e0e0e0;
        }

        .stats-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stats-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .mastery-excellent {
            color: #48bb78;
            font-weight: bold;
        }

        .mastery-good {
            color: #667eea;
            font-weight: bold;
        }

        .mastery-fair {
            color: #ed8936;
            font-weight: bold;
        }

        .mastery-poor {
            color: #f56565;
            font-weight: bold;
        }

        .info-box {
            background: #fff8e1;
            border-left: 5px solid #ed8936;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-option:hover {
            background: #f0f4ff;
            border-color: #667eea;
        }

        .checkbox-option.correct {
            background: #48bb78;
            color: white;
            border-color: #38a169;
        }

        .checkbox-option.incorrect {
            background: #f56565;
            color: white;
            border-color: #e53e3e;
        }

        .tf-options {
            display: flex;
            gap: 20px;
            margin: 15px 0;
        }

        .tf-option {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tf-option:hover {
            background: #f0f4ff;
            border-color: #667eea;
        }

        .tf-option.selected {
            background: #667eea;
            color: white;
            border-color: #5a67d8;
        }

        .tf-option.correct {
            background: #48bb78;
            color: white;
        }

        .tf-option.incorrect {
            background: #f56565;
            color: white;
        }
    </style>
</head>
<body>
    <div id="mathjaxStatus" class="mathjax-status loading">æ­£åœ¨åŠ è½½æ•°å­¦å…¬å¼...</div>
    
    <div class="container">
        <!-- ç™»å½•ç•Œé¢ -->
        <div class="login-section active">
            <h1>ğŸµ DSP-Proj2 ç»ƒä¹ æµ‹éªŒ</h1>
            <h2 style="text-align: center; color: #764ba2; font-size: 1.2em;">éŸ³é¢‘å˜é€Ÿå®éªŒ - åŸºäºç›¸ä½å£°ç å™¨çš„æ—¶é—´æ‹‰ä¼¸</h2>
            <div class="info-box">
                <strong>ğŸ“Œ æµ‹éªŒè¯´æ˜</strong>
                <p>æœ¬ç³»ç»Ÿå°†æµ‹è¯•æ‚¨å¯¹ã€ŠéŸ³é¢‘å˜é€Ÿå®éªŒã€‹çš„æŒæ¡ç¨‹åº¦ã€‚æ¯ä¸ªçŸ¥è¯†ç‚¹å°†éšæœºå‡ºé¢˜,ç­”å¯¹åè¿›å…¥ä¸‹ä¸€çŸ¥è¯†ç‚¹,ç­”é”™å°†ç»§ç»­è¯¥çŸ¥è¯†ç‚¹çš„å…¶ä»–é¢˜ç›®ã€‚æ¶µç›–<strong>8å¤§æ ¸å¿ƒçŸ¥è¯†ç‚¹</strong>,å…±<strong>60+é“éšæœºé¢˜ç›®</strong>ã€‚</p>
                <p style="margin-top: 10px;"><strong>é¢˜å‹åŒ…æ‹¬:</strong> å•é€‰é¢˜ã€å¤šé€‰é¢˜ã€åˆ¤æ–­é¢˜</p>
            </div>
            
            <div class="form-group">
                <label>å­¦å·:</label>
                <input type="text" id="studentId" placeholder="è¯·è¾“å…¥å­¦å·">
            </div>
            
            <div class="form-group">
                <label>å§“å:</label>
                <input type="text" id="studentName" placeholder="è¯·è¾“å…¥å§“å">
            </div>
            
            <button id="startQuizBtn">å¼€å§‹æµ‹éªŒ</button>
        </div>

        <!-- æµ‹éªŒç•Œé¢ -->
        <div class="quiz-section">
            <h1>ğŸµ DSP-Proj2 ç»ƒä¹ æµ‹éªŒ</h1>
            <div id="studentInfo"></div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar">0%</div>
            </div>
            
            <div id="currentTopic"></div>
            
            <div class="question-box">
                <div class="question-title" id="questionTitle"></div>
                <div id="questionContent"></div>
                <div id="options" class="options"></div>
                <div id="feedback"></div>
                <button id="submitBtn">æäº¤ç­”æ¡ˆ</button>
                <button id="nextBtn" style="display:none;">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <!-- ç»“æœç•Œé¢ -->
        <div class="result-section">
            <h1>ğŸ“Š æµ‹éªŒç»“æœæŠ¥å‘Š</h1>
            <div id="finalReport"></div>
            <button id="saveBtn">æˆªå›¾ä¿å­˜</button>
        </div>
    </div>

    <script>
        // ==================== æ•°æ®ç»“æ„ ====================
        let studentData = {
            id: '',
            name: '',
            topicStats: {},
            currentTopicIndex: 0,
            currentQuestionIndex: 0,
            usedQuestions: {}
        };

        // çŸ¥è¯†ç‚¹å®šä¹‰
        const topics = [
            {
                name: 'å‚…é‡Œå¶å˜æ¢åŸºç¡€',
                id: 'fft_basics',
                description: 'DFT/FFTæ¦‚å¿µã€æ—¶é¢‘å¯¹å¶å…³ç³»'
            },
            {
                name: 'STFTçŸ­æ—¶å‚…é‡Œå¶å˜æ¢',
                id: 'stft',
                description: 'åˆ†å¸§+åŠ çª—+FFTçš„ç»„åˆå¤„ç†'
            },
            {
                name: 'æ—¶åŸŸæ’å€¼çš„é™·é˜±',
                id: 'time_interpolation',
                description: 'ä¸ºä»€ä¹ˆç®€å•æ’å€¼ä¼šæ”¹å˜éŸ³é«˜'
            },
            {
                name: 'é¢‘åŸŸæ’å€¼æ³•',
                id: 'freq_interpolation',
                description: 'åœ¨é¢‘åŸŸä¿æŒéŸ³é«˜çš„æ—¶é—´æ‹‰ä¼¸æ–¹æ³•'
            },
            {
                name: 'ç›¸ä½å£°ç å™¨åŸç†',
                id: 'phase_vocoder',
                description: 'Phase Vocoderçš„æ ¸å¿ƒæ€æƒ³å’Œå…¬å¼'
            },
            {
                name: 'åˆ†å¸§ä¸å¸§ç§»',
                id: 'framing',
                description: 'é‡å åˆ†å¸§ã€å¸§ç§»Ra/Rsçš„æ¦‚å¿µ'
            },
            {
                name: 'åŠ çª—å¤„ç†',
                id: 'windowing',
                description: 'Hann/Hammingçª—ã€é¢‘è°±æ³„éœ²'
            },
            {
                name: 'é‡å ç›¸åŠ é‡å»º(OLA)',
                id: 'ola',
                description: 'IFFTåçš„ä¿¡å·é‡å»ºæ–¹æ³•'
            }
        ];

        // ==================== å·¥å…·å‡½æ•° ====================
        
        function randInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function randChoice(arr) {
            return arr[randInt(0, arr.length - 1)];
        }

        function randFloat(min, max, decimals = 2) {
            return (Math.random() * (max - min) + min).toFixed(decimals);
        }

        // å•é€‰é¢˜é€‰é¡¹æ‰“ä¹±å‡½æ•°
        function shuffleOptionsWithAnswer(options, correctIndex) {
            const indices = options.map((_, i) => i);
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            return {
                options: indices.map(i => options[i]),
                correct: indices.indexOf(correctIndex)
            };
        }

        // å¤šé€‰é¢˜é€‰é¡¹æ‰“ä¹±å‡½æ•°
        function shuffleOptionsWithAnswers(options, correctIndices) {
            const indices = options.map((_, i) => i);
            for (let i = indices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [indices[i], indices[j]] = [indices[j], indices[i]];
            }
            return {
                options: indices.map(i => options[i]),
                correct: correctIndices.map(ci => indices.indexOf(ci)).sort((a, b) => a - b)
            };
        }

        // ==================== é¢˜ç›®ç”Ÿæˆå‡½æ•° ====================
        
        const questionGenerators = {
            // ========== çŸ¥è¯†ç‚¹1: å‚…é‡Œå¶å˜æ¢åŸºç¡€ ==========
            fft_basics: [
                // FFTé¢˜ç›®1: æ—¶é¢‘å¯¹å¶
                () => {
                    return {
                        type: 'single',
                        question: 'æ ¹æ®æ—¶é¢‘å¯¹å¶å…³ç³»,å¦‚æœæ—¶åŸŸä¿¡å·è¢«æ‹‰ä¼¸2å€,å…¶é¢‘è°±ä¼š:',
                        options: [
                            'é¢‘ç‡å‹ç¼©ä¸ºåŸæ¥çš„1/2',
                            'é¢‘ç‡æ‹‰ä¼¸ä¸ºåŸæ¥çš„2å€',
                            'é¢‘ç‡ä¸å˜',
                            'é¢‘ç‡å˜ä¸º0'
                        ],
                        correct: 0,
                        explanation: 'æ—¶é¢‘å¯¹å¶å…³ç³»: æ—¶é—´é•¿åº¦ Ã— é¢‘ç‡ = å¸¸æ•°ã€‚æ—¶åŸŸæ‹‰ä¼¸2å€ â†’ é¢‘åŸŸå‹ç¼©1/2 â†’ éŸ³é«˜é™ä½ã€‚'
                    };
                },
                
                // FFTé¢˜ç›®2: FFTç‚¹æ•°
                () => {
                    const N = randChoice([256, 512, 1024, 2048]);
                    return {
                        type: 'single',
                        question: `å¯¹é•¿åº¦ä¸º${N}çš„ä¿¡å·è¿›è¡ŒFFT,å¾—åˆ°çš„é¢‘è°±ç‚¹æ•°ä¸º:`,
                        options: [
                            `${N}ç‚¹`,
                            `${N/2}ç‚¹`,
                            `${N*2}ç‚¹`,
                            `${Math.log2(N)}ç‚¹`
                        ],
                        correct: 0,
                        explanation: `FFTå˜æ¢åçš„é¢‘è°±ç‚¹æ•°ä¸è¾“å…¥ä¿¡å·é•¿åº¦ç›¸åŒ,éƒ½æ˜¯${N}ç‚¹ã€‚ä½†ç”±äºå…±è½­å¯¹ç§°æ€§,å®ä¿¡å·åªæœ‰å‰N/2ç‚¹åŒ…å«ç‹¬ç«‹ä¿¡æ¯ã€‚`
                    };
                },
                
                // FFTé¢˜ç›®3: é¢‘ç‡åˆ†è¾¨ç‡
                () => {
                    const fs = randChoice([8000, 16000, 44100]);
                    const N = randChoice([512, 1024]);
                    const resolution = (fs / N).toFixed(2);
                    return {
                        type: 'single',
                        question: `é‡‡æ ·ç‡${fs}Hz,FFTç‚¹æ•°${N},é¢‘ç‡åˆ†è¾¨ç‡ä¸º:`,
                        options: [
                            `${resolution} Hz`,
                            `${(fs * N).toFixed(0)} Hz`,
                            `${fs} Hz`,
                            `${N} Hz`
                        ],
                        correct: 0,
                        explanation: `é¢‘ç‡åˆ†è¾¨ç‡ = é‡‡æ ·ç‡/FFTç‚¹æ•° = ${fs}/${N} = ${resolution} Hz`
                    };
                },
                
                // FFTé¢˜ç›®4: å¤æ•°é¢‘è°±
                () => {
                    return {
                        type: 'single',
                        question: 'FFTçš„ç»“æœæ˜¯å¤æ•°,å…¶ä¸­åŒ…å«äº†ä¿¡å·çš„å“ªäº›ä¿¡æ¯?',
                        options: [
                            'å¹…åº¦(æ¨¡)å’Œç›¸ä½(è¾è§’)',
                            'åªæœ‰å¹…åº¦',
                            'åªæœ‰ç›¸ä½',
                            'åªæœ‰å®éƒ¨'
                        ],
                        correct: 0,
                        explanation: 'å¤æ•°é¢‘è°± $X[k] = |X[k]|e^{j\\angle X[k]}$,å…¶ä¸­ $|X[k]|$ æ˜¯å¹…åº¦,$\\angle X[k]$ æ˜¯ç›¸ä½ã€‚'
                    };
                },
                
                // FFTé¢˜ç›®5: IFFTä½œç”¨
                () => {
                    return {
                        type: 'single',
                        question: 'IFFT(é€†å‚…é‡Œå¶å˜æ¢)çš„ä½œç”¨æ˜¯:',
                        options: [
                            'å°†é¢‘åŸŸä¿¡å·è½¬æ¢å›æ—¶åŸŸä¿¡å·',
                            'å°†æ—¶åŸŸä¿¡å·è½¬æ¢ä¸ºé¢‘åŸŸä¿¡å·',
                            'è®¡ç®—ä¿¡å·çš„èƒ½é‡',
                            'å¯¹ä¿¡å·è¿›è¡Œæ»¤æ³¢'
                        ],
                        correct: 0,
                        explanation: 'IFFTæ˜¯FFTçš„é€†è¿ç®—,å°†é¢‘åŸŸè¡¨ç¤ºè½¬æ¢å›æ—¶åŸŸè¡¨ç¤º,ç”¨äºä¿¡å·é‡å»ºã€‚'
                    };
                },
                
                // FFTé¢˜ç›®6: åˆ¤æ–­é¢˜
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­: å¯¹äºå®ä¿¡å·,FFTç»“æœå…·æœ‰å…±è½­å¯¹ç§°æ€§,å³ $X[N-k] = X[k]^*$ã€‚',
                        correct: true,
                        explanation: 'å®ä¿¡å·çš„FFTå…·æœ‰å…±è½­å¯¹ç§°æ€§,è¿™æ„å‘³ç€åªæœ‰ä¸€åŠçš„é¢‘è°±ç‚¹åŒ…å«ç‹¬ç«‹ä¿¡æ¯ã€‚'
                    };
                },
                
                // FFTé¢˜ç›®7: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: 'å…³äºFFT,ä»¥ä¸‹æ­£ç¡®çš„æ˜¯:(å¤šé€‰)',
                        options: [
                            'FFTæ˜¯DFTçš„å¿«é€Ÿç®—æ³•,è®¡ç®—å¤æ‚åº¦ä¸ºO(NlogN)',
                            'FFTç‚¹æ•°é€šå¸¸é€‰æ‹©2çš„å¹‚æ¬¡æ–¹',
                            'FFTå¯ä»¥å°†æ—¶åŸŸä¿¡å·åˆ†è§£ä¸ºä¸åŒé¢‘ç‡çš„æ­£å¼¦åˆ†é‡',
                            'FFTåªèƒ½ç”¨äºå‘¨æœŸä¿¡å·'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'FFTæ˜¯é«˜æ•ˆçš„DFTç®—æ³•,é€šå¸¸é€‰æ‹©2^nç‚¹ä»¥è·å¾—æœ€ä½³æ•ˆç‡ã€‚FFTå¯ç”¨äºä»»ä½•æœ‰é™é•¿ä¿¡å·çš„é¢‘è°±åˆ†æã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹2: STFTçŸ­æ—¶å‚…é‡Œå¶å˜æ¢ ==========
            stft: [
                // STFTé¢˜ç›®1: ä¸ºä»€ä¹ˆéœ€è¦STFT
                () => {
                    return {
                        type: 'single',
                        question: 'ä¸ºä»€ä¹ˆéŸ³é¢‘å¤„ç†éœ€è¦ä½¿ç”¨STFTè€Œä¸æ˜¯ç›´æ¥å¯¹æ•´ä¸ªä¿¡å·åšFFT?',
                        options: [
                            'éŸ³é¢‘æ˜¯éå¹³ç¨³ä¿¡å·,STFTèƒ½åˆ†ææ—¶å˜çš„é¢‘è°±ç‰¹æ€§',
                            'ç›´æ¥FFTè®¡ç®—é‡å¤ªå°',
                            'STFTç»“æœæ›´ç²¾ç¡®',
                            'ç›´æ¥FFTæ— æ³•å¾—åˆ°é¢‘è°±'
                        ],
                        correct: 0,
                        explanation: 'éŸ³é¢‘ä¿¡å·æ˜¯éå¹³ç¨³çš„,ä¸åŒæ—¶åˆ»é¢‘ç‡æˆåˆ†ä¸åŒã€‚STFTé€šè¿‡åˆ†å¸§,è®©æˆ‘ä»¬èƒ½çœ‹åˆ°æ—¶é—´-é¢‘ç‡çš„äºŒç»´åˆ†å¸ƒã€‚'
                    };
                },
                
                // STFTé¢˜ç›®2: STFTæ­¥éª¤
                () => {
                    return {
                        type: 'single',
                        question: 'STFTçš„æ­£ç¡®å¤„ç†æ­¥éª¤æ˜¯:',
                        options: [
                            'åˆ†å¸§ â†’ åŠ çª— â†’ FFT',
                            'FFT â†’ åˆ†å¸§ â†’ åŠ çª—',
                            'åŠ çª— â†’ FFT â†’ åˆ†å¸§',
                            'åˆ†å¸§ â†’ FFT â†’ åŠ çª—'
                        ],
                        correct: 0,
                        explanation: 'STFTæ­£ç¡®æµç¨‹: 1)å°†é•¿ä¿¡å·åˆ†å¸§ 2)å¯¹æ¯å¸§åŠ çª—å‡å°‘æ³„éœ² 3)å¯¹æ¯å¸§FFTå¾—åˆ°é¢‘è°±ã€‚'
                    };
                },
                
                // STFTé¢˜ç›®3: é¢‘è°±çŸ©é˜µ
                () => {
                    const N = randChoice([512, 1024]);
                    const M = randInt(50, 100);
                    return {
                        type: 'single',
                        question: `å¸§é•¿${N},å…±${M}å¸§,STFTå¾—åˆ°çš„é¢‘è°±çŸ©é˜µå¤§å°ä¸º:`,
                        options: [
                            `${N} Ã— ${M}`,
                            `${M} Ã— ${N}`,
                            `${N} Ã— ${N}`,
                            `${M} Ã— ${M}`
                        ],
                        correct: 0,
                        explanation: `é¢‘è°±çŸ©é˜µå¤§å°ä¸º [å¸§é•¿ Ã— å¸§æ•°] = [${N} Ã— ${M}],æ¯åˆ—æ˜¯ä¸€å¸§çš„é¢‘è°±ã€‚`
                    };
                },
                
                // STFTé¢˜ç›®4: å¤æ•°è¡¨ç¤º
                () => {
                    return {
                        type: 'single',
                        question: 'STFTé¢‘è°±çš„æ•°å­¦è¡¨ç¤º $X[n,k] = A[n,k]e^{j\\varphi[n,k]}$ ä¸­,$A[n,k]$ å’Œ $\\varphi[n,k]$ åˆ†åˆ«è¡¨ç¤º:',
                        options: [
                            'ç¬¬nå¸§ç¬¬ké¢‘ç‡çš„å¹…åº¦å’Œç›¸ä½',
                            'ç¬¬kå¸§ç¬¬né¢‘ç‡çš„å¹…åº¦å’Œç›¸ä½',
                            'æ—¶é—´å’Œé¢‘ç‡',
                            'å®éƒ¨å’Œè™šéƒ¨'
                        ],
                        correct: 0,
                        explanation: '$A[n,k]$ æ˜¯å¹…åº¦(ç»å¯¹å€¼),$\\varphi[n,k]$ æ˜¯ç›¸ä½(è¾è§’),næ˜¯å¸§ç´¢å¼•,kæ˜¯é¢‘ç‡ç´¢å¼•ã€‚'
                    };
                },
                
                // STFTé¢˜ç›®5: åˆ¤æ–­é¢˜
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­: STFTçš„ç»“æœæ˜¯ä¸€ä¸ªä¸‰ç»´æ•°æ®(æ—¶é—´ã€é¢‘ç‡ã€å¹…åº¦)ã€‚',
                        correct: false,
                        explanation: 'STFTç»“æœæ˜¯äºŒç»´å¤æ•°çŸ©é˜µ[å¸§æ•°Ã—é¢‘ç‡ç‚¹],ä½†æ¯ä¸ªå…ƒç´ æ˜¯å¤æ•°,åŒ…å«å¹…åº¦å’Œç›¸ä½ä¸¤ä¸ªä¿¡æ¯ã€‚'
                    };
                },
                
                // STFTé¢˜ç›®6: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: 'STFTåœ¨éŸ³é¢‘å˜é€Ÿä¸­çš„ä½œç”¨åŒ…æ‹¬:(å¤šé€‰)',
                        options: [
                            'è·å–æ¯å¸§çš„é¢‘è°±å¹…åº¦å’Œç›¸ä½',
                            'ä¸ºé¢‘åŸŸæ’å€¼æˆ–ç›¸ä½å£°ç å™¨æä¾›è¾“å…¥',
                            'å®ç°æ—¶é—´-é¢‘ç‡äºŒç»´åˆ†æ',
                            'ç›´æ¥æ”¹å˜éŸ³é¢‘æ—¶é•¿'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'STFTæä¾›æ—¶é¢‘åˆ†æ,æ˜¯é¢‘åŸŸå¤„ç†çš„åŸºç¡€ã€‚éŸ³é¢‘å˜é€Ÿéœ€è¦ä¿®æ”¹STFTç»“æœåå†é‡å»ºã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹3: æ—¶åŸŸæ’å€¼çš„é™·é˜± ==========
            time_interpolation: [
                // æ—¶åŸŸæ’å€¼é¢˜ç›®1: å¤±è´¥åŸå› 
                () => {
                    return {
                        type: 'single',
                        question: 'å¯¹éŸ³é¢‘ä¿¡å·ç›´æ¥è¿›è¡Œ2å€æ—¶åŸŸæ’å€¼(å¦‚æœ€é‚»è¿‘æ’å€¼),ä¼šå¯¼è‡´:',
                        options: [
                            'æ—¶é•¿å˜ä¸º2å€,ä½†éŸ³é«˜é™ä½(é¢‘ç‡å‡åŠ)',
                            'æ—¶é•¿å˜ä¸º2å€,éŸ³é«˜ä¸å˜',
                            'æ—¶é•¿ä¸å˜,éŸ³é«˜å‡é«˜',
                            'æ—¶é•¿å‡åŠ,éŸ³é«˜ä¸å˜'
                        ],
                        correct: 0,
                        explanation: 'æ—¶åŸŸæ‹‰ä¼¸2å€ â†’ ç›¸åŒæ•°é‡çš„å‘¨æœŸåˆ†å¸ƒåœ¨æ›´é•¿æ—¶é—´ â†’ é¢‘ç‡å˜ä¸º1/2 â†’ éŸ³é«˜é™ä½!'
                    };
                },
                
                // æ—¶åŸŸæ’å€¼é¢˜ç›®2: æ•°å­¦å…³ç³»
                () => {
                    const factor = randChoice([2, 3, 4]);
                    return {
                        type: 'single',
                        question: `å°†æ­£å¼¦ä¿¡å· $\\sin(\\omega t)$ è¿›è¡Œ${factor}å€æ—¶åŸŸæ’å€¼å,é¢‘ç‡å˜ä¸º:`,
                        options: [
                            `$\\omega / ${factor}$`,
                            `$\\omega \\times ${factor}$`,
                            `$\\omega$`,
                            `$\\omega^2$`
                        ],
                        correct: 0,
                        explanation: `æ—¶åŸŸæ‹‰ä¼¸${factor}å€,é¢‘ç‡å‹ç¼©${factor}å€,å˜ä¸º $\\omega/${factor}$ã€‚è¿™å°±æ˜¯ç®€å•æ’å€¼æ”¹å˜éŸ³é«˜çš„åŸå› ã€‚`
                    };
                },
                
                // æ—¶åŸŸæ’å€¼é¢˜ç›®3: æ—¶é¢‘åæ¯”
                () => {
                    return {
                        type: 'single',
                        question: 'æ—¶é¢‘åæ¯”å…³ç³»å¯ä»¥è¡¨ç¤ºä¸º:',
                        options: [
                            'æ—¶é—´é•¿åº¦ Ã— é¢‘ç‡ = å¸¸æ•°',
                            'æ—¶é—´é•¿åº¦ + é¢‘ç‡ = å¸¸æ•°',
                            'æ—¶é—´é•¿åº¦ / é¢‘ç‡ = å¸¸æ•°',
                            'æ—¶é—´é•¿åº¦ = é¢‘ç‡'
                        ],
                        correct: 0,
                        explanation: 'è¿™æ˜¯å‚…é‡Œå¶å˜æ¢çš„åŸºæœ¬æ€§è´¨: $t \\times f = const$,æ—¶åŸŸæ‹‰ä¼¸å¿…ç„¶å¯¼è‡´é¢‘åŸŸå‹ç¼©ã€‚'
                    };
                },
                
                // æ—¶åŸŸæ’å€¼é¢˜ç›®4: åˆ¤æ–­é¢˜
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­: é€šè¿‡ç®€å•çš„æ—¶åŸŸæ’å€¼å¯ä»¥å®ç°éŸ³é¢‘å˜é€Ÿè€Œä¿æŒéŸ³é«˜ä¸å˜ã€‚',
                        correct: false,
                        explanation: 'é”™è¯¯!ç®€å•æ—¶åŸŸæ’å€¼ä¼šæ”¹å˜é¢‘ç‡,å¯¼è‡´éŸ³é«˜å˜åŒ–ã€‚éœ€è¦ä½¿ç”¨é¢‘åŸŸæ’å€¼æˆ–ç›¸ä½å£°ç å™¨ã€‚'
                    };
                },
                
                // æ—¶åŸŸæ’å€¼é¢˜ç›®5: åº”ç”¨åœºæ™¯
                () => {
                    return {
                        type: 'single',
                        question: 'è§†é¢‘æ’­æ”¾å™¨çš„"å€é€Ÿæ’­æ”¾"åŠŸèƒ½,å¦‚æœç›´æ¥æ”¹å˜é‡‡æ ·ç‚¹æ•°ä¼šå¯¼è‡´:',
                        options: [
                            'è¯­éŸ³å˜è°ƒ(åŠ é€Ÿæ—¶å£°éŸ³å˜å°–,å‡é€Ÿæ—¶å£°éŸ³å˜ä½æ²‰)',
                            'è¯­éŸ³ä¿æŒåŸæ¥çš„éŸ³è‰²',
                            'åªæ”¹å˜éŸ³é‡',
                            'ä¸ä¼šæœ‰ä»»ä½•å½±å“'
                        ],
                        correct: 0,
                        explanation: 'ç›´æ¥æ”¹å˜æ—¶é•¿ä¼šæ”¹å˜é¢‘ç‡:åŠ é€Ÿæ—¶é¢‘ç‡å‡é«˜(å£°éŸ³å°–),å‡é€Ÿæ—¶é¢‘ç‡é™ä½(å£°éŸ³ä½æ²‰)ã€‚'
                    };
                },
                
                // æ—¶åŸŸæ’å€¼é¢˜ç›®6: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: 'å…³äºæ—¶åŸŸæ’å€¼æ³•çš„é—®é¢˜,æ­£ç¡®çš„æ˜¯:(å¤šé€‰)',
                        options: [
                            'ä¼šæ”¹å˜ä¿¡å·çš„é¢‘ç‡æˆåˆ†',
                            'æ—¶åŸŸæ‹‰ä¼¸å¯¼è‡´é¢‘ç‡é™ä½',
                            'æ—¶åŸŸå‹ç¼©å¯¼è‡´é¢‘ç‡å‡é«˜',
                            'å¯ä»¥å®Œç¾ä¿æŒéŸ³é«˜ä¸å˜'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'æ—¶åŸŸæ’å€¼çš„è‡´å‘½é—®é¢˜æ˜¯æ”¹å˜é¢‘ç‡:æ‹‰ä¼¸â†’é¢‘ç‡é™ä½,å‹ç¼©â†’é¢‘ç‡å‡é«˜,æ— æ³•ä¿æŒéŸ³é«˜ã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹4: é¢‘åŸŸæ’å€¼æ³• ==========
            freq_interpolation: [
                // é¢‘åŸŸæ’å€¼é¢˜ç›®1: åŸºæœ¬åŸç†
                () => {
                    return {
                        type: 'single',
                        question: 'é¢‘åŸŸæ’å€¼æ³•å®ç°éŸ³é¢‘å˜é€Ÿçš„æ ¸å¿ƒæ€æƒ³æ˜¯:',
                        options: [
                            'å¯¹é¢‘è°±è¿›è¡Œæ’å€¼,æ”¹å˜å¸§æ•°,é¢‘ç‡æˆåˆ†ä¿æŒä¸å˜',
                            'å¯¹æ—¶åŸŸä¿¡å·ç›´æ¥æ’å€¼',
                            'ä¸¢å¼ƒéƒ¨åˆ†é¢‘ç‡æˆåˆ†',
                            'å¢åŠ é‡‡æ ·ç‡'
                        ],
                        correct: 0,
                        explanation: 'é¢‘åŸŸæ’å€¼åœ¨é¢‘è°±ä¸Šæ“ä½œ,é€šè¿‡æ”¹å˜å¸§æ•°å®ç°æ—¶é•¿å˜åŒ–,è€Œæ¯å¸§çš„é¢‘ç‡æˆåˆ†ä¿æŒä¸å˜ã€‚'
                    };
                },
                
                // é¢‘åŸŸæ’å€¼é¢˜ç›®2: æ­¥éª¤
                () => {
                    return {
                        type: 'single',
                        question: 'é¢‘åŸŸæ’å€¼æ³•çš„æ­£ç¡®æ­¥éª¤æ˜¯:',
                        options: [
                            'STFT â†’ å¯¹é¢‘è°±çŸ©é˜µæ’å€¼ â†’ IFFT â†’ é‡å ç›¸åŠ ',
                            'æ—¶åŸŸæ’å€¼ â†’ FFT â†’ IFFT',
                            'FFT â†’ æ—¶åŸŸæ’å€¼ â†’ IFFT',
                            'ç›´æ¥å¯¹éŸ³é¢‘æ³¢å½¢æ’å€¼'
                        ],
                        correct: 0,
                        explanation: 'é¢‘åŸŸæ’å€¼: å…ˆSTFTå¾—åˆ°é¢‘è°± â†’ åœ¨é¢‘åŸŸå¯¹å¸§è¿›è¡Œæ’å€¼ â†’ IFFTå›æ—¶åŸŸ â†’ OLAé‡å»ºã€‚'
                    };
                },
                
                // é¢‘åŸŸæ’å€¼é¢˜ç›®3: å¸§æ•°å˜åŒ–
                () => {
                    const M = randInt(50, 100);
                    const factor = randChoice([1.5, 2, 2.5]);
                    const newM = Math.floor(M * factor);
                    return {
                        type: 'single',
                        question: `åŸå§‹${M}å¸§,æ‹‰ä¼¸å› å­ä¸º${factor},é¢‘åŸŸæ’å€¼åå¸§æ•°ä¸º:`,
                        options: [
                            `${newM}å¸§`,
                            `${M}å¸§`,
                            `${Math.floor(M / factor)}å¸§`,
                            `${M * M}å¸§`
                        ],
                        correct: 0,
                        explanation: `æ–°å¸§æ•° = åŸå¸§æ•° Ã— æ‹‰ä¼¸å› å­ = ${M} Ã— ${factor} = ${newM}å¸§(å–æ•´)ã€‚`
                    };
                },
                
                // é¢‘åŸŸæ’å€¼é¢˜ç›®4: MATLABå®ç°
                () => {
                    return {
                        type: 'single',
                        question: 'åœ¨MATLABä¸­,å¯¹é¢‘è°±è¿›è¡Œçº¿æ€§æ’å€¼å¯ä»¥ä½¿ç”¨:',
                        options: [
                            'interp1å‡½æ•°',
                            'fftå‡½æ•°',
                            'ifftå‡½æ•°',
                            'convå‡½æ•°'
                        ],
                        correct: 0,
                        explanation: 'interp1æ˜¯MATLABçš„ä¸€ç»´æ’å€¼å‡½æ•°,å¯ä»¥å°†Mä¸ªç‚¹æ’å€¼åˆ°newMä¸ªç‚¹ã€‚'
                    };
                },
                
                // é¢‘åŸŸæ’å€¼é¢˜ç›®5: ä¼˜ç¼ºç‚¹
                () => {
                    return {
                        type: 'single',
                        question: 'é¢‘åŸŸæ’å€¼æ³•ç›¸æ¯”ç›¸ä½å£°ç å™¨çš„ç‰¹ç‚¹æ˜¯:',
                        options: [
                            'å®ç°ç®€å•,ä½†å¯èƒ½å¯¼è‡´å¸§é—´ç›¸ä½ä¸è¿ç»­',
                            'å®ç°å¤æ‚,ä½†éŸ³è´¨æ›´å¥½',
                            'ä¸èƒ½æ”¹å˜éŸ³é¢‘æ—¶é•¿',
                            'ä¼šæ”¹å˜éŸ³é«˜'
                        ],
                        correct: 0,
                        explanation: 'é¢‘åŸŸæ’å€¼æ³•ç®€å•(ç”¨interp1),ä½†ç›´æ¥æ’å€¼å¯èƒ½é€ æˆå¸§é—´ç›¸ä½ä¸è¿ç»­,äº§ç”Ÿæ‚éŸ³ã€‚'
                    };
                },
                
                // é¢‘åŸŸæ’å€¼é¢˜ç›®6: åˆ¤æ–­é¢˜
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­: é¢‘åŸŸæ’å€¼æ³•åœ¨é‡å»ºæ—¶åº”ä½¿ç”¨åŸå§‹å¸§ç§»Ra,è€Œä¸æ˜¯æ–°å¸§ç§»Rsã€‚',
                        correct: true,
                        explanation: 'é¢‘åŸŸæ’å€¼æ³•é€šè¿‡å¢åŠ å¸§æ•°æ¥å»¶é•¿ä¿¡å·,é‡å»ºæ—¶ä½¿ç”¨åŸå§‹å¸§ç§»Raè¿›è¡ŒOLAã€‚'
                    };
                },
                
                // é¢‘åŸŸæ’å€¼é¢˜ç›®7: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: 'é¢‘åŸŸæ’å€¼æ³•çš„ç‰¹ç‚¹åŒ…æ‹¬:(å¤šé€‰)',
                        options: [
                            'åœ¨é¢‘åŸŸå¯¹å¸§è¿›è¡Œæ’å€¼',
                            'ä¿æŒé¢‘ç‡æˆåˆ†ä¸å˜',
                            'å®ç°ç›¸å¯¹ç®€å•',
                            'å®Œå…¨é¿å…ç›¸ä½ä¸è¿ç»­'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'é¢‘åŸŸæ’å€¼ç®€å•æœ‰æ•ˆ,ä¿æŒé¢‘ç‡,ä½†å¯èƒ½æœ‰ç›¸ä½ä¸è¿ç»­é—®é¢˜,éœ€è¦ç›¸ä½å£°ç å™¨è§£å†³ã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹5: ç›¸ä½å£°ç å™¨åŸç† ==========
            phase_vocoder: [
                // ç›¸ä½å£°ç å™¨é¢˜ç›®1: æ ¸å¿ƒæ€æƒ³
                () => {
                    return {
                        type: 'single',
                        question: 'ç›¸ä½å£°ç å™¨(Phase Vocoder)çš„æ ¸å¿ƒæ€æƒ³æ˜¯:',
                        options: [
                            'ä¿æŒå¹…åº¦ä¸å˜,é€šè¿‡è°ƒæ•´ç›¸ä½å®ç°å¸§é—´è¿ç»­',
                            'ç›´æ¥ä¿®æ”¹å¹…åº¦å’Œç›¸ä½',
                            'åªä¿®æ”¹å¹…åº¦,å¿½ç•¥ç›¸ä½',
                            'å¯¹æ—¶åŸŸä¿¡å·ç›´æ¥æ“ä½œ'
                        ],
                        correct: 0,
                        explanation: 'ç›¸ä½å£°ç å™¨ä¿æŒæ¯å¸§çš„å¹…åº¦è°±ä¸å˜,é€šè¿‡é‡æ–°è®¡ç®—ç›¸ä½ä½¿å¸§é—´æ— ç¼è¡”æ¥ã€‚'
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®2: ç†è®ºç›¸ä½é€’è¿›
                () => {
                    return {
                        type: 'single',
                        question: 'å¦‚æœé¢‘ç‡ä¸º$\\Omega$,å¸§ç§»ä¸º$R_a$,ä¸¤å¸§ä¹‹é—´çš„ç†è®ºç›¸ä½é€’è¿›ä¸º:',
                        options: [
                            '$\\Omega \\cdot R_a$',
                            '$\\Omega + R_a$',
                            '$\\Omega / R_a$',
                            '$\\Omega - R_a$'
                        ],
                        correct: 0,
                        explanation: 'ç†è®ºç›¸ä½é€’è¿› = è§’é¢‘ç‡ Ã— æ—¶é—´é—´éš” = $\\Omega \\cdot R_a$(é‡‡æ ·ç‚¹ä¸ºå•ä½)ã€‚'
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®3: ç›¸ä½å±•å¼€
                () => {
                    return {
                        type: 'single',
                        question: 'ç›¸ä½å£°ç å™¨ä¸­"ç›¸ä½å±•å¼€"çš„ç›®çš„æ˜¯:',
                        options: [
                            'å°†ç›¸ä½å·®é™åˆ¶åœ¨$[-\\pi, \\pi]$èŒƒå›´å†…',
                            'å¢å¤§ç›¸ä½å€¼',
                            'æ¶ˆé™¤ç›¸ä½',
                            'è®¡ç®—é¢‘ç‡'
                        ],
                        correct: 0,
                        explanation: 'ç›¸ä½å…·æœ‰$2\\pi$å‘¨æœŸæ€§,å±•å¼€å…¬å¼ $\\Delta\\varphi_{wrapped} = mod(\\Delta\\varphi + \\pi, 2\\pi) - \\pi$ å°†ç›¸ä½å·®å½’ä¸€åŒ–ã€‚'
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®4: ç¬æ—¶é¢‘ç‡
                () => {
                    return {
                        type: 'single',
                        question: 'ç›¸ä½å£°ç å™¨ä¸­,ç¬æ—¶é¢‘ç‡$\\omega_{true}$çš„è®¡ç®—å…¬å¼æ˜¯:',
                        options: [
                            '$\\omega_{true} = \\Omega + \\Delta\\omega$,å…¶ä¸­$\\Delta\\omega$æ˜¯é¢‘ç‡åç§»',
                            '$\\omega_{true} = \\Omega \\cdot \\Delta\\omega$',
                            '$\\omega_{true} = \\Omega - \\Delta\\omega$',
                            '$\\omega_{true} = \\Omega / \\Delta\\omega$'
                        ],
                        correct: 0,
                        explanation: 'çœŸå®é¢‘ç‡ = ç†è®ºbiné¢‘ç‡ + é¢‘ç‡åç§»ã€‚åç§»æ¥è‡ªç›¸ä½å·®çš„å½’ä¸€åŒ–: $\\Delta\\omega = \\Delta\\varphi_{wrapped} / R_a$ã€‚'
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®5: ç›¸ä½ç´¯ç§¯
                () => {
                    return {
                        type: 'single',
                        question: 'ç›¸ä½å£°ç å™¨é‡å»ºæ—¶,è¾“å‡ºç›¸ä½çš„æ›´æ–°å…¬å¼æ˜¯:',
                        options: [
                            '$\\varphi_{out} = \\varphi_{out} + \\omega_{true} \\cdot R_s$',
                            '$\\varphi_{out} = \\varphi_{out} + \\omega_{true} \\cdot R_a$',
                            '$\\varphi_{out} = \\omega_{true}$',
                            '$\\varphi_{out} = \\varphi_{out} + \\Omega$'
                        ],
                        correct: 0,
                        explanation: 'å…³é”®: ä½¿ç”¨æ–°å¸§ç§»$R_s$(è€Œé$R_a$)ç´¯ç§¯ç›¸ä½,è¿™æ˜¯å®ç°æ—¶é—´æ‹‰ä¼¸çš„æ ¸å¿ƒ!'
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®6: Raå’ŒRså…³ç³»
                () => {
                    const Ra = randChoice([256, 512]);
                    const factor = randChoice([1.5, 2, 2.5]);
                    const Rs = Math.round(Ra * factor);
                    return {
                        type: 'single',
                        question: `åŸå¸§ç§»$R_a=${Ra}$,æ‹‰ä¼¸å› å­${factor},æ–°å¸§ç§»$R_s$ä¸º:`,
                        options: [
                            `${Rs}`,
                            `${Ra}`,
                            `${Math.round(Ra / factor)}`,
                            `${Ra * Ra}`
                        ],
                        correct: 0,
                        explanation: `$R_s = R_a \\times factor = ${Ra} \\times ${factor} = ${Rs}$ã€‚æ‹‰ä¼¸æ—¶$R_s > R_a$ã€‚`
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®7: ä¼˜åŠ¿
                () => {
                    return {
                        type: 'single',
                        question: 'ç›¸ä½å£°ç å™¨ç›¸æ¯”é¢‘åŸŸæ’å€¼æ³•çš„ä¸»è¦ä¼˜åŠ¿æ˜¯:',
                        options: [
                            'é¿å…å¸§é—´ç›¸ä½ä¸è¿ç»­,éŸ³è´¨æ›´å¥½',
                            'è®¡ç®—æ›´ç®€å•',
                            'ä¸éœ€è¦FFT',
                            'å¯ä»¥æ”¹å˜éŸ³é«˜'
                        ],
                        correct: 0,
                        explanation: 'ç›¸ä½å£°ç å™¨é€šè¿‡ç›¸ä½è°ƒæ•´ç¡®ä¿å¸§é—´è¿ç»­,æ¶ˆé™¤äº†é¢‘åŸŸæ’å€¼å¯èƒ½äº§ç”Ÿçš„"ç›¸ä½çˆ†ç‚¸"æ‚éŸ³ã€‚'
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®8: åˆ¤æ–­é¢˜
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­: ç›¸ä½å£°ç å™¨ä¼šä¿®æ”¹é¢‘è°±çš„å¹…åº¦å’Œç›¸ä½ã€‚',
                        correct: false,
                        explanation: 'ç›¸ä½å£°ç å™¨åªä¿®æ”¹ç›¸ä½,å¹…åº¦ä¿æŒä¸å˜!è¿™æ˜¯å®ƒçš„æ ¸å¿ƒç‰¹ç‚¹ã€‚'
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®9: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: 'ç›¸ä½å£°ç å™¨çš„å…³é”®æ­¥éª¤åŒ…æ‹¬:(å¤šé€‰)',
                        options: [
                            'è®¡ç®—ç›¸ä½å·®å¹¶å±•å¼€åˆ°$[-\\pi,\\pi]$',
                            'è®¡ç®—ç¬æ—¶é¢‘ç‡åç§»',
                            'ç”¨æ–°å¸§ç§»$R_s$ç´¯ç§¯è¾“å‡ºç›¸ä½',
                            'ä¿®æ”¹é¢‘è°±å¹…åº¦'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'ç›¸ä½å£°ç å™¨ä¸‰æ­¥: 1)ç›¸ä½å±•å¼€ 2)è®¡ç®—çœŸå®é¢‘ç‡ 3)ç”¨$R_s$ç´¯ç§¯ç›¸ä½ã€‚å¹…åº¦ä¸å˜!'
                    };
                },
                
                // ç›¸ä½å£°ç å™¨é¢˜ç›®10: è¾“å‡ºå¸§æ•°
                () => {
                    const M = randInt(50, 100);
                    return {
                        type: 'single',
                        question: `ç›¸ä½å£°ç å™¨å¤„ç†${M}å¸§è¾“å…¥,è¾“å‡ºå¸§æ•°ä¸º:`,
                        options: [
                            `${M - 1}å¸§(ç¬¬ä¸€å¸§ç”¨äºåˆå§‹åŒ–)`,
                            `${M}å¸§`,
                            `${M + 1}å¸§`,
                            `${M * 2}å¸§`
                        ],
                        correct: 0,
                        explanation: `è¾“å‡ºå¸§æ•° = è¾“å…¥å¸§æ•° - 1 = ${M - 1}å¸§,å› ä¸ºç¬¬ä¸€å¸§ç”¨äºåˆå§‹åŒ–ç›¸ä½ã€‚`
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹6: åˆ†å¸§ä¸å¸§ç§» ==========
            framing: [
                // åˆ†å¸§é¢˜ç›®1: å¸§ç§»å®šä¹‰
                () => {
                    return {
                        type: 'single',
                        question: 'å¸§ç§»(Hop Size)$R_a$çš„å®šä¹‰æ˜¯:',
                        options: [
                            'ç›¸é‚»ä¸¤å¸§èµ·å§‹ä½ç½®ä¹‹é—´çš„é‡‡æ ·ç‚¹é—´éš”',
                            'æ¯å¸§çš„é•¿åº¦',
                            'ä¿¡å·çš„æ€»é•¿åº¦',
                            'å¸§çš„æ•°é‡'
                        ],
                        correct: 0,
                        explanation: 'å¸§ç§»$R_a$æ˜¯ä¸¤å¸§èµ·å§‹ç‚¹ä¹‹é—´çš„è·ç¦»,å†³å®šäº†å¸§é—´é‡å ç¨‹åº¦ã€‚'
                    };
                },
                
                // åˆ†å¸§é¢˜ç›®2: é‡å ç‡è®¡ç®—
                () => {
                    const Lwin = randChoice([512, 1024]);
                    const Ra = Lwin / 4;
                    const overlap = ((1 - Ra / Lwin) * 100).toFixed(0);
                    return {
                        type: 'single',
                        question: `å¸§é•¿${Lwin},å¸§ç§»${Ra},å¸§é—´é‡å ç‡ä¸º:`,
                        options: [
                            `${overlap}%`,
                            `${100 - parseInt(overlap)}%`,
                            `50%`,
                            `0%`
                        ],
                        correct: 0,
                        explanation: `é‡å ç‡ = (1 - $R_a$/å¸§é•¿) Ã— 100% = (1 - ${Ra}/${Lwin}) Ã— 100% = ${overlap}%`
                    };
                },
                
                // åˆ†å¸§é¢˜ç›®3: å¸§æ•°è®¡ç®—
                () => {
                    const Lx = randInt(8000, 10000);
                    const Lwin = 1024;
                    const Ra = 256;
                    const numFrames = Math.floor((Lx - Lwin) / Ra) + 1;
                    return {
                        type: 'single',
                        question: `ä¿¡å·é•¿åº¦${Lx},å¸§é•¿${Lwin},å¸§ç§»${Ra},å¯åˆ†æˆå¤šå°‘å¸§?`,
                        options: [
                            `çº¦${numFrames}å¸§`,
                            `${Math.floor(Lx / Lwin)}å¸§`,
                            `${Lx}å¸§`,
                            `${Ra}å¸§`
                        ],
                        correct: 0,
                        explanation: `å¸§æ•° â‰ˆ (ä¿¡å·é•¿åº¦ - å¸§é•¿) / å¸§ç§» + 1 = (${Lx} - ${Lwin}) / ${Ra} + 1 â‰ˆ ${numFrames}`
                    };
                },
                
                // åˆ†å¸§é¢˜ç›®4: å¸§ç§»é€‰æ‹©
                () => {
                    return {
                        type: 'single',
                        question: 'å¸§ç§»é€šå¸¸é€‰æ‹©ä¸ºå¸§é•¿çš„å¤šå°‘?',
                        options: [
                            '25%~50%(å¦‚å¸§é•¿çš„1/4æˆ–1/2)',
                            '100%(æ— é‡å )',
                            '1%',
                            '200%'
                        ],
                        correct: 0,
                        explanation: 'é€šå¸¸é€‰æ‹©25%~50%çš„å¸§ç§»,å³75%~50%é‡å ,ä»¥è·å¾—å¹³æ»‘çš„æ—¶é¢‘åˆ†æå’Œè‰¯å¥½çš„é‡å»ºæ•ˆæœã€‚'
                    };
                },
                
                // åˆ†å¸§é¢˜ç›®5: MATLABç´¢å¼•
                () => {
                    return {
                        type: 'single',
                        question: 'åœ¨MATLABä¸­,åˆ†å¸§èµ·å§‹ä½ç½®ç´¢å¼•åºåˆ—åº”ä¸º:',
                        options: [
                            '1 : Ra : (Lx - Lwin)',
                            '0 : Ra : Lx',
                            '1 : Lwin : Lx',
                            'Ra : Ra : Lx'
                        ],
                        correct: 0,
                        explanation: 'MATLABä»1å¼€å§‹,èµ·å§‹ç´¢å¼•: 1, 1+Ra, 1+2Ra, ...,ç›´åˆ°ä¸è¶…è¿‡Lx-Lwin(é˜²æ­¢è¶Šç•Œ)ã€‚'
                    };
                },
                
                // åˆ†å¸§é¢˜ç›®6: åˆ¤æ–­é¢˜
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­: åˆ†å¸§æ—¶,å¸§ç§»è¶Šå°,æ—¶é—´åˆ†è¾¨ç‡è¶Šé«˜,ä½†è®¡ç®—é‡è¶Šå¤§ã€‚',
                        correct: true,
                        explanation: 'å¸§ç§»å°â†’å¸§æ•°å¤šâ†’æ—¶é—´åˆ†è¾¨ç‡é«˜,ä½†éœ€è¦å¤„ç†æ›´å¤šå¸§,è®¡ç®—é‡å¢åŠ ã€‚'
                    };
                },
                
                // åˆ†å¸§é¢˜ç›®7: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: 'å…³äºåˆ†å¸§å¤„ç†,æ­£ç¡®çš„æ˜¯:(å¤šé€‰)',
                        options: [
                            'å¸§é—´éœ€è¦é‡å ä»¥ä¿è¯å¹³æ»‘è¿‡æ¸¡',
                            'å¸§é•¿é€šå¸¸é€‰æ‹©2çš„å¹‚æ¬¡æ–¹ä¾¿äºFFT',
                            'å¸§ç§»å†³å®šäº†æ—¶é—´åˆ†è¾¨ç‡',
                            'å¸§ç§»å¿…é¡»ç­‰äºå¸§é•¿'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'åˆ†å¸§è¦ç‚¹: é‡å åˆ†å¸§ã€2^nå¸§é•¿ã€å¸§ç§»å½±å“åˆ†è¾¨ç‡ã€‚å¸§ç§»é€šå¸¸å°äºå¸§é•¿ã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹7: åŠ çª—å¤„ç† ==========
            windowing: [
                // åŠ çª—é¢˜ç›®1: ç›®çš„
                () => {
                    return {
                        type: 'single',
                        question: 'å¯¹æ¯å¸§ä¿¡å·åŠ çª—çš„ä¸»è¦ç›®çš„æ˜¯:',
                        options: [
                            'å‡å°‘é¢‘è°±æ³„éœ²,ä½¿å¸§è¾¹ç•Œå¹³æ»‘è¿‡æ¸¡',
                            'å¢åŠ ä¿¡å·èƒ½é‡',
                            'æ”¹å˜ä¿¡å·é¢‘ç‡',
                            'å»¶é•¿ä¿¡å·æ—¶é•¿'
                        ],
                        correct: 0,
                        explanation: 'åŠ çª—ä½¿å¸§ä¸¤ç«¯å¹³æ»‘è¿‡æ¸¡åˆ°é›¶,å‡å°‘å› æˆªæ–­é€ æˆçš„é¢‘è°±æ³„éœ²å’Œä¸è¿ç»­æ€§ã€‚'
                    };
                },
                
                // åŠ çª—é¢˜ç›®2: Hannçª—å…¬å¼
                () => {
                    return {
                        type: 'single',
                        question: 'Hannçª—(æ±‰å®çª—)çš„å…¬å¼æ˜¯:',
                        options: [
                            '$w(n) = 0.5 \\times (1 - \\cos(\\frac{2\\pi n}{N-1}))$',
                            '$w(n) = 1$',
                            '$w(n) = n$',
                            '$w(n) = \\sin(n)$'
                        ],
                        correct: 0,
                        explanation: 'Hannçª—æ˜¯å‡ä½™å¼¦çª—,ä¸¤ç«¯ä¸º0,ä¸­é—´ä¸º1,å…¬å¼ä¸º $0.5(1-\\cos(2\\pi n/(N-1)))$ã€‚'
                    };
                },
                
                // åŠ çª—é¢˜ç›®3: çª—å‡½æ•°å½¢çŠ¶
                () => {
                    return {
                        type: 'single',
                        question: 'Hannçª—å’ŒHammingçª—çš„å½¢çŠ¶ç‰¹ç‚¹æ˜¯:',
                        options: [
                            'ä¸¤ç«¯å°(æ¥è¿‘0),ä¸­é—´å¤§(æ¥è¿‘1)',
                            'ä¸¤ç«¯å¤§,ä¸­é—´å°',
                            'å…¨éƒ¨ä¸º1(çŸ©å½¢çª—)',
                            'çº¿æ€§é€’å¢'
                        ],
                        correct: 0,
                        explanation: 'è¿™ä¸¤ç§çª—éƒ½æ˜¯é’Ÿå½¢,ä¸­é—´æœ€å¤§(çº¦1),ä¸¤ç«¯æœ€å°,ä½¿å¸§è¾¹ç•Œå¹³æ»‘ã€‚'
                    };
                },
                
                // åŠ çª—é¢˜ç›®4: MATLABå®ç°
                () => {
                    const N = randChoice([512, 1024]);
                    return {
                        type: 'single',
                        question: `åœ¨MATLABä¸­ç”Ÿæˆé•¿åº¦ä¸º${N}çš„Hannçª—:`,
                        options: [
                            `hann(${N})`,
                            `hamming(${N})`,
                            `ones(${N},1)`,
                            `zeros(${N},1)`
                        ],
                        correct: 0,
                        explanation: `MATLABæä¾›hann()å‡½æ•°ç”ŸæˆHannçª—,hamming()ç”ŸæˆHammingçª—ã€‚`
                    };
                },
                
                // åŠ çª—é¢˜ç›®5: åŠ çª—æ“ä½œ
                () => {
                    return {
                        type: 'single',
                        question: 'å¯¹ä¿¡å·å¸§xè¿›è¡ŒåŠ çª—çš„æ•°å­¦æ“ä½œæ˜¯:',
                        options: [
                            'é€ç‚¹ç›¸ä¹˜: $x_{windowed} = x \\cdot w$',
                            'ç›¸åŠ : $x_{windowed} = x + w$',
                            'å·ç§¯: $x_{windowed} = x * w$',
                            'ç›¸é™¤: $x_{windowed} = x / w$'
                        ],
                        correct: 0,
                        explanation: 'åŠ çª—æ˜¯ä¿¡å·ä¸çª—å‡½æ•°çš„é€ç‚¹ä¹˜æ³•(ç‚¹ä¹˜),MATLABä¸­ç”¨ .* è¿ç®—ç¬¦ã€‚'
                    };
                },
                
                // åŠ çª—é¢˜ç›®6: é¢‘è°±æ³„éœ²
                () => {
                    return {
                        type: 'single',
                        question: 'ä¸åŠ çª—(å³ä½¿ç”¨çŸ©å½¢çª—)ä¼šå¯¼è‡´:',
                        options: [
                            'é¢‘è°±æ³„éœ²ä¸¥é‡,å‡ºç°æ—ç“£',
                            'é¢‘è°±æ›´å‡†ç¡®',
                            'ä¿¡å·èƒ½é‡å¢åŠ ',
                            'æ²¡æœ‰å½±å“'
                        ],
                        correct: 0,
                        explanation: 'çŸ©å½¢çª—çš„é¢‘è°±æ—ç“£å¾ˆå¤§,å¯¼è‡´ä¸¥é‡çš„é¢‘è°±æ³„éœ²,èƒ½é‡"æ³„éœ²"åˆ°ç›¸é‚»é¢‘ç‡ã€‚'
                    };
                },
                
                // åŠ çª—é¢˜ç›®7: åˆ¤æ–­é¢˜
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­: Hammingçª—ä¸¤ç«¯ä¸å®Œå…¨ä¸ºé›¶,ä½†éå¸¸æ¥è¿‘é›¶ã€‚',
                        correct: true,
                        explanation: 'Hammingçª—å…¬å¼ä¸º $0.54 - 0.46\\cos(...)$,ä¸¤ç«¯å€¼çº¦ä¸º0.08,ä¸æ˜¯ä¸¥æ ¼çš„0ã€‚'
                    };
                },
                
                // åŠ çª—é¢˜ç›®8: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: 'å…³äºåŠ çª—å¤„ç†,æ­£ç¡®çš„æ˜¯:(å¤šé€‰)',
                        options: [
                            'åˆ†ææ—¶ä½¿ç”¨Hannçª—å‡å°‘æ³„éœ²',
                            'åˆæˆæ—¶ä½¿ç”¨Hammingçª—ä¾¿äºé‡å»º',
                            'çª—å‡½æ•°ä¸ä¿¡å·é€ç‚¹ç›¸ä¹˜',
                            'åŠ çª—ä¼šæ”¹å˜ä¿¡å·çš„åŸºé¢‘'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'åŠ çª—ç”¨äºåˆ†æå’Œåˆæˆ,æ˜¯ç‚¹ä¹˜æ“ä½œ,ä¸æ”¹å˜ä¿¡å·çš„é¢‘ç‡æˆåˆ†,åªæ”¹å˜å…¶èƒ½é‡åˆ†å¸ƒã€‚'
                    };
                }
            ],
            
            // ========== çŸ¥è¯†ç‚¹8: é‡å ç›¸åŠ é‡å»º(OLA) ==========
            ola: [
                // OLAé¢˜ç›®1: åŸºæœ¬åŸç†
                () => {
                    return {
                        type: 'single',
                        question: 'é‡å ç›¸åŠ (Overlap-Add, OLA)çš„åŸºæœ¬æ“ä½œæ˜¯:',
                        options: [
                            'å°†å„å¸§åŠ çª—åæŒ‰å¸§ç§»é—´éš”å åŠ åˆ°è¾“å‡ºä¿¡å·',
                            'å°†å„å¸§ç›´æ¥æ‹¼æ¥',
                            'å¯¹å„å¸§å–å¹³å‡',
                            'åªä¿ç•™ç¬¬ä¸€å¸§'
                        ],
                        correct: 0,
                        explanation: 'OLA: æ¯å¸§IFFTååŠ çª—,ç„¶åæŒ‰å¸§ç§»é—´éš”å åŠ åˆ°è¾“å‡ºæ•°ç»„,é‡å éƒ¨åˆ†ç›¸åŠ ã€‚'
                    };
                },
                
                // OLAé¢˜ç›®2: è¾“å‡ºé•¿åº¦
                () => {
                    const numFrames = randInt(50, 100);
                    const Lwin = 1024;
                    const Ra = 256;
                    const outLen = (numFrames - 1) * Ra + Lwin;
                    return {
                        type: 'single',
                        question: `${numFrames}å¸§,å¸§é•¿${Lwin},å¸§ç§»${Ra},é‡å»ºä¿¡å·é•¿åº¦çº¦ä¸º:`,
                        options: [
                            `${outLen}`,
                            `${numFrames * Lwin}`,
                            `${numFrames * Ra}`,
                            `${Lwin}`
                        ],
                        correct: 0,
                        explanation: `è¾“å‡ºé•¿åº¦ = (å¸§æ•°-1) Ã— å¸§ç§» + å¸§é•¿ = (${numFrames}-1) Ã— ${Ra} + ${Lwin} = ${outLen}`
                    };
                },
                
                // OLAé¢˜ç›®3: å¸§ç§»é€‰æ‹©
                () => {
                    return {
                        type: 'single',
                        question: 'é¢‘åŸŸæ’å€¼æ³•é‡å»ºæ—¶åº”ä½¿ç”¨å“ªä¸ªå¸§ç§»?',
                        options: [
                            'åŸå§‹å¸§ç§»$R_a$',
                            'æ–°å¸§ç§»$R_s$',
                            'å¸§é•¿$L_{win}$',
                            'ä¿¡å·é•¿åº¦'
                        ],
                        correct: 0,
                        explanation: 'é¢‘åŸŸæ’å€¼æ³•é€šè¿‡å¢åŠ å¸§æ•°å®ç°å»¶é•¿,é‡å»ºæ—¶ä½¿ç”¨åŸå§‹å¸§ç§»$R_a$ã€‚'
                    };
                },
                
                // OLAé¢˜ç›®4: ç›¸ä½å£°ç å™¨å¸§ç§»
                () => {
                    return {
                        type: 'single',
                        question: 'ç›¸ä½å£°ç å™¨é‡å»ºæ—¶åº”ä½¿ç”¨å“ªä¸ªå¸§ç§»?',
                        options: [
                            'æ–°å¸§ç§»$R_s$(å˜é€Ÿåçš„å¸§ç§»)',
                            'åŸå§‹å¸§ç§»$R_a$',
                            'å¸§é•¿',
                            'å›ºå®šå€¼256'
                        ],
                        correct: 0,
                        explanation: 'ç›¸ä½å£°ç å™¨é€šè¿‡è°ƒæ•´å¸§ç§»å®ç°å˜é€Ÿ,é‡å»ºæ—¶ä½¿ç”¨æ–°å¸§ç§»$R_s = R_a \\times factor$ã€‚'
                    };
                },
                
                // OLAé¢˜ç›®5: åˆæˆçª—
                () => {
                    return {
                        type: 'single',
                        question: 'OLAé‡å»ºæ—¶é€šå¸¸ä½¿ç”¨çš„åˆæˆçª—æ˜¯:',
                        options: [
                            'Hammingçª—',
                            'çŸ©å½¢çª—',
                            'ä¸‰è§’çª—',
                            'ä¸éœ€è¦åŠ çª—'
                        ],
                        correct: 0,
                        explanation: 'åˆæˆæ—¶é€šå¸¸ä½¿ç”¨Hammingçª—,é…åˆåˆ†ææ—¶çš„Hannçª—,å¯ä»¥å®ç°è¾ƒå¥½çš„é‡å»ºæ•ˆæœã€‚'
                    };
                },
                
                // OLAé¢˜ç›®6: MATLABå®ç°
                () => {
                    return {
                        type: 'single',
                        question: 'MATLABä¸­IFFTç¡®ä¿è¾“å‡ºä¸ºå®æ•°çš„æ­£ç¡®å†™æ³•æ˜¯:',
                        options: [
                            'ifft(X, \'symmetric\')',
                            'ifft(X)',
                            'real(ifft(X))',
                            'fft(X)'
                        ],
                        correct: 0,
                        explanation: 'ifft(..., \'symmetric\')å‡è®¾è¾“å…¥æ»¡è¶³å…±è½­å¯¹ç§°æ€§,ç›´æ¥è¾“å‡ºå®æ•°,é¿å…æ•°å€¼è¯¯å·®ã€‚'
                    };
                },
                
                // OLAé¢˜ç›®7: åˆ¤æ–­é¢˜
                () => {
                    return {
                        type: 'tf',
                        question: 'åˆ¤æ–­: OLAé‡å»ºæ—¶,ç›¸é‚»å¸§çš„é‡å éƒ¨åˆ†æ˜¯ç›´æ¥ç›¸åŠ çš„ã€‚',
                        correct: true,
                        explanation: 'OLAçš„æ ¸å¿ƒå°±æ˜¯é‡å éƒ¨åˆ†ç›¸åŠ (Overlap-Add),åŠ çª—ç¡®ä¿å åŠ åå¹³æ»‘ã€‚'
                    };
                },
                
                // OLAé¢˜ç›®8: å¤šé€‰
                () => {
                    return {
                        type: 'multiple',
                        question: 'OLAé‡å»ºçš„å…³é”®æ­¥éª¤åŒ…æ‹¬:(å¤šé€‰)',
                        options: [
                            'å¯¹æ¯å¸§é¢‘è°±è¿›è¡ŒIFFT',
                            'å¯¹æ—¶åŸŸå¸§è¿›è¡ŒåŠ çª—',
                            'æŒ‰å¸§ç§»é—´éš”å åŠ åˆ°è¾“å‡ºæ•°ç»„',
                            'å¯¹è¾“å‡ºå†æ¬¡è¿›è¡ŒFFT'
                        ],
                        correct: [0, 1, 2],
                        explanation: 'OLAä¸‰æ­¥: IFFTå›æ—¶åŸŸ â†’ åŠ çª— â†’ æŒ‰å¸§ç§»å åŠ ã€‚ä¸éœ€è¦å†æ¬¡FFTã€‚'
                    };
                }
            ]
        };

        // ==================== äº‹ä»¶å¤„ç† ====================
        
        document.getElementById('startQuizBtn').addEventListener('click', function() {
            const id = document.getElementById('studentId').value.trim();
            const name = document.getElementById('studentName').value.trim();
            
            if (!id || !name) {
                alert('è¯·å¡«å†™å­¦å·å’Œå§“å!');
                return;
            }
            
            studentData.id = id;
            studentData.name = name;
            
            topics.forEach(topic => {
                studentData.topicStats[topic.id] = {
                    attempts: 0,
                    questions: []
                };
                studentData.usedQuestions[topic.id] = [];
            });
            
            document.querySelector('.login-section').classList.remove('active');
            document.querySelector('.quiz-section').classList.add('active');
            
            document.getElementById('studentInfo').innerHTML = 
                `<p style="text-align:center; color:#667eea;">å­¦å·: ${id} | å§“å: ${name}</p>`;
            
            loadQuestion();
        });

        document.getElementById('submitBtn').addEventListener('click', submitAnswer);
        document.getElementById('nextBtn').addEventListener('click', nextQuestion);
        document.getElementById('saveBtn').addEventListener('click', saveScreenshot);

        // ==================== æ ¸å¿ƒé€»è¾‘ ====================
        
        function loadQuestion() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const generators = questionGenerators[topicId];
            
            // æ›´æ–°è¿›åº¦
            const progress = ((studentData.currentTopicIndex / topics.length) * 100).toFixed(0);
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressBar').textContent = 
                `${studentData.currentTopicIndex}/${topics.length} çŸ¥è¯†ç‚¹`;
            
            // æ˜¾ç¤ºå½“å‰çŸ¥è¯†ç‚¹
            document.getElementById('currentTopic').innerHTML = 
                `<h2 style="color: #764ba2;">ğŸ“š çŸ¥è¯†ç‚¹ ${studentData.currentTopicIndex + 1}/${topics.length}: ${currentTopic.name}</h2>
                 <p style="color: #666;">${currentTopic.description}</p>`;
            
            // è·å–æœªä½¿ç”¨çš„é¢˜ç›®
            const usedIndices = studentData.usedQuestions[topicId];
            const availableIndices = [];
            for (let i = 0; i < generators.length; i++) {
                if (!usedIndices.includes(i)) {
                    availableIndices.push(i);
                }
            }
            
            // å¦‚æœæ‰€æœ‰é¢˜ç›®éƒ½ç”¨è¿‡,é‡ç½®
            if (availableIndices.length === 0) {
                studentData.usedQuestions[topicId] = [];
                for (let i = 0; i < generators.length; i++) {
                    availableIndices.push(i);
                }
            }
            
            // éšæœºé€‰æ‹©ä¸€é“é¢˜
            const selectedIndex = availableIndices[randInt(0, availableIndices.length - 1)];
            studentData.usedQuestions[topicId].push(selectedIndex);
            
            // ç”Ÿæˆé¢˜ç›®
            const question = generators[selectedIndex]();
            studentData.currentQuestion = question;
            
            // æ˜¾ç¤ºé¢˜ç›®
            const stats = studentData.topicStats[topicId];
            document.getElementById('questionTitle').textContent = 
                `ç¬¬ ${stats.attempts + 1} æ¬¡å°è¯•`;
            
            let questionHTML = `<p style="font-size: 1.1em; margin-bottom: 15px;">${question.question}</p>`;
            
            if (question.type === 'single') {
                // å•é€‰é¢˜ - æ‰“ä¹±é€‰é¡¹
                const shuffled = shuffleOptionsWithAnswer(question.options, question.correct);
                studentData.currentQuestion.shuffledOptions = shuffled.options;
                studentData.currentQuestion.shuffledCorrect = shuffled.correct;
                
                let optionsHTML = '';
                shuffled.options.forEach((opt, idx) => {
                    optionsHTML += `<div class="option" data-index="${idx}">${String.fromCharCode(65 + idx)}. ${opt}</div>`;
                });
                document.getElementById('questionContent').innerHTML = questionHTML;
                document.getElementById('options').innerHTML = optionsHTML;
                
                document.querySelectorAll('.option').forEach(opt => {
                    opt.addEventListener('click', function() {
                        document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
            } else if (question.type === 'multiple') {
                // å¤šé€‰é¢˜ - æ‰“ä¹±é€‰é¡¹
                const shuffled = shuffleOptionsWithAnswers(question.options, question.correct);
                studentData.currentQuestion.shuffledOptions = shuffled.options;
                studentData.currentQuestion.shuffledCorrect = shuffled.correct;
                
                questionHTML += '<p style="color: #ed8936; font-weight: bold;">ï¼ˆå¤šé€‰é¢˜,è¯·é€‰æ‹©æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆï¼‰</p>';
                let optionsHTML = '';
                shuffled.options.forEach((opt, idx) => {
                    optionsHTML += `<label class="checkbox-option">
                        <input type="checkbox" value="${idx}">
                        ${String.fromCharCode(65 + idx)}. ${opt}
                    </label>`;
                });
                document.getElementById('questionContent').innerHTML = questionHTML;
                document.getElementById('options').innerHTML = optionsHTML;
            } else if (question.type === 'tf') {
                // åˆ¤æ–­é¢˜
                document.getElementById('questionContent').innerHTML = questionHTML;
                document.getElementById('options').innerHTML = `
                    <div class="tf-options">
                        <div class="tf-option" data-value="true">âœ“ æ­£ç¡®</div>
                        <div class="tf-option" data-value="false">âœ— é”™è¯¯</div>
                    </div>`;
                
                document.querySelectorAll('.tf-option').forEach(opt => {
                    opt.addEventListener('click', function() {
                        document.querySelectorAll('.tf-option').forEach(o => o.classList.remove('selected'));
                        this.classList.add('selected');
                    });
                });
            }
            
            document.getElementById('feedback').innerHTML = '';
            document.getElementById('submitBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
            
            if (typeof MathJax !== 'undefined') {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }

        function submitAnswer() {
            const question = studentData.currentQuestion;
            const topicId = topics[studentData.currentTopicIndex].id;
            const stats = studentData.topicStats[topicId];
            
            let userAnswer, isCorrect;
            
            if (question.type === 'single') {
                const selected = document.querySelector('.option.selected');
                if (!selected) {
                    alert('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ!');
                    return;
                }
                userAnswer = parseInt(selected.dataset.index);
                isCorrect = (userAnswer === question.shuffledCorrect);
                
                document.querySelectorAll('.option').forEach((opt, idx) => {
                    if (idx === question.shuffledCorrect) {
                        opt.classList.add('correct');
                    } else if (idx === userAnswer && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                });
            } else if (question.type === 'multiple') {
                const checked = document.querySelectorAll('.checkbox-option input:checked');
                if (checked.length === 0) {
                    alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆ!');
                    return;
                }
                userAnswer = Array.from(checked).map(c => parseInt(c.value)).sort((a, b) => a - b);
                isCorrect = JSON.stringify(userAnswer) === JSON.stringify(question.shuffledCorrect);
                
                document.querySelectorAll('.checkbox-option').forEach((opt, idx) => {
                    if (question.shuffledCorrect.includes(idx)) {
                        opt.classList.add('correct');
                    } else if (userAnswer.includes(idx)) {
                        opt.classList.add('incorrect');
                    }
                });
            } else if (question.type === 'tf') {
                const selected = document.querySelector('.tf-option.selected');
                if (!selected) {
                    alert('è¯·é€‰æ‹©æ­£ç¡®æˆ–é”™è¯¯!');
                    return;
                }
                userAnswer = selected.dataset.value === 'true';
                isCorrect = (userAnswer === question.correct);
                
                document.querySelectorAll('.tf-option').forEach(opt => {
                    const val = opt.dataset.value === 'true';
                    if (val === question.correct) {
                        opt.classList.add('correct');
                    } else if (val === userAnswer && !isCorrect) {
                        opt.classList.add('incorrect');
                    }
                });
            }
            
            stats.attempts++;
            stats.questions.push({
                question: question.question,
                userAnswer: userAnswer,
                isCorrect: isCorrect
            });
            
            const feedbackDiv = document.getElementById('feedback');
            if (isCorrect) {
                feedbackDiv.innerHTML = 
                    `<div class="feedback correct">
                        âœ… å›ç­”æ­£ç¡®!<br>
                        <small>${question.explanation}</small>
                    </div>`;
                document.getElementById('submitBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').textContent = 
                    studentData.currentTopicIndex < topics.length - 1 ? 'ä¸‹ä¸€çŸ¥è¯†ç‚¹' : 'æŸ¥çœ‹ç»“æœ';
            } else {
                feedbackDiv.innerHTML = 
                    `<div class="feedback incorrect">
                        âŒ å›ç­”é”™è¯¯,è¯·å†è¯•ä¸€æ¬¡!<br>
                        <small>${question.explanation}</small>
                    </div>`;
                document.getElementById('submitBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').textContent = 'ç»§ç»­ç­”é¢˜';
            }
            
            if (typeof MathJax !== 'undefined') {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }
        }

        function nextQuestion() {
            const currentTopic = topics[studentData.currentTopicIndex];
            const topicId = currentTopic.id;
            const stats = studentData.topicStats[topicId];
            const lastQuestion = stats.questions[stats.questions.length - 1];
            
            if (lastQuestion.isCorrect) {
                studentData.currentTopicIndex++;
                
                if (studentData.currentTopicIndex >= topics.length) {
                    showResults();
                } else {
                    loadQuestion();
                }
            } else {
                loadQuestion();
            }
        }

        function showResults() {
            document.querySelector('.quiz-section').classList.remove('active');
            document.querySelector('.result-section').classList.add('active');
            
            let reportHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <h2 style="color: #667eea;">ğŸ‰ ${studentData.name} åŒå­¦(å­¦å·:${studentData.id})</h2>
                    <p style="color: #666; font-size: 1.1em;">æ‚¨å·²å®ŒæˆDSP-Proj2éŸ³é¢‘å˜é€Ÿå®éªŒç»ƒä¹ æµ‹éªŒ!</p>
                </div>
                
                <table class="stats-table">
                    <tr>
                        <th>çŸ¥è¯†ç‚¹</th>
                        <th>ç­”é¢˜æ¬¡æ•°</th>
                        <th>é¦–æ¬¡æ­£ç¡®ç‡</th>
                        <th>æŒæ¡ç¨‹åº¦</th>
                    </tr>
            `;
            
            let excellentTopics = [];
            let goodTopics = [];
            let fairTopics = [];
            let poorTopics = [];
            
            topics.forEach(topic => {
                const stats = studentData.topicStats[topic.id];
                const accuracy = ((1 / stats.attempts) * 100).toFixed(0);
                
                let mastery, masteryClass;
                if (stats.attempts === 1) {
                    mastery = 'ä¼˜ç§€ â­â­â­â­';
                    masteryClass = 'mastery-excellent';
                    excellentTopics.push(topic.name);
                } else if (stats.attempts === 2) {
                    mastery = 'è‰¯å¥½ â­â­â­';
                    masteryClass = 'mastery-good';
                    goodTopics.push(topic.name);
                } else if (stats.attempts <= 4) {
                    mastery = 'ä¸€èˆ¬ â­â­';
                    masteryClass = 'mastery-fair';
                    fairTopics.push(topic.name);
                } else {
                    mastery = 'éœ€åŠ å¼º â­';
                    masteryClass = 'mastery-poor';
                    poorTopics.push(topic.name);
                }
                
                reportHTML += `
                    <tr>
                        <td><strong>${topic.name}</strong></td>
                        <td>${stats.attempts}æ¬¡</td>
                        <td>${accuracy}%</td>
                        <td class="${masteryClass}">${mastery}</td>
                    </tr>
                `;
            });
            
            reportHTML += '</table>';
            
            reportHTML += '<div style="margin-top: 30px;">';
            reportHTML += '<h3 style="color: #667eea;">ğŸ“Š çŸ¥è¯†æŒæ¡åˆ†æ</h3>';
            
            if (excellentTopics.length > 0) {
                reportHTML += `
                    <div style="background: #e8f5e9; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #48bb78;">
                        <strong style="color: #48bb78;">âœ… æŒæ¡ä¼˜ç§€çš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${excellentTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (goodTopics.length > 0) {
                reportHTML += `
                    <div style="background: #e3f2fd; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #667eea;">
                        <strong style="color: #667eea;">ğŸ‘ æŒæ¡è‰¯å¥½çš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${goodTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (fairTopics.length > 0) {
                reportHTML += `
                    <div style="background: #fff8e1; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #ed8936;">
                        <strong style="color: #ed8936;">âš ï¸ éœ€è¦å·©å›ºçš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${fairTopics.join('ã€')}
                    </div>
                `;
            }
            
            if (poorTopics.length > 0) {
                reportHTML += `
                    <div style="background: #ffebee; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 5px solid #f56565;">
                        <strong style="color: #f56565;">âŒ éœ€è¦é‡ç‚¹åŠ å¼ºçš„çŸ¥è¯†ç‚¹:</strong><br>
                        ${poorTopics.join('ã€')}
                    </div>
                `;
            }
            
            reportHTML += `
                <div style="background: #f0f4ff; padding: 20px; margin: 20px 0; border-radius: 8px; border-left: 5px solid #667eea;">
                    <h4 style="color: #667eea; margin-top: 0;">ğŸ’¡ å¤ä¹ å»ºè®®</h4>
                    <ul style="line-height: 2; color: #555;">
                        <li>é‡ç‚¹å¤ä¹ æ ‡è®°ä¸º"éœ€åŠ å¼º"çš„çŸ¥è¯†ç‚¹,ç»“åˆå®éªŒæ‰‹å†Œè¯¦ç»†å­¦ä¹ </li>
                        <li>ç†è§£æ—¶é¢‘å¯¹å¶å…³ç³»æ˜¯ç†è§£å˜é€Ÿçš„å…³é”®:æ—¶åŸŸæ‹‰ä¼¸â†’é¢‘åŸŸå‹ç¼©</li>
                        <li>æŒæ¡STFTå®Œæ•´æµç¨‹:åˆ†å¸§â†’åŠ çª—â†’FFTâ†’ä¿®æ”¹â†’IFFTâ†’OLA</li>
                        <li>åŒºåˆ†é¢‘åŸŸæ’å€¼æ³•å’Œç›¸ä½å£°ç å™¨çš„é‡å»ºå¸§ç§»:å‰è€…ç”¨Ra,åè€…ç”¨Rs</li>
                        <li>åŠ¨æ‰‹å®è·µMATLABä»£ç ,åŠ æ·±å¯¹ç›¸ä½å±•å¼€å’Œç›¸ä½ç´¯ç§¯çš„ç†è§£</li>
                    </ul>
                </div>
            `;
            
            reportHTML += '</div>';
            
            document.getElementById('finalReport').innerHTML = reportHTML;
        }

        function saveScreenshot() {
            const button = document.getElementById('saveBtn');
            button.disabled = true;
            button.textContent = 'æ­£åœ¨ç”Ÿæˆæˆªå›¾...';
            
            html2canvas(document.body, {
                backgroundColor: '#ffffff',
                scale: 2,
                logging: false
            }).then(canvas => {
                canvas.toBlob(blob => {
                    const cleanId = studentData.id.replace(/[^a-zA-Z0-9_\u4e00-\u9fa5-]/g, '_');
                    const cleanName = studentData.name.replace(/[^a-zA-Z0-9_\u4e00-\u9fa5-]/g, '_');
                    const filename = `${cleanId}_${cleanName}_Proj2Quiz.png`;
                    
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    button.disabled = false;
                    button.textContent = 'æˆªå›¾å·²ä¿å­˜';
                    setTimeout(() => {
                        button.textContent = 'å†æ¬¡æˆªå›¾';
                    }, 2000);
                }, 'image/png');
            }).catch(error => {
                console.error('æˆªå›¾å¤±è´¥:', error);
                alert('æˆªå›¾å¤±è´¥,è¯·å°è¯•ä½¿ç”¨æµè§ˆå™¨æˆªå›¾åŠŸèƒ½');
                button.disabled = false;
                button.textContent = 'æˆªå›¾ä¿å­˜';
            });
        }
    </script>
    
    <script>
        (function() {
            const statusDiv = document.getElementById('mathjaxStatus');
            const primaryCDN = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
            const backupCDN = 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML';

            function loadScript(src, onload, onerror) {
                const script = document.createElement('script');
                script.src = src;
                script.async = true;
                script.onload = onload;
                script.onerror = onerror;
                document.head.appendChild(script);
            }

            function onMathJaxLoad() {
                console.log('MathJax loaded successfully.');
                statusDiv.textContent = 'âœ“ æ•°å­¦å…¬å¼åŠ è½½æˆåŠŸ';
                statusDiv.className = 'mathjax-status success';
            }

            loadScript(primaryCDN, onMathJaxLoad, function() {
                console.warn('Primary MathJax CDN failed. Trying backup...');
                statusDiv.textContent = 'ä¸»CDNåŠ è½½å¤±è´¥,å°è¯•å¤‡ç”¨...';
                loadScript(backupCDN, onMathJaxLoad, function() {
                    console.error('Backup MathJax CDN also failed.');
                    statusDiv.textContent = 'âŒ å…¬å¼åŠ è½½å¤±è´¥,è¯·æ£€æŸ¥ç½‘ç»œ';
                    statusDiv.className = 'mathjax-status';
                });
            });
        })();
    </script>
</body>
</html>