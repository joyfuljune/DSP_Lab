<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>DSP é¡¹ç›®2 - æ•™å¸ˆå‚è€ƒç­”æ¡ˆ</title>
    <style>
        body { font-family: 'Segoe UI', Consolas, 'Microsoft YaHei', sans-serif; background: #f4f7f6; padding: 20px; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        .control-panel {
            position: sticky; top: 0; z-index: 100;
            background: white; padding: 15px; margin-bottom: 20px;
            border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .control-btn {
            background: #B3CDE3; color: #333; border: none; padding: 8px 16px;
            border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 10px;
        }
        .control-btn:hover { background: #9bb8d3; }
        .control-btn.secondary { background: #E5D8BD; }

        .file-block { background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 20px; overflow: hidden; }
        
        /* Pastel1è‰²ç³» - ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ†é…ä¸åŒé¢œè‰² */
        .file-block:nth-child(3) .file-header { background: #FBB4AE; }  /* æ·¡ç²‰è‰² - ex0 */
        .file-block:nth-child(3) .file-header:hover { background: #f9a199; }
        .file-block:nth-child(3) .copy-btn { color: #FBB4AE; }
        .file-block:nth-child(3) pre { background: #fff5f4; }
        
        .file-block:nth-child(4) .file-header { background: #B3CDE3; }  /* æ·¡è“è‰² - ex1 */
        .file-block:nth-child(4) .file-header:hover { background: #a1bdd8; }
        .file-block:nth-child(4) .copy-btn { color: #B3CDE3; }
        .file-block:nth-child(4) pre { background: #f5f9fc; }
        
        .file-block:nth-child(5) .file-header { background: #CCEBC5; }  /* æ·¡ç»¿è‰² - ex2 */
        .file-block:nth-child(5) .file-header:hover { background: #bbe3b3; }
        .file-block:nth-child(5) .copy-btn { color: #CCEBC5; }
        .file-block:nth-child(5) pre { background: #f7fcf6; }
        
        .file-block:nth-child(6) .file-header { background: #DECBE4; }  /* æ·¡ç´«è‰² - ex3 */
        .file-block:nth-child(6) .file-header:hover { background: #d3bdd9; }
        .file-block:nth-child(6) .copy-btn { color: #DECBE4; }
        .file-block:nth-child(6) pre { background: #faf8fb; }
        
        .file-block:nth-child(7) .file-header { background: #FED9A6; }  /* æ·¡æ©™è‰² - ex4 */
        .file-block:nth-child(7) .file-header:hover { background: #fecf93; }
        .file-block:nth-child(7) .copy-btn { color: #FED9A6; }
        .file-block:nth-child(7) pre { background: #fffaf3; }
        
        .file-block:nth-child(8) .file-header { background: #FFFFCC; }  /* æ·¡é»„è‰² - ex5 */
        .file-block:nth-child(8) .file-header:hover { background: #ffffb8; }
        .file-block:nth-child(8) .copy-btn { color: #e6e6b3; }
        .file-block:nth-child(8) pre { background: #fffffa; }
        
        .file-block:nth-child(9) .file-header { background: #E5D8BD; }  /* æ·¡è¤è‰² - ex6 */
        .file-block:nth-child(9) .file-header:hover { background: #dccfad; }
        .file-block:nth-child(9) .copy-btn { color: #E5D8BD; }
        .file-block:nth-child(9) pre { background: #faf8f4; }
        
        .file-header { 
            color: #333; padding: 15px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
            cursor: pointer; user-select: none;
        }
        
        .file-title { font-weight: bold; display: flex; align-items: center; }
        .arrow-icon { display: inline-block; margin-right: 10px; transition: transform 0.3s; }
        .file-block.collapsed .arrow-icon { transform: rotate(-90deg); }
        
        .file-content { display: block; }
        .file-block.collapsed .file-content { display: none; }

        .copy-btn { background: #fff; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 0.9em; font-weight: bold; }
        .copy-btn:hover { background: #f8f9fa; }

        pre { margin: 0; padding: 20px; overflow-x: auto; line-height: 1.8; font-size: 13px; border-top: 1px solid #e9ecef; }
        
        /* æ•™å¸ˆç‰ˆç‰¹æœ‰æ ·å¼ */
        .comment { color: #6c757d; font-style: italic; }
        .answer { color: #dc3545; font-weight: bold; }  /* ç­”æ¡ˆä¸ºçº¢è‰² */
        
        .teacher-banner { background: #FFF9E6; border-left: 4px solid #FED9A6; padding: 15px; margin-bottom: 20px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="control-panel">
            <h2 style="margin:0; color:#666;">ğŸµ DSP é¡¹ç›®2 - éŸ³é¢‘å˜é€Ÿå®éªŒå‚è€ƒç­”æ¡ˆ</h2>
            <div>
                <button class="control-btn" onclick="expandAll()">å…¨éƒ¨å±•å¼€</button>
                <button class="control-btn secondary" onclick="collapseAll()">å…¨éƒ¨æŠ˜å </button>
            </div>
        </div>

        <div class="teacher-banner">
            <strong>ğŸµ æ•™å¸ˆç‰ˆè¯´æ˜ï¼š</strong>
            <ul style="margin:5px 0 0 20px; padding:0; line-height:1.8;">
                <li><span style="color:#dc3545; font-weight:bold;">çº¢è‰²æ–‡å­—</span>éƒ¨åˆ†ä¸ºå‚è€ƒç­”æ¡ˆä»£ç </li>
                <li>ç‚¹å‡»"å¤åˆ¶ä»£ç "æŒ‰é’®å¯ç›´æ¥è·å–å®Œæ•´çš„ã€å¯è¿è¡Œçš„ MATLAB ä»£ç </li>
                <li>ç°è‰²æ–‡å­—ä¸ºæ³¨é‡Šè¯´æ˜</li>
                <li>æœ¬å®éªŒåŸºäº<strong>ç›¸ä½å£°ç å™¨ï¼ˆPhase Vocoderï¼‰</strong>å®ç°éŸ³é¢‘æ—¶é—´æ‹‰ä¼¸</li>
            </ul>
        </div>

        <!-- ex0 ä¸»å‡½æ•° -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex0_synthesize_all.mï¼ˆä¸»å‡½æ•°ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code0')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code0"><span class="comment">%% ========================================================================</span>
<span class="comment">%  ex0_synthesize_all.m - éŸ³é¢‘å˜é€Ÿå®éªŒä¸»æ§ç¨‹åº</span>
<span class="comment">%  ========================================================================</span>
<span class="comment">%  åŠŸèƒ½ï¼šè°ƒç”¨ ex1-ex6 å‡½æ•°å®ç°åŸºäºç›¸ä½å£°ç å™¨/é¢‘åŸŸæ’å€¼çš„éŸ³é¢‘æ—¶é—´æ‹‰ä¼¸</span>
<span class="comment">%  å…¼å®¹ç‰ˆæœ¬ï¼šMATLAB 2014b åŠä»¥ä¸Š</span>
<span class="comment">%  ========================================================================</span>

clc;            <span class="comment">% æ¸…é™¤å‘½ä»¤çª—å£</span>
clear;          <span class="comment">% æ¸…é™¤å·¥ä½œåŒºå˜é‡</span>
close all;      <span class="comment">% å…³é—­æ‰€æœ‰æ‰“å¼€çš„å›¾å½¢çª—å£</span>

<span class="comment">%% ========================== ç¨‹åºå¼€å§‹æç¤º ================================</span>
fprintf('\n');
fprintf('================================================================\n');
fprintf('      éŸ³é¢‘å˜é€Ÿå®éªŒ - åŸºäºç›¸ä½å£°ç å™¨çš„æ—¶é—´æ‹‰ä¼¸\n');
fprintf('             Digital Signal Processing\n');
fprintf('================================================================\n');
fprintf('\n');

<span class="comment">%% ========================== æ­¥éª¤1ï¼šè¯»å–éŸ³é¢‘æ–‡ä»¶ ==========================</span>
fprintf('----------------------------------------------------------------\n');
fprintf('[æ­¥éª¤ 1/8] è¯»å–éŸ³é¢‘æ–‡ä»¶...\n');
fprintf('----------------------------------------------------------------\n');

try
    audioFile = './audio/orig.wav';  <span class="comment">% ä½¿ç”¨å•å¼•å·ï¼ˆå…¼å®¹2014bï¼‰</span>
    [x, fs] = audioread(audioFile);
    fprintf('  [OK] éŸ³é¢‘æ–‡ä»¶è¯»å–æˆåŠŸ!\n');
    fprintf('    - æ–‡ä»¶è·¯å¾„: %s\n', audioFile);
    fprintf('    - é‡‡æ ·ç‡: %d Hz\n', fs);
    fprintf('    - ä¿¡å·é•¿åº¦: %d æ ·æœ¬ç‚¹\n', length(x));
    fprintf('    - éŸ³é¢‘æ—¶é•¿: %.2f ç§’\n', length(x)/fs);
    if size(x, 2) > 1
        x = x(:, 1);  <span class="comment">% å¦‚æœæ˜¯ç«‹ä½“å£°ï¼Œå–å·¦å£°é“</span>
        fprintf('    - æ³¨æ„: æ£€æµ‹åˆ°ç«‹ä½“å£°ï¼Œå·²è½¬æ¢ä¸ºå•å£°é“\n');
    end
catch ME
    fprintf('  [ERROR] æ— æ³•è¯»å–éŸ³é¢‘æ–‡ä»¶!\n');
    fprintf('    - é”™è¯¯ä¿¡æ¯: %s\n', ME.message);
    fprintf('    - è¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®\n');
    return;
end
fprintf('\n');

<span class="comment">%% ========================== æ­¥éª¤2ï¼šå‚æ•°è®¾ç½® ==============================</span>
fprintf('----------------------------------------------------------------\n');
fprintf('[æ­¥éª¤ 2/8] å‚æ•°è®¾ç½®...\n');
fprintf('----------------------------------------------------------------\n');

Lwin = 1024;           <span class="comment">% æ¯å¸§çš„é•¿åº¦ï¼ˆé€šå¸¸ä¸º 2 çš„å¹‚æ¬¡ï¼‰</span>
Ra = Lwin / 4;         <span class="comment">% å¸§ç§» (Hop size)ï¼Œé€šå¸¸ä¸ºå¸§é•¿çš„ 1/4 æˆ– 1/2</span>
stretchFactor = 2;     <span class="comment">% æ—¶é—´æ‹‰ä¼¸å› å­</span>

fprintf('  [OK] å‚æ•°è®¾ç½®å®Œæˆ!\n');
fprintf('    - å¸§é•¿ (Lwin): %d æ ·æœ¬ç‚¹\n', Lwin);
fprintf('    - å¸§ç§» (Ra): %d æ ·æœ¬ç‚¹ (%.1f%% é‡å )\n', Ra, (1-Ra/Lwin)*100);
fprintf('    - æ‹‰ä¼¸å› å­: %.2f\n', stretchFactor);
if stretchFactor > 1
    fprintf('    - æ•ˆæœ: éŸ³é¢‘å°†è¢«æ‹‰ä¼¸ä¸ºåŸæ¥çš„ %.1f å€ï¼ˆå‡é€Ÿæ’­æ”¾ï¼‰\n', stretchFactor);
elseif stretchFactor < 1
    fprintf('    - æ•ˆæœ: éŸ³é¢‘å°†è¢«å‹ç¼©ä¸ºåŸæ¥çš„ %.1f å€ï¼ˆåŠ é€Ÿæ’­æ”¾ï¼‰\n', stretchFactor);
else
    fprintf('    - æ•ˆæœ: éŸ³é¢‘é•¿åº¦ä¿æŒä¸å˜\n');
end
fprintf('\n');

<span class="comment">%% ========================== æ­¥éª¤3ï¼šä¿¡å·åˆ†å¸§ ==============================</span>
fprintf('----------------------------------------------------------------\n');
fprintf('[æ­¥éª¤ 3/8] è°ƒç”¨ ex1_frame_signal è¿›è¡Œä¿¡å·åˆ†å¸§...\n');
fprintf('----------------------------------------------------------------\n');

try
    tic;
    [x_mat] = ex1_frame_signal(x, Lwin, Ra);
    time_ex1 = toc;
    
    <span class="comment">% ç»Ÿä¸€å‘½åå›¾å½¢çª—å£</span>
    set(gcf, 'Name', 'åˆ†å¸§ç»“æœ - ex1_frame_signal', 'NumberTitle', 'off');
    
    fprintf('  [OK] ex1_frame_signal æ‰§è¡ŒæˆåŠŸ! (è€—æ—¶ %.3f ç§’)\n', time_ex1);
    fprintf('    - è¾“å…¥: é•¿åº¦ä¸º %d çš„ä¸€ç»´ä¿¡å·\n', length(x));
    fprintf('    - è¾“å‡º: %d x %d çš„åˆ†å¸§çŸ©é˜µ\n', size(x_mat, 1), size(x_mat, 2));
    fprintf('    - æ€»å¸§æ•°: %d å¸§\n', size(x_mat, 2));
    fprintf('\n');
    fprintf('  [å›¾å½¢è¾“å‡º - æ¥è‡ª ex1_frame_signal]\n');
    fprintf('    - å›¾å½¢å†…å®¹: åŸå§‹ä¿¡å·ä¸å„å¸§ä¿¡å·çš„å åŠ æ˜¾ç¤º\n');
    fprintf('    - è¯´æ˜: ä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒçš„å¸§ï¼Œå¯è§‚å¯Ÿå¸§é—´é‡å æƒ…å†µ\n');
catch ME
    fprintf('  [ERROR] ex1_frame_signal æ‰§è¡Œå¤±è´¥!\n');
    fprintf('    - é”™è¯¯ä¿¡æ¯: %s\n', ME.message);
    return;
end
fprintf('\n');

<span class="comment">%% ========================== æ­¥éª¤4ï¼šåŠ çª—å¤„ç† ==============================</span>
fprintf('----------------------------------------------------------------\n');
fprintf('[æ­¥éª¤ 4/8] è°ƒç”¨ ex2_window_signal è¿›è¡ŒåŠ çª—å¤„ç†...\n');
fprintf('----------------------------------------------------------------\n');

try
    tic;
    [W_x_mat] = ex2_window_signal(x_mat, Lwin);
    time_ex2 = toc;
    
    <span class="comment">% ç»Ÿä¸€å‘½åå›¾å½¢çª—å£</span>
    set(gcf, 'Name', 'åŠ çª—å¤„ç† - ex2_window_signal', 'NumberTitle', 'off');
    
    fprintf('  [OK] ex2_window_signal æ‰§è¡ŒæˆåŠŸ! (è€—æ—¶ %.3f ç§’)\n', time_ex2);
    fprintf('    - çª—å‡½æ•°ç±»å‹: Hann çª—\n');
    fprintf('    - çª—å£é•¿åº¦: %d æ ·æœ¬ç‚¹\n', Lwin);
    fprintf('    - è¾“å‡ºçŸ©é˜µå¤§å°: %d x %d\n', size(W_x_mat, 1), size(W_x_mat, 2));
    fprintf('\n');
    fprintf('  [å›¾å½¢è¾“å‡º - æ¥è‡ª ex2_window_signal]\n');
    fprintf('    - å­å›¾1: åŸå§‹ä¿¡å·çš„ç¬¬ä¸€å¸§ï¼ˆæœªåŠ çª—ï¼‰\n');
    fprintf('    - å­å›¾2: Hann çª—å‡½æ•°å½¢çŠ¶\n');
    fprintf('    - å­å›¾3: åŠ çª—åçš„ç¬¬ä¸€å¸§ä¿¡å·ï¼ˆä¸¤ç«¯å¹…åº¦å‡å°ï¼‰\n');
catch ME
    fprintf('  [ERROR] ex2_window_signal æ‰§è¡Œå¤±è´¥!\n');
    fprintf('    - é”™è¯¯ä¿¡æ¯: %s\n', ME.message);
    return;
end
fprintf('\n');

<span class="comment">%% ========================== æ­¥éª¤5ï¼šè®¡ç®—é¢‘è°± ==============================</span>
fprintf('----------------------------------------------------------------\n');
fprintf('[æ­¥éª¤ 5/8] è°ƒç”¨ ex3_compute_spectrum è®¡ç®—é¢‘è°±...\n');
fprintf('----------------------------------------------------------------\n');

try
    tic;
    [W_X_MAT] = ex3_compute_spectrum(W_x_mat);
    time_ex3 = toc;
    
    <span class="comment">% ç»Ÿä¸€å‘½åå›¾å½¢çª—å£</span>
    set(gcf, 'Name', 'é¢‘è°±åˆ†æ - ex3_compute_spectrum', 'NumberTitle', 'off');
    
    fprintf('  [OK] ex3_compute_spectrum æ‰§è¡ŒæˆåŠŸ! (è€—æ—¶ %.3f ç§’)\n', time_ex3);
    fprintf('    - å˜æ¢ç±»å‹: FFT (å¿«é€Ÿå‚…é‡Œå¶å˜æ¢)\n');
    fprintf('    - é¢‘è°±çŸ©é˜µå¤§å°: %d x %d (å¤æ•°çŸ©é˜µ)\n', size(W_X_MAT, 1), size(W_X_MAT, 2));
    fprintf('    - é¢‘ç‡åˆ†è¾¨ç‡: %.2f Hz\n', fs/Lwin);
    fprintf('\n');
    fprintf('  [å›¾å½¢è¾“å‡º - æ¥è‡ª ex3_compute_spectrum]\n');
    fprintf('    - å­å›¾1: åŠ çª—åç¬¬ä¸€å¸§çš„æ—¶åŸŸæ³¢å½¢\n');
    fprintf('    - å­å›¾2: ç¬¬ä¸€å¸§çš„å¹…åº¦è°±ï¼ˆæ˜¾ç¤ºå„é¢‘ç‡æˆåˆ†å¼ºåº¦ï¼‰\n');
    fprintf('    - å­å›¾3: ç¬¬ä¸€å¸§çš„ç›¸ä½è°±ï¼ˆæ˜¾ç¤ºå„é¢‘ç‡æˆåˆ†ç›¸ä½ï¼‰\n');
catch ME
    fprintf('  [ERROR] ex3_compute_spectrum æ‰§è¡Œå¤±è´¥!\n');
    fprintf('    - é”™è¯¯ä¿¡æ¯: %s\n', ME.message);
    return;
end
fprintf('\n');

<span class="comment">%% ========================== æ­¥éª¤6ï¼šä¿®æ”¹é¢‘è°± ==============================</span>
fprintf('----------------------------------------------------------------\n');
fprintf('[æ­¥éª¤ 6/8] ä¿®æ”¹é¢‘è°±ï¼ˆæ—¶é—´æ‹‰ä¼¸æ ¸å¿ƒæ­¥éª¤ï¼‰...\n');
fprintf('----------------------------------------------------------------\n');

usePhaseVocoder = true;  <span class="comment">% true: ç›¸ä½å£°ç å™¨æ³•; false: é¢‘åŸŸæ’å€¼æ³•</span>

if ~usePhaseVocoder
    <span class="comment">% -------------------- æ–¹æ³•1ï¼šé¢‘åŸŸæ’å€¼æ³• --------------------</span>
    fprintf('  -> ä½¿ç”¨æ–¹æ³•: é¢‘åŸŸæ’å€¼æ³• (ex4_modify_STFT)\n');
    fprintf('    - åŸç†: é€šè¿‡çº¿æ€§æ’å€¼è°ƒæ•´é¢‘è°±çŸ©é˜µçš„å¸§æ•°\n');
    fprintf('\n');
    
    try
        tic;
        [freq_mat_modified] = ex4_modify_STFT(W_X_MAT, stretchFactor);
        time_ex4 = toc;
        
        <span class="comment">% ç»Ÿä¸€å‘½åå›¾å½¢çª—å£</span>
        set(gcf, 'Name', 'é¢‘åŸŸæ’å€¼ - ex4_modify_STFT', 'NumberTitle', 'off');
        
        fprintf('  [OK] ex4_modify_STFT æ‰§è¡ŒæˆåŠŸ! (è€—æ—¶ %.3f ç§’)\n', time_ex4);
        fprintf('    - åŸå§‹å¸§æ•°: %d\n', size(W_X_MAT, 2));
        fprintf('    - æ‹‰ä¼¸åå¸§æ•°: %d\n', size(freq_mat_modified, 2));
        fprintf('    - é‡å»ºå¸§ç§»: %d (ä½¿ç”¨åŸå§‹å¸§ç§» Ra)\n', Ra);
        fprintf('\n');
        fprintf('  [å›¾å½¢è¾“å‡º - æ¥è‡ª ex4_modify_STFT]\n');
        fprintf('    - å­å›¾1: åŸå§‹æœ€ä½é¢‘ç‡åˆ†é‡éšæ—¶é—´å˜åŒ–\n');
        fprintf('    - å­å›¾2: æ’å€¼åæœ€ä½é¢‘ç‡åˆ†é‡éšæ—¶é—´å˜åŒ–\n');
        fprintf('    - è¯´æ˜: å¯è§‚å¯Ÿåˆ°å¸§æ•°å˜åŒ–ï¼Œä½†é¢‘ç‡æˆåˆ†å½¢çŠ¶ä¿æŒ\n');
        
        <span class="comment">% è®¾ç½®é‡å»ºç”¨çš„å¸§ç§»</span>
        Rs_reconstruct = Ra;
    catch ME
        fprintf('  [ERROR] ex4_modify_STFT æ‰§è¡Œå¤±è´¥!\n');
        fprintf('    - é”™è¯¯ä¿¡æ¯: %s\n', ME.message);
        return;
    end
    
else
    <span class="comment">% -------------------- æ–¹æ³•2ï¼šç›¸ä½å£°ç å™¨æ³• --------------------</span>
    fprintf('  -> ä½¿ç”¨æ–¹æ³•: ç›¸ä½å£°ç å™¨æ³• (ex6_Phase_Vocoder)\n');
    fprintf('    - åŸç†: ä¿æŒå¹…åº¦ä¸å˜ï¼Œé€šè¿‡ç›¸ä½è°ƒæ•´å®ç°æ—¶é—´æ‹‰ä¼¸\n');
    fprintf('    - ä¼˜åŠ¿: é¿å…å¸§é—´ç›¸ä½ä¸è¿ç»­ï¼ŒéŸ³è´¨æ›´å¥½\n');
    fprintf('\n');
    
    Rs = round(Ra * stretchFactor);
    fprintf('    - åŸå§‹å¸§ç§» Ra: %d\n', Ra);
    fprintf('    - æ‹‰ä¼¸åå¸§ç§» Rs: %d\n', Rs);
    fprintf('\n');
    
    try
        tic;
        [freq_mat_modified] = ex6_Phase_Vocoder(W_X_MAT, Lwin, Ra, Rs);
        time_ex6 = toc;
        
        <span class="comment">% ç»Ÿä¸€å‘½åå›¾å½¢çª—å£</span>
        set(gcf, 'Name', 'ç›¸ä½å£°ç å™¨ - ex6_Phase_Vocoder', 'NumberTitle', 'off');
        
        fprintf('  [OK] ex6_Phase_Vocoder æ‰§è¡ŒæˆåŠŸ! (è€—æ—¶ %.3f ç§’)\n', time_ex6);
        fprintf('    - è¾“å…¥å¸§æ•°: %d\n', size(W_X_MAT, 2));
        fprintf('    - è¾“å‡ºå¸§æ•°: %d (å°‘1å¸§ç”¨äºç›¸ä½å·®è®¡ç®—)\n', size(freq_mat_modified, 2));
        fprintf('    - é‡å»ºå¸§ç§»: %d (ä½¿ç”¨æ‹‰ä¼¸åå¸§ç§» Rs)\n', Rs);
        fprintf('\n');
        fprintf('  [å›¾å½¢è¾“å‡º - æ¥è‡ª ex6_Phase_Vocoder]\n');
        fprintf('    - å­å›¾1-2: åŸå§‹ä¸å¤„ç†åçš„å¹…åº¦è°±å¯¹æ¯”\n');
        fprintf('    - å­å›¾3-4: åŸå§‹ä¸å¤„ç†åçš„ç›¸ä½è°±å¯¹æ¯”\n');
        fprintf('    - è¯´æ˜: å¹…åº¦åº”åŸºæœ¬ä¿æŒï¼Œç›¸ä½ç»è¿‡é‡æ–°ç´¯ç§¯\n');
        
        <span class="comment">% è®¾ç½®é‡å»ºç”¨çš„å¸§ç§»</span>
        Rs_reconstruct = Rs;
    catch ME
        fprintf('  [ERROR] ex6_Phase_Vocoder æ‰§è¡Œå¤±è´¥!\n');
        fprintf('    - é”™è¯¯ä¿¡æ¯: %s\n', ME.message);
        return;
    end
end
fprintf('\n');

<span class="comment">%% ========================== æ­¥éª¤7ï¼šä¿¡å·é‡å»º ==============================</span>
fprintf('----------------------------------------------------------------\n');
fprintf('[æ­¥éª¤ 7/8] è°ƒç”¨ ex5_reconstruct_signal é‡å»ºä¿¡å·...\n');
fprintf('----------------------------------------------------------------\n');

try
    tic;
    [outputSignal] = ex5_reconstruct_signal(freq_mat_modified, Lwin, Rs_reconstruct);
    time_ex5 = toc;
    
    fprintf('  [OK] ex5_reconstruct_signal æ‰§è¡ŒæˆåŠŸ! (è€—æ—¶ %.3f ç§’)\n', time_ex5);
    fprintf('    - é‡å»ºæ–¹æ³•: IFFT + Hammingçª— + é‡å ç›¸åŠ (OLA)\n');
    fprintf('    - ä½¿ç”¨å¸§ç§»: %d\n', Rs_reconstruct);
    fprintf('    - è¾“å‡ºä¿¡å·é•¿åº¦: %d æ ·æœ¬ç‚¹\n', length(outputSignal));
    fprintf('    - è¾“å‡ºéŸ³é¢‘æ—¶é•¿: %.2f ç§’\n', length(outputSignal)/fs);
    fprintf('    - å®é™…æ‹‰ä¼¸æ¯”ä¾‹: %.2f å€\n', length(outputSignal)/length(x));
catch ME
    fprintf('  [ERROR] ex5_reconstruct_signal æ‰§è¡Œå¤±è´¥!\n');
    fprintf('    - é”™è¯¯ä¿¡æ¯: %s\n', ME.message);
    return;
end
fprintf('\n');

<span class="comment">%% ========================== æ­¥éª¤8ï¼šæ’­æ”¾å’Œç»˜å›¾ ============================</span>
fprintf('----------------------------------------------------------------\n');
fprintf('[æ­¥éª¤ 8/8] æ’­æ”¾é‡æ„éŸ³é¢‘å¹¶ç»˜åˆ¶å¯¹æ¯”å›¾...\n');
fprintf('----------------------------------------------------------------\n');

<span class="comment">% æ’­æ”¾é‡æ„åçš„éŸ³é¢‘</span>
fprintf('  >> æ­£åœ¨æ’­æ”¾é‡æ„åçš„éŸ³é¢‘...\n');
fprintf('    - é¢„è®¡æ’­æ”¾æ—¶é•¿: %.2f ç§’\n', length(outputSignal)/fs);
sound(outputSignal, fs);

<span class="comment">% åˆ›å»ºæ—¶é—´è½´</span>
t_orig = (0:length(x)-1) / fs;
t_recon = (0:length(outputSignal)-1) / fs;

<span class="comment">% åˆ›å»ºå›¾å½¢çª—å£è¿›è¡Œå¯¹æ¯”ç»˜å›¾ï¼ˆç»Ÿä¸€å‘½åé£æ ¼ï¼‰</span>
figure;
set(gcf, 'Name', 'éŸ³é¢‘å˜é€Ÿç»“æœå¯¹æ¯” - ex0_synthesize_all', 'NumberTitle', 'off');

<span class="comment">% ç»˜åˆ¶åŸå§‹éŸ³é¢‘ä¿¡å·</span>
subplot(2, 1, 1);
plot(t_orig, x, 'b', 'LineWidth', 0.5);
title('åŸå§‹éŸ³é¢‘ä¿¡å·');
xlabel('æ—¶é—´ (ç§’)');
ylabel('å¹…åº¦');
xlim([0, max(t_orig)]);
grid on;

<span class="comment">% ç»˜åˆ¶é‡æ„åçš„éŸ³é¢‘ä¿¡å·</span>
subplot(2, 1, 2);
plot(t_recon, outputSignal, 'r', 'LineWidth', 0.5);
title('é‡æ„åçš„éŸ³é¢‘ä¿¡å·');
xlabel('æ—¶é—´ (ç§’)');
ylabel('å¹…åº¦');
xlim([0, max(t_recon)]);
grid on;

fprintf('\n');
fprintf('  [å›¾å½¢è¾“å‡º - æ¥è‡ª ex0_synthesize_all]\n');
fprintf('    - å­å›¾1: åŸå§‹éŸ³é¢‘æ³¢å½¢ (è“è‰²ï¼Œæ—¶é•¿ %.2f ç§’)\n', length(x)/fs);
fprintf('    - å­å›¾2: é‡æ„éŸ³é¢‘æ³¢å½¢ (çº¢è‰²ï¼Œæ—¶é•¿ %.2f ç§’)\n', length(outputSignal)/fs);
fprintf('    - è¯´æ˜: é‡æ„ä¿¡å·åº”æ¯”åŸå§‹ä¿¡å·é•¿ %.1f å€\n', stretchFactor);
fprintf('\n');

<span class="comment">%% ========================== è¿è¡Œæ€»ç»“ =====================================</span>
fprintf('================================================================\n');
fprintf('                       è¿ è¡Œ æ€» ç»“\n');
fprintf('================================================================\n');
fprintf('\n');
fprintf('  [å¤„ç†å‚æ•°]\n');
fprintf('    - å¸§é•¿: %d | å¸§ç§»: %d | æ‹‰ä¼¸å› å­: %.2f\n', Lwin, Ra, stretchFactor);
if usePhaseVocoder
    fprintf('    - å¤„ç†æ–¹æ³•: ç›¸ä½å£°ç å™¨æ³• (Phase Vocoder)\n');
else
    fprintf('    - å¤„ç†æ–¹æ³•: é¢‘åŸŸæ’å€¼æ³•\n');
end
fprintf('\n');
fprintf('  [å¤„ç†ç»“æœ]\n');
fprintf('    - åŸå§‹æ—¶é•¿: %.2f ç§’ -> è¾“å‡ºæ—¶é•¿: %.2f ç§’\n', length(x)/fs, length(outputSignal)/fs);
fprintf('    - å®é™…æ‹‰ä¼¸æ¯”: %.2f (ç›®æ ‡: %.2f)\n', length(outputSignal)/length(x), stretchFactor);
fprintf('\n');
fprintf('  [ç”Ÿæˆå›¾å½¢æ±‡æ€»]\n');
fprintf('    - Figure 1: åˆ†å¸§ç»“æœ - ex1_frame_signal\n');
fprintf('    - Figure 2: åŠ çª—å¤„ç† - ex2_window_signal\n');
fprintf('    - Figure 3: é¢‘è°±åˆ†æ - ex3_compute_spectrum\n');
if usePhaseVocoder
    fprintf('    - Figure 4: ç›¸ä½å£°ç å™¨ - ex6_Phase_Vocoder\n');
else
    fprintf('    - Figure 4: é¢‘åŸŸæ’å€¼ - ex4_modify_STFT\n');
end
fprintf('    - Figure 5: éŸ³é¢‘å˜é€Ÿç»“æœå¯¹æ¯” - ex0_synthesize_all\n');
fprintf('\n');
fprintf('  [æ‰§è¡ŒçŠ¶æ€] æ‰€æœ‰æ­¥éª¤æ‰§è¡ŒæˆåŠŸ! éŸ³é¢‘æ­£åœ¨æ’­æ”¾ä¸­...\n');
fprintf('\n');
fprintf('================================================================\n');
fprintf('                     ç¨‹åºè¿è¡Œå®Œæˆ\n');
fprintf('================================================================\n');
fprintf('\n');</pre>
            </div>
        </div>

        <!-- ex1 ä¿¡å·åˆ†å¸§ -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex1_frame_signal.mï¼ˆä¿¡å·åˆ†å¸§ï¼‰
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code1')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code1">function [x_mat] = ex1_frame_signal(x, Lwin, Ra)
<span class="comment">% EX1_FRAME_SIGNAL - å°†è¾“å…¥æ—¶åŸŸä¿¡å·åˆ†å¸§å¤„ç†</span>
<span class="comment">%</span>
<span class="comment">% æ­¤å‡½æ•°å°†è¾“å…¥ä¿¡å· `x` æŒ‰ç…§æŒ‡å®šçš„å¸§é•¿åº¦ `Lwin` å’Œå¸§ç§» `Ra` è¿›è¡Œåˆ†æ®µå¤„ç†ã€‚</span>
<span class="comment">% æ¯å¸§é•¿åº¦ä¸º `Lwin`ï¼Œç›¸é‚»å¸§ä¹‹é—´çš„é‡‡æ ·ç‚¹é—´éš”ä¸º `Ra`ï¼Œç»“æœè¾“å‡ºä¸€ä¸ªä¿¡å·çŸ©é˜µã€‚</span>
<span class="comment">%</span>
<span class="comment">% è¾“å…¥å‚æ•°ï¼š</span>
<span class="comment">% - x: è¾“å…¥çš„æ—¶åŸŸä¿¡å·ï¼Œ1ç»´æ•°ç»„</span>
<span class="comment">% - Lwin: æ¯å¸§çš„é•¿åº¦ï¼ˆæ ·æœ¬æ•°ï¼‰</span>
<span class="comment">% - Ra: å¸§ç§»ï¼ˆæ­¥é•¿ï¼‰ï¼Œå³ç›¸é‚»å¸§ä¹‹é—´çš„é‡‡æ ·ç‚¹é—´éš”</span>
<span class="comment">%</span>
<span class="comment">% è¾“å‡ºå‚æ•°ï¼š</span>
<span class="comment">% - x_mat: åˆ†å¸§åçš„ä¿¡å·çŸ©é˜µï¼Œå¤§å°ä¸º [Lwin, Lframe]</span>

<span class="comment">%% 1. è·å–è¾“å…¥ä¿¡å·çš„é•¿åº¦</span>
Lx = <span class="answer">length(x)</span>;  <span class="comment">% è¾“å…¥ä¿¡å·åŒ…å«çš„é‡‡æ ·ç‚¹æ€»æ•°</span>

<span class="comment">%% 2. è®¡ç®—æ¯å¸§çš„èµ·å§‹ä½ç½®ç´¢å¼•</span>
Idx = <span class="answer">1:Ra:(Lx - Lwin)</span>;  <span class="comment">% æ¯å¸§çš„èµ·å§‹é‡‡æ ·ç‚¹ï¼ŒæŒ‰å¸§ç§» Ra é€’å¢</span>

<span class="comment">%% 3. è®¡ç®—æ€»å¸§æ•°</span>
Lframe = <span class="answer">length(Idx)</span>;  <span class="comment">% æ ¹æ®èµ·å§‹ç´¢å¼•è®¡ç®—æ€»å¸§æ•°</span>

<span class="comment">%% 4. åˆå§‹åŒ–ä¿¡å·çŸ©é˜µ</span>
x_mat = <span class="answer">zeros(Lwin, Lframe)</span>;  <span class="comment">% åˆ›å»ºå¤§å°ä¸º [Lwin, Lframe] çš„çŸ©é˜µ</span>

<span class="comment">%% 5. éå†æ¯ä¸€å¸§å¹¶å­˜å…¥çŸ©é˜µ</span>
for idx = 1:Lframe
    <span class="comment">% æå–å½“å‰å¸§çš„ä¿¡å·ç‰‡æ®µ</span>
    currentFrame = <span class="answer">x(Idx(idx):(Idx(idx) + Lwin - 1))</span>;  
    <span class="comment">% å°†å½“å‰å¸§å­˜å…¥ä¿¡å·çŸ©é˜µçš„ç›¸åº”åˆ—</span>
    x_mat(:, idx) = <span class="answer">currentFrame</span>;
end

end</pre>
            </div>
        </div>

        <!-- ex2 åŠ çª—å¤„ç† -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex2_window_signal.mï¼ˆåŠ çª—å¤„ç†ï¼‰
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code2')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code2">function [W_x_mat] = ex2_window_signal(x_mat, Lwin)
<span class="comment">% EX2_WINDOW_SIGNAL - å¯¹åˆ†å¸§ä¿¡å·çŸ©é˜µåº”ç”¨ Hann çª—è¿›è¡ŒåŠ çª—å¤„ç†</span>
<span class="comment">%</span>
<span class="comment">% æ­¤å‡½æ•°å¯¹è¾“å…¥çš„åˆ†å¸§ä¿¡å·çŸ©é˜µåº”ç”¨ Hann çª—è¿›è¡ŒåŠ çª—å¤„ç†ï¼Œä»¥å‡å°‘é¢‘è°±æ³„éœ²ã€‚</span>
<span class="comment">%</span>
<span class="comment">% è¾“å…¥å‚æ•°ï¼š</span>
<span class="comment">% - x_mat: åˆ†å¸§åçš„æ—¶åŸŸä¿¡å·çŸ©é˜µï¼Œæ¯åˆ—è¡¨ç¤ºä¸€ä¸ªæ—¶é—´å¸§ï¼ˆå¤§å°ä¸º [Lwin, N]ï¼‰</span>
<span class="comment">% - Lwin: çª—å£çš„é•¿åº¦ï¼Œä¸æ¯å¸§çš„é•¿åº¦ç›¸åŒ</span>
<span class="comment">%</span>
<span class="comment">% è¾“å‡ºå‚æ•°ï¼š</span>
<span class="comment">% - W_x_mat: åŠ çª—åçš„ä¿¡å·çŸ©é˜µï¼Œå¤§å°ä¸ x_mat ç›¸åŒ</span>

<span class="comment">%% 1. ç”Ÿæˆ Hann çª—å‡½æ•°</span>
Whann = <span class="answer">hann(Lwin)</span>;  <span class="comment">% ç”Ÿæˆé•¿åº¦ä¸º Lwin çš„ Hann çª—</span>

<span class="comment">%% 2. åˆå§‹åŒ–åŠ çª—åçš„ä¿¡å·çŸ©é˜µ</span>
W_x_mat = <span class="answer">zeros(size(x_mat))</span>;  <span class="comment">% åˆ›å»ºä¸ x_mat å¤§å°ç›¸åŒçš„é›¶çŸ©é˜µ</span>

<span class="comment">%% 3. éå†æ¯ä¸€åˆ—ï¼Œé€åˆ—è¿›è¡ŒåŠ çª—</span>
numFrames = size(x_mat, 2);  <span class="comment">% è·å–å¸§æ•°ï¼ˆçŸ©é˜µçš„åˆ—æ•°ï¼‰</span>

for i = 1:numFrames
    <span class="comment">% 3.1 æå–å½“å‰å¸§çš„ä¿¡å·</span>
    currentFrame = x_mat(:, i);  <span class="comment">% è·å–ç¬¬ i å¸§çš„ä¿¡å·</span>
    
    <span class="comment">% 3.2 å¯¹å½“å‰å¸§è¿›è¡ŒåŠ çª—</span>
    windowedFrame = <span class="answer">Whann .* currentFrame</span>;  <span class="comment">% é€å…ƒç´ ä¹˜ä»¥ Hann çª—</span>

    <span class="comment">% 3.3 å°†åŠ çª—åçš„å¸§å­˜å…¥çŸ©é˜µ</span>
    W_x_mat(:, i) = <span class="answer">windowedFrame</span>;
end

end</pre>
            </div>
        </div>

        <!-- ex3 é¢‘è°±è®¡ç®— -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex3_compute_spectrum.mï¼ˆé¢‘è°±è®¡ç®—ï¼‰
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code3')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code3">function [W_X_MAT] = ex3_compute_spectrum(W_x_mat)
<span class="comment">% EX3_COMPUTE_SPECTRUM - å¯¹åŠ çª—åçš„ä¿¡å·çŸ©é˜µè®¡ç®—é¢‘è°±</span>
<span class="comment">%</span>
<span class="comment">% æ­¤å‡½æ•°å¯¹è¾“å…¥çš„æ¯ä¸€å¸§åŠ çª—ä¿¡å·åº”ç”¨å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ (FFT)ï¼Œå°†å…¶è½¬æ¢ä¸ºé¢‘åŸŸè¡¨ç¤ºã€‚</span>
<span class="comment">%</span>
<span class="comment">% è¾“å…¥å‚æ•°ï¼š</span>
<span class="comment">% - W_x_mat: åŠ çª—åçš„æ—¶åŸŸä¿¡å·çŸ©é˜µï¼Œå¤§å°ä¸º [Lwin, Lframe]</span>
<span class="comment">%</span>
<span class="comment">% è¾“å‡ºå‚æ•°ï¼š</span>
<span class="comment">% - W_X_MAT: é¢‘è°±çŸ©é˜µï¼Œæ¯åˆ—å¯¹åº”ä¸€å¸§ä¿¡å·çš„é¢‘è°±ä¿¡æ¯ï¼Œå¤§å°ä¸ W_x_mat ç›¸åŒ</span>

<span class="comment">%% 1. è·å–è¾“å…¥çŸ©é˜µçš„å°ºå¯¸</span>
[Lwin, Lframe] = <span class="answer">size(W_x_mat)</span>;  <span class="comment">% Lwin æ˜¯æ¯å¸§çš„é•¿åº¦ï¼ŒLframe æ˜¯æ€»å¸§æ•°</span>

<span class="comment">%% 2. åˆå§‹åŒ–é¢‘è°±çŸ©é˜µ</span>
W_X_MAT = <span class="answer">zeros(Lwin, Lframe)</span>;  <span class="comment">% åˆ›å»ºä¸ W_x_mat ç›¸åŒå¤§å°çš„é›¶çŸ©é˜µ</span>

<span class="comment">%% 3. éå†æ¯ä¸€å¸§å¹¶è®¡ç®—é¢‘è°±</span>
for idx = 1:Lframe
    <span class="comment">% 3.1 æå–å½“å‰å¸§çš„ä¿¡å·</span>
    currentFrame = W_x_mat(:, idx);  <span class="comment">% è·å–ç¬¬ idx å¸§çš„ä¿¡å·</span>

    <span class="comment">% 3.2 è®¡ç®—å½“å‰å¸§çš„é¢‘è°±</span>
    spectrum = <span class="answer">fft(currentFrame)</span>;  <span class="comment">% å¯¹è¯¥å¸§è¿›è¡Œ FFT è®¡ç®—</span>

    <span class="comment">% 3.3 å°†é¢‘è°±å­˜å…¥é¢‘è°±çŸ©é˜µ</span>
    W_X_MAT(:, idx) = <span class="answer">spectrum</span>;
end

end</pre>
            </div>
        </div>

        <!-- ex4 é¢‘åŸŸæ’å€¼ -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex4_modify_STFT.mï¼ˆé¢‘åŸŸæ’å€¼æ³•ï¼‰
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code4')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code4">function [freq_mat_modified] = ex4_modify_STFT(freq_mat, stretchFactor)
<span class="comment">% EX4_MODIFY_STFT - å¯¹ STFT é¢‘è°±çŸ©é˜µè¿›è¡Œæ—¶é—´æ‹‰ä¼¸æˆ–ç¼©æ”¾</span>
<span class="comment">%</span>
<span class="comment">% è¯¥å‡½æ•°é€šè¿‡çº¿æ€§æ’å€¼è°ƒæ•´é¢‘è°±çŸ©é˜µçš„å¸§æ•°ï¼Œå®ç°éŸ³é¢‘ä¿¡å·çš„æ—¶é—´å°ºåº¦å˜æ¢ã€‚</span>
<span class="comment">%</span>
<span class="comment">% è¾“å…¥å‚æ•°ï¼š</span>
<span class="comment">% - freq_mat: åŸå§‹ STFT é¢‘è°±çŸ©é˜µï¼Œå¤§å°ä¸º [Lwin, numFrames]</span>
<span class="comment">% - stretchFactor: æ—¶é—´æ‹‰ä¼¸å› å­ï¼Œå¤§äº 1 è¡¨ç¤ºå»¶é•¿ï¼Œå°äº 1 è¡¨ç¤ºç¼©çŸ­</span>
<span class="comment">%</span>
<span class="comment">% è¾“å‡ºå‚æ•°ï¼š</span>
<span class="comment">% - freq_mat_modified: è°ƒæ•´åçš„é¢‘è°±çŸ©é˜µï¼Œå¤§å°ä¸º [Lwin, newNumFrames]</span>

<span class="comment">%% 1. è·å–åŸå§‹é¢‘è°±çŸ©é˜µçš„å°ºå¯¸ä¿¡æ¯</span>
[Lwin, numFrames] = <span class="answer">size(freq_mat)</span>;  <span class="comment">% æ¯å¸§é•¿åº¦ Lwinï¼Œæ€»å¸§æ•° numFrames</span>

<span class="comment">%% 2. è®¡ç®—æ‹‰ä¼¸åçš„æ–°å¸§æ•°</span>
newNumFrames = <span class="answer">floor(numFrames * stretchFactor)</span>;  <span class="comment">% æ ¹æ®æ‹‰ä¼¸å› å­è®¡ç®—æ–°å¸§æ•°</span>

<span class="comment">%% 3. åˆå§‹åŒ–æ–°çš„é¢‘è°±çŸ©é˜µ</span>
freq_mat_modified = <span class="answer">zeros(Lwin, newNumFrames)</span>;  <span class="comment">% åˆ›å»º [Lwin, newNumFrames] çŸ©é˜µ</span>

<span class="comment">%% 4. ç”ŸæˆåŸå§‹å’Œæ–°çš„æ—¶é—´ç‚¹åºåˆ—</span>
originalTimePoints = <span class="answer">linspace(0, 1, numFrames)</span>;  <span class="comment">% åŸå§‹æ—¶é—´ç‚¹</span>
newTimePoints = <span class="answer">linspace(0, 1, newNumFrames)</span>;    <span class="comment">% æ–°æ—¶é—´ç‚¹</span>

<span class="comment">%% 5. éå†æ¯ä¸€è¡Œè¿›è¡Œçº¿æ€§æ’å€¼</span>
for k = 1:Lwin
    <span class="comment">% 5.1 æå–å½“å‰è¡Œçš„é¢‘åŸŸæ•°æ®</span>
    currentRow = freq_mat(k, :);  <span class="comment">% è·å–ç¬¬ k è¡Œçš„é¢‘è°±æ•°æ®</span>

    <span class="comment">% 5.2 å¯¹å½“å‰è¡Œè¿›è¡Œçº¿æ€§æ’å€¼</span>
    interpolatedValues = <span class="answer">interp1(originalTimePoints, currentRow, newTimePoints, 'linear', 'extrap')</span>;

    <span class="comment">% 5.3 å°†æ’å€¼ç»“æœå­˜å…¥æ–°çš„é¢‘è°±çŸ©é˜µ</span>
    freq_mat_modified(k, :) = <span class="answer">interpolatedValues</span>;
end

end</pre>
            </div>
        </div>

        <!-- ex5 ä¿¡å·é‡å»º -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex5_reconstruct_signal.mï¼ˆä¿¡å·é‡å»ºï¼‰
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code5')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code5">function [outputSignal] = ex5_reconstruct_signal(freq_mat_modified, Lwin, Ra)
<span class="comment">% EX5_RECONSTRUCT_SIGNAL - é‡æ„æ—¶é—´æ‹‰ä¼¸åçš„éŸ³é¢‘ä¿¡å·</span>
<span class="comment">%</span>
<span class="comment">% è¯¥å‡½æ•°é€šè¿‡å¯¹ STFT çŸ©é˜µé€å¸§è¿›è¡Œ iFFT å’ŒåŠ çª—é‡å ç›¸åŠ ï¼Œé‡æ„éŸ³é¢‘ä¿¡å·ã€‚</span>
<span class="comment">%</span>
<span class="comment">% è¾“å…¥å‚æ•°ï¼š</span>
<span class="comment">% - freq_mat_modified: æ‹‰ä¼¸åçš„ STFT çŸ©é˜µï¼Œå¤§å°ä¸º [Lwin, newNumFrames]</span>
<span class="comment">% - Lwin: çª—å£å¤§å°</span>
<span class="comment">% - Ra: å¸§ç§» (hop size)</span>
<span class="comment">%</span>
<span class="comment">% è¾“å‡ºå‚æ•°ï¼š</span>
<span class="comment">% - outputSignal: é‡æ„åçš„éŸ³é¢‘ä¿¡å·</span>

<span class="comment">% 1. è·å– STFT çŸ©é˜µçš„å¸§æ•°</span>
[~, newNumFrames] = <span class="answer">size(freq_mat_modified)</span>;  <span class="comment">% è·å–çŸ©é˜µåˆ—æ•°ï¼Œå³å¸§æ•°</span>

<span class="comment">% 2. ç”Ÿæˆ Hamming çª—å‡½æ•°ç”¨äºåŠ çª—å¤„ç†</span>
window = <span class="answer">hamming(Lwin)</span>;  <span class="comment">% é•¿åº¦ä¸º Lwin çš„ Hamming çª—å‡½æ•°</span>

<span class="comment">% 3. è®¡ç®—è¾“å‡ºä¿¡å·çš„æ€»é•¿åº¦</span>
outputLength = <span class="answer">(newNumFrames - 1) * Ra + Lwin</span>;  <span class="comment">% æ ¹æ®å…¬å¼è®¡ç®—æ€»é•¿åº¦</span>

<span class="comment">% 4. åˆå§‹åŒ–è¾“å‡ºä¿¡å·ä¸ºå…¨é›¶å‘é‡</span>
outputSignal = <span class="answer">zeros(outputLength, 1)</span>;  <span class="comment">% åˆ›å»ºå…¨é›¶å‘é‡ä»¥å­˜å‚¨ç»“æœ</span>

<span class="comment">% 5. éå†æ¯ä¸€å¸§ï¼Œå¯¹å…¶è¿›è¡Œé€†å˜æ¢å’Œé‡å åŠ å’Œ</span>
for i = 1:newNumFrames
    <span class="comment">% 5.1 æå–ç¬¬ i å¸§çš„é¢‘åŸŸæ•°æ®</span>
    freqData = freq_mat_modified(:, i);  <span class="comment">% æå–ç¬¬ i å¸§æ•°æ®</span>

    <span class="comment">% 5.2 å¯¹ç¬¬ i å¸§è¿›è¡Œé€† FFTï¼Œå¾—åˆ°æ—¶åŸŸä¿¡å·</span>
    frame = <span class="answer">ifft(freqData, 'symmetric')</span>;  <span class="comment">% ä½¿ç”¨ symmetric ä¿è¯å®æ•°è¾“å‡º</span>

    <span class="comment">% 5.3 è®¡ç®—è¯¥å¸§åœ¨è¾“å‡ºä¿¡å·ä¸­çš„èµ·å§‹ä½ç½®</span>
    startIdx = <span class="answer">(i - 1) * Ra</span>;  <span class="comment">% è®¡ç®—å½“å‰å¸§çš„èµ·å§‹ç´¢å¼•</span>

    <span class="comment">% 5.4 ç¡®å®šè¯¥å¸§å¯¹åº”çš„è¾“å‡ºä¿¡å·ç´¢å¼•èŒƒå›´</span>
    indices = <span class="answer">startIdx + (1:Lwin)</span>;  <span class="comment">% è·å–è¯¥å¸§çš„ç´¢å¼•èŒƒå›´</span>

    <span class="comment">% 5.5 æå–è¾“å‡ºä¿¡å·ä¸­å½“å‰ç‰‡æ®µ</span>
    outputSegment = outputSignal(indices);  <span class="comment">% æå–ä¸å½“å‰å¸§å¯¹åº”çš„è¾“å‡ºç‰‡æ®µ</span>

    <span class="comment">% 5.6 å¯¹å½“å‰å¸§è¿›è¡ŒåŠ çª—å¤„ç†</span>
    windowedFrame = <span class="answer">frame .* window</span>;  <span class="comment">% é€å…ƒç´ ä¹˜ä»¥ Hamming çª—å‡½æ•°</span>

    <span class="comment">% 5.7 å°†åŠ çª—åçš„å¸§ä¸è¾“å‡ºç‰‡æ®µç›¸åŠ </span>
    updatedSegment = <span class="answer">outputSegment + windowedFrame</span>;  <span class="comment">% é‡å åŠ å’Œ</span>

    <span class="comment">% 5.8 å°†æ›´æ–°åçš„ç‰‡æ®µå†™å›è¾“å‡ºä¿¡å·</span>
    outputSignal(indices) = <span class="answer">updatedSegment</span>;  <span class="comment">% æ›´æ–°è¾“å‡ºä¿¡å·çš„ç›¸åº”ä½ç½®</span>
end

end</pre>
            </div>
        </div>

        <!-- ex6 ç›¸ä½å£°ç å™¨ -->
        <div class="file-block">
            <div class="file-header" onclick="toggleBlock(this)">
                <span class="file-title">
                    <span class="arrow-icon">â–¼</span>
                    ğŸ“„ ex6_Phase_Vocoder.mï¼ˆç›¸ä½å£°ç å™¨ - è¿›é˜¶ï¼‰
                </span>
                <button class="copy-btn" onclick="copyCode(event, 'code6')">å¤åˆ¶ä»£ç </button>
            </div>
            <div class="file-content">
                <pre id="code6">function [freq_mat_modified] = ex6_Phase_Vocoder(freq_mat, Lwin, Ra, Rs)
<span class="comment">% EX6_PHASE_VOCODER - åŸºäºç›¸ä½å£°ç å™¨æ³•çš„æ—¶é—´å°ºåº¦ä¿®æ”¹å¤„ç†</span>
<span class="comment">%</span>
<span class="comment">% è¯¥å‡½æ•°ç”¨äºåœ¨æ‹‰ä¼¸æˆ–å‹ç¼©éŸ³é¢‘ä¿¡å·æ—¶ï¼Œä¿æŒç›¸é‚»å¸§çš„é¢‘ç‡ä¸€è‡´æ€§ã€‚</span>
<span class="comment">% Phase Vocoder é€šè¿‡é‡æ–°è®¡ç®—é¢‘è°±çš„ç›¸ä½ï¼Œç¡®ä¿æ‹‰ä¼¸åçš„ä¿¡å·ä¿æŒå¬è§‰è¿è´¯æ€§ã€‚</span>
<span class="comment">%</span>
<span class="comment">% è¾“å…¥å‚æ•°ï¼š</span>
<span class="comment">% - freq_mat: STFT é¢‘è°±çŸ©é˜µï¼Œå¤§å°ä¸º [Lwin, numFrames]</span>
<span class="comment">% - Lwin: æ¯å¸§çš„çª—å£é•¿åº¦</span>
<span class="comment">% - Ra: åŸå§‹ä¿¡å·çš„å¸§ç§»</span>
<span class="comment">% - Rs: æ‹‰ä¼¸æˆ–å‹ç¼©åçš„å¸§ç§»</span>
<span class="comment">%</span>
<span class="comment">% è¾“å‡ºå‚æ•°ï¼š</span>
<span class="comment">% - freq_mat_modified: ç»è¿‡ç›¸ä½è°ƒæ•´åçš„é¢‘è°±çŸ©é˜µï¼Œå¤§å°ä¸º [Lwin, numFrames-1]</span>

<span class="comment">%% 1. è·å–è¾“å…¥çŸ©é˜µå°ºå¯¸</span>
[Lwin, numFrames] = <span class="answer">size(freq_mat)</span>;

<span class="comment">%% 2. åˆå§‹åŒ–å˜é‡ - ä½¿ç”¨æ­£ç¡®çš„å‘é‡ç»´åº¦</span>
<span class="comment">% é¢‘ç‡ç´¢å¼•ï¼šè¡¨ç¤ºæ¯ä¸€é¢‘ç‡åˆ†é‡çš„ç´¢å¼•ï¼Œä» 0 åˆ° Lwin-1</span>
k = <span class="answer">(0:Lwin-1)'</span>;

<span class="comment">% æ¯ä¸ªé¢‘ç‡åˆ†é‡çš„ç†è®ºè§’é¢‘ç‡ï¼ˆå¼§åº¦/æ ·æœ¬ï¼‰</span>
Omega = <span class="answer">2 * pi * k / Lwin</span>;

<span class="comment">% ä¸Šä¸€å¸§çš„ç›¸ä½ï¼šåˆå§‹åŒ–ä¸ºç¬¬ä¸€å¸§çš„ç›¸ä½</span>
prev_phase = <span class="answer">angle(freq_mat(:, 1))</span>;

<span class="comment">% è¾“å‡ºä¿¡å·çš„ç´¯è®¡ç›¸ä½ï¼šåˆå§‹åŒ–ä¸ºç¬¬ä¸€å¸§çš„ç›¸ä½</span>
phase_out = <span class="answer">prev_phase</span>;

<span class="comment">%% 3. åˆå§‹åŒ–è¾“å‡ºé¢‘è°±çŸ©é˜µ</span>
<span class="comment">% è¾“å‡ºçŸ©é˜µæ¯”è¾“å…¥å°‘1åˆ—ï¼ˆç¬¬ä¸€å¸§ç”¨äºåˆå§‹åŒ–ï¼Œä»ç¬¬äºŒå¸§å¼€å§‹è®¡ç®—ï¼‰</span>
numOutputFrames = <span class="answer">numFrames - 1</span>;
freq_mat_modified = <span class="answer">zeros(Lwin, numOutputFrames)</span>;

<span class="comment">%% 4. éå†æ¯ä¸€å¸§ï¼Œè®¡ç®—æ–°çš„é¢‘è°±ç›¸ä½</span>
for idx = 2:numFrames
    <span class="comment">%% 4.1 æå–å½“å‰å¸§çš„å¹…åº¦å’Œç›¸ä½</span>
    Amp = <span class="answer">abs(freq_mat(:, idx))</span>;      <span class="comment">% å½“å‰å¸§çš„å¹…åº¦</span>
    Pha = <span class="answer">angle(freq_mat(:, idx))</span>;    <span class="comment">% å½“å‰å¸§çš„ç›¸ä½</span>

    <span class="comment">%% 4.2 è®¡ç®—ç›¸ä½å·®ï¼ˆå»é™¤ç†è®ºçº¿æ€§ç›¸ä½é€’è¿›ï¼‰</span>
    <span class="comment">% ç†è®ºä¸Šï¼Œå¦‚æœé¢‘ç‡ç²¾ç¡®ä¸º Omegaï¼Œåˆ™ç›¸ä½åº”é€’è¿› Omega * Ra</span>
    <span class="comment">% å®é™…ç›¸ä½å·® = æµ‹é‡ç›¸ä½å·® - ç†è®ºç›¸ä½é€’è¿›</span>
    delta_phase = <span class="answer">Pha - prev_phase - Omega * Ra</span>;

    <span class="comment">%% 4.3 å°†ç›¸ä½å·®é™åˆ¶åœ¨ [-pi, pi] èŒƒå›´ï¼ˆç›¸ä½å±•å¼€/å½’ä¸€åŒ–ï¼‰</span>
    <span class="comment">% è¿™ä¸€æ­¥æ˜¯ç›¸ä½å£°ç å™¨çš„å…³é”®ï¼šå¤„ç†ç›¸ä½çš„ 2*pi å‘¨æœŸæ€§</span>
    delta_phase_wrapped = <span class="answer">mod(delta_phase + pi, 2 * pi) - pi</span>;

    <span class="comment">%% 4.4 è®¡ç®—ç¬æ—¶é¢‘ç‡åç§»é‡</span>
    <span class="comment">% é¢‘ç‡åç§» = å½’ä¸€åŒ–ç›¸ä½å·® / å¸§ç§»</span>
    delta_omega = <span class="answer">delta_phase_wrapped / Ra</span>;

    <span class="comment">%% 4.5 è®¡ç®—çœŸå®çš„ç¬æ—¶è§’é¢‘ç‡</span>
    <span class="comment">% çœŸå®é¢‘ç‡ = ç†è®ºé¢‘ç‡ + é¢‘ç‡åç§»</span>
    omega_true = <span class="answer">Omega + delta_omega</span>;

    <span class="comment">%% 4.6 ç´¯ç§¯è¾“å‡ºç›¸ä½ï¼ˆä½¿ç”¨æ–°å¸§ç§» Rsï¼‰</span>
    <span class="comment">% è¿™æ˜¯æ—¶é—´æ‹‰ä¼¸çš„å…³é”®ï¼šä½¿ç”¨ Rs è€Œä¸æ˜¯ Ra æ¥ç´¯ç§¯ç›¸ä½</span>
    phase_out = <span class="answer">phase_out + omega_true * Rs</span>;

    <span class="comment">%% 4.7 ç”Ÿæˆæ–°çš„å¤æ•°é¢‘è°±</span>
    <span class="comment">% ä¿æŒåŸå§‹å¹…åº¦ï¼Œä½¿ç”¨ç´¯ç§¯çš„æ–°ç›¸ä½</span>
    freq_mat_modified(:, idx - 1) = <span class="answer">Amp .* exp(1i * phase_out)</span>;

    <span class="comment">%% 4.8 æ›´æ–°ä¸Šä¸€å¸§ç›¸ä½ï¼Œç”¨äºä¸‹ä¸€æ¬¡è¿­ä»£</span>
    prev_phase = <span class="answer">Pha</span>;
end

end</pre>
            </div>
        </div>

    </div>

    <script>
        function toggleBlock(header) {
            const block = header.parentElement;
            block.classList.toggle('collapsed');
        }

        function expandAll() {
            document.querySelectorAll('.file-block').forEach(block => {
                block.classList.remove('collapsed');
            });
        }

        function collapseAll() {
            document.querySelectorAll('.file-block').forEach(block => {
                block.classList.add('collapsed');
            });
        }

        function copyCode(event, codeId) {
            event.stopPropagation();
            const codeElement = document.getElementById(codeId);
            // åˆ›å»ºä¸´æ—¶å…ƒç´ æ¥è·å–çº¯æ–‡æœ¬ï¼ˆå»é™¤HTMLæ ‡ç­¾ï¼‰
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = codeElement.innerHTML;
            const code = tempDiv.textContent || tempDiv.innerText;
            
            navigator.clipboard.writeText(code).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ“ å·²å¤åˆ¶';
                btn.style.background = '#d4edda';
                btn.style.color = '#155724';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#fff';
                    btn.style.color = btn.parentElement.querySelector('.file-header').style.backgroundColor;
                }, 2000);
            });
        }
    </script>
</body>
</html>